<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.1"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>214532</bug_id>
          
          <creation_ts>2008-01-07 15:02:00 -0500</creation_ts>
          <short_desc>[JFace] Open up the API for org.eclipse.jface.layout.AbstractColumnLayout</short_desc>
          <delta_ts>2009-06-01 09:39:25 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>Platform</product>
          <component>UI</component>
          <version>3.3</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>3.5 M6</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Norris">ryan.norris</reporter>
          <assigned_to name="Thomas Schindl">tom.schindl</assigned_to>
          <cc>b.kolb</cc>
    
    <cc>bokowski</cc>
    
    <cc>gordon.hirsch</cc>
    
    <cc>remysuen</cc>
    
    <cc>tom.schindl</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="5243"
          type_id="1"
          status="+"
          setter="bokowski"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>1126873</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Norris">ryan.norris</who>
    <bug_when>2008-01-07 15:02:25 -0500</bug_when>
    <thetext>Build ID: I20070625-1500

Steps To Reproduce:
1.  Unable to subclass AbstractColumnLayout due to package scope.

More information:
This request is to open up the API on org.eclipse.jface.layout.AbstractColumnLayout.  Currently it and its abstract methods are package scope.  

This layout is useful for any column-based widget users (Table, Tree or others such as Nebula Grid) that want to take advantage of the pixel-based and weight-based ColumnLayoutData objects.

I have been using TableViewer and this layout.  I recently switched to Nebula&apos;s GridTableViewer and lost the layout support.  If AbstractColumnLayout were public, it would be very easy to create a version for the Grid table widget.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1148328</commentid>
    <comment_count>1</comment_count>
    <who name="Thomas Schindl">tom.schindl</who>
    <bug_when>2008-02-03 08:56:42 -0500</bug_when>
    <thetext>*** Bug 217605 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1148413</commentid>
    <comment_count>2</comment_count>
      <attachid>88725</attachid>
    <who name="Thomas Schindl">tom.schindl</who>
    <bug_when>2008-02-03 17:35:53 -0500</bug_when>
    <thetext>Created attachment 88725
Patch</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1148414</commentid>
    <comment_count>3</comment_count>
    <who name="Thomas Schindl">tom.schindl</who>
    <bug_when>2008-02-03 17:36:42 -0500</bug_when>
    <thetext>Boris, could you review please.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1160625</commentid>
    <comment_count>4</comment_count>
    <who name="Thomas Schindl">tom.schindl</who>
    <bug_when>2008-02-20 14:34:49 -0500</bug_when>
    <thetext>The class @since of the class has to be @since 3.4</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1160721</commentid>
    <comment_count>5</comment_count>
    <who name="Thomas Schindl">tom.schindl</who>
    <bug_when>2008-02-20 15:55:13 -0500</bug_when>
    <thetext>released to CVS HEAD &gt;= 20080220</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1186014</commentid>
    <comment_count>6</comment_count>
    <who name="Thomas Schindl">tom.schindl</who>
    <bug_when>2008-03-27 09:23:59 -0400</bug_when>
    <thetext>Verified in build I20080326-1950</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1253348</commentid>
    <comment_count>7</comment_count>
    <who name="Gordon Hirsch">gordon.hirsch</who>
    <bug_when>2008-05-29 16:34:16 -0400</bug_when>
    <thetext>Unfortunately, the abstract methods in this class are package private, so there is no practical way to extend this class from a package outside of org.eclipse.jface.layout. Reopening. 

I&apos;ll attach a patch, but I suspect you won&apos;t want to make this change in 3.4, especially since there are changes in multiple files to react to the change from package-private to protected. </thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1253352</commentid>
    <comment_count>8</comment_count>
      <attachid>102746</attachid>
    <who name="Gordon Hirsch">gordon.hirsch</who>
    <bug_when>2008-05-29 16:35:14 -0400</bug_when>
    <thetext>Created attachment 102746
patch to make abstract methods protected</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1433020</commentid>
    <comment_count>9</comment_count>
    <who name="Thomas Schindl">tom.schindl</who>
    <bug_when>2009-02-18 18:18:20 -0500</bug_when>
    <thetext>released to head &gt;= 20090219</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1433034</commentid>
    <comment_count>10</comment_count>
    <who name="Remy Suen">remysuen</who>
    <bug_when>2009-02-18 18:53:10 -0500</bug_when>
    <thetext>(In reply to comment #9)
&gt; released to head &gt;= 20090219

Tom, I&apos;m getting several API tooling errors because the methods&apos; visibility went up to &quot;protected&quot;. Please rectify them with @since tags.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1433057</commentid>
    <comment_count>11</comment_count>
      <attachid>102746</attachid>
    <who name="Boris Bokowski">bokowski</who>
    <bug_when>2009-02-18 19:52:16 -0500</bug_when>
    <thetext>Comment on attachment 102746
patch to make abstract methods protected

The iplog+ flag needs to be applied to the patch, not the whole bug to be processed correctly.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1451663</commentid>
    <comment_count>12</comment_count>
    <who name="Thomas Schindl">tom.schindl</who>
    <bug_when>2009-03-13 04:43:55 -0400</bug_when>
    <thetext>Verified in I20090312-0100 by providing a nebula implementation in bug 268497 </thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1515307</commentid>
    <comment_count>13</comment_count>
    <who name="John Arthorne">john_arthorne</who>
    <bug_when>2009-06-01 09:39:25 -0400</bug_when>
    <thetext>Removing iplog+ from bug - this indicates an IP contribution in a comment
rather than a patch.

http://wiki.eclipse.org/Development_Resources/Automatic_IP_Log</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>88725</attachid>
            <date>2008-02-03 17:35:00 -0500</date>
            <delta_ts>2008-02-03 17:35:53 -0500</delta_ts>
            <desc>Patch</desc>
            <filename>patch.txt</filename>
            <type>text/plain</type>
            <size>3860</size>
            <attacher name="Thomas Schindl">tom.schindl</attacher>
            
              <data encoding="base64">IyMjIEVjbGlwc2UgV29ya3NwYWNlIFBhdGNoIDEuMAojUCBvcmcuZWNsaXBzZS5qZmFjZQpJbmRl
eDogc3JjL29yZy9lY2xpcHNlL2pmYWNlL2xheW91dC9BYnN0cmFjdENvbHVtbkxheW91dC5qYXZh
Cj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT0KUkNTIGZpbGU6IC9jdnNyb290L2VjbGlwc2Uvb3JnLmVjbGlwc2UuamZhY2Uv
c3JjL29yZy9lY2xpcHNlL2pmYWNlL2xheW91dC9BYnN0cmFjdENvbHVtbkxheW91dC5qYXZhLHYK
cmV0cmlldmluZyByZXZpc2lvbiAxLjkKZGlmZiAtdSAtcjEuOSBBYnN0cmFjdENvbHVtbkxheW91
dC5qYXZhCi0tLSBzcmMvb3JnL2VjbGlwc2UvamZhY2UvbGF5b3V0L0Fic3RyYWN0Q29sdW1uTGF5
b3V0LmphdmEJMTggSmFuIDIwMDggMjE6NTY6NDggLTAwMDAJMS45CisrKyBzcmMvb3JnL2VjbGlw
c2UvamZhY2UvbGF5b3V0L0Fic3RyYWN0Q29sdW1uTGF5b3V0LmphdmEJMyBGZWIgMjAwOCAyMjoz
NToyMyAtMDAwMApAQCAtMTMsNyArMTMsNiBAQAogICoqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiBw
YWNrYWdlIG9yZy5lY2xpcHNlLmpmYWNlLmxheW91dDsKIAotCiBpbXBvcnQgb3JnLmVjbGlwc2Uu
Y29yZS5ydW50aW1lLkFzc2VydDsKIGltcG9ydCBvcmcuZWNsaXBzZS5qZmFjZS51dGlsLlBvbGlj
eTsKIGltcG9ydCBvcmcuZWNsaXBzZS5qZmFjZS52aWV3ZXJzLkNvbHVtbkxheW91dERhdGE7CkBA
IC0zNSwyMCArMzQsMTQgQEAKICAqIGluIGEgY29uc2lzdGVudCB3YXkgZXZlbiBkdXJpbmcgYSBy
ZXNpemUgdW5saWtlIGEge0BsaW5rIFRhYmxlTGF5b3V0fSB3aGljaAogICogb25seSBzZXRzIGlu
aXRpYWwgc2l6ZXMuCiAgKgotICogPHA+PGI+WW91IGNhbiBvbmx5IGFkZCB0aGUgbGF5b3V0IHRv
IGEgY29udGFpbmVyIHdob3NlCi0gKiBvbmx5IGNoaWxkIGlzIHRoZSB0YWJsZS90cmVlIGNvbnRy
b2wgeW91IHdhbnQgdGhlIGxheW91dHMgYXBwbGllZCB0by48L2I+CisgKiA8cD4KKyAqIDxiPllv
dSBjYW4gb25seSBhZGQgdGhlIGxheW91dCB0byBhIGNvbnRhaW5lciB3aG9zZSBvbmx5IGNoaWxk
IGlzIHRoZQorICogdGFibGUvdHJlZSBjb250cm9sIHlvdSB3YW50IHRoZSBsYXlvdXRzIGFwcGxp
ZWQgdG8uPC9iPgogICogPC9wPgogICoKICAqIEBzaW5jZSAzLjMKICAqLwotYWJzdHJhY3QgY2xh
c3MgQWJzdHJhY3RDb2x1bW5MYXlvdXQgZXh0ZW5kcyBMYXlvdXQgewotCS8qKgotCSAqIFRoZSBu
dW1iZXIgb2YgZXh0cmEgcGl4ZWxzIHRha2VuIGFzIGhvcml6b250YWwgdHJpbSBieSB0aGUgdGFi
bGUgY29sdW1uLgotCSAqIFRvIGVuc3VyZSB0aGVyZSBhcmUgTiBwaXhlbHMgYXZhaWxhYmxlIGZv
ciB0aGUgY29udGVudCBvZiB0aGUgY29sdW1uLAotCSAqIGFzc2lnbiBOK0NPTFVNTl9UUklNIGZv
ciB0aGUgY29sdW1uIHdpZHRoLgotCSAqCi0JICogQHNpbmNlIDMuMQotCSAqLworcHVibGljIGFi
c3RyYWN0IGNsYXNzIEFic3RyYWN0Q29sdW1uTGF5b3V0IGV4dGVuZHMgTGF5b3V0IHsKIAlwcml2
YXRlIHN0YXRpYyBpbnQgQ09MVU1OX1RSSU07CiAJc3RhdGljIHsKIAkJaWYgKCJ3aW4zMiIuZXF1
YWxzKFNXVC5nZXRQbGF0Zm9ybSgpKSkgeyAvLyROT04tTkxTLTEkCkBAIC02MCw3ICs1Myw2IEBA
CiAJCX0KIAl9CiAKLQogCXN0YXRpYyBmaW5hbCBib29sZWFuIElTX0dUSyA9ICJndGsiLmVxdWFs
cyhTV1QuZ2V0UGxhdGZvcm0oKSk7Ly8kTk9OLU5MUy0xJAogCiAJc3RhdGljIGZpbmFsIFN0cmlu
ZyBMQVlPVVRfREFUQSA9IFBvbGljeS5KRkFDRSArICIuTEFZT1VUX0RBVEEiOyAvLyROT04tTkxT
LTEkCkBAIC03Miw3ICs2NCw3IEBACiAJcHJpdmF0ZSBMaXN0ZW5lciByZXNpemVMaXN0ZW5lciA9
IG5ldyBMaXN0ZW5lcigpIHsKIAogCQlwdWJsaWMgdm9pZCBoYW5kbGVFdmVudChFdmVudCBldmVu
dCkgewotCQkJaWYoICEgaW51cGRhdGVNb2RlICkgeworCQkJaWYgKCFpbnVwZGF0ZU1vZGUpIHsK
IAkJCQl1cGRhdGVDb2x1bW5EYXRhKGV2ZW50LndpZGdldCk7CiAJCQl9CiAJCX0KQEAgLTkwLDcg
KzgyLDcgQEAKIAkgKi8KIAlwdWJsaWMgdm9pZCBzZXRDb2x1bW5EYXRhKFdpZGdldCBjb2x1bW4s
IENvbHVtbkxheW91dERhdGEgZGF0YSkgewogCi0JCWlmKCBjb2x1bW4uZ2V0RGF0YShMQVlPVVRf
REFUQSkgPT0gbnVsbCApIHsKKwkJaWYgKGNvbHVtbi5nZXREYXRhKExBWU9VVF9EQVRBKSA9PSBu
dWxsKSB7CiAJCQljb2x1bW4uYWRkTGlzdGVuZXIoU1dULlJlc2l6ZSwgcmVzaXplTGlzdGVuZXIp
OwogCQl9CiAKQEAgLTExNiwxMiArMTA4LDEyIEBACiAJCWludCB3aWR0aCA9IDA7CiAJCWludCBz
aXplID0gZ2V0Q29sdW1uQ291bnQoc2Nyb2xsYWJsZSk7CiAJCWZvciAoaW50IGkgPSAwOyBpIDwg
c2l6ZTsgKytpKSB7Ci0JCQlDb2x1bW5MYXlvdXREYXRhIGxheW91dERhdGEgPSBnZXRMYXlvdXRE
YXRhKHNjcm9sbGFibGUsaSk7CisJCQlDb2x1bW5MYXlvdXREYXRhIGxheW91dERhdGEgPSBnZXRM
YXlvdXREYXRhKHNjcm9sbGFibGUsIGkpOwogCQkJaWYgKGxheW91dERhdGEgaW5zdGFuY2VvZiBD
b2x1bW5QaXhlbERhdGEpIHsKIAkJCQlDb2x1bW5QaXhlbERhdGEgY29sID0gKENvbHVtblBpeGVs
RGF0YSkgbGF5b3V0RGF0YTsKIAkJCQl3aWR0aCArPSBjb2wud2lkdGg7CiAJCQkJaWYgKGNvbC5h
ZGRUcmltKSB7Ci0JCQkJCXdpZHRoICs9IENPTFVNTl9UUklNOworCQkJCQl3aWR0aCArPSBnZXRD
b2x1bW5UcmltKCk7CiAJCQkJfQogCQkJfSBlbHNlIGlmIChsYXlvdXREYXRhIGluc3RhbmNlb2Yg
Q29sdW1uV2VpZ2h0RGF0YSkgewogCQkJCUNvbHVtbldlaWdodERhdGEgY29sID0gKENvbHVtbldl
aWdodERhdGEpIGxheW91dERhdGE7CkBAIC0xNjMsNyArMTU1LDcgQEAKIAkJCQlDb2x1bW5QaXhl
bERhdGEgY3BkID0gKENvbHVtblBpeGVsRGF0YSkgY29sOwogCQkJCWludCBwaXhlbHMgPSBjcGQu
d2lkdGg7CiAJCQkJaWYgKGNwZC5hZGRUcmltKSB7Ci0JCQkJCXBpeGVscyArPSBDT0xVTU5fVFJJ
TTsKKwkJCQkJcGl4ZWxzICs9IGdldENvbHVtblRyaW0oKTsKIAkJCQl9CiAJCQkJd2lkdGhzW2ld
ID0gcGl4ZWxzOwogCQkJCWZpeGVkV2lkdGggKz0gcGl4ZWxzOwpAQCAtMzA0LDcgKzI5NiwyMCBA
QAogCSAqLwogCWFic3RyYWN0IHZvaWQgc2V0Q29sdW1uV2lkdGhzKFNjcm9sbGFibGUgdGFibGVU
cmVlLCBpbnRbXSB3aWR0aHMpOwogCi0JYWJzdHJhY3QgQ29sdW1uTGF5b3V0RGF0YSBnZXRMYXlv
dXREYXRhKFNjcm9sbGFibGUgdGFibGVUcmVlLCBpbnQgY29sdW1uSW5kZXgpOworCWFic3RyYWN0
IENvbHVtbkxheW91dERhdGEgZ2V0TGF5b3V0RGF0YShTY3JvbGxhYmxlIHRhYmxlVHJlZSwKKwkJ
CWludCBjb2x1bW5JbmRleCk7CiAKIAlhYnN0cmFjdCB2b2lkIHVwZGF0ZUNvbHVtbkRhdGEoV2lk
Z2V0IGNvbHVtbik7CisKKwkvKioKKwkgKiBUaGUgbnVtYmVyIG9mIGV4dHJhIHBpeGVscyB0YWtl
biBhcyBob3Jpem9udGFsIHRyaW0gYnkgdGhlIHRhYmxlIGNvbHVtbi4KKwkgKiBUbyBlbnN1cmUg
dGhlcmUgYXJlIE4gcGl4ZWxzIGF2YWlsYWJsZSBmb3IgdGhlIGNvbnRlbnQgb2YgdGhlIGNvbHVt
biwKKwkgKiBhc3NpZ24gTitDT0xVTU5fVFJJTSBmb3IgdGhlIGNvbHVtbiB3aWR0aC4KKwkgKgor
CSAqIEByZXR1cm4gdGhlIHRyaW0gdXNlZCBieSB0aGUgY29sdW1ucworCSAqIEBzaW5jZSAzLjQK
KwkgKi8KKwlwcm90ZWN0ZWQgaW50IGdldENvbHVtblRyaW0oKSB7CisJCXJldHVybiBDT0xVTU5f
VFJJTTsKKwl9CiB9ClwgTm8gbmV3bGluZSBhdCBlbmQgb2YgZmlsZQo=
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>102746</attachid>
            <date>2008-05-29 16:35:00 -0400</date>
            <delta_ts>2009-02-18 19:52:16 -0500</delta_ts>
            <desc>patch to make abstract methods protected</desc>
            <filename>layout.txt</filename>
            <type>text/plain</type>
            <size>20699</size>
            <attacher name="Gordon Hirsch">gordon.hirsch</attacher>
            
              <data encoding="base64">IyMjIEVjbGlwc2UgV29ya3NwYWNlIFBhdGNoIDEuMAojUCBvcmcuZWNsaXBzZS5qZmFjZQpJbmRl
eDogc3JjL29yZy9lY2xpcHNlL2pmYWNlL2xheW91dC9UYWJsZUNvbHVtbkxheW91dC5qYXZhCj09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT0KUkNTIGZpbGU6IC9jdnNyb290L2VjbGlwc2Uvb3JnLmVjbGlwc2UuamZhY2Uvc3Jj
L29yZy9lY2xpcHNlL2pmYWNlL2xheW91dC9UYWJsZUNvbHVtbkxheW91dC5qYXZhLHYKcmV0cmll
dmluZyByZXZpc2lvbiAxLjQKZGlmZiAtdSAtcjEuNCBUYWJsZUNvbHVtbkxheW91dC5qYXZhCi0t
LSBzcmMvb3JnL2VjbGlwc2UvamZhY2UvbGF5b3V0L1RhYmxlQ29sdW1uTGF5b3V0LmphdmEJMTIg
QXByIDIwMDcgMTg6MDg6NTYgLTAwMDAJMS40CisrKyBzcmMvb3JnL2VjbGlwc2UvamZhY2UvbGF5
b3V0L1RhYmxlQ29sdW1uTGF5b3V0LmphdmEJMjkgTWF5IDIwMDggMjA6MzE6NTQgLTAwMDAKQEAg
LTQxLDcgKzQxLDcgQEAKIAkgKiAKIAkgKiBAc2VlIG9yZy5lY2xpcHNlLmpmYWNlLmxheW91dC5B
YnN0cmFjdENvbHVtbkxheW91dCNnZXRDb2x1bW5Db3VudChvcmcuZWNsaXBzZS5zd3Qud2lkZ2V0
cy5TY3JvbGxhYmxlKQogCSAqLwotCWludCBnZXRDb2x1bW5Db3VudChTY3JvbGxhYmxlIHRhYmxl
VHJlZSkgeworCXByb3RlY3RlZCBpbnQgZ2V0Q29sdW1uQ291bnQoU2Nyb2xsYWJsZSB0YWJsZVRy
ZWUpIHsKIAkJcmV0dXJuICgoVGFibGUpIHRhYmxlVHJlZSkuZ2V0Q29sdW1uQ291bnQoKTsKIAl9
CiAKQEAgLTUxLDcgKzUxLDcgQEAKIAkgKiBAc2VlIG9yZy5lY2xpcHNlLmpmYWNlLmxheW91dC5B
YnN0cmFjdENvbHVtbkxheW91dCNzZXRDb2x1bW5XaWR0aHMob3JnLmVjbGlwc2Uuc3d0LndpZGdl
dHMuU2Nyb2xsYWJsZSwKIAkgKiAgICAgIGludFtdKQogCSAqLwotCXZvaWQgc2V0Q29sdW1uV2lk
dGhzKFNjcm9sbGFibGUgdGFibGVUcmVlLCBpbnRbXSB3aWR0aHMpIHsKKwlwcm90ZWN0ZWQgdm9p
ZCBzZXRDb2x1bW5XaWR0aHMoU2Nyb2xsYWJsZSB0YWJsZVRyZWUsIGludFtdIHdpZHRocykgewog
CQlUYWJsZUNvbHVtbltdIGNvbHVtbnMgPSAoKFRhYmxlKSB0YWJsZVRyZWUpLmdldENvbHVtbnMo
KTsKIAkJZm9yIChpbnQgaSA9IDA7IGkgPCB3aWR0aHMubGVuZ3RoOyBpKyspIHsKIAkJCWNvbHVt
bnNbaV0uc2V0V2lkdGgod2lkdGhzW2ldKTsKQEAgLTYzLDcgKzYzLDcgQEAKIAkgKiAKIAkgKiBA
c2VlIG9yZy5lY2xpcHNlLmpmYWNlLmxheW91dC5BYnN0cmFjdENvbHVtbkxheW91dCNnZXRMYXlv
dXREYXRhKGludCkKIAkgKi8KLQlDb2x1bW5MYXlvdXREYXRhIGdldExheW91dERhdGEoU2Nyb2xs
YWJsZSB0YWJsZVRyZWUsIGludCBjb2x1bW5JbmRleCkgeworCXByb3RlY3RlZCBDb2x1bW5MYXlv
dXREYXRhIGdldExheW91dERhdGEoU2Nyb2xsYWJsZSB0YWJsZVRyZWUsIGludCBjb2x1bW5JbmRl
eCkgewogCQlUYWJsZUNvbHVtbiBjb2x1bW4gPSAoKFRhYmxlKSB0YWJsZVRyZWUpLmdldENvbHVt
bihjb2x1bW5JbmRleCk7CiAJCXJldHVybiAoQ29sdW1uTGF5b3V0RGF0YSkgY29sdW1uLmdldERh
dGEoTEFZT1VUX0RBVEEpOwogCX0KQEAgLTc1LDcgKzc1LDcgQEAKIAkvKiAobm9uLUphdmFkb2Mp
CiAJICogQHNlZSBvcmcuZWNsaXBzZS5qZmFjZS5sYXlvdXQuQWJzdHJhY3RDb2x1bW5MYXlvdXQj
dXBkYXRlQ29sdW1uRGF0YShvcmcuZWNsaXBzZS5zd3Qud2lkZ2V0cy5XaWRnZXQpCiAJICovCi0J
dm9pZCB1cGRhdGVDb2x1bW5EYXRhKFdpZGdldCBjb2x1bW4pIHsKKwlwcm90ZWN0ZWQgdm9pZCB1
cGRhdGVDb2x1bW5EYXRhKFdpZGdldCBjb2x1bW4pIHsKIAkJVGFibGVDb2x1bW4gdENvbHVtbiA9
IChUYWJsZUNvbHVtbikgY29sdW1uOwogCQlUYWJsZSB0ID0gdENvbHVtbi5nZXRQYXJlbnQoKTsK
IAkJCkluZGV4OiBzcmMvb3JnL2VjbGlwc2UvamZhY2UvbGF5b3V0L1RyZWVDb2x1bW5MYXlvdXQu
amF2YQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvY3Zzcm9vdC9lY2xpcHNlL29yZy5lY2xpcHNlLmpm
YWNlL3NyYy9vcmcvZWNsaXBzZS9qZmFjZS9sYXlvdXQvVHJlZUNvbHVtbkxheW91dC5qYXZhLHYK
cmV0cmlldmluZyByZXZpc2lvbiAxLjcKZGlmZiAtdSAtcjEuNyBUcmVlQ29sdW1uTGF5b3V0Lmph
dmEKLS0tIHNyYy9vcmcvZWNsaXBzZS9qZmFjZS9sYXlvdXQvVHJlZUNvbHVtbkxheW91dC5qYXZh
CTI4IEFwciAyMDA3IDE4OjMyOjMzIC0wMDAwCTEuNworKysgc3JjL29yZy9lY2xpcHNlL2pmYWNl
L2xheW91dC9UcmVlQ29sdW1uTGF5b3V0LmphdmEJMjkgTWF5IDIwMDggMjA6MzE6NTQgLTAwMDAK
QEAgLTc2LDE0ICs3NiwxNCBAQAogCS8qIChub24tSmF2YWRvYykKIAkgKiBAc2VlIG9yZy5lY2xp
cHNlLmpmYWNlLmxheW91dC5BYnN0cmFjdENvbHVtbkxheW91dCNnZXRDb2x1bW5Db3VudChvcmcu
ZWNsaXBzZS5zd3Qud2lkZ2V0cy5TY3JvbGxhYmxlKQogCSAqLwotCWludCBnZXRDb2x1bW5Db3Vu
dChTY3JvbGxhYmxlIHRyZWUpIHsKKwlwcm90ZWN0ZWQgaW50IGdldENvbHVtbkNvdW50KFNjcm9s
bGFibGUgdHJlZSkgewogCQlyZXR1cm4gKChUcmVlKSB0cmVlKS5nZXRDb2x1bW5Db3VudCgpOwog
CX0KIAogCS8qIChub24tSmF2YWRvYykKIAkgKiBAc2VlIG9yZy5lY2xpcHNlLmpmYWNlLmxheW91
dC5BYnN0cmFjdENvbHVtbkxheW91dCNzZXRDb2x1bW5XaWR0aHMob3JnLmVjbGlwc2Uuc3d0Lndp
ZGdldHMuU2Nyb2xsYWJsZSwgaW50W10pCiAJICovCi0Jdm9pZCBzZXRDb2x1bW5XaWR0aHMoU2Ny
b2xsYWJsZSB0cmVlLCBpbnRbXSB3aWR0aHMpIHsKKwlwcm90ZWN0ZWQgdm9pZCBzZXRDb2x1bW5X
aWR0aHMoU2Nyb2xsYWJsZSB0cmVlLCBpbnRbXSB3aWR0aHMpIHsKIAkJVHJlZUNvbHVtbltdIGNv
bHVtbnMgPSAoKFRyZWUpIHRyZWUpLmdldENvbHVtbnMoKTsKIAkJZm9yIChpbnQgaSA9IDA7IGkg
PCB3aWR0aHMubGVuZ3RoOyBpKyspIHsKIAkJCWNvbHVtbnNbaV0uc2V0V2lkdGgod2lkdGhzW2ld
KTsKQEAgLTkzLDEyICs5MywxMiBAQAogCS8qIChub24tSmF2YWRvYykKIAkgKiBAc2VlIG9yZy5l
Y2xpcHNlLmpmYWNlLmxheW91dC5BYnN0cmFjdENvbHVtbkxheW91dCNnZXRMYXlvdXREYXRhKG9y
Zy5lY2xpcHNlLnN3dC53aWRnZXRzLlNjcm9sbGFibGUsIGludCkKIAkgKi8KLQlDb2x1bW5MYXlv
dXREYXRhIGdldExheW91dERhdGEoU2Nyb2xsYWJsZSB0YWJsZVRyZWUsIGludCBjb2x1bW5JbmRl
eCkgeworCXByb3RlY3RlZCBDb2x1bW5MYXlvdXREYXRhIGdldExheW91dERhdGEoU2Nyb2xsYWJs
ZSB0YWJsZVRyZWUsIGludCBjb2x1bW5JbmRleCkgewogCQlUcmVlQ29sdW1uIGNvbHVtbiA9ICgo
VHJlZSkgdGFibGVUcmVlKS5nZXRDb2x1bW4oY29sdW1uSW5kZXgpOwogCQlyZXR1cm4gKENvbHVt
bkxheW91dERhdGEpIGNvbHVtbi5nZXREYXRhKExBWU9VVF9EQVRBKTsKIAl9CiAJCi0Jdm9pZCB1
cGRhdGVDb2x1bW5EYXRhKFdpZGdldCBjb2x1bW4pIHsKKwlwcm90ZWN0ZWQgdm9pZCB1cGRhdGVD
b2x1bW5EYXRhKFdpZGdldCBjb2x1bW4pIHsKIAkJVHJlZUNvbHVtbiB0Q29sdW1uID0gKFRyZWVD
b2x1bW4pIGNvbHVtbjsKIAkJVHJlZSB0ID0gdENvbHVtbi5nZXRQYXJlbnQoKTsKIAkJCkluZGV4
OiBzcmMvb3JnL2VjbGlwc2UvamZhY2UvbGF5b3V0L0Fic3RyYWN0Q29sdW1uTGF5b3V0LmphdmEK
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PQpSQ1MgZmlsZTogL2N2c3Jvb3QvZWNsaXBzZS9vcmcuZWNsaXBzZS5qZmFjZS9z
cmMvb3JnL2VjbGlwc2UvamZhY2UvbGF5b3V0L0Fic3RyYWN0Q29sdW1uTGF5b3V0LmphdmEsdgpy
ZXRyaWV2aW5nIHJldmlzaW9uIDEuMTEKZGlmZiAtdSAtcjEuMTEgQWJzdHJhY3RDb2x1bW5MYXlv
dXQuamF2YQotLS0gc3JjL29yZy9lY2xpcHNlL2pmYWNlL2xheW91dC9BYnN0cmFjdENvbHVtbkxh
eW91dC5qYXZhCTI0IE1hciAyMDA4IDE5OjIxOjUyIC0wMDAwCTEuMTEKKysrIHNyYy9vcmcvZWNs
aXBzZS9qZmFjZS9sYXlvdXQvQWJzdHJhY3RDb2x1bW5MYXlvdXQuamF2YQkyOSBNYXkgMjAwOCAy
MDozMTo1NCAtMDAwMApAQCAtNDIsMjc0ICs0MiwyNzQgQEAKICAqIEBzaW5jZSAzLjQKICAqLwog
cHVibGljIGFic3RyYWN0IGNsYXNzIEFic3RyYWN0Q29sdW1uTGF5b3V0IGV4dGVuZHMgTGF5b3V0
IHsKLQlwcml2YXRlIHN0YXRpYyBpbnQgQ09MVU1OX1RSSU07Ci0Jc3RhdGljIHsKLQkJaWYgKCJ3
aW4zMiIuZXF1YWxzKFNXVC5nZXRQbGF0Zm9ybSgpKSkgeyAvLyROT04tTkxTLTEkCi0JCQlDT0xV
TU5fVFJJTSA9IDQ7Ci0JCX0gZWxzZSBpZiAoImNhcmJvbiIuZXF1YWxzKFNXVC5nZXRQbGF0Zm9y
bSgpKSkgeyAvLyROT04tTkxTLTEkCi0JCQlDT0xVTU5fVFJJTSA9IDI0OwotCQl9IGVsc2Ugewot
CQkJQ09MVU1OX1RSSU0gPSAzOwotCQl9Ci0JfQotCi0Jc3RhdGljIGZpbmFsIGJvb2xlYW4gSVNf
R1RLID0gImd0ayIuZXF1YWxzKFNXVC5nZXRQbGF0Zm9ybSgpKTsvLyROT04tTkxTLTEkCi0KLQlz
dGF0aWMgZmluYWwgU3RyaW5nIExBWU9VVF9EQVRBID0gUG9saWN5LkpGQUNFICsgIi5MQVlPVVRf
REFUQSI7IC8vJE5PTi1OTFMtMSQKLQotCXByaXZhdGUgYm9vbGVhbiBpbnVwZGF0ZU1vZGUgPSBm
YWxzZTsKLQotCXByaXZhdGUgYm9vbGVhbiByZWxheW91dCA9IHRydWU7Ci0KLQlwcml2YXRlIExp
c3RlbmVyIHJlc2l6ZUxpc3RlbmVyID0gbmV3IExpc3RlbmVyKCkgewotCi0JCXB1YmxpYyB2b2lk
IGhhbmRsZUV2ZW50KEV2ZW50IGV2ZW50KSB7Ci0JCQlpZiAoIWludXBkYXRlTW9kZSkgewotCQkJ
CXVwZGF0ZUNvbHVtbkRhdGEoZXZlbnQud2lkZ2V0KTsKLQkJCX0KLQkJfQotCi0JfTsKLQotCS8q
KgotCSAqIEFkZHMgYSBuZXcgY29sdW1uIG9mIGRhdGEgdG8gdGhpcyB0YWJsZSBsYXlvdXQuCi0J
ICoKLQkgKiBAcGFyYW0gY29sdW1uCi0JICogICAgICAgICAgICB0aGUgY29sdW1uCi0JICoKLQkg
KiBAcGFyYW0gZGF0YQotCSAqICAgICAgICAgICAgdGhlIGNvbHVtbiBsYXlvdXQgZGF0YQotCSAq
LwotCXB1YmxpYyB2b2lkIHNldENvbHVtbkRhdGEoV2lkZ2V0IGNvbHVtbiwgQ29sdW1uTGF5b3V0
RGF0YSBkYXRhKSB7Ci0KLQkJaWYgKGNvbHVtbi5nZXREYXRhKExBWU9VVF9EQVRBKSA9PSBudWxs
KSB7Ci0JCQljb2x1bW4uYWRkTGlzdGVuZXIoU1dULlJlc2l6ZSwgcmVzaXplTGlzdGVuZXIpOwot
CQl9Ci0KLQkJY29sdW1uLnNldERhdGEoTEFZT1VUX0RBVEEsIGRhdGEpOwotCX0KLQotCS8qKgot
CSAqIENvbXB1dGUgdGhlIHNpemUgb2YgdGhlIHRhYmxlIG9yIHRyZWUgYmFzZWQgb24gdGhlIENv
bHVtbkxheW91dERhdGEgYW5kCi0JICogdGhlIHdpZHRoIGFuZCBoZWlnaHQgaGludC4KLQkgKgot
CSAqIEBwYXJhbSBzY3JvbGxhYmxlCi0JICogICAgICAgICAgICB0aGUgd2lkZ2V0IHRvIGNvbXB1
dGUKLQkgKiBAcGFyYW0gd0hpbnQKLQkgKiAgICAgICAgICAgIHRoZSB3aWR0aCBoaW50Ci0JICog
QHBhcmFtIGhIaW50Ci0JICogICAgICAgICAgICB0aGUgaGVpZ2h0IGhpbnQKLQkgKiBAcmV0dXJu
IFBvaW50IHdoZXJlIHggaXMgdGhlIHdpZHRoIGFuZCB5IGlzIHRoZSBoZWlnaHQKLQkgKi8KLQlw
cml2YXRlIFBvaW50IGNvbXB1dGVUYWJsZVRyZWVTaXplKFNjcm9sbGFibGUgc2Nyb2xsYWJsZSwg
aW50IHdIaW50LAotCQkJaW50IGhIaW50KSB7Ci0JCVBvaW50IHJlc3VsdCA9IHNjcm9sbGFibGUu
Y29tcHV0ZVNpemUod0hpbnQsIGhIaW50KTsKLQotCQlpbnQgd2lkdGggPSAwOwotCQlpbnQgc2l6
ZSA9IGdldENvbHVtbkNvdW50KHNjcm9sbGFibGUpOwotCQlmb3IgKGludCBpID0gMDsgaSA8IHNp
emU7ICsraSkgewotCQkJQ29sdW1uTGF5b3V0RGF0YSBsYXlvdXREYXRhID0gZ2V0TGF5b3V0RGF0
YShzY3JvbGxhYmxlLCBpKTsKLQkJCWlmIChsYXlvdXREYXRhIGluc3RhbmNlb2YgQ29sdW1uUGl4
ZWxEYXRhKSB7Ci0JCQkJQ29sdW1uUGl4ZWxEYXRhIGNvbCA9IChDb2x1bW5QaXhlbERhdGEpIGxh
eW91dERhdGE7Ci0JCQkJd2lkdGggKz0gY29sLndpZHRoOwotCQkJCWlmIChjb2wuYWRkVHJpbSkg
ewotCQkJCQl3aWR0aCArPSBnZXRDb2x1bW5UcmltKCk7Ci0JCQkJfQotCQkJfSBlbHNlIGlmIChs
YXlvdXREYXRhIGluc3RhbmNlb2YgQ29sdW1uV2VpZ2h0RGF0YSkgewotCQkJCUNvbHVtbldlaWdo
dERhdGEgY29sID0gKENvbHVtbldlaWdodERhdGEpIGxheW91dERhdGE7Ci0JCQkJd2lkdGggKz0g
Y29sLm1pbmltdW1XaWR0aDsKLQkJCX0gZWxzZSB7Ci0JCQkJQXNzZXJ0LmlzVHJ1ZShmYWxzZSwg
IlVua25vd24gY29sdW1uIGxheW91dCBkYXRhIik7IC8vJE5PTi1OTFMtMSQKLQkJCX0KLQkJfQot
CQlpZiAod2lkdGggPiByZXN1bHQueCkKLQkJCXJlc3VsdC54ID0gd2lkdGg7Ci0KLQkJcmV0dXJu
IHJlc3VsdDsKLQl9Ci0KLQkvKioKLQkgKiBMYXlvdXQgdGhlIHNjcm9sbGFibGUgYmFzZWQgb24g
dGhlIHN1cHBsaWVkIHdpZHRoIGFuZCBhcmVhLiBPbmx5IGluY3JlYXNlCi0JICogdGhlIHNpemUg
b2YgdGhlIHNjcm9sbGFibGUgaWYgaW5jcmVhc2UgaXMgPGNvZGU+dHJ1ZTwvY29kZT4uCi0JICoK
LQkgKiBAcGFyYW0gc2Nyb2xsYWJsZQotCSAqIEBwYXJhbSB3aWR0aAotCSAqIEBwYXJhbSBhcmVh
Ci0JICogQHBhcmFtIGluY3JlYXNlCi0JICovCi0JcHJpdmF0ZSB2b2lkIGxheW91dFRhYmxlVHJl
ZShmaW5hbCBTY3JvbGxhYmxlIHNjcm9sbGFibGUsIGZpbmFsIGludCB3aWR0aCwKLQkJCWZpbmFs
IFJlY3RhbmdsZSBhcmVhLCBmaW5hbCBib29sZWFuIGluY3JlYXNlKSB7Ci0JCWZpbmFsIGludCBu
dW1iZXJPZkNvbHVtbnMgPSBnZXRDb2x1bW5Db3VudChzY3JvbGxhYmxlKTsKLQkJZmluYWwgaW50
W10gd2lkdGhzID0gbmV3IGludFtudW1iZXJPZkNvbHVtbnNdOwotCi0JCWZpbmFsIGludFtdIHdl
aWdodENvbHVtbkluZGljZXMgPSBuZXcgaW50W251bWJlck9mQ29sdW1uc107Ci0JCWludCBudW1i
ZXJPZldlaWdodENvbHVtbnMgPSAwOwotCi0JCWludCBmaXhlZFdpZHRoID0gMDsKLQkJaW50IHRv
dGFsV2VpZ2h0ID0gMDsKLQotCQkvLyBGaXJzdCBjYWxjIHNwYWNlIG9jY3VwaWVkIGJ5IGZpeGVk
IGNvbHVtbnMKLQkJZm9yIChpbnQgaSA9IDA7IGkgPCBudW1iZXJPZkNvbHVtbnM7IGkrKykgewot
CQkJQ29sdW1uTGF5b3V0RGF0YSBjb2wgPSBnZXRMYXlvdXREYXRhKHNjcm9sbGFibGUsIGkpOwot
CQkJaWYgKGNvbCBpbnN0YW5jZW9mIENvbHVtblBpeGVsRGF0YSkgewotCQkJCUNvbHVtblBpeGVs
RGF0YSBjcGQgPSAoQ29sdW1uUGl4ZWxEYXRhKSBjb2w7Ci0JCQkJaW50IHBpeGVscyA9IGNwZC53
aWR0aDsKLQkJCQlpZiAoY3BkLmFkZFRyaW0pIHsKLQkJCQkJcGl4ZWxzICs9IGdldENvbHVtblRy
aW0oKTsKLQkJCQl9Ci0JCQkJd2lkdGhzW2ldID0gcGl4ZWxzOwotCQkJCWZpeGVkV2lkdGggKz0g
cGl4ZWxzOwotCQkJfSBlbHNlIGlmIChjb2wgaW5zdGFuY2VvZiBDb2x1bW5XZWlnaHREYXRhKSB7
Ci0JCQkJQ29sdW1uV2VpZ2h0RGF0YSBjdyA9IChDb2x1bW5XZWlnaHREYXRhKSBjb2w7Ci0JCQkJ
d2VpZ2h0Q29sdW1uSW5kaWNlc1tudW1iZXJPZldlaWdodENvbHVtbnNdID0gaTsKLQkJCQludW1i
ZXJPZldlaWdodENvbHVtbnMrKzsKLQkJCQl0b3RhbFdlaWdodCArPSBjdy53ZWlnaHQ7Ci0JCQl9
IGVsc2UgewotCQkJCUFzc2VydC5pc1RydWUoZmFsc2UsICJVbmtub3duIGNvbHVtbiBsYXlvdXQg
ZGF0YSIpOyAvLyROT04tTkxTLTEkCi0JCQl9Ci0JCX0KLQotCQlib29sZWFuIHJlY2FsY3VsYXRl
OwotCQlkbyB7Ci0JCQlyZWNhbGN1bGF0ZSA9IGZhbHNlOwotCQkJZm9yIChpbnQgaSA9IDA7IGkg
PCBudW1iZXJPZldlaWdodENvbHVtbnM7IGkrKykgewotCQkJCWludCBjb2xJbmRleCA9IHdlaWdo
dENvbHVtbkluZGljZXNbaV07Ci0JCQkJQ29sdW1uV2VpZ2h0RGF0YSBjdyA9IChDb2x1bW5XZWln
aHREYXRhKSBnZXRMYXlvdXREYXRhKAotCQkJCQkJc2Nyb2xsYWJsZSwgY29sSW5kZXgpOwotCQkJ
CWZpbmFsIGludCBtaW5XaWR0aCA9IGN3Lm1pbmltdW1XaWR0aDsKLQkJCQlmaW5hbCBpbnQgYWxs
b3dlZFdpZHRoID0gKHdpZHRoIC0gZml4ZWRXaWR0aCkgKiBjdy53ZWlnaHQKLQkJCQkJCS8gdG90
YWxXZWlnaHQ7Ci0JCQkJaWYgKGFsbG93ZWRXaWR0aCA8IG1pbldpZHRoKSB7Ci0JCQkJCS8qCi0J
CQkJCSAqIGlmIHRoZSB3aWR0aCBhc3NpZ25lZCBieSB3ZWlnaHQgaXMgbGVzcyB0aGFuIHRoZSBt
aW5pbXVtLAotCQkJCQkgKiB0aGVuIHRyZWF0IHRoaXMgY29sdW1uIGFzIGZpeGVkLCByZW1vdmUg
aXQgZnJvbSB3ZWlnaHQKLQkJCQkJICogY2FsY3VsYXRpb25zLCBhbmQgcmVjYWxjdWxhdGUgb3Ro
ZXIgd2VpZ2h0cy4KLQkJCQkJICovCi0JCQkJCW51bWJlck9mV2VpZ2h0Q29sdW1ucy0tOwotCQkJ
CQl0b3RhbFdlaWdodCAtPSBjdy53ZWlnaHQ7Ci0JCQkJCWZpeGVkV2lkdGggKz0gbWluV2lkdGg7
Ci0JCQkJCXdpZHRoc1tjb2xJbmRleF0gPSBtaW5XaWR0aDsKLQkJCQkJU3lzdGVtLmFycmF5Y29w
eSh3ZWlnaHRDb2x1bW5JbmRpY2VzLCBpICsgMSwKLQkJCQkJCQl3ZWlnaHRDb2x1bW5JbmRpY2Vz
LCBpLCBudW1iZXJPZldlaWdodENvbHVtbnMgLSBpKTsKLQkJCQkJcmVjYWxjdWxhdGUgPSB0cnVl
OwotCQkJCQlicmVhazsKLQkJCQl9Ci0JCQkJd2lkdGhzW2NvbEluZGV4XSA9IGFsbG93ZWRXaWR0
aDsKLQkJCX0KLQkJfSB3aGlsZSAocmVjYWxjdWxhdGUpOwotCi0JCWlmIChpbmNyZWFzZSkgewot
CQkJc2Nyb2xsYWJsZS5zZXRTaXplKGFyZWEud2lkdGgsIGFyZWEuaGVpZ2h0KTsKLQkJfQotCi0J
CWludXBkYXRlTW9kZSA9IHRydWU7Ci0JCXNldENvbHVtbldpZHRocyhzY3JvbGxhYmxlLCB3aWR0
aHMpOwotCQlzY3JvbGxhYmxlLnVwZGF0ZSgpOwotCQlpbnVwZGF0ZU1vZGUgPSBmYWxzZTsKLQot
CQlpZiAoIWluY3JlYXNlKSB7Ci0JCQlzY3JvbGxhYmxlLnNldFNpemUoYXJlYS53aWR0aCwgYXJl
YS5oZWlnaHQpOwotCQl9Ci0JfQotCi0JLyoKLQkgKiAobm9uLUphdmFkb2MpCi0JICoKLQkgKiBA
c2VlIG9yZy5lY2xpcHNlLnN3dC53aWRnZXRzLkxheW91dCNjb21wdXRlU2l6ZShvcmcuZWNsaXBz
ZS5zd3Qud2lkZ2V0cy5Db21wb3NpdGUsCi0JICogICAgICBpbnQsIGludCwgYm9vbGVhbikKLQkg
Ki8KLQlwcm90ZWN0ZWQgUG9pbnQgY29tcHV0ZVNpemUoQ29tcG9zaXRlIGNvbXBvc2l0ZSwgaW50
IHdIaW50LCBpbnQgaEhpbnQsCi0JCQlib29sZWFuIGZsdXNoQ2FjaGUpIHsKLQkJcmV0dXJuIGNv
bXB1dGVUYWJsZVRyZWVTaXplKGdldENvbnRyb2woY29tcG9zaXRlKSwgd0hpbnQsIGhIaW50KTsK
LQl9Ci0KLQkvKgotCSAqIChub24tSmF2YWRvYykKLQkgKgotCSAqIEBzZWUgb3JnLmVjbGlwc2Uu
c3d0LndpZGdldHMuTGF5b3V0I2xheW91dChvcmcuZWNsaXBzZS5zd3Qud2lkZ2V0cy5Db21wb3Np
dGUsCi0JICogICAgICBib29sZWFuKQotCSAqLwotCXByb3RlY3RlZCB2b2lkIGxheW91dChDb21w
b3NpdGUgY29tcG9zaXRlLCBib29sZWFuIGZsdXNoQ2FjaGUpIHsKLQkJUmVjdGFuZ2xlIGFyZWEg
PSBjb21wb3NpdGUuZ2V0Q2xpZW50QXJlYSgpOwotCQlTY3JvbGxhYmxlIHRhYmxlID0gZ2V0Q29u
dHJvbChjb21wb3NpdGUpOwotCQlpbnQgdGFibGVXaWR0aCA9IHRhYmxlLmdldFNpemUoKS54Owot
CQlpbnQgdHJpbSA9IGNvbXB1dGVUcmltKGFyZWEsIHRhYmxlLCB0YWJsZVdpZHRoKTsKLQkJaW50
IHdpZHRoID0gTWF0aC5tYXgoMCwgYXJlYS53aWR0aCAtIHRyaW0pOwotCi0JCWlmICh3aWR0aCA+
IDEpCi0JCQlsYXlvdXRUYWJsZVRyZWUodGFibGUsIHdpZHRoLCBhcmVhLCB0YWJsZVdpZHRoIDwg
YXJlYS53aWR0aCk7Ci0KLQkJLy8gRm9yIHRoZSBmaXJzdCB0aW1lIHdlIG5lZWQgdG8gcmVsYXlv
dXQgYmVjYXVzZSBTY3JvbGxiYXJzIGFyZSBub3QKLQkJLy8gY2FsY3VsYXRlIGFwcHJvcHJpYXRl
bHkKLQkJaWYgKHJlbGF5b3V0KSB7Ci0JCQlyZWxheW91dCA9IGZhbHNlOwotCQkJY29tcG9zaXRl
LmxheW91dCgpOwotCQl9Ci0JfQotCi0JLyoqCi0JICogQ29tcHV0ZSB0aGUgYXJlYSByZXF1aXJl
ZCBmb3IgdHJpbS4KLQkgKgotCSAqIEBwYXJhbSBhcmVhCi0JICogQHBhcmFtIHNjcm9sbGFibGUK
LQkgKiBAcGFyYW0gY3VycmVudFdpZHRoCi0JICogQHJldHVybiBpbnQKLQkgKi8KLQlwcml2YXRl
IGludCBjb21wdXRlVHJpbShSZWN0YW5nbGUgYXJlYSwgU2Nyb2xsYWJsZSBzY3JvbGxhYmxlLAot
CQkJaW50IGN1cnJlbnRXaWR0aCkgewotCQlpbnQgdHJpbTsKLQotCQlpZiAoY3VycmVudFdpZHRo
ID4gMSkgewotCQkJdHJpbSA9IGN1cnJlbnRXaWR0aCAtIHNjcm9sbGFibGUuZ2V0Q2xpZW50QXJl
YSgpLndpZHRoOwotCQl9IGVsc2UgewotCQkJLy8gaW5pdGlhbGx5LCB0aGUgdGFibGUgaGFzIG5v
IGV4dGVuZCBhbmQgbm8gY2xpZW50IGFyZWEgLSB1c2UgdGhlCi0JCQkvLyBib3JkZXIgd2l0aAot
CQkJLy8gcGx1cyBzb21lIHBhZGRpbmcgYXMgZWR1Y2F0ZWQgZ3Vlc3MKLQkJCXRyaW0gPSAyICog
c2Nyb2xsYWJsZS5nZXRCb3JkZXJXaWR0aCgpICsgMTsKLQkJfQotCi0JCXJldHVybiB0cmltOwot
CX0KLQotCS8qKgotCSAqIEdldCB0aGUgY29udHJvbCBiZWluZyBsYWlkIG91dC4KLQkgKgotCSAq
IEBwYXJhbSBjb21wb3NpdGUKLQkgKiAgICAgICAgICAgIHRoZSBjb21wb3NpdGUgd2l0aCB0aGUg
bGF5b3V0Ci0JICogQHJldHVybiB7QGxpbmsgU2Nyb2xsYWJsZX0KLQkgKi8KLQlTY3JvbGxhYmxl
IGdldENvbnRyb2woQ29tcG9zaXRlIGNvbXBvc2l0ZSkgewotCQlyZXR1cm4gKFNjcm9sbGFibGUp
IGNvbXBvc2l0ZS5nZXRDaGlsZHJlbigpWzBdOwotCX0KLQotCS8qKgotCSAqIEdldCB0aGUgbnVt
YmVyIG9mIGNvbHVtbnMgZm9yIHRoZSByZWNlaXZlci4KLQkgKgotCSAqIEByZXR1cm4gdGhlIG51
bWJlciBvZiBjb2x1bW5zCi0JICovCi0JYWJzdHJhY3QgaW50IGdldENvbHVtbkNvdW50KFNjcm9s
bGFibGUgdGFibGVUcmVlKTsKLQotCS8qKgotCSAqIFNldCB0aGUgd2lkdGhzIG9mIHRoZSBjb2x1
bW5zLgotCSAqCi0JICogQHBhcmFtIHdpZHRocwotCSAqLwotCWFic3RyYWN0IHZvaWQgc2V0Q29s
dW1uV2lkdGhzKFNjcm9sbGFibGUgdGFibGVUcmVlLCBpbnRbXSB3aWR0aHMpOwotCi0JYWJzdHJh
Y3QgQ29sdW1uTGF5b3V0RGF0YSBnZXRMYXlvdXREYXRhKFNjcm9sbGFibGUgdGFibGVUcmVlLAot
CQkJaW50IGNvbHVtbkluZGV4KTsKLQotCWFic3RyYWN0IHZvaWQgdXBkYXRlQ29sdW1uRGF0YShX
aWRnZXQgY29sdW1uKTsKLQotCS8qKgotCSAqIFRoZSBudW1iZXIgb2YgZXh0cmEgcGl4ZWxzIHRh
a2VuIGFzIGhvcml6b250YWwgdHJpbSBieSB0aGUgdGFibGUgY29sdW1uLgotCSAqIFRvIGVuc3Vy
ZSB0aGVyZSBhcmUgTiBwaXhlbHMgYXZhaWxhYmxlIGZvciB0aGUgY29udGVudCBvZiB0aGUgY29s
dW1uLAotCSAqIGFzc2lnbiBOK0NPTFVNTl9UUklNIGZvciB0aGUgY29sdW1uIHdpZHRoLgotCSAq
Ci0JICogQHJldHVybiB0aGUgdHJpbSB1c2VkIGJ5IHRoZSBjb2x1bW5zCi0JICogQHNpbmNlIDMu
NAotCSAqLwotCXByb3RlY3RlZCBpbnQgZ2V0Q29sdW1uVHJpbSgpIHsKLQkJcmV0dXJuIENPTFVN
Tl9UUklNOwotCX0KKyAgICBwcml2YXRlIHN0YXRpYyBpbnQgQ09MVU1OX1RSSU07CisgICAgc3Rh
dGljIHsKKyAgICAgICAgaWYgKCJ3aW4zMiIuZXF1YWxzKFNXVC5nZXRQbGF0Zm9ybSgpKSkgeyAv
LyROT04tTkxTLTEkCisgICAgICAgICAgICBDT0xVTU5fVFJJTSA9IDQ7CisgICAgICAgIH0gZWxz
ZSBpZiAoImNhcmJvbiIuZXF1YWxzKFNXVC5nZXRQbGF0Zm9ybSgpKSkgeyAvLyROT04tTkxTLTEk
CisgICAgICAgICAgICBDT0xVTU5fVFJJTSA9IDI0OworICAgICAgICB9IGVsc2UgeworICAgICAg
ICAgICAgQ09MVU1OX1RSSU0gPSAzOworICAgICAgICB9CisgICAgfQorCisgICAgc3RhdGljIGZp
bmFsIGJvb2xlYW4gSVNfR1RLID0gImd0ayIuZXF1YWxzKFNXVC5nZXRQbGF0Zm9ybSgpKTsvLyRO
T04tTkxTLTEkCisKKyAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIFN0cmluZyBMQVlPVVRfREFU
QSA9IFBvbGljeS5KRkFDRSArICIuTEFZT1VUX0RBVEEiOyAvLyROT04tTkxTLTEkCisKKyAgICBw
cml2YXRlIGJvb2xlYW4gaW51cGRhdGVNb2RlID0gZmFsc2U7CisKKyAgICBwcml2YXRlIGJvb2xl
YW4gcmVsYXlvdXQgPSB0cnVlOworCisgICAgcHJpdmF0ZSBMaXN0ZW5lciByZXNpemVMaXN0ZW5l
ciA9IG5ldyBMaXN0ZW5lcigpIHsKKworICAgICAgICBwdWJsaWMgdm9pZCBoYW5kbGVFdmVudChF
dmVudCBldmVudCkgeworICAgICAgICAgICAgaWYgKCFpbnVwZGF0ZU1vZGUpIHsKKyAgICAgICAg
ICAgICAgICB1cGRhdGVDb2x1bW5EYXRhKGV2ZW50LndpZGdldCk7CisgICAgICAgICAgICB9Cisg
ICAgICAgIH0KKworICAgIH07CisKKyAgICAvKioKKyAgICAgKiBBZGRzIGEgbmV3IGNvbHVtbiBv
ZiBkYXRhIHRvIHRoaXMgdGFibGUgbGF5b3V0LgorICAgICAqCisgICAgICogQHBhcmFtIGNvbHVt
bgorICAgICAqICAgICAgICAgICAgdGhlIGNvbHVtbgorICAgICAqCisgICAgICogQHBhcmFtIGRh
dGEKKyAgICAgKiAgICAgICAgICAgIHRoZSBjb2x1bW4gbGF5b3V0IGRhdGEKKyAgICAgKi8KKyAg
ICBwdWJsaWMgdm9pZCBzZXRDb2x1bW5EYXRhKFdpZGdldCBjb2x1bW4sIENvbHVtbkxheW91dERh
dGEgZGF0YSkgeworCisgICAgICAgIGlmIChjb2x1bW4uZ2V0RGF0YShMQVlPVVRfREFUQSkgPT0g
bnVsbCkgeworICAgICAgICAgICAgY29sdW1uLmFkZExpc3RlbmVyKFNXVC5SZXNpemUsIHJlc2l6
ZUxpc3RlbmVyKTsKKyAgICAgICAgfQorCisgICAgICAgIGNvbHVtbi5zZXREYXRhKExBWU9VVF9E
QVRBLCBkYXRhKTsKKyAgICB9CisKKyAgICAvKioKKyAgICAgKiBDb21wdXRlIHRoZSBzaXplIG9m
IHRoZSB0YWJsZSBvciB0cmVlIGJhc2VkIG9uIHRoZSBDb2x1bW5MYXlvdXREYXRhIGFuZAorICAg
ICAqIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IGhpbnQuCisgICAgICoKKyAgICAgKiBAcGFyYW0gc2Ny
b2xsYWJsZQorICAgICAqICAgICAgICAgICAgdGhlIHdpZGdldCB0byBjb21wdXRlCisgICAgICog
QHBhcmFtIHdIaW50CisgICAgICogICAgICAgICAgICB0aGUgd2lkdGggaGludAorICAgICAqIEBw
YXJhbSBoSGludAorICAgICAqICAgICAgICAgICAgdGhlIGhlaWdodCBoaW50CisgICAgICogQHJl
dHVybiBQb2ludCB3aGVyZSB4IGlzIHRoZSB3aWR0aCBhbmQgeSBpcyB0aGUgaGVpZ2h0CisgICAg
ICovCisgICAgcHJpdmF0ZSBQb2ludCBjb21wdXRlVGFibGVUcmVlU2l6ZShTY3JvbGxhYmxlIHNj
cm9sbGFibGUsIGludCB3SGludCwKKyAgICAgICAgICAgIGludCBoSGludCkgeworICAgICAgICBQ
b2ludCByZXN1bHQgPSBzY3JvbGxhYmxlLmNvbXB1dGVTaXplKHdIaW50LCBoSGludCk7CisKKyAg
ICAgICAgaW50IHdpZHRoID0gMDsKKyAgICAgICAgaW50IHNpemUgPSBnZXRDb2x1bW5Db3VudChz
Y3JvbGxhYmxlKTsKKyAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzaXplOyArK2kpIHsKKyAg
ICAgICAgICAgIENvbHVtbkxheW91dERhdGEgbGF5b3V0RGF0YSA9IGdldExheW91dERhdGEoc2Ny
b2xsYWJsZSwgaSk7CisgICAgICAgICAgICBpZiAobGF5b3V0RGF0YSBpbnN0YW5jZW9mIENvbHVt
blBpeGVsRGF0YSkgeworICAgICAgICAgICAgICAgIENvbHVtblBpeGVsRGF0YSBjb2wgPSAoQ29s
dW1uUGl4ZWxEYXRhKSBsYXlvdXREYXRhOworICAgICAgICAgICAgICAgIHdpZHRoICs9IGNvbC53
aWR0aDsKKyAgICAgICAgICAgICAgICBpZiAoY29sLmFkZFRyaW0pIHsKKyAgICAgICAgICAgICAg
ICAgICAgd2lkdGggKz0gZ2V0Q29sdW1uVHJpbSgpOworICAgICAgICAgICAgICAgIH0KKyAgICAg
ICAgICAgIH0gZWxzZSBpZiAobGF5b3V0RGF0YSBpbnN0YW5jZW9mIENvbHVtbldlaWdodERhdGEp
IHsKKyAgICAgICAgICAgICAgICBDb2x1bW5XZWlnaHREYXRhIGNvbCA9IChDb2x1bW5XZWlnaHRE
YXRhKSBsYXlvdXREYXRhOworICAgICAgICAgICAgICAgIHdpZHRoICs9IGNvbC5taW5pbXVtV2lk
dGg7CisgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAgIEFzc2VydC5pc1RydWUo
ZmFsc2UsICJVbmtub3duIGNvbHVtbiBsYXlvdXQgZGF0YSIpOyAvLyROT04tTkxTLTEkCisgICAg
ICAgICAgICB9CisgICAgICAgIH0KKyAgICAgICAgaWYgKHdpZHRoID4gcmVzdWx0LngpCisgICAg
ICAgICAgICByZXN1bHQueCA9IHdpZHRoOworCisgICAgICAgIHJldHVybiByZXN1bHQ7CisgICAg
fQorCisgICAgLyoqCisgICAgICogTGF5b3V0IHRoZSBzY3JvbGxhYmxlIGJhc2VkIG9uIHRoZSBz
dXBwbGllZCB3aWR0aCBhbmQgYXJlYS4gT25seSBpbmNyZWFzZQorICAgICAqIHRoZSBzaXplIG9m
IHRoZSBzY3JvbGxhYmxlIGlmIGluY3JlYXNlIGlzIDxjb2RlPnRydWU8L2NvZGU+LgorICAgICAq
CisgICAgICogQHBhcmFtIHNjcm9sbGFibGUKKyAgICAgKiBAcGFyYW0gd2lkdGgKKyAgICAgKiBA
cGFyYW0gYXJlYQorICAgICAqIEBwYXJhbSBpbmNyZWFzZQorICAgICAqLworICAgIHByaXZhdGUg
dm9pZCBsYXlvdXRUYWJsZVRyZWUoZmluYWwgU2Nyb2xsYWJsZSBzY3JvbGxhYmxlLCBmaW5hbCBp
bnQgd2lkdGgsCisgICAgICAgICAgICBmaW5hbCBSZWN0YW5nbGUgYXJlYSwgZmluYWwgYm9vbGVh
biBpbmNyZWFzZSkgeworICAgICAgICBmaW5hbCBpbnQgbnVtYmVyT2ZDb2x1bW5zID0gZ2V0Q29s
dW1uQ291bnQoc2Nyb2xsYWJsZSk7CisgICAgICAgIGZpbmFsIGludFtdIHdpZHRocyA9IG5ldyBp
bnRbbnVtYmVyT2ZDb2x1bW5zXTsKKworICAgICAgICBmaW5hbCBpbnRbXSB3ZWlnaHRDb2x1bW5J
bmRpY2VzID0gbmV3IGludFtudW1iZXJPZkNvbHVtbnNdOworICAgICAgICBpbnQgbnVtYmVyT2ZX
ZWlnaHRDb2x1bW5zID0gMDsKKworICAgICAgICBpbnQgZml4ZWRXaWR0aCA9IDA7CisgICAgICAg
IGludCB0b3RhbFdlaWdodCA9IDA7CisKKyAgICAgICAgLy8gRmlyc3QgY2FsYyBzcGFjZSBvY2N1
cGllZCBieSBmaXhlZCBjb2x1bW5zCisgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtYmVy
T2ZDb2x1bW5zOyBpKyspIHsKKyAgICAgICAgICAgIENvbHVtbkxheW91dERhdGEgY29sID0gZ2V0
TGF5b3V0RGF0YShzY3JvbGxhYmxlLCBpKTsKKyAgICAgICAgICAgIGlmIChjb2wgaW5zdGFuY2Vv
ZiBDb2x1bW5QaXhlbERhdGEpIHsKKyAgICAgICAgICAgICAgICBDb2x1bW5QaXhlbERhdGEgY3Bk
ID0gKENvbHVtblBpeGVsRGF0YSkgY29sOworICAgICAgICAgICAgICAgIGludCBwaXhlbHMgPSBj
cGQud2lkdGg7CisgICAgICAgICAgICAgICAgaWYgKGNwZC5hZGRUcmltKSB7CisgICAgICAgICAg
ICAgICAgICAgIHBpeGVscyArPSBnZXRDb2x1bW5UcmltKCk7CisgICAgICAgICAgICAgICAgfQor
ICAgICAgICAgICAgICAgIHdpZHRoc1tpXSA9IHBpeGVsczsKKyAgICAgICAgICAgICAgICBmaXhl
ZFdpZHRoICs9IHBpeGVsczsKKyAgICAgICAgICAgIH0gZWxzZSBpZiAoY29sIGluc3RhbmNlb2Yg
Q29sdW1uV2VpZ2h0RGF0YSkgeworICAgICAgICAgICAgICAgIENvbHVtbldlaWdodERhdGEgY3cg
PSAoQ29sdW1uV2VpZ2h0RGF0YSkgY29sOworICAgICAgICAgICAgICAgIHdlaWdodENvbHVtbklu
ZGljZXNbbnVtYmVyT2ZXZWlnaHRDb2x1bW5zXSA9IGk7CisgICAgICAgICAgICAgICAgbnVtYmVy
T2ZXZWlnaHRDb2x1bW5zKys7CisgICAgICAgICAgICAgICAgdG90YWxXZWlnaHQgKz0gY3cud2Vp
Z2h0OworICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICBBc3NlcnQuaXNUcnVl
KGZhbHNlLCAiVW5rbm93biBjb2x1bW4gbGF5b3V0IGRhdGEiKTsgLy8kTk9OLU5MUy0xJAorICAg
ICAgICAgICAgfQorICAgICAgICB9CisKKyAgICAgICAgYm9vbGVhbiByZWNhbGN1bGF0ZTsKKyAg
ICAgICAgZG8geworICAgICAgICAgICAgcmVjYWxjdWxhdGUgPSBmYWxzZTsKKyAgICAgICAgICAg
IGZvciAoaW50IGkgPSAwOyBpIDwgbnVtYmVyT2ZXZWlnaHRDb2x1bW5zOyBpKyspIHsKKyAgICAg
ICAgICAgICAgICBpbnQgY29sSW5kZXggPSB3ZWlnaHRDb2x1bW5JbmRpY2VzW2ldOworICAgICAg
ICAgICAgICAgIENvbHVtbldlaWdodERhdGEgY3cgPSAoQ29sdW1uV2VpZ2h0RGF0YSkgZ2V0TGF5
b3V0RGF0YSgKKyAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbGFibGUsIGNvbEluZGV4KTsK
KyAgICAgICAgICAgICAgICBmaW5hbCBpbnQgbWluV2lkdGggPSBjdy5taW5pbXVtV2lkdGg7Cisg
ICAgICAgICAgICAgICAgZmluYWwgaW50IGFsbG93ZWRXaWR0aCA9ICh3aWR0aCAtIGZpeGVkV2lk
dGgpICogY3cud2VpZ2h0CisgICAgICAgICAgICAgICAgICAgICAgICAvIHRvdGFsV2VpZ2h0Owor
ICAgICAgICAgICAgICAgIGlmIChhbGxvd2VkV2lkdGggPCBtaW5XaWR0aCkgeworICAgICAgICAg
ICAgICAgICAgICAvKgorICAgICAgICAgICAgICAgICAgICAgKiBpZiB0aGUgd2lkdGggYXNzaWdu
ZWQgYnkgd2VpZ2h0IGlzIGxlc3MgdGhhbiB0aGUgbWluaW11bSwKKyAgICAgICAgICAgICAgICAg
ICAgICogdGhlbiB0cmVhdCB0aGlzIGNvbHVtbiBhcyBmaXhlZCwgcmVtb3ZlIGl0IGZyb20gd2Vp
Z2h0CisgICAgICAgICAgICAgICAgICAgICAqIGNhbGN1bGF0aW9ucywgYW5kIHJlY2FsY3VsYXRl
IG90aGVyIHdlaWdodHMuCisgICAgICAgICAgICAgICAgICAgICAqLworICAgICAgICAgICAgICAg
ICAgICBudW1iZXJPZldlaWdodENvbHVtbnMtLTsKKyAgICAgICAgICAgICAgICAgICAgdG90YWxX
ZWlnaHQgLT0gY3cud2VpZ2h0OworICAgICAgICAgICAgICAgICAgICBmaXhlZFdpZHRoICs9IG1p
bldpZHRoOworICAgICAgICAgICAgICAgICAgICB3aWR0aHNbY29sSW5kZXhdID0gbWluV2lkdGg7
CisgICAgICAgICAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkod2VpZ2h0Q29sdW1uSW5kaWNl
cywgaSArIDEsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2VpZ2h0Q29sdW1uSW5kaWNl
cywgaSwgbnVtYmVyT2ZXZWlnaHRDb2x1bW5zIC0gaSk7CisgICAgICAgICAgICAgICAgICAgIHJl
Y2FsY3VsYXRlID0gdHJ1ZTsKKyAgICAgICAgICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICAg
ICAgICAgfQorICAgICAgICAgICAgICAgIHdpZHRoc1tjb2xJbmRleF0gPSBhbGxvd2VkV2lkdGg7
CisgICAgICAgICAgICB9CisgICAgICAgIH0gd2hpbGUgKHJlY2FsY3VsYXRlKTsKKworICAgICAg
ICBpZiAoaW5jcmVhc2UpIHsKKyAgICAgICAgICAgIHNjcm9sbGFibGUuc2V0U2l6ZShhcmVhLndp
ZHRoLCBhcmVhLmhlaWdodCk7CisgICAgICAgIH0KKworICAgICAgICBpbnVwZGF0ZU1vZGUgPSB0
cnVlOworICAgICAgICBzZXRDb2x1bW5XaWR0aHMoc2Nyb2xsYWJsZSwgd2lkdGhzKTsKKyAgICAg
ICAgc2Nyb2xsYWJsZS51cGRhdGUoKTsKKyAgICAgICAgaW51cGRhdGVNb2RlID0gZmFsc2U7CisK
KyAgICAgICAgaWYgKCFpbmNyZWFzZSkgeworICAgICAgICAgICAgc2Nyb2xsYWJsZS5zZXRTaXpl
KGFyZWEud2lkdGgsIGFyZWEuaGVpZ2h0KTsKKyAgICAgICAgfQorICAgIH0KKworICAgIC8qCisg
ICAgICogKG5vbi1KYXZhZG9jKQorICAgICAqCisgICAgICogQHNlZSBvcmcuZWNsaXBzZS5zd3Qu
d2lkZ2V0cy5MYXlvdXQjY29tcHV0ZVNpemUob3JnLmVjbGlwc2Uuc3d0LndpZGdldHMuQ29tcG9z
aXRlLAorICAgICAqICAgICAgaW50LCBpbnQsIGJvb2xlYW4pCisgICAgICovCisgICAgcHJvdGVj
dGVkIFBvaW50IGNvbXB1dGVTaXplKENvbXBvc2l0ZSBjb21wb3NpdGUsIGludCB3SGludCwgaW50
IGhIaW50LAorICAgICAgICAgICAgYm9vbGVhbiBmbHVzaENhY2hlKSB7CisgICAgICAgIHJldHVy
biBjb21wdXRlVGFibGVUcmVlU2l6ZShnZXRDb250cm9sKGNvbXBvc2l0ZSksIHdIaW50LCBoSGlu
dCk7CisgICAgfQorCisgICAgLyoKKyAgICAgKiAobm9uLUphdmFkb2MpCisgICAgICoKKyAgICAg
KiBAc2VlIG9yZy5lY2xpcHNlLnN3dC53aWRnZXRzLkxheW91dCNsYXlvdXQob3JnLmVjbGlwc2Uu
c3d0LndpZGdldHMuQ29tcG9zaXRlLAorICAgICAqICAgICAgYm9vbGVhbikKKyAgICAgKi8KKyAg
ICBwcm90ZWN0ZWQgdm9pZCBsYXlvdXQoQ29tcG9zaXRlIGNvbXBvc2l0ZSwgYm9vbGVhbiBmbHVz
aENhY2hlKSB7CisgICAgICAgIFJlY3RhbmdsZSBhcmVhID0gY29tcG9zaXRlLmdldENsaWVudEFy
ZWEoKTsKKyAgICAgICAgU2Nyb2xsYWJsZSB0YWJsZSA9IGdldENvbnRyb2woY29tcG9zaXRlKTsK
KyAgICAgICAgaW50IHRhYmxlV2lkdGggPSB0YWJsZS5nZXRTaXplKCkueDsKKyAgICAgICAgaW50
IHRyaW0gPSBjb21wdXRlVHJpbShhcmVhLCB0YWJsZSwgdGFibGVXaWR0aCk7CisgICAgICAgIGlu
dCB3aWR0aCA9IE1hdGgubWF4KDAsIGFyZWEud2lkdGggLSB0cmltKTsKKworICAgICAgICBpZiAo
d2lkdGggPiAxKQorICAgICAgICAgICAgbGF5b3V0VGFibGVUcmVlKHRhYmxlLCB3aWR0aCwgYXJl
YSwgdGFibGVXaWR0aCA8IGFyZWEud2lkdGgpOworCisgICAgICAgIC8vIEZvciB0aGUgZmlyc3Qg
dGltZSB3ZSBuZWVkIHRvIHJlbGF5b3V0IGJlY2F1c2UgU2Nyb2xsYmFycyBhcmUgbm90CisgICAg
ICAgIC8vIGNhbGN1bGF0ZSBhcHByb3ByaWF0ZWx5CisgICAgICAgIGlmIChyZWxheW91dCkgewor
ICAgICAgICAgICAgcmVsYXlvdXQgPSBmYWxzZTsKKyAgICAgICAgICAgIGNvbXBvc2l0ZS5sYXlv
dXQoKTsKKyAgICAgICAgfQorICAgIH0KKworICAgIC8qKgorICAgICAqIENvbXB1dGUgdGhlIGFy
ZWEgcmVxdWlyZWQgZm9yIHRyaW0uCisgICAgICoKKyAgICAgKiBAcGFyYW0gYXJlYQorICAgICAq
IEBwYXJhbSBzY3JvbGxhYmxlCisgICAgICogQHBhcmFtIGN1cnJlbnRXaWR0aAorICAgICAqIEBy
ZXR1cm4gaW50CisgICAgICovCisgICAgcHJpdmF0ZSBpbnQgY29tcHV0ZVRyaW0oUmVjdGFuZ2xl
IGFyZWEsIFNjcm9sbGFibGUgc2Nyb2xsYWJsZSwKKyAgICAgICAgICAgIGludCBjdXJyZW50V2lk
dGgpIHsKKyAgICAgICAgaW50IHRyaW07CisKKyAgICAgICAgaWYgKGN1cnJlbnRXaWR0aCA+IDEp
IHsKKyAgICAgICAgICAgIHRyaW0gPSBjdXJyZW50V2lkdGggLSBzY3JvbGxhYmxlLmdldENsaWVu
dEFyZWEoKS53aWR0aDsKKyAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgIC8vIGluaXRpYWxs
eSwgdGhlIHRhYmxlIGhhcyBubyBleHRlbmQgYW5kIG5vIGNsaWVudCBhcmVhIC0gdXNlIHRoZQor
ICAgICAgICAgICAgLy8gYm9yZGVyIHdpdGgKKyAgICAgICAgICAgIC8vIHBsdXMgc29tZSBwYWRk
aW5nIGFzIGVkdWNhdGVkIGd1ZXNzCisgICAgICAgICAgICB0cmltID0gMiAqIHNjcm9sbGFibGUu
Z2V0Qm9yZGVyV2lkdGgoKSArIDE7CisgICAgICAgIH0KKworICAgICAgICByZXR1cm4gdHJpbTsK
KyAgICB9CisKKyAgICAvKioKKyAgICAgKiBHZXQgdGhlIGNvbnRyb2wgYmVpbmcgbGFpZCBvdXQu
CisgICAgICoKKyAgICAgKiBAcGFyYW0gY29tcG9zaXRlCisgICAgICogICAgICAgICAgICB0aGUg
Y29tcG9zaXRlIHdpdGggdGhlIGxheW91dAorICAgICAqIEByZXR1cm4ge0BsaW5rIFNjcm9sbGFi
bGV9CisgICAgICovCisgICAgU2Nyb2xsYWJsZSBnZXRDb250cm9sKENvbXBvc2l0ZSBjb21wb3Np
dGUpIHsKKyAgICAgICAgcmV0dXJuIChTY3JvbGxhYmxlKSBjb21wb3NpdGUuZ2V0Q2hpbGRyZW4o
KVswXTsKKyAgICB9CisKKyAgICAvKioKKyAgICAgKiBHZXQgdGhlIG51bWJlciBvZiBjb2x1bW5z
IGZvciB0aGUgcmVjZWl2ZXIuCisgICAgICoKKyAgICAgKiBAcmV0dXJuIHRoZSBudW1iZXIgb2Yg
Y29sdW1ucworICAgICAqLworICAgIHByb3RlY3RlZCBhYnN0cmFjdCBpbnQgZ2V0Q29sdW1uQ291
bnQoU2Nyb2xsYWJsZSB0YWJsZVRyZWUpOworCisgICAgLyoqCisgICAgICogU2V0IHRoZSB3aWR0
aHMgb2YgdGhlIGNvbHVtbnMuCisgICAgICoKKyAgICAgKiBAcGFyYW0gd2lkdGhzCisgICAgICov
CisgICAgcHJvdGVjdGVkIGFic3RyYWN0IHZvaWQgc2V0Q29sdW1uV2lkdGhzKFNjcm9sbGFibGUg
dGFibGVUcmVlLCBpbnRbXSB3aWR0aHMpOworCisgICAgcHJvdGVjdGVkIGFic3RyYWN0IENvbHVt
bkxheW91dERhdGEgZ2V0TGF5b3V0RGF0YShTY3JvbGxhYmxlIHRhYmxlVHJlZSwKKyAgICAgICAg
ICAgIGludCBjb2x1bW5JbmRleCk7CisKKyAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qgdm9pZCB1cGRh
dGVDb2x1bW5EYXRhKFdpZGdldCBjb2x1bW4pOworCisgICAgLyoqCisgICAgICogVGhlIG51bWJl
ciBvZiBleHRyYSBwaXhlbHMgdGFrZW4gYXMgaG9yaXpvbnRhbCB0cmltIGJ5IHRoZSB0YWJsZSBj
b2x1bW4uCisgICAgICogVG8gZW5zdXJlIHRoZXJlIGFyZSBOIHBpeGVscyBhdmFpbGFibGUgZm9y
IHRoZSBjb250ZW50IG9mIHRoZSBjb2x1bW4sCisgICAgICogYXNzaWduIE4rQ09MVU1OX1RSSU0g
Zm9yIHRoZSBjb2x1bW4gd2lkdGguCisgICAgICoKKyAgICAgKiBAcmV0dXJuIHRoZSB0cmltIHVz
ZWQgYnkgdGhlIGNvbHVtbnMKKyAgICAgKiBAc2luY2UgMy40CisgICAgICovCisgICAgcHJvdGVj
dGVkIGludCBnZXRDb2x1bW5UcmltKCkgeworICAgICAgICByZXR1cm4gQ09MVU1OX1RSSU07Cisg
ICAgfQogfQo=
</data>
<flag name="iplog"
          id="15588"
          type_id="7"
          status="+"
          setter="bokowski"
    />
          </attachment>
      

    </bug>

</bugzilla>