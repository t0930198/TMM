<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.1"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>214769</bug_id>
          
          <creation_ts>2008-01-09 11:39:00 -0500</creation_ts>
          <short_desc>DatasourceLogin.setPlatformClassName should take optional ClassLoader</short_desc>
          <delta_ts>2009-09-15 10:59:52 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>12</classification_id>
          <classification>RT</classification>
          <product>EclipseLink</product>
          <component>JPA</component>
          <version>1.0</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>Fixed in 1.0M6</status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>1.0</target_milestone>
          
          <blocked>221225</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Shaun Smith">shaun.smith</reporter>
          <assigned_to name="Peter Krogh">peter.krogh</assigned_to>
          <cc>peter.krogh</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>1128224</commentid>
    <comment_count>0</comment_count>
    <who name="Shaun Smith">shaun.smith</who>
    <bug_when>2008-01-09 11:39:32 -0500</bug_when>
    <thetext>org.eclipse.persistence.sessions.DatasourceLogin should provide a version of setPlatformClassName that takes a class loader in addition to the database platform class name.  Currently the single parameter version takes only a class name.  It uses the ConversionManager.loadClass(..) method to load the named class.  In JPA, DatasourceLogin.setPlatformClassName(..) is called by org.eclipse.persistence.internal.jpa.EntityManagerSetupImpl.  EntityManagerSetupImpl has a PersistenceUnitInfo that holds the ClassLoader that should be used to load the database platform.  Ignoring this ClassLoader and using the statically stored one obtained from the ConversionManager does not work in an OSGi environment that enforces strict class visibility rules.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1169688</commentid>
    <comment_count>1</comment_count>
      <attachid>91441</attachid>
    <who name="Shaun Smith">shaun.smith</who>
    <bug_when>2008-03-03 16:06:55 -0500</bug_when>
    <thetext>Created attachment 91441
Modified DatasourceLogin from OSGi POC</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1197247</commentid>
    <comment_count>2</comment_count>
    <who name="Peter Krogh">peter.krogh</who>
    <bug_when>2008-04-08 16:08:05 -0400</bug_when>
    <thetext>These three related bugs are fixed by this transaction.

221226 Support a provided classloader in EclipseLink JPA EntityManagerFactory Creation
	214769 DatasourceLogin.setPlatformClassName should take optional ClassLoader
	221225 EntityManagerSetupImpl should set PersistenceUnitInfo classloader on DatasourceLogin

Patch is on this bug - https://bugs.eclipse.org/bugs/show_bug.cgi?id=221226

This fix was written by Shaun Smith and Peter Krogh, and reviewed by Tom Ware.

New API:
	221226 adds a property called eclipselink.classloader.  
	/*
	 * Specify the classloader to use to create an EntityManagerFactory in the
       * property map passed to Persistence.createEntityManagerFactory.
       * This is a dynamic property, that can only be set at runtime in the property
       * map, and is not for use in the persistence.xml
       */

</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>91441</attachid>
            <date>2008-03-03 16:06:00 -0500</date>
            <delta_ts>2008-03-03 16:06:55 -0500</delta_ts>
            <desc>Modified DatasourceLogin from OSGi POC</desc>
            <filename>DatasourceLogin.java</filename>
            <type>application/octet-stream</type>
            <size>29835</size>
            <attacher name="Shaun Smith">shaun.smith</attacher>
            
              <data encoding="base64">LyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioKICogQ29weXJpZ2h0IChjKSAxOTk4LCAyMDA3IE9yYWNs
ZS4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogVGhpcyBwcm9ncmFtIGFuZCB0aGUgYWNjb21wYW55
aW5nIG1hdGVyaWFscyBhcmUgbWFkZSBhdmFpbGFibGUgdW5kZXIgdGhlCiAqIHRlcm1zIG9mIHRo
ZSBFY2xpcHNlIFB1YmxpYyBMaWNlbnNlIHYxLjAsIHdoaWNoIGFjY29tcGFuaWVzIHRoaXMgZGlz
dHJpYnV0aW9uCiAqIGFuZCBpcyBhdmFpbGFibGUgYXQgaHR0cDovL3d3dy5lY2xpcHNlLm9yZy9s
ZWdhbC9lcGwtdjEwLmh0bWwuCiAqCiAqIENvbnRyaWJ1dG9yczoKICogICAgIE9yYWNsZSAtIGlu
aXRpYWwgQVBJIGFuZCBpbXBsZW1lbnRhdGlvbiBmcm9tIE9yYWNsZSBUb3BMaW5rCiAqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKiovICAKcGFja2FnZSBvcmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS5zZXNzaW9u
czsKCmltcG9ydCBqYXZhLnV0aWwuKjsKaW1wb3J0IGphdmEuaW8uKjsKaW1wb3J0IGphdmEuc2Vj
dXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHkuUHJpdmlsZWdlZEFj
dGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudGV4dC5NZXNzYWdlRm9ybWF0OwppbXBvcnQgb3Jn
LmVjbGlwc2UucGVyc2lzdGVuY2UuZXhjZXB0aW9ucy4qOwppbXBvcnQgb3JnLmVjbGlwc2UucGVy
c2lzdGVuY2UucGxhdGZvcm0uZGF0YWJhc2UuRGF0YWJhc2VQbGF0Zm9ybTsKaW1wb3J0IG9yZy5l
Y2xpcHNlLnBlcnNpc3RlbmNlLnF1ZXJpZXMuKjsKaW1wb3J0IG9yZy5lY2xpcHNlLnBlcnNpc3Rl
bmNlLnNlcXVlbmNpbmcuU2VxdWVuY2U7CmltcG9ydCBvcmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS5W
ZXJzaW9uOwppbXBvcnQgb3JnLmVjbGlwc2UucGVyc2lzdGVuY2UuaW50ZXJuYWwuZGF0YWJhc2Vh
Y2Nlc3MuQWNjZXNzb3I7CmltcG9ydCBvcmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS5pbnRlcm5hbC5k
YXRhYmFzZWFjY2Vzcy5EYXRhc291cmNlUGxhdGZvcm07CmltcG9ydCBvcmcuZWNsaXBzZS5wZXJz
aXN0ZW5jZS5pbnRlcm5hbC5kYXRhYmFzZWFjY2Vzcy5QbGF0Zm9ybTsKaW1wb3J0IG9yZy5lY2xp
cHNlLnBlcnNpc3RlbmNlLmludGVybmFsLmhlbHBlci4qOwppbXBvcnQgb3JnLmVjbGlwc2UucGVy
c2lzdGVuY2UuaW50ZXJuYWwubG9jYWxpemF0aW9uLio7CmltcG9ydCBvcmcuZWNsaXBzZS5wZXJz
aXN0ZW5jZS5pbnRlcm5hbC5zZWN1cml0eS5TZWN1cmFibGVPYmplY3RIb2xkZXI7CmltcG9ydCBv
cmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS5pbnRlcm5hbC5oZWxwZXIuQ29udmVyc2lvbk1hbmFnZXI7
CmltcG9ydCBvcmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS5pbnRlcm5hbC5zZWN1cml0eS5Qcml2aWxl
Z2VkQWNjZXNzSGVscGVyOwppbXBvcnQgb3JnLmVjbGlwc2UucGVyc2lzdGVuY2UuaW50ZXJuYWwu
c2VjdXJpdHkuUHJpdmlsZWdlZE5ld0luc3RhbmNlRnJvbUNsYXNzOwoKLyoqCiAqIDxwPgogKiA8
Yj5QdXJwb3NlPC9iPjoKICogSG9sZCB0aGUgY29uZmlndXJhdGlvbiBpbmZvcm1hdGlvbiBuZWNl
c3NhcnkgdG8gY29ubmVjdCB0byBhIGRhdGFzb3VyY2UuCiAqIDxwPgogKiA8Yj5EZXNjcmlwdGlv
bjwvYj46CiAqIFRoaXMgaXMgYW4gYWJzdHJhY3QgY2xhc3MgdGhhdCBkZWZpbmVzIHRoZSBjb21t
b24gZGF0YXNvdXJjZSBpbmRlcGVuZGVudCBjb25uZWN0aW9uIGNvbmZpZ3VyYXRpb24uCiAqIEl0
IGlzIGV4dGVuZGVkIHRvIHN1cHBvcnQgc3BlY2lmaWMgZGF0YXNvdXJjZXMgc3VjaCBhcyBKREJD
LCBKQ0EsIFhNTCwgZXRjLgogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIERhdGFzb3VyY2VMb2dp
biBpbXBsZW1lbnRzIG9yZy5lY2xpcHNlLnBlcnNpc3RlbmNlLnNlc3Npb25zLkxvZ2luLCBTZXJp
YWxpemFibGUsIENsb25lYWJsZSB7CgogICAgLyoqIFZlcnNpb24gaW5mbyAqLwogICAgcHJpdmF0
ZSBzdGF0aWMgZmluYWwgU3RyaW5nIHZlcnNpb25TdHJpbmdUZW1wbGF0ZSA9ICJ7MH0gLSB7MX0g
KEJ1aWxkIHsyfSkiOwogICAgcHVibGljIHN0YXRpYyBTdHJpbmcgdmVyc2lvblN0cmluZyA9IG51
bGw7CgogICAgLyoqIENvbm5lY3Rpb24gcHJvcGVydGllcyAoZS5nLiB1c2VyLCBwYXNzd29yZCwg
YW5kIGRyaXZlci1zcGVjaWZpYyBzZXR0aW5ncykgKi8KICAgIHByb3RlY3RlZCBQcm9wZXJ0aWVz
IHByb3BlcnRpZXM7CgogICAgLyoqIEltcGxlbWVudGF0aW9uIG9mIHBsYXRmb3JtLXNwZWNpZmlj
IGJlaGF2aW9ycy4gKi8KICAgIHByb3RlY3RlZCBQbGF0Zm9ybSBwbGF0Zm9ybTsKCiAgICAvKiog
ZmluZGJ1Z3M6IHJlbW92ZWQgdGhlIGVuY3J5cHRlZCBTdHJpbmcgdGhhdCBob2xkcyB0aGUgZXhw
aXJ5IGtleSAqLwoKICAgIC8qKiBUaGUgc2VjdXJhYmxlIG9iamVjdCBob2xkZXIgYW5kIGZsYWcq
LwogICAgcHJpdmF0ZSBib29sZWFuIGlzRW5jcnlwdGVkUGFzc3dvcmRTZXQ7CiAgICBwcml2YXRl
IHRyYW5zaWVudCBTZWN1cmFibGVPYmplY3RIb2xkZXIgc2VjdXJhYmxlT2JqZWN0SG9sZGVyOwoK
ICAgIC8qKiBQcm92aWRlIGEgbGl0dGxlIGZsZXhpYmlsaXR5IGZvciBjb25uZWN0aW5nIHRvIGEg
ZGF0YWJhc2UgKi8KICAgIHByb3RlY3RlZCBDb25uZWN0b3IgY29ubmVjdG9yOwoKICAgIC8qKiBU
cnVlIGlmIHdlIHVzZSBhbiBleHRlcm5hbCBjb25uZWN0aW9uIHBvb2wgc3VjaCBhcyBXZWJMb2dp
YydzIEpUUyBkcml2ZXIgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIHVzZXNFeHRlcm5hbENvbm5l
Y3Rpb25Qb29saW5nOwoKICAgIC8qKiBUcnVlIGlmIHdlIHNob3VsZCB1c2Ugc29tZSBleHRlcm5h
bCB0cmFuc2FjdGlvbiBzZXJ2aWNlIHN1Y2ggYXMgSlRTLiAqLwogICAgcHJvdGVjdGVkIGJvb2xl
YW4gdXNlc0V4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVyOwoKICAgIC8qKgogICAgICogQnkg
ZGVmYXVsdCBjb25jdXJyZW5jeSBpcyBvcHRpbWl6ZWQgYW5kIHRoZSBjYWNoZSBpcyBub3QgbG9j
a2VkIGR1cmluZyByZWFkcyBvciB3cml0ZXMsCiAgICAgKiBUaGlzIGFsbG93cyBmb3IgY29uY3Vy
cmVudCByZWFkaW5nIGFuZCB3cml0aW5nIGFuZCBzaG91bGQgbmV2ZXIgY2F1c2UgYW55IHByb2Js
ZW1zLiAgSWYgdGhlIGFwcGxpY2F0aW9uCiAgICAgKiB1c2VzIG5vIGZvcm0gb2YgbG9ja2luZyB0
aGUgbGFzdCB1bml0IG9mIHdvcmsgdG8gbWVyZ2UgY2hhbmdlcyB3aWxsIHdpbiwgd2l0aCBubyBs
b2NraW5nIGl0IGlzIHBvc3NpYmxlCiAgICAgKiBvbmx5IHVuZGVyIHRoaXMgc2VuZXJpbyBmb3Ig
dHdvIHVuaXQgb2Ygd29ya3MgdG8gbWVyZ2UgY2hhbmdlcyBkaWZmZXJlbnQgdGhhbiB0aGUgZGF0
YWJhc2UgYWx0aG91Z2ggaGlnaGx5IHVubGlrZWx5CiAgICAgKiBhbmQgaWYgb2NjdXJlZCBpcyB0
aGUgZW50aXJlIHB1cnBvc2Ugb2YgbG9ja2luZy4gIFRoaXMgcHJvcGVydHkgYWxsb3dzIGZvciB0
aGUgaXNvbGF0aW9uIGxldmVsIG9mIGNoYW5nZXMgdG8gdGhlCiAgICAgKiBjYWNoZSB0byBiZSBj
b25maWd1cmVkIGZvciBzZXZlciBzaXR1YXRpb24gYW5kIGl0IGlzIG5vdCBzdWdnZXN0IHRoYXQg
dGhpcyBiZSBjaGFuZ2VkLgogICAgICovCiAgICBwcm90ZWN0ZWQgaW50IGNhY2hlVHJhbnNhY3Rp
b25Jc29sYXRpb24gPSBTWU5DUk9OSVpFRF9PQkpFQ1RfTEVWRUxfUkVBRF9XUklURV9EQVRBQkFT
RTsgCgogICAgLyoqIFJlYWRzIGFuZCB1bml0IG9mIHdvcmsgbWVyZ2VzIGNhbiBvY2N1ciBjb25j
dXJyZW50bHkuICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBDT05DVVJSRU5UX1JFQURf
V1JJVEUgPSAxOwoKICAgIC8qKiBSZWFkcyBjYW4gb2NjdXIgY29uY3VycmVudGx5IGJ1dCB1bml0
IG9mIHdvcmsgbWVyZ2VzIHdpbGwgYmUgc2VyaWFsaXplZC4gKi8KICAgIHB1YmxpYyBzdGF0aWMg
ZmluYWwgaW50IFNZTkNIUk9OSVpFRF9XUklURSA9IDI7CgogICAgLyoqIFJlYWRzIGFuZCB1bml0
IG9mIHdvcmsgbWVyZ2VzIHdpbGwgYmUgc2VyaWFsaXplZC4gKi8KICAgIHB1YmxpYyBzdGF0aWMg
ZmluYWwgaW50IFNZTkNIUk9OSVpFRF9SRUFEX09OX1dSSVRFID0gMzsKICAgIAogICAgLyoqIFdy
aXRlcyB0byB0aGUgY2FjaGUgKG1lcmdlLCBvYmplY3QgYnVpbGQvcmVmcmVzaCB3aWxsIGJlIHN5
bmNocm9uaXplZAogICAgICogYXMgd2lsbCBjYWNoZSBhY2Nlc3MgKGNsb25pbmcpIGJhc2VkIG9u
IHdoZW4gYWNjZXNzIGlzIHJlcXVpcmVkLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFs
IGludCBTWU5DUk9OSVpFRF9PQkpFQ1RfTEVWRUxfUkVBRF9XUklURSA9IDQ7CgogICAgLyoqIFdy
aXRlcyB0byB0aGUgY2FjaGUgKG1lcmdlLCBvYmplY3QgYnVpbGQvcmVmcmVzaCB3aWxsIGJlIHN5
bmNocm9uaXplZAogICAgICogYXMgd2lsbCBjYWNoZSBhY2Nlc3MgKGNsb25pbmcpIGJhc2VkIG9u
IGRhdGFiYXNlIHRyYW5zYWN0aW9uLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGlu
dCBTWU5DUk9OSVpFRF9PQkpFQ1RfTEVWRUxfUkVBRF9XUklURV9EQVRBQkFTRSA9IDU7CgogICAg
LyoqCiAgICAgKiBQVUJMSUM6CiAgICAgKiBDcmVhdGUgYSBuZXcgbG9naW4uCiAgICAgKi8KICAg
IHB1YmxpYyBEYXRhc291cmNlTG9naW4oKSB7CiAgICAgICAgdGhpcyhuZXcgRGF0YXNvdXJjZVBs
YXRmb3JtKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQURWQU5DRUQ6CiAgICAgKiBDcmVhdGUg
YSBuZXcgbG9naW4gZm9yIHRoZSBnaXZlbiBwbGF0Zm9ybS4KICAgICAqLwogICAgcHVibGljIERh
dGFzb3VyY2VMb2dpbihQbGF0Zm9ybSBkYXRhYmFzZVBsYXRmb3JtKSB7CiAgICAgICAgdGhpcy5w
bGF0Zm9ybSA9IGRhdGFiYXNlUGxhdGZvcm07CgogICAgICAgIHRoaXMuZG9udFVzZUV4dGVybmFs
Q29ubmVjdGlvblBvb2xpbmcoKTsKICAgICAgICB0aGlzLmRvbnRVc2VFeHRlcm5hbFRyYW5zYWN0
aW9uQ29udHJvbGxlcigpOwoKICAgICAgICB0aGlzLnByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGll
cygpOwogICAgICAgIHRoaXMucHJvcGVydGllcy5wdXQoInVzZXIiLCAiIik7CiAgICAgICAgLy8g
QnVnIDQxMTc0NDEgLSBTZWN1cmUgcHJvZ3JhbW1pbmcgcHJhY3RpY2VzLCBzdG9yZSBwYXNzd29y
ZCBpbiBjaGFyW10KICAgICAgICB0aGlzLnByb3BlcnRpZXMucHV0KCJwYXNzd29yZCIsIG5ldyBj
aGFyWzBdKTsKICAgICAgICB0aGlzLmlzRW5jcnlwdGVkUGFzc3dvcmRTZXQgPSBmYWxzZTsKICAg
ICAgICB0aGlzLnNlY3VyYWJsZU9iamVjdEhvbGRlciA9IG5ldyBTZWN1cmFibGVPYmplY3RIb2xk
ZXIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIElOVEVSTkFMOgogICAgICogUmV0dXJuIHRoZSBl
bmNyeXB0aW9uIHNlY3VyYWJsZSBob2xkZXIuCiAgICAgKiBMYXp5IGluaXRpYWxpemUgdG8gaGFu
ZGxlIHNlcmlhbGl6YXRpb24uCiAgICAgKi8KICAgIHByb3RlY3RlZCBTZWN1cmFibGVPYmplY3RI
b2xkZXIgZ2V0U2VjdXJhYmxlT2JqZWN0SG9sZGVyKCkgewogICAgICAgIGlmIChzZWN1cmFibGVP
YmplY3RIb2xkZXIgPT0gbnVsbCkgewogICAgICAgICAgICBzZWN1cmFibGVPYmplY3RIb2xkZXIg
PSBuZXcgU2VjdXJhYmxlT2JqZWN0SG9sZGVyKCk7CiAgICAgICAgICAgIHNlY3VyYWJsZU9iamVj
dEhvbGRlci5nZXRTZWN1cmFibGVPYmplY3QoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNl
Y3VyYWJsZU9iamVjdEhvbGRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIElOVEVSTkFMOgogICAg
ICogQ2xvbmUgdGhlIGxvZ2luLgogICAgICogVGhpcyBhbHNvIGNsb25lcyB0aGUgcGxhdGZvcm0g
YXMgaXQgaXMgaW50ZXJuYWwgdG8gdGhlIGxvZ2luLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0
IGNsb25lKCkgewogICAgICAgIERhdGFzb3VyY2VMb2dpbiBjbG9uZSA9IG51bGw7CiAgICAgICAg
dHJ5IHsKICAgICAgICAgICAgY2xvbmUgPSAoRGF0YXNvdXJjZUxvZ2luKXN1cGVyLmNsb25lKCk7
CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAgICAgICAvLyBz
aG91bGQgbm90IGhhcHBlbi4uLmRvIG5vdGhpbmcKICAgICAgICB9CiAgICAgICAgaWYgKGdldENv
bm5lY3RvcigpICE9IG51bGwpIHsKICAgICAgICAgICAgY2xvbmUuc2V0Q29ubmVjdG9yKChDb25u
ZWN0b3IpZ2V0Q29ubmVjdG9yKCkuY2xvbmUoKSk7CiAgICAgICAgfQogICAgICAgIGNsb25lLnNl
dERhdGFzb3VyY2VQbGF0Zm9ybSgoUGxhdGZvcm0pZ2V0RGF0YXNvdXJjZVBsYXRmb3JtKCkuY2xv
bmUoKSk7CiAgICAgICAgY2xvbmUuc2V0UHJvcGVydGllcygoUHJvcGVydGllcylwcm9wZXJ0aWVz
LmNsb25lKCkpOwogICAgICAgIHJldHVybiBjbG9uZTsKICAgIH0KCiAgICAvKioKICAgICAqIElO
VEVSTkFMOgogICAgICogQ29ubmVjdCB0byB0aGUgZGF0YXNvdXJjZSwgYW5kIHJldHVybiB0aGUg
ZHJpdmVyIGxldmVsIGNvbm5lY3Rpb24gb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0
IGNvbm5lY3RUb0RhdGFzb3VyY2UoQWNjZXNzb3IgYWNjZXNzb3IsIFNlc3Npb24gc2Vzc2lvbikg
dGhyb3dzIERhdGFiYXNlRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZ2V0Q29ubmVjdG9yKCku
Y29ubmVjdChwcmVwYXJlUHJvcGVydGllcyhwcm9wZXJ0aWVzKSwgc2Vzc2lvbik7CiAgICB9Cgog
ICAgLyoqCiAgICAgKiBBRFZBTkNFRDoKICAgICAqIEJ5IGRlZmF1bHQgY29uY3VycmVuY3kgaXMg
b3B0aW1pemVkIGFuZCB0aGUgY2FjaGUgaXMgbm90IGxvY2tlZCBtb3JlIHRoYW4gcmVxdWlyZWQg
ZHVyaW5nIHJlYWRzIG9yIHdyaXRlcywKICAgICAqIFRoaXMgYWxsb3dzIGZvciB2aXJ0dWFsIGNv
bmN1cnJlbnQgcmVhZGluZyBhbmQgd3JpdGluZyBhbmQgc2hvdWxkIG5ldmVyIGNhdXNlIGFueSBw
cm9ibGVtcy4gIElmIHRoZSBhcHBsaWNhdGlvbgogICAgICogdXNlcyBubyBmb3JtIG9mIGxvY2tp
bmcgdGhlIGxhc3QgdW5pdCBvZiB3b3JrIHRvIG1lcmdlIGNoYW5nZXMgd2lsbCB3aW4sIHdpdGgg
bm8gbG9ja2luZyBpdCBpcyBwb3NzaWJsZQogICAgICogb25seSB1bmRlciB0aGlzIHNlbmVyaW8g
Zm9yIHR3byB1bml0IG9mIHdvcmtzIHRvIG1lcmdlIGNoYW5nZXMgZGlmZmVyZW50IHRoYW4gdGhl
IGRhdGFiYXNlIGFsdGhvdWdoIGhpZ2hseSB1bmxpa2VseQogICAgICogYW5kIGlmIG9jY3VyZWQg
aXMgdGhlIGVudGlyZSBwdXJwb3NlIG9mIGxvY2tpbmcgYW5kIGxvY2tpbmcgaXMgdGhlIHN1Z2dl
c3RlZCBzb2x1dGlvbiBpZiB0aGlzIGlzIGEgcHJvYmxlbS4KICAgICAqIFRoaXMgcHJvcGVydHkg
YWxsb3dzIGZvciB0aGUgaXNvbGF0aW9uIGxldmVsIG9mIGNoYW5nZXMgdG8gdGhlCiAgICAgKiBj
YWNoZSB0byBiZSBjb25maWd1cmVkIGZvciBzZXZlciBzaXR1YXRpb25zIGFuZCBpdCBpcyBub3Qg
c3VnZ2VzdCB0aGF0IHRoaXMgYmUgY2hhbmdlZC4KICAgICAqIDxwPlNldHRpbmcgYXJlOjx1bD4K
ICAgICAqIDxsaT5Db25jdXJyZW50UmVhZFdyaXRlIC0gZGVmYXVsdAogICAgICogPGxpPlN5bmNo
cm9uaXplZFdyaXRlIC0gb25seSBhbGxvdyBhIHNpbmdsZSB3cml0ZXIgKGkuZS4gdW5pdCBvZiB3
b3JrIG1lcmdlKSB0byB0aGUgY2FjaGUgYXQgb25jZQogICAgICogPGxpPlN5bmNocm9uaXplZFJl
YWRPbldyaXRlIC0gZG8gbm90IGFsbG93IHJlYWRpbmcgb3Igb3RoZXIgdW5pdCBvZiB3b3JrIG1l
cmdlIGVoaWxlIGEgdW5pdCBvZiB3b3JrIGlzIGluIG1lcmdlCiAgICAgKi8KICAgIHB1YmxpYyBp
bnQgZ2V0Q2FjaGVUcmFuc2FjdGlvbklzb2xhdGlvbigpIHsKICAgICAgICByZXR1cm4gY2FjaGVU
cmFuc2FjdGlvbklzb2xhdGlvbjsKICAgIH0KCiAgICAvKioKICAgICAqIEFEVkFOQ0VEOgogICAg
ICogUmV0dXJuIHRoZSBjb25uZWN0b3IgdGhhdCB3aWxsIGluc3RhbnRpYXRlIHRoZSBjb25uZWN0
aW9uLgogICAgICovCiAgICBwdWJsaWMgQ29ubmVjdG9yIGdldENvbm5lY3RvcigpIHsKICAgICAg
ICByZXR1cm4gY29ubmVjdG9yOwogICAgfQoKICAgIC8qKgogICAgICogSU5URVJOQUw6CiAgICAg
KiBSZXR1cm4gdGhlIGRhdGFiYXNlIHBsYXRmb3JtIHNwZWNpZmljIGluZm9ybWF0aW9uLgogICAg
ICogVGhpcyBhbGxvd3MgVG9wTGluayB0byBjb25maWd1cmUgY2VydGFpbiBhZHZhbmNlZCBmZWF0
dXJlcyBmb3IgdGhlIGRhdGFiYXNlIGRlc2lyZWQuCiAgICAgKiBOT1RFOiB0aGlzIG11c3Qgb25s
eSBiZSB1c2VkIGZvciByZWxhdGlvbmFsIHNwZWNpZmljIHVzYWdlIGFuZCB3aWxsIG5vdCB3b3Jr
IGZvcgogICAgICogbm9uLXJlbGF0aW9uYWwgZGF0YXNvdXJjZXMuCiAgICAgKi8KICAgIHB1Ymxp
YyBEYXRhYmFzZVBsYXRmb3JtIGdldFBsYXRmb3JtKCkgewogICAgICAgIHRyeSB7CiAgICAgICAg
ICAgIHJldHVybiAoRGF0YWJhc2VQbGF0Zm9ybSlnZXREYXRhc291cmNlUGxhdGZvcm0oKTsKICAg
ICAgICB9IGNhdGNoIChDbGFzc0Nhc3RFeGNlcHRpb24gd3JvbmdUeXBlKSB7CiAgICAgICAgICAg
IHRocm93IFZhbGlkYXRpb25FeGNlcHRpb24ubm90U3VwcG9ydGVkRm9yRGF0YXNvdXJjZSgpOwog
ICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBVQkxJQzoKICAgICAqIFJldHVybiB0aGUg
ZGF0YXNvdXJjZSBwbGF0Zm9ybSBzcGVjaWZpYyBpbmZvcm1hdGlvbi4KICAgICAqIFRoaXMgYWxs
b3dzIFRvcExpbmsgdG8gY29uZmlndXJlIGNlcnRhaW4gYWR2YW5jZWQgZmVhdHVyZXMgZm9yIHRo
ZSBkYXRhc291cmNlIGRlc2lyZWQuCiAgICAgKi8KICAgIHB1YmxpYyBQbGF0Zm9ybSBnZXREYXRh
c291cmNlUGxhdGZvcm0oKSB7CiAgICAgICAgcmV0dXJuIHBsYXRmb3JtOwogICAgfQoKICAgIC8q
KgogICAgICogSU5URVJOQUw6CiAgICAgKiBUaGUgcHJvcGVydGllcyBhcmUgYWRkaXRpb25hbCwg
ZHJpdmVyLXNwZWNpZmljLCBjb25uZWN0aW9uIGluZm9ybWF0aW9uCiAgICAgKiB0byBiZSBwYXNz
ZWQgdG8gdGhlIGRyaXZlci48cD4KICAgICAqIE5PVEU6IERvIG5vdCBzZXQgdGhlIHBhc3N3b3Jk
IGRpcmVjdGx5IGJ5IGdldHRpbmcgdGhlIHByb3BlcnRpZXMgYW5kCiAgICAgKiBzZXR0aW5nIHRo
ZSAicGFzc3dvcmQiIHByb3BlcnR5IGRpcmVjdGx5LiBVc2UgdGhlIG1ldGhvZCBEYXRhYmFzZUxv
Z2luLnNldFBhc3N3b3JkKFN0cmluZykuCiAgICAgKi8KICAgIHB1YmxpYyBQcm9wZXJ0aWVzIGdl
dFByb3BlcnRpZXMoKSB7CiAgICAgICAgcmV0dXJuIHByb3BlcnRpZXM7CiAgICB9CgogICAgLyoq
CiAgICAgKiBQVUJMSUM6CiAgICAgKiBUaGUgcHJvcGVydGllcyBhcmUgYWRkaXRpb25hbCwgZHJp
dmVyLXNwZWNpZmljLCBjb25uZWN0aW9uIGluZm9ybWF0aW9uCiAgICAgKiB0byBiZSBwYXNzZWQg
dG8gdGhlIGRyaXZlci48cD4KICAgICAqIE5PVEU6IERvIG5vdCBzZXQgdGhlIHBhc3N3b3JkIGRp
cmVjdGx5IGJ5IGdldHRpbmcgdGhlIHByb3BlcnRpZXMgYW5kCiAgICAgKiBzZXR0aW5nIHRoZSAi
cGFzc3dvcmQiIHByb3BlcnR5IGRpcmVjdGx5LiBVc2UgdGhlIG1ldGhvZCBEYXRhYmFzZUxvZ2lu
LnNldFBhc3N3b3JkKFN0cmluZykuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0UHJvcGVy
dHkoU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1cm4gZ2V0UHJvcGVydGllcygpLmdldChuYW1l
KTsKICAgIH0KCiAgICAvKioKICAgICAqIFBVQkxJQzoKICAgICAqIFJldHVybiB0aGUgcXVhbGlm
aWVyIGZvciB0aGUgYWxsIG9mIHRoZSB0YWJsZXMgcmVmZXJlbmNlZCBieSBUb3BMaW5rLgogICAg
ICogVGhpcyBjYW4gYmUgdGhlIGNyZWF0b3Igb2YgdGhlIHRhYmxlIG9yIGRhdGFiYXNlIG5hbWUg
dGhlIHRhYmxlIGV4aXN0cyBvbi4KICAgICAqIFRoaXMgaXMgcmVxdWlyZWQgYnkgc29tZSBkYXRh
YmFzZXMgc3VjaCBhcyBPcmFjbGUgYW5kIERCMi4KICAgICAqIFRoaXMgc2hvdWxkIG9ubHkgYmUg
dXNlZCBpZiBhbGwgb2YgdGhlIHRhYmxlcyBoYXZlIHRoZSBzYW1lIHF1YWxpZmllci4KICAgICAq
IEl0IGNhbiBhbHNvIGJlIHNldCBvbiBlYWNoIGRlc2NyaXB0b3Igd2hlbiB0aGUgdGFibGUgbmFt
ZSBpcyBzcGVjaWZpZWQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VGFibGVRdWFsaWZp
ZXIoKSB7CiAgICAgICAgcmV0dXJuIGdldERhdGFzb3VyY2VQbGF0Zm9ybSgpLmdldFRhYmxlUXVh
bGlmaWVyKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQVUJMSUM6CiAgICAgKiBUaGUgdXNlciBu
YW1lIGlzIHRoZSBkYXRhYmFzZSBsb2dpbiBuYW1lLgogICAgICogU29tZSBkYXRhYmFzZXMgZG8g
bm90IHJlcXVpcmUgYSB1c2VyIG5hbWUgb3IgdGhlIHVzZXIgaXMgb2J0YWluZWQgZnJvbSB0aGUg
T1MsCiAgICAgKiBpbiB0aGlzIGNhc2UgdGhlIHVzZXIgbmFtZSBub3QgYmUgc3BlY2lmaWVkLgog
ICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFVzZXJOYW1lKCkgewogICAgICAgIHJldHVybiBw
cm9wZXJ0aWVzLmdldFByb3BlcnR5KCJ1c2VyIik7CiAgICB9CgoKICAgIC8qKgogICAgICogUFVC
TElDOgogICAgICogVGhpcyB2YWx1ZSBkZWZhdWx0cyB0byBmYWxzZSB3aGVuIG5vdCBvbiBhIERh
dGFiYXNlTG9naW4gYXMgdGhlIGZ1bmN0aW9uYWxpdHkgaGFzIG5vdCBiZWVuIGltcGxlbWVudGVk
CiAgICAgKiBmb3Igb3RoZXIgZGF0YXNvdXJjZSB0eXBlLiAgT24gYW4gU1FMIEV4Y2VwdGlvbiBU
b3BMaW5rIHdpbGwgcGluZyB0aGUgZGF0YWJhc2UgdG8gZGV0ZXJtaW5lCiAgICAgKiBpZiB0aGUg
Y29ubmVjdGlvbiB1c2VkIGNhbiBjb250aW51ZSB0byBiZSB1c2VkIGZvciBxdWVyaWVzLiAgVGhp
cyBzaG91bGQgaGF2ZSBubyBpbXBhY3Qgb24gYXBwbGljYXRpb25zCiAgICAgKiB1bmxlc3MgdGhl
IHVzZXIgaXMgdXNpbmcgcGVzc2ltaXN0aWMgbG9ja2luZyBxdWVyaWVzIHdpdGggJ25vIHdhaXQn
IG9yIGFyZSB1c2luZyBhIHF1ZXJ5IHRpbWVvdXQgZmVhdHVyZS4KICAgICAqIElmIHRoYXQgaXMg
dGhlIGNhc2UgYW5kIHRoZSBhcHBsaWNhdGlvbiBpcyBleHBlcmllbmNpbmcgYSBwZXJmb3JtYW5j
ZSBpbXBhY3QgZnJvbSB0aGUgaGVhbHRoIGNoZWNrIHRoZW4KICAgICAqIHRoaXMgZmVhdHVyZSBj
YW4gYmUgdHVybmVkIG9mZi4gVHVybmluZyB0aGlzIGZlYXR1cmUgb2ZmIHdpbGwgcHJldmVudCBU
b3BMaW5rIGZyb20gYmVpbmcgYWJsZSB0bwogICAgICogcmV0cnkgcXVlcmllcyBpbiB0aGUgY2Fz
ZSBvZiBkYXRhYmFzZSBmYWlsdXJlLiAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNDb25u
ZWN0aW9uSGVhbHRoVmFsaWRhdGVkT25FcnJvcigpewogICAgICAgIHJldHVybiBmYWxzZTsKICAg
IH0KICAgIAogICAgLyoqCiAgICAgKiBQVUJMSUM6CiAgICAgKiBSZXR1cm4gdGhlIFRvcExpbmsg
dmVyc2lvbi4KICAgICAqIEByZXR1cm4gdmVyc2lvbiBvZiBUb3BMaW5rCiAgICAgKi8KICAgIHB1
YmxpYyBzdGF0aWMgU3RyaW5nIGdldFZlcnNpb24oKSB7CiAgICAgICAgaWYgKHZlcnNpb25TdHJp
bmcgPT0gbnVsbCkgewogICAgICAgICAgICBPYmplY3RbXSBhcmdzID0geyBWZXJzaW9uLmdldFBy
b2R1Y3QoKSwgVmVyc2lvbi5nZXRWZXJzaW9uKCksIFZlcnNpb24uZ2V0QnVpbGROdW1iZXIoKSB9
OwogICAgICAgICAgICB2ZXJzaW9uU3RyaW5nID0gTWVzc2FnZUZvcm1hdC5mb3JtYXQodmVyc2lv
blN0cmluZ1RlbXBsYXRlLCBhcmdzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZlcnNpb25T
dHJpbmc7CiAgICB9CgogICAgLyoqCiAgICAgKiBTRUNVUkU6CiAgICAgKiBUaGUgcGFzc3dvcmQg
aW4gdGhlIGxvZ2luIHByb3BlcnRpZXMgaXMgZW5jcnlwdGVkLiBSZXR1cm4gYSBjbG9uZQogICAg
ICogb2YgdGhlIHByb3BlcnRpZXMgd2l0aCB0aGUgcGFzc3dvcmQgZGVjcnlwdGVkLgogICAgICov
CiAgICBwcml2YXRlIFByb3BlcnRpZXMgcHJlcGFyZVByb3BlcnRpZXMoUHJvcGVydGllcyBwcm9w
ZXJ0aWVzKSB7CiAgICAgICAgUHJvcGVydGllcyByZXN1bHQgPSAoUHJvcGVydGllcylwcm9wZXJ0
aWVzLmNsb25lKCk7CiAgICAgICAgT2JqZWN0IHBhc3N3b3JkT2JqZWN0ID0gcmVzdWx0LmdldCgi
cGFzc3dvcmQiKTsKICAgICAgICBpZiAocGFzc3dvcmRPYmplY3QgIT0gbnVsbCkgewogICAgICAg
ICAgICAvLyBGaXggZm9yIGJ1ZyAjIDI3MDA1MjkKICAgICAgICAgICAgLy8gVGhlIHNlY3VyYWJs
ZSBvYmplY3QgaXMgaW5pdGlhbGl6ZWQgb24gZmlyc3QgY2FsbCBvZgogICAgICAgICAgICAvLyBn
ZXRTZWN1cmFibGVPYmplY3QuIFdoZW4gc2V0dGluZyBhbiBlbmNyeXB0ZWQgcGFzc3dvcmQKICAg
ICAgICAgICAgLy8gd2UgZG9uJ3QgbWFrZSB0aGlzIGNhbGwgc2luY2UgaXQgaXMgYWxyZWFkeSBl
bmNyeXB0ZWQsIGhlbmNlLAogICAgICAgICAgICAvLyB3ZSBkbyBub3QgaW5pdGlhbGl6ZSB0aGUg
c2VjdXJhYmxlIG9iamVjdCBvbiB0aGUgaG9sZGVyLgogICAgICAgICAgICAvLwogICAgICAgICAg
ICAvLyBJZiBuZWl0aGVyIHNldFBhc3N3b3JkIG9yIHNldEVuY3J5cHRlZFBhc3N3b3JkIGlzIGNh
bGxlZCAKICAgICAgICAgICAgLy8gKGV4YW1wbGUsIHVzZXIgc2V0cyBwcm9wZXJ0aWVzIHZpYSB0
aGUgc2V0UHJvcGVydGllcyBtZXRob2QpLAogICAgICAgICAgICAvLyB3aGVuIHRoZSB1c2VyIHRy
aWVzIHRvIGNvbm5lY3QgdGhleSAgd2lsbCBnZXQgYSBudWxsIHBvaW50ZXIgCiAgICAgICAgICAg
IC8vIGV4Y2VwdGlvbi4gU28gaWYgdGhlIGhvbGRlciBkb2VzIG5vdCBob2xkIAogICAgICAgICAg
ICAvLyBhIHNlY3VyYWJsZSBvYmplY3Qgb3IgdGhlIHNldEVuY3J5cHRlZFBhc3N3b3JkIGZsYWcg
aXMgbm90IHRydWUsIAogICAgICAgICAgICAvLyBkb24ndCBib3RoZXIgdHJ5aW5nIHRvIGRlY3J5
cHQuCiAgICAgICAgICAgIGlmIChnZXRTZWN1cmFibGVPYmplY3RIb2xkZXIoKS5oYXNTZWN1cmFi
bGVPYmplY3QoKSB8fCBpc0VuY3J5cHRlZFBhc3N3b3JkU2V0KSB7CiAgICAgICAgICAgICAgICAv
LyBCdWcgNDExNzQ0MSAtIFNlY3VyZSBwcm9ncmFtbWluZyBwcmFjdGljZXMsIHN0b3JlIHBhc3N3
b3JkIGluIGNoYXJbXQogICAgICAgICAgICAgICAgLy8gSWYgaXNFbmNyeXB0ZWRQYXNzd29yZFNl
dCBpcyB0cnVlLCBvciB3ZSBoYXZlIGEgU2VjdXJhYmxlT2JqZWN0IHRoZW4gd2Ugc3RvcmVkIAog
ICAgICAgICAgICAgICAgLy8gdGhlIHBhc3N3b3JkIGFzIGEgY2hhcltdLCBhbmQgd2UgbmVlZCB0
byBjb252ZXJ0IGl0IGludG8gYSBTdHJpbmcgZm9yIHRoZSAKICAgICAgICAgICAgICAgIC8vIHBy
ZXBhcmVkIFByb3BlcnRpZXMgb2JqZWN0LgogICAgICAgICAgICAgICAgU3RyaW5nIHBhc3N3b3Jk
U3RyaW5nID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmIChwYXNzd29yZE9iamVjdCBpbnN0YW5j
ZW9mIGNoYXJbXSkgewogICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkU3RyaW5nID0gbmV3IFN0
cmluZygoY2hhcltdKXBhc3N3b3JkT2JqZWN0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAo
cGFzc3dvcmRPYmplY3QgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICAgICAgICAgICAgICBw
YXNzd29yZFN0cmluZyA9IChTdHJpbmcpcGFzc3dvcmRPYmplY3Q7CiAgICAgICAgICAgICAgICB9
CiAgICAgICAgICAgICAgICByZXN1bHQucHV0KCJwYXNzd29yZCIsIGdldFNlY3VyYWJsZU9iamVj
dEhvbGRlcigpLmdldFNlY3VyYWJsZU9iamVjdCgpLmRlY3J5cHRQYXNzd29yZChwYXNzd29yZFN0
cmluZykpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzdWx0Owog
ICAgfQoKICAgIC8qKgogICAgICogUFVCTElDOgogICAgICogU29tZSBkcml2ZXJzIGRvbid0IGxp
a2UgdGhlICJ1c2VyIiBhbmQgInBhc3N3b3JkIiBwcm9wZXJ0aWVzLgogICAgICogVGhleSBjYW4g
YmUgcmVtb3ZlZCB3aXRoIHRoaXMgbWV0aG9kLgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZW1v
dmVQcm9wZXJ0eShTdHJpbmcgcHJvcGVydHlOYW1lKSB7CiAgICAgICAgcHJvcGVydGllcy5yZW1v
dmUocHJvcGVydHlOYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFEVkFOQ0VEOgogICAgICog
QnkgZGVmYXVsdCBjb25jdXJyZW5jeSBpcyBvcHRpbWl6ZWQgYW5kIHRoZSBjYWNoZSBpcyBub3Qg
bG9ja2VkIG1vcmUgdGhhbiByZXF1aXJlZCBkdXJpbmcgcmVhZHMgb3Igd3JpdGVzLAogICAgICog
VGhpcyBhbGxvd3MgZm9yIHZpcnR1YWwgY29uY3VycmVudCByZWFkaW5nIGFuZCB3cml0aW5nIGFu
ZCBzaG91bGQgbmV2ZXIgY2F1c2UgYW55IHByb2JsZW1zLiAgSWYgdGhlIGFwcGxpY2F0aW9uCiAg
ICAgKiB1c2VzIG5vIGZvcm0gb2YgbG9ja2luZyB0aGUgbGFzdCB1bml0IG9mIHdvcmsgdG8gbWVy
Z2UgY2hhbmdlcyB3aWxsIHdpbiwgd2l0aCBubyBsb2NraW5nIGl0IGlzIHBvc3NpYmxlCiAgICAg
KiBvbmx5IHVuZGVyIHRoaXMgc2VuZXJpbyBmb3IgdHdvIHVuaXQgb2Ygd29ya3MgdG8gbWVyZ2Ug
Y2hhbmdlcyBkaWZmZXJlbnQgdGhhbiB0aGUgZGF0YWJhc2UgYWx0aG91Z2ggaGlnaGx5IHVubGlr
ZWx5CiAgICAgKiBhbmQgaWYgb2NjdXJlZCBpcyB0aGUgZW50aXJlIHB1cnBvc2Ugb2YgbG9ja2lu
ZyBhbmQgbG9ja2luZyBpcyB0aGUgc3VnZ2VzdGVkIHNvbHV0aW9uIGlmIHRoaXMgaXMgYSBwcm9i
bGVtLgogICAgICogVGhpcyBwcm9wZXJ0eSBhbGxvd3MgZm9yIHRoZSBpc29sYXRpb24gbGV2ZWwg
b2YgY2hhbmdlcyB0byB0aGUKICAgICAqIGNhY2hlIHRvIGJlIGNvbmZpZ3VyZWQgZm9yIHNldmVy
IHNpdHVhdGlvbnMgYW5kIGl0IGlzIG5vdCBzdWdnZXN0IHRoYXQgdGhpcyBiZSBjaGFuZ2VkLgog
ICAgICogPHA+U2V0dGluZyBhcmU6PHVsPgogICAgICogPGxpPkNvbmN1cnJlbnRSZWFkV3JpdGUg
LSBkZWZhdWx0CiAgICAgKiA8bGk+U3luY2hyb25pemVkV3JpdGUgLSBvbmx5IGFsbG93IGEgc2lu
Z2xlIHdyaXRlciAoaS5lLiB1bml0IG9mIHdvcmsgbWVyZ2UpIHRvIHRoZSBjYWNoZSBhdCBvbmNl
CiAgICAgKiA8bGk+U3luY2hyb25pemVkUmVhZE9uV3JpdGUgLSBkbyBub3QgYWxsb3cgcmVhZGlu
ZyBvciBvdGhlciB1bml0IG9mIHdvcmsgbWVyZ2UgZWhpbGUgYSB1bml0IG9mIHdvcmsgaXMgaW4g
bWVyZ2UKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2FjaGVUcmFuc2FjdGlvbklzb2xhdGlv
bihpbnQgY2FjaGVUcmFuc2FjdGlvbklzb2xhdGlvbikgewogICAgICAgIHRoaXMuY2FjaGVUcmFu
c2FjdGlvbklzb2xhdGlvbiA9IGNhY2hlVHJhbnNhY3Rpb25Jc29sYXRpb247CiAgICB9CgogICAg
LyoqCiAgICAgKiBQVUJMSUM6CiAgICAgKiBTZXQgdGhlIGNvbm5lY3RvciB0aGF0IHdpbGwgaW5z
dGFudGlhdGUgdGhlIGNvbm5lY3Rpb24uCiAgICAgKiBBcyBhbiBleGFtcGxlLCB0byB1c2UgYSBK
TkRJLXN1cHBsaWVkIDxjb2RlPkRhdGFTb3VyY2U8L2NvZGU+LCB1c2UgY29kZQogICAgICogc29t
ZXRoaW5nIGxpa2UgdGhlIGZvbGxvd2luZzoKICAgICAqIDxibG9ja3F1b3RlPjxjb2RlPgogICAg
ICogc2Vzc2lvbi5nZXRMb2dpbigpLnNldENvbm5lY3RvcihuZXcgSk5ESUNvbm5lY3Rvcihjb250
ZXh0LCBkYXRhU291cmNlTmFtZSkpOzxicj4KICAgICAqIHNlc3Npb24ubG9naW4oKTsKICAgICAq
IDwvY29kZT48L2Jsb2NrcXVvdGU+CiAgICAgKiB3aGVyZSB0aGUgPGNvZGU+Y29udGV4dDwvY29k
ZT4gaXMgYW4gaW5zdGFuY2Ugb2YgYSA8Y29kZT5qYXZheC5uYW1pbmcuQ29udGV4dDwvY29kZT4g
YW5kCiAgICAgKiB0aGUgPGNvZGU+ZGF0YVNvdXJjZU5hbWU8L2NvZGU+IHJlZmVycyB0byB0aGUg
bmFtZSBvZiB0aGUgPGNvZGU+RGF0YVNvdXJjZTwvY29kZT4KICAgICAqIHdpdGhpbiB0aGUgY29u
dGV4dC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q29ubmVjdG9yKENvbm5lY3RvciBjb25u
ZWN0b3IpIHsKICAgICAgICB0aGlzLmNvbm5lY3RvciA9IGNvbm5lY3RvcjsKICAgIH0KCiAgICAv
KioKICAgICAqIFBVQkxJQzoKICAgICAqIFRoZSBkZWZhdWx0IHZhbHVlIHRvIHN1YnN0aXR1dGUg
Zm9yIGRhdGFiYXNlIE5VTExzIGNhbiBiZSBjb25maWd1cmVkCiAgICAgKiBvbiBhIHBlci1jbGFz
cyBiYXNpcy4KICAgICAqIEV4YW1wbGU6IGxvZ2luLnNldERlZmF1bHROdWxsVmFsdWUobG9uZy5j
bGFzcywgbmV3IExvbmcoMCkpCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERlZmF1bHROdWxs
VmFsdWUoQ2xhc3MgdHlwZSwgT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgZ2V0RGF0YXNvdXJjZVBs
YXRmb3JtKCkuZ2V0Q29udmVyc2lvbk1hbmFnZXIoKS5zZXREZWZhdWx0TnVsbFZhbHVlKHR5cGUs
IHZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgcGFzc3dvcmQuCiAgICAgKi8K
ICAgIHB1YmxpYyB2b2lkIHNldFBhc3N3b3JkKFN0cmluZyBwYXNzd29yZCkgewogICAgICAgIGlm
IChwYXNzd29yZCAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIFBFUkY6IERvIG5vdCBlbmNyeXB0
IGVtcHR5IHN0cmluZy4KICAgICAgICAgICAgaWYgKHBhc3N3b3JkID09ICIiKSB7CiAgICAgICAg
ICAgICAgICAvLyBlbXB0eSBjaGFyW10gZm9yIGVtcHR5IFN0cmluZwogICAgICAgICAgICAgICAg
c2V0UHJvcGVydHkoInBhc3N3b3JkIiwgbmV3IGNoYXJbMF0pOwogICAgICAgICAgICB9IGVsc2Ug
ewogICAgICAgICAgICAgICAgLy8gZmlyc3QgY2FsbCB0byBnZXQgd2lsbCBpbml0aWFsaXplIHRo
ZSBzZWN1cmFibGUgb2JqZWN0CiAgICAgICAgICAgICAgICAgLy8gQnVnIDQxMTc0NDEgLSBTZWN1
cmUgcHJvZ3JhbW1pbmcgcHJhY3RpY2VzLCBzdG9yZSBwYXNzd29yZCBpbiBjaGFyW10KICAgICAg
ICAgICAgICAgIFN0cmluZyBlbmNyeXB0ZWRQYXNzd29yZCA9IGdldFNlY3VyYWJsZU9iamVjdEhv
bGRlcigpLmdldFNlY3VyYWJsZU9iamVjdCgpLmVuY3J5cHRQYXNzd29yZChwYXNzd29yZCk7IAog
ICAgICAgICAgICAgICAgc2V0UHJvcGVydHkoInBhc3N3b3JkIiwgZW5jcnlwdGVkUGFzc3dvcmQu
dG9DaGFyQXJyYXkoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAg
ICAvLyBpcyBudWxsIHNvIHJlbW92ZSB0aGUgcHJvcGVydHkKICAgICAgICAgICAgcmVtb3ZlUHJv
cGVydHkoInBhc3N3b3JkIik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu
IHRoZSBwYXNzd29yZC4gSXQgd2lsbCBiZSBlbmNyeXB0ZWQuCiAgICAgKi8KICAgIHB1YmxpYyBT
dHJpbmcgZ2V0UGFzc3dvcmQoKSB7CiAgICAgICAgLy8gQnVnIDQxMTc0NDEgLSBTZWN1cmUgcHJv
Z3JhbW1pbmcgcHJhY3RpY2VzLCBzdG9yZSBwYXNzd29yZCBpbiBjaGFyW10KICAgICAgICBjaGFy
W10gcGFzc3dvcmRPYmplY3QgPSAoY2hhcltdKSBwcm9wZXJ0aWVzLmdldCgicGFzc3dvcmQiKTsK
ICAgICAgICBpZiAocGFzc3dvcmRPYmplY3QgIT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4g
bmV3IFN0cmluZyhwYXNzd29yZE9iamVjdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg
IC8vIHJlc3BlY3QgZXhwbGljaXQgZGUtcmVmZXJlbmNpbmcgb2YgcGFzc3dvcmQKICAgICAgICAg
ICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBl
bmNyeXB0ZWQgcGFzc3dvcmQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEVuY3J5cHRlZFBh
c3N3b3JkKFN0cmluZyBwYXNzd29yZCkgewogICAgICAgIC8vIHJlbWVtYmVyIHRoYXQgd2Ugc2V0
IGFuIGVuY3J5cHRlZCBwYXNzd29yZAogICAgICAgIC8vIGZsYWcgd2lsbCBiZSBuZWVkZWQgaW4g
cHJlcGFyZVByb3BlcnRpZXMuCiAgICAgICAgaXNFbmNyeXB0ZWRQYXNzd29yZFNldCA9IHRydWU7
CgogICAgICAgIGlmIChwYXNzd29yZCAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIEJ1ZyA0MTE3
NDQxIC0gU2VjdXJlIHByb2dyYW1taW5nIHByYWN0aWNlcywgc3RvcmUgcGFzc3dvcmQgaW4gY2hh
cltdCiAgICAgICAgICAgIHNldFByb3BlcnR5KCJwYXNzd29yZCIsIHBhc3N3b3JkLnRvQ2hhckFy
cmF5KCkpOwogICAgICAgIH0gZWxzZSB7Ly8gaXMgbnVsbCBzbyByZW1vdmUgdGhlIHByb3BlcnR5
CiAgICAgICAgICAgIHJlbW92ZVByb3BlcnR5KCJwYXNzd29yZCIpOwogICAgICAgIH0KICAgIH0K
CiAgICAvKioKICAgICAqIFNldHMgdGhlIGVuY3J5cHRpb24gY2xhc3MgbmFtZQogICAgICovCiAg
ICBwdWJsaWMgdm9pZCBzZXRFbmNyeXB0aW9uQ2xhc3NOYW1lKFN0cmluZyBlbmNyeXB0aW9uQ2xh
c3NOYW1lKSB7CiAgICAgICAgZ2V0U2VjdXJhYmxlT2JqZWN0SG9sZGVyKCkuc2V0RW5jcnlwdGlv
bkNsYXNzTmFtZShlbmNyeXB0aW9uQ2xhc3NOYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIElO
VEVSTkFMOgogICAgICogU2V0IHRoZSBkYXRhYmFzZSBwbGF0Zm9ybSBzcGVjaWZpYyBpbmZvcm1h
dGlvbi4KICAgICAqIFRoaXMgYWxsb3dzIFRvcExpbmsgdG8gY29uZmlndXJlIGNlcnRhaW4gYWR2
YW5jZWQgZmVhdHVyZXMgZm9yIHRoZSBkYXRhYmFzZSBkZXNpcmVkLgogICAgICovCiAgICBwdWJs
aWMgdm9pZCBzZXRQbGF0Zm9ybShQbGF0Zm9ybSBwbGF0Zm9ybSkgewogICAgICAgIHNldERhdGFz
b3VyY2VQbGF0Zm9ybShwbGF0Zm9ybSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQVUJMSUM6CiAg
ICAgKiBTZXQgdGhlIGRhdGFiYXNlIHBsYXRmb3JtIHNwZWNpZmljIGluZm9ybWF0aW9uLgogICAg
ICogVGhpcyBhbGxvd3MgVG9wTGluayB0byBjb25maWd1cmUgY2VydGFpbiBhZHZhbmNlZCBmZWF0
dXJlcyBmb3IgdGhlIGRhdGFiYXNlIGRlc2lyZWQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl
dERhdGFzb3VyY2VQbGF0Zm9ybShQbGF0Zm9ybSBwbGF0Zm9ybSkgewogICAgICAgIHRoaXMucGxh
dGZvcm0gPSBwbGF0Zm9ybTsKICAgIH0KCiAgICAvKioKICAgICAqIElOVEVSTkFMOgogICAgICog
UmV0dXJuIHRoZSBuYW1lIG9mIHRoZSBkYXRhYmFzZSBwbGF0Zm9ybSBjbGFzcy4KICAgICAqLwog
ICAgcHVibGljIFN0cmluZyBnZXRQbGF0Zm9ybUNsYXNzTmFtZSgpIHsKICAgICAgICByZXR1cm4g
Z2V0RGF0YXNvdXJjZVBsYXRmb3JtKCkuZ2V0Q2xhc3MoKS5nZXROYW1lKCk7CiAgICB9CgogICAg
LyoqCiAgICAgKiBJTlRFUk5BTDoKICAgICAqIFNldCB0aGUgbmFtZSBvZiB0aGUgUGxhdGZvcm0g
dG8gYmUgdXNlZC4KICAgICAqIENyZWF0ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIHNwZWNpZmll
ZCBDbGFzcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UGxhdGZvcm1DbGFzc05hbWUoU3Ry
aW5nIHBsYXRmb3JtQ2xhc3NOYW1lKSB0aHJvd3MgVmFsaWRhdGlvbkV4Y2VwdGlvbiB7CiAgICAJ
c2V0UGxhdGZvcm1DbGFzc05hbWUocGxhdGZvcm1DbGFzc05hbWUsIG51bGwpOwogICAgfQoKICAg
IHB1YmxpYyB2b2lkIHNldFBsYXRmb3JtQ2xhc3NOYW1lKFN0cmluZyBwbGF0Zm9ybUNsYXNzTmFt
ZSwgQ2xhc3NMb2FkZXIgbG9hZGVyKSB0aHJvd3MgVmFsaWRhdGlvbkV4Y2VwdGlvbiB7CiAgICAg
ICAgQ2xhc3MgcGxhdGZvcm1DbGFzcyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg
Ly9GaXJzdCB0cnkgbG9hZGluZyB3aXRoIHRoZSBMb2dpbidzIGNsYXNzIGxvYWRlcgogICAgICAg
ICAgICBwbGF0Zm9ybUNsYXNzID0gdGhpcy5nZXRDbGFzcygpLmdldENsYXNzTG9hZGVyKCkubG9h
ZENsYXNzKHBsYXRmb3JtQ2xhc3NOYW1lKTsKICAgICAgICAgICAgUGxhdGZvcm0gcGxhdGZvcm0g
PSBudWxsOwogICAgICAgICAgICBpZiAoUHJpdmlsZWdlZEFjY2Vzc0hlbHBlci5zaG91bGRVc2VQ
cml2aWxlZ2VkQWNjZXNzKCkpewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg
ICAgICBwbGF0Zm9ybSA9IChQbGF0Zm9ybSlBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChu
ZXcgUHJpdmlsZWdlZE5ld0luc3RhbmNlRnJvbUNsYXNzKHBsYXRmb3JtQ2xhc3MpKTsKICAgICAg
ICAgICAgICAgIH0gY2F0Y2ggKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24gZXhjZXB0aW9uKSB7
CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXhjZXB0aW9uLmdldEV4Y2VwdGlvbigpOwogICAg
ICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcGxhdGZv
cm0gPSAoUGxhdGZvcm0pUHJpdmlsZWdlZEFjY2Vzc0hlbHBlci5uZXdJbnN0YW5jZUZyb21DbGFz
cyhwbGF0Zm9ybUNsYXNzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB1c2VQbGF0Zm9ybShw
bGF0Zm9ybSk7CiAgICAgICAgfSBjYXRjaChFeGNlcHRpb24gY25lKSB7CiAgICAgICAgICAgIC8v
bmV4dCB0cnkgdXNpbmcgQ29udmVyc2lvbk1hbmFnZXIKICAgICAgICAgICAgdHJ5IHsKICAgICAg
ICAgICAgICAgIFBsYXRmb3JtIHBsYXRmb3JtID0gbnVsbDsKICAgICAgICAgICAgICAgIC8vIFRP
RE86IGludmVzdGlnYXRlIHdoeSBDb252ZXJzaW9uTWFuYWdlciBoYXMgdGhlIHdyb25nIGNsYXNz
bG9hZGVyCiAgICAgICAgICAgIAlpZiAobG9hZGVyID09IG51bGwpIHsKICAgICAgICAgICAgCQlw
bGF0Zm9ybUNsYXNzID0gQ29udmVyc2lvbk1hbmFnZXIubG9hZENsYXNzKHBsYXRmb3JtQ2xhc3NO
YW1lKTsKICAgICAgICAgICAgCX0gZWxzZSB7CiAgICAgICAgICAgIAkJcGxhdGZvcm1DbGFzcyA9
IGxvYWRlci5sb2FkQ2xhc3MocGxhdGZvcm1DbGFzc05hbWUpOwogICAgICAgICAgICAJfQogICAg
ICAgICAgICAgICAgaWYgKFByaXZpbGVnZWRBY2Nlc3NIZWxwZXIuc2hvdWxkVXNlUHJpdmlsZWdl
ZEFjY2VzcygpKXsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg
ICAgICBwbGF0Zm9ybSA9IChQbGF0Zm9ybSlBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChu
ZXcgUHJpdmlsZWdlZE5ld0luc3RhbmNlRnJvbUNsYXNzKHBsYXRmb3JtQ2xhc3MpKTsKICAgICAg
ICAgICAgICAgICAgICB9IGNhdGNoIChQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uIGV4Y2VwdGlv
bikgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBWYWxpZGF0aW9uRXhjZXB0aW9uLnBs
YXRmb3JtQ2xhc3NOb3RGb3VuZChleGNlcHRpb24uZ2V0RXhjZXB0aW9uKCksIHBsYXRmb3JtQ2xh
c3NOYW1lKTsgIAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7
CiAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm0gPSAoUGxhdGZvcm0pUHJpdmlsZWdlZEFjY2Vz
c0hlbHBlci5uZXdJbnN0YW5jZUZyb21DbGFzcyhwbGF0Zm9ybUNsYXNzKTsKICAgICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgICAgIHVzZVBsYXRmb3JtKHBsYXRmb3JtKTsKICAgICAgICAgICAg
fSBjYXRjaChFeGNlcHRpb24gY25lMikgewogICAgICAgICAgICAgICAgLy9pZiBzdGlsbCBub3Qg
Zm91bmQsIHRocm93IGV4Y2VwdGlvbgogICAgICAgICAgICAgICAgdGhyb3cgVmFsaWRhdGlvbkV4
Y2VwdGlvbi5wbGF0Zm9ybUNsYXNzTm90Rm91bmQoY25lMiwgcGxhdGZvcm1DbGFzc05hbWUpOyAg
ICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg
ICAqIEFEVkFOQ0VEOgogICAgICogU2V0IHRoZSBkYXRhYmFzZSBwbGF0Zm9ybSB0byBiZSBjdXN0
b20gcGxhdGZvcm0uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHVzZVBsYXRmb3JtKFBsYXRmb3Jt
IHBsYXRmb3JtKSB7CiAgICAgICAgaWYgKGdldERhdGFzb3VyY2VQbGF0Zm9ybSgpICE9IG51bGwp
IHsKICAgICAgICAgICAgZ2V0RGF0YXNvdXJjZVBsYXRmb3JtKCkuY29weUludG8ocGxhdGZvcm0p
OwogICAgICAgIH0KICAgICAgICBzZXRQbGF0Zm9ybShwbGF0Zm9ybSk7CiAgICB9CgogICAgLyoq
CiAgICAgKiBQVUJMSUM6CiAgICAgKiBUaGUgcHJvcGVydGllcyBhcmUgYWRkaXRpb25hbCwgZHJp
dmVyLXNwZWNpZmljLCBjb25uZWN0aW9uIGluZm9ybWF0aW9uCiAgICAgKiB0byBiZSBwYXNzZWQg
dG8gdGhlIEpEQkMgZHJpdmVyLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQcm9wZXJ0aWVz
KFByb3BlcnRpZXMgcHJvcGVydGllcykgewogICAgICAgIHRoaXMucHJvcGVydGllcyA9IHByb3Bl
cnRpZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBQVUJMSUM6CiAgICAgKiBTb21lIEpEQkMgZHJp
dmVycyByZXF1aXJlIGFkZGl0aW9uYWwsIGRyaXZlci1zcGVjaWZpYywgcHJvcGVydGllcy4KICAg
ICAqIEFkZCB0aGUgc3BlY2lmaWVkIHByb3BlcnR5IHRvIHRob3NlIHRvIGJlIHBhc3NlZCB0byB0
aGUgSkRCQyBkcml2ZXIuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFByb3BlcnR5KFN0cmlu
ZyBwcm9wZXJ0eU5hbWUsIE9iamVjdCBwcm9wZXJ0eVZhbHVlKSB7CiAgICAgICAgcHJvcGVydGll
cy5wdXQocHJvcGVydHlOYW1lLCBwcm9wZXJ0eVZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAq
IFBVQkxJQzoKICAgICAqIFNldCB0aGUgZGVmYXVsdCBxdWFsaWZpZXIgZm9yIGFsbCB0YWJsZXMu
CiAgICAgKiBUaGlzIGNhbiBiZSB0aGUgY3JlYXRvciBvZiB0aGUgdGFibGUgb3IgZGF0YWJhc2Ug
bmFtZSB0aGUgdGFibGUgZXhpc3RzIG9uLgogICAgICogVGhpcyBpcyByZXF1aXJlZCBieSBzb21l
IGRhdGFiYXNlcyBzdWNoIGFzIE9yYWNsZSBhbmQgREIyLgogICAgICovCiAgICBwdWJsaWMgdm9p
ZCBzZXRUYWJsZVF1YWxpZmllcihTdHJpbmcgcXVhbGlmaWVyKSB7CiAgICAgICAgZ2V0RGF0YXNv
dXJjZVBsYXRmb3JtKCkuc2V0VGFibGVRdWFsaWZpZXIocXVhbGlmaWVyKTsKICAgIH0KCiAgICAv
KioKICAgICAqIFBVQkxJQzoKICAgICAqIE92ZXJyaWRlIHRoZSBkZWZhdWx0IHF1ZXJ5IGZvciBy
ZXR1cm5pbmcgYSB0aW1lc3RhbXAgZnJvbSB0aGUgc2VydmVyLgogICAgICovCiAgICBwdWJsaWMg
dm9pZCBzZXRUaW1lc3RhbXBRdWVyeShWYWx1ZVJlYWRRdWVyeSB0aW1lc3RhbXBRdWVyeSkgewog
ICAgICAgIGdldERhdGFzb3VyY2VQbGF0Zm9ybSgpLnNldFRpbWVzdGFtcFF1ZXJ5KHRpbWVzdGFt
cFF1ZXJ5KTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBQVUJMSUM6CiAgICAgKiBUaGUgdXNlciBu
YW1lIGlzIHRoZSBkYXRhYmFzZSBsb2dpbiBuYW1lLgogICAgICogU29tZSBkYXRhYmFzZXMgZG8g
bm90IHJlcXVpcmUgYSB1c2VyIG5hbWUgb3IgdGhlIHVzZXIgaXMgb2J0YWluZWQgZnJvbSB0aGUg
T1MsCiAgICAgKiBpbiB0aGlzIGNhc2UgdGhpcyBzaG91bGQgbm90IGJlIHNwZWNpZmllZC4KICAg
ICAqLwogICAgcHVibGljIHZvaWQgc2V0VXNlck5hbWUoU3RyaW5nIG5hbWUpIHsKICAgICAgICBp
ZiAobmFtZSAhPSBudWxsKSB7CiAgICAgICAgICAgIHNldFByb3BlcnR5KCJ1c2VyIiwgbmFtZSk7
CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUFVCTElDOgogICAgICogUmV0dXJuIHdo
ZXRoZXIgVG9wTGluayB1c2VzIHNvbWUgZXh0ZXJuYWwgY29ubmVjdGlvbiBwb29saW5nIHNlcnZp
Y2Ugc3VjaCBhcyBhIEpEQkMgMi4wIGRyaXZlci4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0
VXNlc0V4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcoYm9vbGVhbiB1c2VzRXh0ZXJuYWxDb25uZWN0
aW9uUG9vbGluZykgewogICAgICAgIHRoaXMudXNlc0V4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcg
PSB1c2VzRXh0ZXJuYWxDb25uZWN0aW9uUG9vbGluZzsKICAgIH0KCiAgICAvKioKICAgICAqIFBV
QkxJQzoKICAgICAqIFJldHVybiB3aGV0aGVyIFRvcExpbmsgdXNlcyBzb21lIGV4dGVybmFsIHRy
YW5zYWN0aW9uIHNlcnZpY2Ugc3VjaCBhcyBKVFMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl
dFVzZXNFeHRlcm5hbFRyYW5zYWN0aW9uQ29udHJvbGxlcihib29sZWFuIHVzZXNFeHRlcm5hbFRy
YW5zYWN0aW9uQ29udHJvbGxlcikgewogICAgICAgIHRoaXMudXNlc0V4dGVybmFsVHJhbnNhY3Rp
b25Db250cm9sbGVyID0gdXNlc0V4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVyOwogICAgfQoK
ICAgIC8qKgogICAgICogUFVCTElDOgogICAgICogRG8gbm90IHVzZSBleHRlcm5hbCBjb25uZWN0
aW9uIHBvb2xpbmcuIFRoaXMgaXMgYXBwcm9wcmlhdGUgaWYgdXNpbmcgcmVndWxhcgogICAgICog
VG9wTGluayBjb25uZWN0aW9uIHBvb2xpbmcgYW5kIHJlZ3VsYXIgSkRCQyBkcml2ZXJzLgogICAg
ICoKICAgICAqIEBzZWUgI3VzZUV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcoKQogICAgICovCiAg
ICBwdWJsaWMgdm9pZCBkb250VXNlRXh0ZXJuYWxDb25uZWN0aW9uUG9vbGluZygpIHsKICAgICAg
ICBzZXRVc2VzRXh0ZXJuYWxDb25uZWN0aW9uUG9vbGluZyhmYWxzZSk7CiAgICB9CgogICAgLyoq
CiAgICAgKiBQVUJMSUM6CiAgICAgKiBMZXQgVG9wTGluayBjb250cm9sIHRyYW5zYWN0aW9ucyBp
bnN0ZWFkIG9mIHNvbWUgZXh0ZXJuYWwgdHJhbnNhY3Rpb24KICAgICAqIHNlcnZpY2Ugc3VjaCBh
cyBKVFMuCiAgICAgKgogICAgICogQHNlZSAjdXNlRXh0ZXJuYWxUcmFuc2FjdGlvbkNvbnRyb2xs
ZXIoKQogICAgICovCiAgICBwdWJsaWMgdm9pZCBkb250VXNlRXh0ZXJuYWxUcmFuc2FjdGlvbkNv
bnRyb2xsZXIoKSB7CiAgICAgICAgc2V0VXNlc0V4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVy
KGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIElOVEVSTkFMOgogICAgICogVXNlZCBmb3Ig
Y2FjaGUgaXNvbGF0aW9uLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBzaG91bGRBbGxvd0Nv
bmN1cnJlbnRSZWFkV3JpdGUoKSB7CiAgICAgICAgcmV0dXJuIGdldENhY2hlVHJhbnNhY3Rpb25J
c29sYXRpb24oKSA9PSBDT05DVVJSRU5UX1JFQURfV1JJVEU7CiAgICB9CgogICAgLyoqCiAgICAg
KiBJTlRFUk5BTDoKICAgICAqIFVzZWQgZm9yIGNhY2hlIGlzb2xhdGlvbi4KICAgICAqLwogICAg
cHVibGljIGJvb2xlYW4gc2hvdWxkU3luY2hyb25pemVkUmVhZE9uV3JpdGUoKSB7CiAgICAgICAg
cmV0dXJuIGdldENhY2hlVHJhbnNhY3Rpb25Jc29sYXRpb24oKSA9PSBTWU5DSFJPTklaRURfUkVB
RF9PTl9XUklURTsKICAgIH0KCiAgICAvKioKICAgICAqIElOVEVSTkFMOgogICAgICogVXNlZCBm
b3IgQ2FjaGUgSXNvbGF0aW9uLiAgQ2F1c2VzIFRvcExpbmsgdG8gbG9jayBhdCB0aGUgY2xhc3Mg
bGV2ZWwgb24KICAgICAqIGNhY2hlIHVwZGF0ZXMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu
IHNob3VsZFN5bmNocm9uaXplV3JpdGVzKCkgewogICAgICAgIHJldHVybiBnZXRDYWNoZVRyYW5z
YWN0aW9uSXNvbGF0aW9uKCkgPT0gU1lOQ0hST05JWkVEX1dSSVRFOwogICAgfQogICAgCiAgICAv
KioKICAgICAqIElOVEVSTkFMOgogICAgICogVXNlZCBmb3IgQ2FjaGUgSXNvbGF0aW9uLiAgQ2F1
c2VzIFRvcExpbmsgdG8gbG9jayBhdCB0aGUgb2JqZWN0IGxldmVsIG9uCiAgICAgKiBjYWNoZSB1
cGRhdGVzIGFuZCBjYWNoZSBhY2Nlc3MuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHNob3Vs
ZFN5bmNocm9uaXplT2JqZWN0TGV2ZWxSZWFkV3JpdGUoKXsKICAgICAgICByZXR1cm4gZ2V0Q2Fj
aGVUcmFuc2FjdGlvbklzb2xhdGlvbigpID09IFNZTkNST05JWkVEX09CSkVDVF9MRVZFTF9SRUFE
X1dSSVRFOwogICAgfQogICAgCiAgICAvKioKICAgICAqIElOVEVSTkFMOgogICAgICogVXNlZCBm
b3IgQ2FjaGUgSXNvbGF0aW9uLiAgQ2F1c2VzIFRvcExpbmsgdG8gbG9jayBhdCB0aGUgb2JqZWN0
IGxldmVsIG9uCiAgICAgKiBjYWNoZSB1cGRhdGVzIGFuZCBjYWNoZSBhY2Nlc3MsIGJhc2VkIG9u
IGRhdGFiYXNlIHRyYW5zYWN0aW9uLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBzaG91bGRT
eW5jaHJvbml6ZU9iamVjdExldmVsUmVhZFdyaXRlRGF0YWJhc2UoKXsKICAgICAgICByZXR1cm4g
Z2V0Q2FjaGVUcmFuc2FjdGlvbklzb2xhdGlvbigpID09IFNZTkNST05JWkVEX09CSkVDVF9MRVZF
TF9SRUFEX1dSSVRFX0RBVEFCQVNFOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFBVQkxJQzoK
ICAgICAqIFJldHVybiB3aGV0aGVyIFRvcExpbmsgdXNlcyBzb21lIGV4dGVybmFsIGNvbm5lY3Rp
b24gcG9vbGluZwogICAgICogKGUuZy4gV2ViTG9naWMncyBKVFMgZHJpdmVyKS4KICAgICAqCiAg
ICAgKiBAc2VlICN1c2VFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCkKICAgICAqIEBzZWUgI2Rv
bnRVc2VFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCkKICAgICAqLwogICAgcHVibGljIGJvb2xl
YW4gc2hvdWxkVXNlRXh0ZXJuYWxDb25uZWN0aW9uUG9vbGluZygpIHsKICAgICAgICByZXR1cm4g
dXNlc0V4dGVybmFsQ29ubmVjdGlvblBvb2xpbmc7CiAgICB9CgogICAgLyoqCiAgICAgKiBQVUJM
SUM6CiAgICAgKiBSZXR1cm4gd2hldGhlciBUb3BMaW5rIHVzZXMgc29tZSBleHRlcm5hbCB0cmFu
c2FjdGlvbiBzZXJ2aWNlIHN1Y2ggYXMgSlRTLgogICAgICoKICAgICAqIEBzZWUgI3VzZUV4dGVy
bmFsVHJhbnNhY3Rpb25Db250cm9sbGVyKCkKICAgICAqIEBzZWUgI2RvbnRVc2VFeHRlcm5hbFRy
YW5zYWN0aW9uQ29udHJvbGxlcigpCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHNob3VsZFVz
ZUV4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVyKCkgewogICAgICAgIHJldHVybiB1c2VzRXh0
ZXJuYWxUcmFuc2FjdGlvbkNvbnRyb2xsZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBQVUJMSUM6
CiAgICAgKiBVc2UgZXh0ZXJuYWwgY29ubmVjdGlvbiBwb29saW5nLgogICAgICoKICAgICAqIEBz
ZWUgI2RvbnRVc2VFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCkKICAgICAqIEBzZWUgI3Nob3Vs
ZFVzZUV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcoKQogICAgICovCiAgICBwdWJsaWMgdm9pZCB1
c2VFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCkgewogICAgICAgIHNldFVzZXNFeHRlcm5hbENv
bm5lY3Rpb25Qb29saW5nKHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogUFVCTElDOgogICAg
ICogVXNlIGFuIGV4dGVybmFsIHRyYW5zYWN0aW9uIGNvbnRyb2xsZXIgc3VjaCBhcyBhIEpUUyBz
ZXJ2aWNlCiAgICAgKgogICAgICogQHNlZSAjZG9udFVzZUV4dGVybmFsVHJhbnNhY3Rpb25Db250
cm9sbGVyKCkKICAgICAqIEBzZWUgI3Nob3VsZFVzZUV4dGVybmFsVHJhbnNhY3Rpb25Db250cm9s
bGVyKCkKICAgICAqLwogICAgcHVibGljIHZvaWQgdXNlRXh0ZXJuYWxUcmFuc2FjdGlvbkNvbnRy
b2xsZXIoKSB7CiAgICAgICAgc2V0VXNlc0V4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVyKHRy
dWUpOwogICAgfQoKICAgIC8qKgogICAgICogUFVCTElDOgogICAgICogUHJpbnQgYWxsIG9mIHRo
ZSBjb25uZWN0aW9uIGluZm9ybWF0aW9uLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIHRvU3Ry
aW5nKCkgewogICAgICAgIFN0cmluZ1dyaXRlciBzdHJpbmdXcml0ZXIgPSBuZXcgU3RyaW5nV3Jp
dGVyKCk7CiAgICAgICAgUHJpbnRXcml0ZXIgd3JpdGVyID0gbmV3IFByaW50V3JpdGVyKHN0cmlu
Z1dyaXRlcik7CiAgICAgICAgd3JpdGVyLndyaXRlKEhlbHBlci5nZXRTaG9ydENsYXNzTmFtZShn
ZXRDbGFzcygpKSk7CiAgICAgICAgd3JpdGVyLnByaW50bG4oIigiKTsKICAgICAgICB3cml0ZXIu
cHJpbnRsbigiXHQiICsgVG9TdHJpbmdMb2NhbGl6YXRpb24uYnVpbGRNZXNzYWdlKCJwbGF0Zm9y
bSIsIChPYmplY3RbXSludWxsKSArICI9PiAiICsgZ2V0RGF0YXNvdXJjZVBsYXRmb3JtKCkpOwog
ICAgICAgIGlmICghc2hvdWxkVXNlRXh0ZXJuYWxDb25uZWN0aW9uUG9vbGluZygpKSB7CiAgICAg
ICAgICAgIHdyaXRlci5wcmludGxuKCJcdCIgKyBUb1N0cmluZ0xvY2FsaXphdGlvbi5idWlsZE1l
c3NhZ2UoInVzZXJfbmFtZSIsIChPYmplY3RbXSludWxsKSArICI9PiBcIiIgKyBnZXRVc2VyTmFt
ZSgpICsgIlwiIik7CiAgICAgICAgfQogICAgICAgIHdyaXRlci5wcmludCgiXHQiKTsKICAgICAg
ICBnZXRDb25uZWN0b3IoKS50b1N0cmluZyh3cml0ZXIpOwogICAgICAgIHdyaXRlci53cml0ZSgi
KSIpOwogICAgICAgIHJldHVybiBzdHJpbmdXcml0ZXIudG9TdHJpbmcoKTsKICAgIH0KCiAgICAv
KioKICAgICAqIEdldCBkZWZhdWx0IHNlcXVlbmNlCiAgICAgKi8KICAgIHB1YmxpYyBTZXF1ZW5j
ZSBnZXREZWZhdWx0U2VxdWVuY2UoKSB7CiAgICAgICAgcmV0dXJuIGdldERhdGFzb3VyY2VQbGF0
Zm9ybSgpLmdldERlZmF1bHRTZXF1ZW5jZSgpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGRl
ZmF1bHQgc2VxdWVuY2UKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RGVmYXVsdFNlcXVlbmNl
KFNlcXVlbmNlIHNlcXVlbmNlKSB7CiAgICAgICAgZ2V0RGF0YXNvdXJjZVBsYXRmb3JtKCkuc2V0
RGVmYXVsdFNlcXVlbmNlKHNlcXVlbmNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBzZXF1
ZW5jZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBuYW1lCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFk
ZFNlcXVlbmNlKFNlcXVlbmNlIHNlcXVlbmNlKSB7CiAgICAgICAgZ2V0RGF0YXNvdXJjZVBsYXRm
b3JtKCkuYWRkU2VxdWVuY2Uoc2VxdWVuY2UpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHNl
cXVlbmNlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIG5hbWUKICAgICAqLwogICAgcHVibGljIFNlcXVl
bmNlIGdldFNlcXVlbmNlKFN0cmluZyBzZXFOYW1lKSB7CiAgICAgICAgcmV0dXJuIGdldERhdGFz
b3VyY2VQbGF0Zm9ybSgpLmdldFNlcXVlbmNlKHNlcU5hbWUpOwogICAgfQoJCQogICAgLyoqCiAg
ICAgKiBSZXR1cm5zIGEgbWFwIG9mIHNlcXVlbmNlIG5hbWVzIHRvIFNlcXVlbmNlcyAobWF5IGJl
IG51bGwpLgogICAgICovCiAgICBwdWJsaWMgTWFwIGdldFNlcXVlbmNlcygpIHsKICAgICAgICBy
ZXR1cm4gZ2V0RGF0YXNvdXJjZVBsYXRmb3JtKCkuZ2V0U2VxdWVuY2VzKCk7CiAgICB9CgogICAg
LyoqCiAgICAgKiBSZW1vdmUgc2VxdWVuY2UgY29ycmVzcG9uZGluZyB0byBuYW1lLgogICAgICog
RG9lc24ndCByZW1vdmUgZGVmYXVsdCBzZXF1ZW5jZS4KICAgICAqLwogICAgcHVibGljIFNlcXVl
bmNlIHJlbW92ZVNlcXVlbmNlKFN0cmluZyBzZXFOYW1lKSB7CiAgICAgICAgcmV0dXJuIGdldERh
dGFzb3VyY2VQbGF0Zm9ybSgpLnJlbW92ZVNlcXVlbmNlKHNlcU5hbWUpOwogICAgfQoKICAgIC8q
KgogICAgICogUmVtb3ZlIGFsbCBzZXF1ZW5jZXMgYnV0IHRoZSBkZWZhdWx0IG9uZS4KICAgICAq
LwogICAgcHVibGljIHZvaWQgcmVtb3ZlQWxsU2VxdWVuY2VzKCkgewogICAgICAgIGdldERhdGFz
b3VyY2VQbGF0Zm9ybSgpLnJlbW92ZUFsbFNlcXVlbmNlcygpOwogICAgfQoKICAgIC8qKgogICAg
ICogSU5URVJOQUw6CiAgICAgKiBVc2VkIG9ubHkgZm9yIHdyaXRpbmcgdGhlIGxvZ2luIGludG8g
WE1MIG9yIEphdmEuCiAgICAgKi8KICAgIHB1YmxpYyBTZXF1ZW5jZSBnZXREZWZhdWx0U2VxdWVu
Y2VUb1dyaXRlKCkgewogICAgICAgIHJldHVybiBnZXREYXRhc291cmNlUGxhdGZvcm0oKS5nZXRE
ZWZhdWx0U2VxdWVuY2VUb1dyaXRlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJTlRFUk5BTDoK
ICAgICAqIFVzZWQgb25seSBmb3Igd3JpdGluZyB0aGUgbG9naW4gaW50byBYTUwgb3IgSmF2YS4K
ICAgICAqLwogICAgcHVibGljIE1hcCBnZXRTZXF1ZW5jZXNUb1dyaXRlKCkgewogICAgICAgIHJl
dHVybiBnZXREYXRhc291cmNlUGxhdGZvcm0oKS5nZXRTZXF1ZW5jZXNUb1dyaXRlKCk7CiAgICB9
CgogICAgLyoqCiAgICAgKiBJTlRFUk5BTDoKICAgICAqIFVzZWQgb25seSBmb3IgcmVhZGluZyB0
aGUgbG9naW4gZnJvbSBYTUwuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFNlcXVlbmNlcyhN
YXAgc2VxdWVuY2VzKSB7CiAgICAgICAgZ2V0RGF0YXNvdXJjZVBsYXRmb3JtKCkuc2V0U2VxdWVu
Y2VzKHNlcXVlbmNlcyk7CiAgICB9Cn0K
</data>

          </attachment>
      

    </bug>

</bugzilla>