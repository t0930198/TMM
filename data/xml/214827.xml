<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.1"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>214827</bug_id>
          
          <creation_ts>2008-01-09 17:12:00 -0500</creation_ts>
          <short_desc>MEM: DBSESSION NEVER RELEASES CONNECTION IN JTA CASE.</short_desc>
          <delta_ts>2009-09-15 10:56:12 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>12</classification_id>
          <classification>RT</classification>
          <product>EclipseLink</product>
          <component>Foundation</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>Fixed in 1.0M4</status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>1.0</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Andrei Ilitchev">andrei.ilitchev</reporter>
          <assigned_to name="Project Inbox">eclipselink.foundation-inbox</assigned_to>
          <cc>peter.krogh</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>1128530</commentid>
    <comment_count>0</comment_count>
    <who name="Andrei Ilitchev">andrei.ilitchev</who>
    <bug_when>2008-01-09 17:12:06 -0500</bug_when>
    <thetext>In case of DatabaseSession connection is not closed in afterTransaction 
method, so Accessor keeps flag inTransaction set to true and the 
sqlConnectuion for until the DatabaseSession is logged out.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1128536</commentid>
    <comment_count>1</comment_count>
      <attachid>86512</attachid>
    <who name="Andrei Ilitchev">andrei.ilitchev</who>
    <bug_when>2008-01-09 17:18:35 -0500</bug_when>
    <thetext>Created attachment 86512
The proposed fix</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1129156</commentid>
    <comment_count>2</comment_count>
    <who name="Andrei Ilitchev">andrei.ilitchev</who>
    <bug_when>2008-01-10 14:25:59 -0500</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1129282</commentid>
    <comment_count>3</comment_count>
      <attachid>86612</attachid>
    <who name="Andrei Ilitchev">andrei.ilitchev</who>
    <bug_when>2008-01-10 16:21:11 -0500</bug_when>
    <thetext>Created attachment 86612
SequencingCallbackFactory class I forgot to put into the originalpatch</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1129295</commentid>
    <comment_count>4</comment_count>
      <attachid>86617</attachid>
    <who name="Andrei Ilitchev">andrei.ilitchev</who>
    <bug_when>2008-01-10 16:29:43 -0500</bug_when>
    <thetext>Created attachment 86617
The forgotten SequencingCallbackFactory - please disreguard the prev. attachment</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>86512</attachid>
            <date>2008-01-09 17:18:00 -0500</date>
            <delta_ts>2008-01-09 17:18:35 -0500</delta_ts>
            <desc>The proposed fix</desc>
            <filename>214826-214827_080109.patch</filename>
            <type>text/plain</type>
            <size>94063</size>
            <attacher name="Andrei Ilitchev">andrei.ilitchev</attacher>
            
              <data encoding="base64">SW5kZXg6IGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS50ZXN0L3NyYy9vcmcvZWNsaXBzZS9w
ZXJzaXN0ZW5jZS90ZXN0aW5nL3Rlc3RzL3ZhbGlkYXRpb24vQ2xvc2VDb25uQWZ0ZXJEYXRhYmFz
ZVNlc3Npb25UeG5UZXN0LmphdmENCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBmb3VuZGF0aW9uL2VjbGlwc2Vs
aW5rLmNvcmUudGVzdC9zcmMvb3JnL2VjbGlwc2UvcGVyc2lzdGVuY2UvdGVzdGluZy90ZXN0cy92
YWxpZGF0aW9uL0Nsb3NlQ29ubkFmdGVyRGF0YWJhc2VTZXNzaW9uVHhuVGVzdC5qYXZhCShyZXZp
c2lvbiA3NDU2KQ0KKysrIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS50ZXN0L3NyYy9vcmcv
ZWNsaXBzZS9wZXJzaXN0ZW5jZS90ZXN0aW5nL3Rlc3RzL3ZhbGlkYXRpb24vQ2xvc2VDb25uQWZ0
ZXJEYXRhYmFzZVNlc3Npb25UeG5UZXN0LmphdmEJKHdvcmtpbmcgY29weSkNCkBAIC0yMCw1MiAr
MjAsMjUgQEANCiBpbXBvcnQgb3JnLmVjbGlwc2UucGVyc2lzdGVuY2UudGVzdGluZy5tb2RlbHMu
ZW1wbG95ZWUucmVsYXRpb25hbC5FbXBsb3llZVByb2plY3Q7CiAKIC8qKgotICogZm9yIGJ1ZyA2
MDY1ODgyLCBWZXJpZnkgZGF0YWJhc2VTZXNzaW9uIGNvbm5lY3Rpb24gc2hvdWxkIGNsb3NlIGFm
dGVyIHR4biB3YXMgZmluaXNoZWQoZWl0aGVyIGNvbW1pdCBvciByb2xsYmFjayB0eG4pCi0gKiBy
ZWdhcmRsZXNzIHRoZSB0eG4gY29udHJvbGxlZCBieSBFeHRlcm5hbFRyYW5zYWN0aW9uQ29udHJv
bGxlcgorICogZm9yIGJ1ZyA2MDY1ODgyLCBWZXJpZnkgZGF0YWJhc2VTZXNzaW9uIGNvbm5lY3Rp
b24gc2hvdWxkIGNsb3NlIGFmdGVyIHR4biB3YXMgZmluaXNoZWQoZWl0aGVyIGNvbW1pdCBvciBy
b2xsYmFjayB0eG4pLgorICogVGhpcyB0ZXN0IHdvcmtzIG9ubHkgd2l0aG91dCBleHRlcm5hbCB0
cmFuc2FjdGlvbiBjb250cm9sbGVyLgorICogVGhlIHZlcnNpb24gb2YgdGhpcyB0ZXN0IHdvcmtp
bmcgd2l0aCBleHRlcm5hbCB0cmFuc2FjdGlvbm0gY29udHJvbGxlcgorICogaXMgaW4gc2VydmVy
L3RocmVldGllcjoKKyAqIC4udGhyZWV0aWVyLnRlc3RzLmV4dGVybmFsdHJhbnNhY3Rpb24uQ29u
bkNsb3NlVmFsaWRhdGlvbkluRGF0YWJhc2VTZXNzaW9uRXh0ZXJuYWxUeG5UZXN0Q2FzZQogICov
CiBwdWJsaWMgY2xhc3MgQ2xvc2VDb25uQWZ0ZXJEYXRhYmFzZVNlc3Npb25UeG5UZXN0IGV4dGVu
ZHMgQXV0b1ZlcmlmeVRlc3RDYXNlIHsKICAgICBwcm90ZWN0ZWQgRGF0YWJhc2VTZXNzaW9uIHNl
c3Npb24gPSBudWxsOwotICAgIHByb3RlY3RlZCBib29sZWFuIGhhc0V4dGVybmFsVHJhbnNhY3Rp
b25Db250cm9sbGVyID0gZmFsc2U7CiAgICAgCi0gICAgcHVibGljIENsb3NlQ29ubkFmdGVyRGF0
YWJhc2VTZXNzaW9uVHhuVGVzdChib29sZWFuIGhhc0V4dGVybmFsVHJhbnNhY3Rpb25Db250cm9s
bGVyKXsKLSAgICAgICAgaWYoaGFzRXh0ZXJuYWxUcmFuc2FjdGlvbkNvbnRyb2xsZXIpewotICAg
ICAgICAgICBzZXREZXNjcmlwdGlvbigiRW5zdXJlIHRoZSBjb25uZWN0aW9uIGNsb3NlZCBwcm9w
ZXJseSBvbmNlIHF1ZXJ5IGZpbmlzaGVkIC0gRGF0YWJhc2VTZXNzaW9uIGhhcyBFeHRlcm5hbFRy
YW5zYWN0aW9uQ29udHJvbGxlciIpOwotICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgc2V0
RGVzY3JpcHRpb24oIkVuc3VyZSB0aGUgY29ubmVjdGlvbiBjbG9zZWQgcHJvcGVybHkgb25jZSBx
dWVyeSBmaW5pc2hlZCAtIERhdGFiYXNlU2Vzc2lvbiBoYXMgbm8gRXh0ZXJuYWxUcmFuc2FjdGlv
bkNvbnRyb2xsZXIiKTsKLSAgICAgICAgfQotICAgICAgICB0aGlzLmhhc0V4dGVybmFsVHJhbnNh
Y3Rpb25Db250cm9sbGVyID0gaGFzRXh0ZXJuYWxUcmFuc2FjdGlvbkNvbnRyb2xsZXI7CisgICAg
cHVibGljIENsb3NlQ29ubkFmdGVyRGF0YWJhc2VTZXNzaW9uVHhuVGVzdCgpeworICAgICAgICBz
ZXREZXNjcmlwdGlvbigiRW5zdXJlIHRoZSBjb25uZWN0aW9uIGNsb3NlZCBwcm9wZXJseSBvbmNl
IHF1ZXJ5IGZpbmlzaGVkIC0gRGF0YWJhc2VTZXNzaW9uIGhhcyBubyBFeHRlcm5hbFRyYW5zYWN0
aW9uQ29udHJvbGxlciIpOwogICAgIH0KICAgICAKLSAgICBwdWJsaWMgc3RhdGljIGNsYXNzIER1
bW15RXh0ZXJuYWxUcmFuc2FjdGlvbkNvbnRyb2xsZXIgZXh0ZW5kcyBvcmcuZWNsaXBzZS5wZXJz
aXN0ZW5jZS50cmFuc2FjdGlvbi5BYnN0cmFjdFRyYW5zYWN0aW9uQ29udHJvbGxlciB7Ci0gICAg
ICAgIHB1YmxpYyBib29sZWFuIGlzUm9sbGVkQmFja19pbXBsKE9iamVjdCBzdGF0dXMpe3JldHVy
biBmYWxzZTt9Ci0gICAgICAgIHByb3RlY3RlZCB2b2lkIHJlZ2lzdGVyU3luY2hyb25pemF0aW9u
X2ltcGwob3JnLmVjbGlwc2UucGVyc2lzdGVuY2UudHJhbnNhY3Rpb24uQWJzdHJhY3RTeW5jaHJv
bml6YXRpb25MaXN0ZW5lciBsaXN0ZW5lciwgT2JqZWN0IHR4bikgdGhyb3dzIEV4Y2VwdGlvbnt9
Ci0gICAgICAgIHByb3RlY3RlZCBPYmplY3QgZ2V0VHJhbnNhY3Rpb25faW1wbCgpIHRocm93cyBF
eGNlcHRpb24ge3JldHVybiBudWxsO30KLSAgICAgICAgcHJvdGVjdGVkIE9iamVjdCBnZXRUcmFu
c2FjdGlvbktleV9pbXBsKE9iamVjdCB0cmFuc2FjdGlvbikgdGhyb3dzIEV4Y2VwdGlvbiB7cmV0
dXJuIG51bGw7fQotICAgICAgICBwcm90ZWN0ZWQgT2JqZWN0IGdldFRyYW5zYWN0aW9uU3RhdHVz
X2ltcGwoKSB0aHJvd3MgRXhjZXB0aW9uIHtyZXR1cm4gbnVsbDt9Ci0gICAgICAgIHByb3RlY3Rl
ZCB2b2lkIGJlZ2luVHJhbnNhY3Rpb25faW1wbCgpIHRocm93cyBFeGNlcHRpb257fQotICAgICAg
ICBwcm90ZWN0ZWQgdm9pZCBjb21taXRUcmFuc2FjdGlvbl9pbXBsKCkgdGhyb3dzIEV4Y2VwdGlv
bnt9Ci0gICAgICAgIHByb3RlY3RlZCB2b2lkIHJvbGxiYWNrVHJhbnNhY3Rpb25faW1wbCgpIHRo
cm93cyBFeGNlcHRpb257fQotICAgICAgICBwcm90ZWN0ZWQgdm9pZCBtYXJrVHJhbnNhY3Rpb25G
b3JSb2xsYmFja19pbXBsKCkgdGhyb3dzIEV4Y2VwdGlvbnt9Ci0gICAgICAgIHByb3RlY3RlZCBi
b29sZWFuIGNhbkJlZ2luVHJhbnNhY3Rpb25faW1wbChPYmplY3Qgc3RhdHVzKXtyZXR1cm4gZmFs
c2U7fQotICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBjYW5Db21taXRUcmFuc2FjdGlvbl9pbXBs
KE9iamVjdCBzdGF0dXMpe3JldHVybiBmYWxzZTt9Ci0gICAgICAgIHByb3RlY3RlZCBib29sZWFu
IGNhblJvbGxiYWNrVHJhbnNhY3Rpb25faW1wbChPYmplY3Qgc3RhdHVzKXtyZXR1cm4gZmFsc2U7
fQotICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBjYW5Jc3N1ZVNRTFRvRGF0YWJhc2VfaW1wbChP
YmplY3Qgc3RhdHVzKXtyZXR1cm4gZmFsc2U7fQotICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBj
YW5NZXJnZVVuaXRPZldvcmtfaW1wbChPYmplY3Qgc3RhdHVzKXtyZXR1cm4gZmFsc2U7fQotICAg
ICAgICBwcm90ZWN0ZWQgU3RyaW5nIHN0YXR1c1RvU3RyaW5nX2ltcGwoT2JqZWN0IHN0YXR1cyl7
cmV0dXJuICIiO30KLSAgICB9Ci0gICAgCiAgICAgcHVibGljIHZvaWQgc2V0dXAoKSB7CiAgICAg
ICAgIG9yZy5lY2xpcHNlLnBlcnNpc3RlbmNlLnNlc3Npb25zLlByb2plY3QgcHJvamVjdCA9IG5l
dyBvcmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS50ZXN0aW5nLm1vZGVscy5lbXBsb3llZS5yZWxhdGlv
bmFsLkVtcGxveWVlUHJvamVjdCgpOwogICAgICAgICBEYXRhc291cmNlTG9naW4gY2xvbmVkTG9n
aW4gPSAoRGF0YXNvdXJjZUxvZ2luKSgob3JnLmVjbGlwc2UucGVyc2lzdGVuY2Uuc2Vzc2lvbnMu
RGF0YWJhc2VTZXNzaW9uKWdldFNlc3Npb24oKSkuZ2V0UHJvamVjdCgpLmdldERhdGFzb3VyY2VM
b2dpbigpLmNsb25lKCk7CiAgICAgICAgIHByb2plY3Quc2V0TG9naW4oY2xvbmVkTG9naW4pOwog
ICAgICAgICBjbG9uZWRMb2dpbi51c2VFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCk7Ci0gICAg
ICAgIGlmKGhhc0V4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVyKXsKLSAgICAgICAgICAgIGNs
b25lZExvZ2luLnVzZUV4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVyKCk7Ci0gICAgICAgICB9
CiAgICAgICAgIHNlc3Npb249cHJvamVjdC5jcmVhdGVEYXRhYmFzZVNlc3Npb24oKTsKLSAgICAg
ICAgaWYoaGFzRXh0ZXJuYWxUcmFuc2FjdGlvbkNvbnRyb2xsZXIpewotICAgICAgICAgICAgc2Vz
c2lvbi5zZXRFeHRlcm5hbFRyYW5zYWN0aW9uQ29udHJvbGxlcihuZXcgRHVtbXlFeHRlcm5hbFRy
YW5zYWN0aW9uQ29udHJvbGxlcigpKTsKLSAgICAgICAgIH0KICAgICAgICAgc2Vzc2lvbi5sb2dp
bigpOwogICAgIH0KIApJbmRleDogZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlLnRlc3Qvc3Jj
L29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL3Rlc3RpbmcvdGVzdHMvdmFsaWRhdGlvbi9WYWxpZGF0
aW9uTW9kZWwuamF2YQ0KPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0tIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29y
ZS50ZXN0L3NyYy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS90ZXN0aW5nL3Rlc3RzL3ZhbGlkYXRp
b24vVmFsaWRhdGlvbk1vZGVsLmphdmEJKHJldmlzaW9uIDc0NTYpDQorKysgZm91bmRhdGlvbi9l
Y2xpcHNlbGluay5jb3JlLnRlc3Qvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL3Rlc3Rpbmcv
dGVzdHMvdmFsaWRhdGlvbi9WYWxpZGF0aW9uTW9kZWwuamF2YQkod29ya2luZyBjb3B5KQ0KQEAg
LTQ2LDkgKzQ2LDcgQEANCiAgICAgICAgIFRlc3RTdWl0ZSBzdWl0ZSA9IG5ldyBUZXN0U3VpdGUo
KTsKICAgICAgICAgc3VpdGUuc2V0TmFtZSgiQ29ubmVjdGlvbkNsb3NlQWZ0ZXJUeG5UZXN0U3Vp
dGUiKTsKICAgICAgICAgc3VpdGUuc2V0RGVzY3JpcHRpb24oIlRoaXMgc3VpdGUgdGVzdHMgdGhh
dCBjb25uZWN0aW9ucyBhcmUgY2xvc2VkIG9uY2UgdHhuIGZpbmlzaGVkLiIpOwotICAgICAgICBi
b29sZWFuIGhhc0V4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVyPXRydWU7Ci0gICAgICAgIHN1
aXRlLmFkZFRlc3QobmV3IENsb3NlQ29ubkFmdGVyRGF0YWJhc2VTZXNzaW9uVHhuVGVzdChoYXNF
eHRlcm5hbFRyYW5zYWN0aW9uQ29udHJvbGxlcikpOwotICAgICAgICBzdWl0ZS5hZGRUZXN0KG5l
dyBDbG9zZUNvbm5BZnRlckRhdGFiYXNlU2Vzc2lvblR4blRlc3QoIWhhc0V4dGVybmFsVHJhbnNh
Y3Rpb25Db250cm9sbGVyKSk7CisgICAgICAgIHN1aXRlLmFkZFRlc3QobmV3IENsb3NlQ29ubkFm
dGVyRGF0YWJhc2VTZXNzaW9uVHhuVGVzdCgpKTsKICAgICAgICAgcmV0dXJuIHN1aXRlOwogICAg
IH0KICAgICBwdWJsaWMgc3RhdGljIFRlc3RTdWl0ZSBnZXRDbGllbnRTZXNzaW9uUmVsZWFzZVRl
c3RTdWl0ZSgpIHsKSW5kZXg6IGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2Vj
bGlwc2UvcGVyc2lzdGVuY2UvaW50ZXJuYWwvZGF0YWJhc2VhY2Nlc3MvQWNjZXNzb3IuamF2YQ0K
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PQ0KLS0tIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlw
c2UvcGVyc2lzdGVuY2UvaW50ZXJuYWwvZGF0YWJhc2VhY2Nlc3MvQWNjZXNzb3IuamF2YQkocmV2
aXNpb24gNzQ1NikNCisrKyBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xp
cHNlL3BlcnNpc3RlbmNlL2ludGVybmFsL2RhdGFiYXNlYWNjZXNzL0FjY2Vzc29yLmphdmEJKHdv
cmtpbmcgY29weSkNCkBAIC0xMSw2ICsxMSw4IEBADQogCiBpbXBvcnQgamF2YS51dGlsLlZlY3Rv
cjsKIGltcG9ydCBvcmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS5leGNlcHRpb25zLkRhdGFiYXNlRXhj
ZXB0aW9uOworaW1wb3J0IG9yZy5lY2xpcHNlLnBlcnNpc3RlbmNlLmludGVybmFsLnNlcXVlbmNp
bmcuU2VxdWVuY2luZ0NhbGxiYWNrOworaW1wb3J0IG9yZy5lY2xpcHNlLnBlcnNpc3RlbmNlLmlu
dGVybmFsLnNlcXVlbmNpbmcuU2VxdWVuY2luZ0NhbGxiYWNrRmFjdG9yeTsKIGltcG9ydCBvcmcu
ZWNsaXBzZS5wZXJzaXN0ZW5jZS5pbnRlcm5hbC5zZXNzaW9ucy5BYnN0cmFjdFNlc3Npb247CiBp
bXBvcnQgb3JnLmVjbGlwc2UucGVyc2lzdGVuY2UuaW50ZXJuYWwuc2Vzc2lvbnMuQWJzdHJhY3RS
ZWNvcmQ7CiBpbXBvcnQgb3JnLmVjbGlwc2UucGVyc2lzdGVuY2Uuc2Vzc2lvbnMuTG9naW47CkBA
IC00MSw5ICs0MywxMiBAQA0KIHB1YmxpYyBpbnRlcmZhY2UgQWNjZXNzb3IgZXh0ZW5kcyBDbG9u
ZWFibGUgewogCiAgICAgLyoqCi0gICAgICogVG8gYmUgY2FsbGVkIGFmdGVyIEpUUyB0cmFuc2Fj
dGlvbiBoYXMgYmVlbiBjb21wbGV0ZWQgKGNvbW1pdHRlZCBvciByb2xsZWQgYmFjaykKKyAgICAg
KiBDYWxsZWQgZnJvbSBiZWZvcmVDb21wbGV0aW9uIGV4dGVybmFsIHRyYW5zYWN0aW9uIHN5bmNo
cm9uaXphdGlvbiBsaXN0ZW5lciBjYWxsYmFjaworICAgICAqIHRvIGNsb3NlIHRoZSBleHRlcm5h
bCBjb25uZWN0aW9uIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGNvbXBsZXRpbmcgZXh0ZXJuYWwgdHJh
bnNhY3Rpb24uCisgICAgICogRmluYWwgc3FsIGNhbGxzIGNvdWxkIGJlIHNlbnQgdGhyb3VnaCB0
aGUgY29ubmVjdGlvbiBieSB0aGlzIG1ldGhvZAorICAgICAqIGJlZm9yZSBpdCBjbG9zZXMgdGhl
IGNvbm5lY3Rpb24uCiAgICAgICovCi0gICAgcHVibGljIHZvaWQgYWZ0ZXJKVFNUcmFuc2FjdGlv
bigpOworICAgIHB1YmxpYyB2b2lkIGNsb3NlSlRTQ29ubmVjdGlvbigpOwogCiAgICAgLyoqCiAg
ICAgICogQmVnaW4gYSB0cmFuc2FjdGlvbiBvbiB0aGUgZGF0YSBzdG9yZS4KQEAgLTY4LDIyICs3
Myw5IEBADQogICAgIHZvaWQgY29tbWl0VHJhbnNhY3Rpb24oQWJzdHJhY3RTZXNzaW9uIHNlc3Np
b24pIHRocm93cyBEYXRhYmFzZUV4Y2VwdGlvbjsKIAogICAgIC8qKgotICAgICAqIEFsbG93IGNh
bGxpbmcgc2Vzc2lvbiB0byBiZSBwYXNzZWQuCi0gICAgICogICAgICAKLSAgICAgKiBUaGUgY2Fs
bGluZyBzZXNzaW9uIGlzIHRoZSBzZXNzaW9uIHdobyBhY3R1YWxseSBpbnZva2VzIGNvbW1pdCBv
ciByb2xsYmFjayB0cmFuc2FjdGlvbiwgCi0gICAgICogaXQgaXMgdXNlZCB0byBkZXRlcm1pbmUg
d2hldGhlciB0aGUgY29ubmVjdGlvbiBuZWVkcyB0byBiZSBjbG9zZWQgd2hlbiB1c2luZyBleHRl
cm5hbCBjb25uZWN0aW9uIHBvb2wuCi0gICAgICogVGhlIGNvbm5lY3Rpb24gd2l0aCBhIGV4dGVy
bmFsQ29ubmVjdGlvblBvb2wgdXNlZCBieSBzeW5jaHJvbml6ZWQgVU9XIHNob3VsZCBsZWF2ZSBv
cGVuIHVudGlsIAotICAgICAqIGFmdGVyQ29tcGxldGlvbiBjYWxsIGJhY2s7IHRoZSBjb25uZWN0
aW9uIHdpdGggYSBleHRlcm5hbENvbm5lY3Rpb25Qb29sIHVzZWQgYnkgb3RoZXIgdHlwZSBvZiBz
ZXNzaW9uIAotICAgICAqIHNob3VsZCBiZSBjbG9zZWQgYWZ0ZXIgdHJhbnNhY3Rpb24gd2FzIGZp
bmlzZWQuCi0gICAgICoKLSAgICAgKiBDb21taXQgYSB0cmFuc2FjdGlvbiBvbiB0aGUgZGF0YSBz
dG9yZSAKLSAgICAgKi8KLSAgICB2b2lkIGNvbW1pdFRyYW5zYWN0aW9uKEFic3RyYWN0U2Vzc2lv
biBzZXNzaW9uLCBBYnN0cmFjdFNlc3Npb24gY2FsbGluZ1Nlc3Npb24pIHRocm93cyBEYXRhYmFz
ZUV4Y2VwdGlvbjsKLSAgICAvKioKICAgICAgKiBDb25uZWN0IHRvIHRoZSBkYXRhIHN0b3JlIHVz
aW5nIHRoZSBjb25maWd1cmF0aW9uCiAgICAgICogaW5mb3JtYXRpb24gaW4gdGhlIGxvZ2luLgog
ICAgICAqLwotCiAgICAgdm9pZCBjb25uZWN0KExvZ2luIGxvZ2luLCBBYnN0cmFjdFNlc3Npb24g
c2Vzc2lvbikgdGhyb3dzIERhdGFiYXNlRXhjZXB0aW9uOwogCiAgICAgLyoqCkBAIC0xNDEsNiAr
MTMzLDExIEBADQogICAgIE9iamVjdCBnZXREYXRhc291cmNlQ29ubmVjdGlvbigpOwogCiAgICAg
LyoqCisgICAgICogUmV0dXJuIHNlcXVlbmNpbmcgY2FsbGJhY2suCisgICAgICovCisgICAgU2Vx
dWVuY2luZ0NhbGxiYWNrIGdldFNlcXVlbmNpbmdDYWxsYmFjayhTZXF1ZW5jaW5nQ2FsbGJhY2tG
YWN0b3J5IHNlcXVlbmNpbmdDYWxsYmFja0ZhY3RvcnkpOworCisgICAgLyoqCiAgICAgICogUmV0
dXJuIHRoZSB0YWJsZSBtZXRhZGF0YSBmb3IgdGhlIHNwZWNpZmllZAogICAgICAqIHNlbGVjdGlv
biBjcml0ZXJpYS4KICAgICAgKi8KQEAgLTE3NSwyNCArMTcyLDEwIEBADQogICAgICAqLwogICAg
IHZvaWQgcm9sbGJhY2tUcmFuc2FjdGlvbihBYnN0cmFjdFNlc3Npb24gc2Vzc2lvbikgdGhyb3dz
IERhdGFiYXNlRXhjZXB0aW9uOwogCi0KICAgICAvKioKLSAgICAgKiBBbGxvdyBjYWxsaW5nIHNl
c3Npb24gdG8gYmUgcGFzc2VkLiAgICAgCi0gICAgICogCi0gICAgICogVGhlIGNhbGxpbmcgc2Vz
c2lvbiBpcyB0aGUgc2Vzc2lvbiB3aG8gYWN0dWFsbHkgaW52b2tlcyBjb21taXQgb3Igcm9sbGJh
Y2sgdHJhbnNhY3Rpb24sIAotICAgICAqIGl0IGlzIHVzZWQgdG8gZGV0ZXJtaW5lIHdoZXRoZXIg
dGhlIGNvbm5lY3Rpb24gbmVlZHMgdG8gYmUgY2xvc2VkIHdoZW4gdXNpbmcgZXh0ZXJuYWwgY29u
bmVjdGlvbiBwb29sLgotICAgICAqIFRoZSBjb25uZWN0aW9uIHdpdGggYSBleHRlcm5hbENvbm5l
Y3Rpb25Qb29sIHVzZWQgYnkgc3luY2hyb25pemVkIFVPVyBzaG91bGQgbGVhdmUgb3BlbiB1bnRp
bCAKLSAgICAgKiBhZnRlckNvbXBsZXRpb24gY2FsbCBiYWNrOyB0aGUgY29ubmVjdGlvbiB3aXRo
IGEgZXh0ZXJuYWxDb25uZWN0aW9uUG9vbCB1c2VkIGJ5IG90aGVyIHR5cGUgb2Ygc2Vzc2lvbiAK
LSAgICAgKiBzaG91bGQgYmUgY2xvc2VkIGFmdGVyIHRyYW5zYWN0aW9uIHdhcyBmaW5pc2VkLgot
ICAgICAqIAotICAgICAqIFJvbGwgYmFjayBhIHRyYW5zYWN0aW9uIG9uIHRoZSBkYXRhIHN0b3Jl
LgorICAgICAqIFRoaXMgc2hvdWxkIGJlIHNldCB0byBmYWxzZSBpZiBhIGNvbW11bmljYXRpb24g
ZmFpbHVyZSBvY2N1cnJlZCBkdXJyaW5nIGEgY2FsbCBleGVjdXRpb24uICAKKyAgICAgKiBJbiB0
aGUgY2FzZSBvZiBhbiBpbnZhbGlkIGFjY2Vzc29yIHRoZSBBY2Nlc3NvciB3aWxsIG5vdCBiZSBy
ZXR1cm5lZCB0byB0aGUgcG9vbC4KICAgICAgKi8KLSAgICB2b2lkIHJvbGxiYWNrVHJhbnNhY3Rp
b24oQWJzdHJhY3RTZXNzaW9uIHNlc3Npb24sQWJzdHJhY3RTZXNzaW9uIGNhbGxpbmdTZXNzaW9u
KSB0aHJvd3MgRGF0YWJhc2VFeGNlcHRpb247Ci0gICAgCi0gICAgLyoqCi0gICAgICogVGhpcyBz
aG91bGQgYmUgc2V0IHRvICdmYWxzZScgaWYgYSBjb21tdW5pY2F0aW9uIGZhaWx1cmUgb2NjdXJy
ZWQgZHVycmluZyBhIGNhbGwgZXhlY3V0aW9uLgotICAgICAqIEluIHRoZSBjYXNlIG9mIGFuIGlu
dmFsaWQgYWNjZXNzb3IgdGhlIEFjY2Vzc29yIHdpbGwgbm90IGJlIHJldHVybmVkIHRvIHRoZSBQ
b29sLgotICAgICAqLwogICAgIHB1YmxpYyB2b2lkIHNldElzVmFsaWQoYm9vbGVhbiBpc1ZhbGlk
KTsKICAgICAKICAgICAvKioKQEAgLTIwMiw2ICsxODUsMTEgQEANCiAgICAgYm9vbGVhbiB1c2Vz
RXh0ZXJuYWxUcmFuc2FjdGlvbkNvbnRyb2xsZXIoKTsKIAogICAgIC8qKgorICAgICAqIFJldHVy
biB3aGV0aGVyIHRoZSBhY2Nlc3NvciB1c2VzIGV4dGVybmFsIGNvbm5lY3Rpb24gcG9vbGluZy4K
KyAgICAgKi8KKyAgICBib29sZWFuIHVzZXNFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCk7CisK
KyAgICAvKioKICAgICAgKiBUaGlzIG1ldGhvZCB3aWxsIGJlIGNhbGxlZCBhZnRlciBhIHNlcmll
cyBvZiB3cml0ZXMgaGF2ZSBiZWVuIGlzc3VlZCB0bwogICAgICAqIG1hcmsgd2hlcmUgYSBwYXJ0
aWN1bGFyIHNldCBvZiB3cml0ZXMgaGFzIGNvbXBsZXRlZC4gIEl0IHdpbGwgYmUgY2FsbGVkCiAg
ICAgICogZnJvbSBjb21taXRUcmFuc2FjdGlvbiBhbmQgbWF5IGJlIGNhbGxlZCBmcm9tIHdyaXRl
Q2hhbmdlcy4gICBJdHMgbWFpbgpJbmRleDogZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3Ny
Yy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9pbnRlcm5hbC9kYXRhYmFzZWFjY2Vzcy9EYXRhYmFz
ZUFjY2Vzc29yLmphdmENCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNv
cmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL2ludGVybmFsL2RhdGFiYXNlYWNjZXNzL0Rh
dGFiYXNlQWNjZXNzb3IuamF2YQkocmV2aXNpb24gNzQ1NikNCisrKyBmb3VuZGF0aW9uL2VjbGlw
c2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL2ludGVybmFsL2RhdGFiYXNl
YWNjZXNzL0RhdGFiYXNlQWNjZXNzb3IuamF2YQkod29ya2luZyBjb3B5KQ0KQEAgLTM2NiwyNiAr
MzY2LDkgQEANCiAgICAgICogICAgQ29tbWl0IGEgdHJhbnNhY3Rpb24gb24gdGhlIGRhdGFiYXNl
LiBGaXJzdCBmbHVzaCBhbnkgYmF0Y2hlZCBzdGF0ZW1lbnRzLgogICAgICAqLwogICAgIHB1Ymxp
YyB2b2lkIGNvbW1pdFRyYW5zYWN0aW9uKEFic3RyYWN0U2Vzc2lvbiBzZXNzaW9uKSB0aHJvd3Mg
RGF0YWJhc2VFeGNlcHRpb24gewotICAgICAgICB0aGlzLmNvbW1pdFRyYW5zYWN0aW9uKHNlc3Np
b24sc2Vzc2lvbik7Ci0gICAgfQotICAgIAotICAgIAotICAgIC8qKgotICAgICAqIEFsbG93IGNh
bGxpbmcgc2Vzc2lvbiB0byBiZSBwYXNzZWQuICAgICAKLSAgICAgKiAKLSAgICAgKiBUaGUgY2Fs
bGluZyBzZXNzaW9uIGlzIHRoZSBzZXNzaW9uIHdobyBhY3R1YWxseSBpbnZva2VzIGNvbW1pdCBv
ciByb2xsYmFjayB0cmFuc2FjdGlvbiwgCi0gICAgICogaXQgaXMgdXNlZCB0byBkZXRlcm1pbmUg
d2hldGhlciB0aGUgY29ubmVjdGlvbiBuZWVkcyB0byBiZSBjbG9zZWQgd2hlbiB1c2luZyBleHRl
cm5hbCBjb25uZWN0aW9uIHBvb2wuCi0gICAgICogVGhlIGNvbm5lY3Rpb24gd2l0aCBhIGV4dGVy
bmFsQ29ubmVjdGlvblBvb2wgdXNlZCBieSBzeW5jaHJvbml6ZWQgVU9XIHNob3VsZCBsZWF2ZSBv
cGVuIHVudGlsIAotICAgICAqIGFmdGVyQ29tcGxldGlvbiBjYWxsIGJhY2s7IHRoZSBjb25uZWN0
aW9uIHdpdGggYSBleHRlcm5hbENvbm5lY3Rpb25Qb29sIHVzZWQgYnkgb3RoZXIgdHlwZSBvZiBz
ZXNzaW9uIAotICAgICAqIHNob3VsZCBiZSBjbG9zZWQgYWZ0ZXIgdHJhbnNhY3Rpb24gd2FzIGZp
bmlzZWQuCi0gICAgICogCi0gICAgICogQ29tbWl0IGEgdHJhbnNhY3Rpb24gb24gdGhlIGRhdGFi
YXNlLiBGaXJzdCBmbHVzaCBhbnkgYmF0Y2hlZCBzdGF0ZW1lbnRzLgotICAgICAqLwotICAgIHB1
YmxpYyB2b2lkIGNvbW1pdFRyYW5zYWN0aW9uKEFic3RyYWN0U2Vzc2lvbiBzZXNzaW9uLEFic3Ry
YWN0U2Vzc2lvbiBjYWxsaW5nU2Vzc2lvbikgdGhyb3dzIERhdGFiYXNlRXhjZXB0aW9uIHsKICAg
ICAgICAgdGhpcy53cml0ZXNDb21wbGV0ZWQoc2Vzc2lvbik7Ci0gICAgICAgIHN1cGVyLmNvbW1p
dFRyYW5zYWN0aW9uKHNlc3Npb24sY2FsbGluZ1Nlc3Npb24pOworICAgICAgICBzdXBlci5jb21t
aXRUcmFuc2FjdGlvbihzZXNzaW9uKTsKICAgICB9Ci0gICAgCiAKICAgICAvKioKICAgICAgKiBD
b21taXQgYSB0cmFuc2FjdGlvbiBvbiB0aGUgZGF0YWJhc2UuIFRoaXMgbWVhbnMgdG9nZ2xpbmcg
dGhlIGF1dG8tY29tbWl0IG9wdGlvbi4KQEAgLTE0NDEsMjQgKzE0MjQsOSBAQA0KICAgICAgKiBS
b2xsYmFjayBhIHRyYW5zYWN0aW9uIG9uIHRoZSBkYXRhYmFzZS4gVGhpcyBtZWFucyB0b2dnbGlu
ZyB0aGUgYXV0by1jb21taXQgb3B0aW9uLgogICAgICAqLwogICAgIHB1YmxpYyB2b2lkIHJvbGxi
YWNrVHJhbnNhY3Rpb24oQWJzdHJhY3RTZXNzaW9uIHNlc3Npb24pIHRocm93cyBEYXRhYmFzZUV4
Y2VwdGlvbiB7Ci0gICAgICAgIHRoaXMucm9sbGJhY2tUcmFuc2FjdGlvbihzZXNzaW9uLHNlc3Np
b24pOwotICAgIH0KLSAgICAKLSAgICAKLSAgICAvKioKLSAgICAgKiBBbGxvdyBjYWxsaW5nIHNl
c3Npb24gdG8gYmUgcGFzc2VkCi0gICAgICogVGhlIGNhbGxpbmcgc2Vzc2lvbiBpcyB0aGUgc2Vz
c2lvbiB3aG8gYWN0dWFsbHkgaW52b2tlcyBjb21taXQgb3Igcm9sbGJhY2sgdHJhbnNhY3Rpb24s
IAotICAgICAqIGl0IGlzIHVzZWQgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgdGhlIGNvbm5lY3Rpb24g
bmVlZHMgdG8gYmUgY2xvc2VkIHdoZW4gdXNpbmcgZXh0ZXJuYWwgY29ubmVjdGlvbiBwb29sLgot
ICAgICAqIFRoZSBjb25uZWN0aW9uIHdpdGggYSBleHRlcm5hbENvbm5lY3Rpb25Qb29sIHVzZWQg
Ynkgc3luY2hyb25pemVkIFVPVyBzaG91bGQgbGVhdmUgb3BlbiB1bnRpbCAKLSAgICAgKiBhZnRl
ckNvbXBsZXRpb24gY2FsbCBiYWNrOyB0aGUgY29ubmVjdGlvbiB3aXRoIGEgZXh0ZXJuYWxDb25u
ZWN0aW9uUG9vbCB1c2VkIGJ5IG90aGVyIHR5cGUgb2Ygc2Vzc2lvbiAKLSAgICAgKiBzaG91bGQg
YmUgY2xvc2VkIGFmdGVyIHRyYW5zYWN0aW9uIHdhcyBmaW5pc2hlZC4KLSAgICAgKiBSb2xsYmFj
ayBhIHRyYW5zYWN0aW9uIG9uIHRoZSBkYXRhYmFzZS4gVGhpcyBtZWFucyB0b2dnbGluZyB0aGUg
YXV0by1jb21taXQgb3B0aW9uLgotICAgICAqLwotICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrVHJh
bnNhY3Rpb24oQWJzdHJhY3RTZXNzaW9uIHNlc3Npb24sQWJzdHJhY3RTZXNzaW9uIGNhbGxpbmdT
ZXNzaW9uKSB0aHJvd3MgRGF0YWJhc2VFeGNlcHRpb24gewogICAgICAgICBnZXRBY3RpdmVCYXRj
aFdyaXRpbmdNZWNoYW5pc20oKS5jbGVhcigpOwotICAgICAgICBzdXBlci5yb2xsYmFja1RyYW5z
YWN0aW9uKHNlc3Npb24sY2FsbGluZ1Nlc3Npb24pOworICAgICAgICBzdXBlci5yb2xsYmFja1Ry
YW5zYWN0aW9uKHNlc3Npb24pOwogICAgIH0KLSAgICAKIAogICAgIC8qKgogICAgICAqIFJvbGxi
YWNrIGEgdHJhbnNhY3Rpb24gb24gdGhlIGRhdGFiYXNlLiBUaGlzIG1lYW5zIHRvZ2dsaW5nIHRo
ZSBhdXRvLWNvbW1pdCBvcHRpb24uCkluZGV4OiBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUv
c3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL2ludGVybmFsL2RhdGFiYXNlYWNjZXNzL0RhdGFz
b3VyY2VBY2Nlc3Nvci5qYXZhDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLS0gZm91bmRhdGlvbi9lY2xpcHNlbGlu
ay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9pbnRlcm5hbC9kYXRhYmFzZWFjY2Vz
cy9EYXRhc291cmNlQWNjZXNzb3IuamF2YQkocmV2aXNpb24gNzQ1NikNCisrKyBmb3VuZGF0aW9u
L2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL2ludGVybmFsL2Rh
dGFiYXNlYWNjZXNzL0RhdGFzb3VyY2VBY2Nlc3Nvci5qYXZhCSh3b3JraW5nIGNvcHkpDQpAQCAt
MTMsMTEgKzEzLDEyIEBADQogaW1wb3J0IG9yZy5lY2xpcHNlLnBlcnNpc3RlbmNlLmV4Y2VwdGlv
bnMuKjsKIGltcG9ydCBvcmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS5zZXNzaW9ucy5Mb2dpbjsKIGlt
cG9ydCBvcmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS5xdWVyaWVzLkNhbGw7CitpbXBvcnQgb3JnLmVj
bGlwc2UucGVyc2lzdGVuY2UuaW50ZXJuYWwuc2VxdWVuY2luZy5TZXF1ZW5jaW5nQ2FsbGJhY2s7
CitpbXBvcnQgb3JnLmVjbGlwc2UucGVyc2lzdGVuY2UuaW50ZXJuYWwuc2VxdWVuY2luZy5TZXF1
ZW5jaW5nQ2FsbGJhY2tGYWN0b3J5OwogaW1wb3J0IG9yZy5lY2xpcHNlLnBlcnNpc3RlbmNlLmlu
dGVybmFsLnNlc3Npb25zLkFic3RyYWN0UmVjb3JkOwogaW1wb3J0IG9yZy5lY2xpcHNlLnBlcnNp
c3RlbmNlLmludGVybmFsLnNlc3Npb25zLkFic3RyYWN0U2Vzc2lvbjsKIGltcG9ydCBvcmcuZWNs
aXBzZS5wZXJzaXN0ZW5jZS5sb2dnaW5nLlNlc3Npb25Mb2c7CiBpbXBvcnQgb3JnLmVjbGlwc2Uu
cGVyc2lzdGVuY2Uuc2Vzc2lvbnMuU2Vzc2lvblByb2ZpbGVyOwotaW1wb3J0IG9yZy5lY2xpcHNl
LnBlcnNpc3RlbmNlLmludGVybmFsLnNlc3Npb25zLlVuaXRPZldvcmtJbXBsOwogCiAvKioKICAq
IElOVEVSTkFMOgpAQCAtNzgsMTcgKzc5LDI0IEBADQogICAgIC8qKiBLZWVwIHRyYWNrIG9mIHdo
ZXRoZXIgdGhlIGFjY2Vzc29yIGlzICJjb25uZWN0ZWQiLiAqLwogICAgIHByb3RlY3RlZCBib29s
ZWFuIGlzQ29ubmVjdGVkOwogCisgICAgLyoqIFBFUkY6IENhY2hlIHBsYXRmb3JtIHRvIGF2b2lk
IGdldHMgKHNtYWxsIGJ1dCBjYW4gYWRkIHVwKS4gKi8KKyAgICAvKiogVGhpcyBpcyBhbHNvIHJl
cXVpcmVkIHRvIGVuc3VyZSBhbGwgYWNjZXNzb3JzIGZvciBhIHNlc3Npb24gYXJlIHVzaW5nIHRo
ZSBzYW1lIHBsYXRmb3JtLiAqLworICAgIHByb3RlY3RlZCBEYXRhc291cmNlUGxhdGZvcm0gcGxh
dGZvcm07CisgICAgCiAgICAgLyoqCiAgICAgICogIFRoaXMgYXR0cmlidXRlIGlzIHVzZWQgdG8g
ZGV0ZXJtaW5lIGlmIHRoZSBjb25uZWN0aW9uIHNob3VsZCBiZSByZXR1cm5lZCB0byB0aGUgcG9v
bCBvcgogICAgICAqICByZW1vdmVkIGZyb20gdGhlIHBvb2wgYW5kIGNsb3NlZC4gIEl0IHdpbGwg
YmUgc2V0IHRvIGZhbHNlIGlmIGFuIGV4Y2VwdGlvbiBvY2N1cnMgZHVycmluZwogICAgICAqICBD
YWxsIGV4ZWN1dGlvbi4KICAgICAgKi8KICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc1ZhbGlkOwor
ICAgIAorICAgIC8qKgorICAgICAqICBEdXJpbmcgKG5vdCBleHRlcm5hbCkgdHJhbnNhY3Rpb24s
IFNlcXVlbmNpbmdNYW5hZ2VyIG1heSBzZXQgU2VxdWVuY2luZ0NhbGxiYWNrIG9uIHRoZSBhY2Nl
c3NvciwKKyAgICAgKiAgVGhlIGNhbGxiYWNrJ3Mgb25seSBtZXRob2QgaXMgY2FsbGVkIHdoZW4g
dHJhbnNhY3Rpb24gY29tbWl0cywKKyAgICAgKiAgYWZ0ZXIgdHJhbnNhY3Rpb24gaXMgY29tcGxl
dGVkIHRoZSBjYWxsYmFjayBpcyBkaXNjYXJkZWQuCisgICAgICovCisgICAgcHJvdGVjdGVkIHRy
YW5zaWVudCBTZXF1ZW5jaW5nQ2FsbGJhY2sgc2VxdWVuY2luZ0NhbGxiYWNrOwogCi0gICAgLyoq
IFBFUkY6IENhY2hlIHBsYXRmb3JtIHRvIGF2b2lkIGdldHMgKHNtYWxsIGJ1dCBjYW4gYWRkIHVw
KS4gKi8KLSAgICAvKiogVGhpcyBpcyBhbHNvIHJlcXVpcmVkIHRvIGVuc3VyZSBhbGwgYWNjZXNz
b3JzIGZvciBhIHNlc3Npb24gYXJlIHVzaW5nIHRoZSBzYW1lIHBsYXRmb3JtLiAqLwotICAgIHBy
b3RlY3RlZCBEYXRhc291cmNlUGxhdGZvcm0gcGxhdGZvcm07Ci0KICAgICAvKioKICAgICAgKiAg
ICBEZWZhdWx0IENvbnN0cnVjdG9yLgogICAgICAqLwpAQCAtMTEyLDE0ICsxMjAsMTYgQEANCiAg
ICAgfQogCiAgICAgLyoqCi0gICAgICogVG8gYmUgY2FsbGVkIGFmdGVyIEpUUyB0cmFuc2FjdGlv
biBoYXMgYmVlbiBjb21wbGV0ZWQgKGNvbW1pdHRlZCBvciByb2xsZWQgYmFjaykKKyAgICAgKiBD
YWxsZWQgZnJvbSBiZWZvcmVDb21wbGV0aW9uIGV4dGVybmFsIHRyYW5zYWN0aW9uIHN5bmNocm9u
aXphdGlvbiBsaXN0ZW5lciBjYWxsYmFjaworICAgICAqIHRvIGNsb3NlIHRoZSBleHRlcm5hbCBj
b25uZWN0aW9uIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGNvbXBsZXRpbmcgZXh0ZXJuYWwgdHJhbnNh
Y3Rpb24uCisgICAgICogRmluYWwgc3FsIGNhbGxzIGNvdWxkIGJlIHNlbnQgdGhyb3VnaCB0aGUg
Y29ubmVjdGlvbiBieSB0aGlzIG1ldGhvZAorICAgICAqIGJlZm9yZSBpdCBjbG9zZXMgdGhlIGNv
bm5lY3Rpb24uCiAgICAgICovCi0gICAgcHVibGljIHZvaWQgYWZ0ZXJKVFNUcmFuc2FjdGlvbigp
IHsKKyAgICBwdWJsaWMgdm9pZCBjbG9zZUpUU0Nvbm5lY3Rpb24oKSB7CiAgICAgICAgIGlmICh1
c2VzRXh0ZXJuYWxUcmFuc2FjdGlvbkNvbnRyb2xsZXIoKSkgewogICAgICAgICAgICAgc2V0SXNJ
blRyYW5zYWN0aW9uKGZhbHNlKTsKLSAgICAgICAgICAgIGlmICgoZ2V0RGF0YXNvdXJjZUNvbm5l
Y3Rpb24oKSAhPSBudWxsKSAmJiB1c2VzRXh0ZXJuYWxDb25uZWN0aW9uUG9vbGluZygpKSB7Cisg
ICAgICAgICAgICBpZiAodXNlc0V4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcoKSkgewogICAgICAg
ICAgICAgICAgIGNsb3NlQ29ubmVjdGlvbigpOwotICAgICAgICAgICAgICAgIHNldERhdGFzb3Vy
Y2VDb25uZWN0aW9uKG51bGwpOwogICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgfQpAQCAt
Mjk2LDMyICszMDYsMTYgQEANCiAgICAgICogQ29tbWl0IGEgdHJhbnNhY3Rpb24gb24gdGhlIGRh
dGFiYXNlLiBJZiB1c2luZyBub24tbWFuYWdlZCB0cmFuc2FjdGlvbiBjb21taXQgdGhlIGxvY2Fs
IHRyYW5zYWN0aW9uLgogICAgICAqLwogICAgIHB1YmxpYyB2b2lkIGNvbW1pdFRyYW5zYWN0aW9u
KEFic3RyYWN0U2Vzc2lvbiBzZXNzaW9uKSB0aHJvd3MgRGF0YWJhc2VFeGNlcHRpb24gewotICAg
ICAgICB0aGlzLmNvbW1pdFRyYW5zYWN0aW9uKHNlc3Npb24sIHNlc3Npb24pOwotICAgIH0KLSAg
ICAKLSAgICAvKioKLSAgICAgKiBBbGxvdyBjYWxsaW5nIHNlc3Npb24gdG8gYmUgcGFzc2VkLiAg
ICAgCi0gICAgICogCi0gICAgICogVGhlIGNhbGxpbmcgc2Vzc2lvbiBpcyB0aGUgc2Vzc2lvbiB3
aG8gYWN0dWFsbHkgaW52b2tlcyBjb21taXQgb3Igcm9sbGJhY2sgdHJhbnNhY3Rpb24sIAotICAg
ICAqIGl0IGlzIHVzZWQgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgdGhlIGNvbm5lY3Rpb24gbmVlZHMg
dG8gYmUgY2xvc2VkIHdoZW4gdXNpbmcgZXh0ZXJuYWwgY29ubmVjdGlvbiBwb29sLgotICAgICAq
IFRoZSBjb25uZWN0aW9uIHdpdGggYSBleHRlcm5hbENvbm5lY3Rpb25Qb29sIHVzZWQgYnkgc3lu
Y2hyb25pemVkIFVPVyBzaG91bGQgbGVhdmUgb3BlbiB1bnRpbCAKLSAgICAgKiBhZnRlckNvbXBs
ZXRpb24gY2FsbCBiYWNrOyB0aGUgY29ubmVjdGlvbiB3aXRoIGEgZXh0ZXJuYWxDb25uZWN0aW9u
UG9vbCB1c2VkIGJ5IG90aGVyIHR5cGUgb2Ygc2Vzc2lvbiAKLSAgICAgKiBzaG91bGQgYmUgY2xv
c2VkIGFmdGVyIHRyYW5zYWN0aW9uIHdhcyBmaW5pc2VkLgotICAgICAqIAotICAgICAqIENvbW1p
dCBhIHRyYW5zYWN0aW9uIG9uIHRoZSBkYXRhYmFzZS4gSWYgdXNpbmcgbm9uLW1hbmFnZWQgdHJh
bnNhY3Rpb24gY29tbWl0IHRoZSBsb2NhbCB0cmFuc2FjdGlvbi4KLSAgICAgKi8KLSAgICBwdWJs
aWMgdm9pZCBjb21taXRUcmFuc2FjdGlvbihBYnN0cmFjdFNlc3Npb24gc2Vzc2lvbixBYnN0cmFj
dFNlc3Npb24gY2FsbGluZ1Nlc3Npb24pIHRocm93cyBEYXRhYmFzZUV4Y2VwdGlvbiB7CiAgICAg
ICAgIGlmICh1c2VzRXh0ZXJuYWxUcmFuc2FjdGlvbkNvbnRyb2xsZXIoKSkgewogICAgICAgICAg
ICAgLy8gaWYgdGhlcmUgaXMgbm8gZXh0ZXJuYWwgVFggY29udHJvbGxlciwgdGhlbiB0aGF0IG1l
YW5zIHdlIGFyZSBjdXJyZW50bHkgbm90IHN5bmNocm9uaXplZAogICAgICAgICAgICAgLy8gd2l0
aCBhIGdsb2JhbCBKVFMgdHJhbnNhY3Rpb24uICBJbiB0aGlzIGNhc2UsIHRoZXJlIHdvbid0IGJl
IGFueSAnYWZ0ZXJDb21wbGV0aW9uJwogICAgICAgICAgICAgLy8gY2FsbGJhY2tzIHNvIHdlIGhh
dmUgdG8gcmVsZWFzZSB0aGUgY29ubmVjdGlvbiBoZXJlLiAgSXQgaXMgcG9zc2libGUgKFdMUyA1
LjEpIHRvIGNob29zZQogICAgICAgICAgICAgLy8gJ3VzZXNFeHRlcm5hbFRyYW5zYWN0aW9uQ29u
dHJvbGxlcicgb24gdGhlIGxvZ2luLCBidXQgc3RpbGwgYWNxdWlyZSBhIHVvdyB0aGF0IFdPTidU
IGJlCiAgICAgICAgICAgICAvLyBzeW5jaHJvbml6ZWQgd2l0aCBhIGdsb2JhbCBUWC4KLSAgICAg
ICAgICAgIGlmICghKChjYWxsaW5nU2Vzc2lvbiBpbnN0YW5jZW9mIFVuaXRPZldvcmtJbXBsKSAm
JiAoKFVuaXRPZldvcmtJbXBsKWNhbGxpbmdTZXNzaW9uKS5pc1N5bmNocm9uaXplZCgpKSl7Cisg
ICAgICAgICAgICBpZiAoIXNlc3Npb24uaXNTeW5jaHJvbml6ZWQoKSkgewogICAgICAgICAgICAg
ICAgIHNldElzSW5UcmFuc2FjdGlvbihmYWxzZSk7Ci0gICAgICAgICAgICAgICAgaWYgKChnZXRE
YXRhc291cmNlQ29ubmVjdGlvbigpICE9IG51bGwpICYmIHVzZXNFeHRlcm5hbENvbm5lY3Rpb25Q
b29saW5nKCkpIHsKKyAgICAgICAgICAgICAgICBpZiAodXNlc0V4dGVybmFsQ29ubmVjdGlvblBv
b2xpbmcoKSkgewogICAgICAgICAgICAgICAgICAgICBjbG9zZUNvbm5lY3Rpb24oKTsKLSAgICAg
ICAgICAgICAgICAgICAgc2V0RGF0YXNvdXJjZUNvbm5lY3Rpb24obnVsbCk7CiAgICAgICAgICAg
ICAgICAgfQogICAgICAgICAgICAgfQogICAgICAgICAgICAgcmV0dXJuOwpAQCAtMzM0LDE1ICsz
MjgsMTYgQEANCiAgICAgICAgICAgICBpbmNyZW1lbnRDYWxsQ291bnQoc2Vzc2lvbik7CiAgICAg
ICAgICAgICBiYXNpY0NvbW1pdFRyYW5zYWN0aW9uKHNlc3Npb24pOwogCi0gICAgICAgICAgICAv
LyB0cnVlPT0iY29tbWl0dGVkIjsgZmFsc2U9PSJub3QganRzIHRyYW5zYWN0aW9pbiIKLSAgICAg
ICAgICAgIHNlc3Npb24uYWZ0ZXJUcmFuc2FjdGlvbih0cnVlLCBmYWxzZSk7CisgICAgICAgICAg
ICBpZihzZXF1ZW5jaW5nQ2FsbGJhY2sgIT0gbnVsbCkgeworICAgICAgICAgICAgICAgIHNlcXVl
bmNpbmdDYWxsYmFjay5hZnRlckNvbW1pdCh0aGlzKTsKKyAgICAgICAgICAgIH0KICAgICAgICAg
ICAgIHNldElzSW5UcmFuc2FjdGlvbihmYWxzZSk7CiAgICAgICAgIH0gZmluYWxseSB7CisgICAg
ICAgICAgICBzZXF1ZW5jaW5nQ2FsbGJhY2sgPSBudWxsOwogICAgICAgICAgICAgZGVjcmVtZW50
Q2FsbENvdW50KCk7CiAgICAgICAgICAgICBzZXNzaW9uLmVuZE9wZXJhdGlvblByb2ZpbGUoU2Vz
c2lvblByb2ZpbGVyLlRSQU5TQUNUSU9OKTsKICAgICAgICAgfQogICAgIH0KLSAgICAKIAogICAg
IC8qKgogICAgICAqIENvbm5lY3QgdG8gdGhlIGRhdGFzb3VyY2UuICBUaHJvdWdoIHVzaW5nIGEg
Q0NJIENvbm5lY3Rpb25GYWN0b3J5LgpAQCAtNTcwLDMyICs1NjUsMTYgQEANCiAgICAgICogUm9s
bGJhY2sgdGhlIHRyYW5zYWN0aW9uIG9uIHRoZSBkYXRhc291cmNlLiBJZiBub3QgdXNpbmcgbWFu
YWdlZCB0cmFuc2FjdGlvbiByb2xsYmFjayB0aGUgbG9jYWwgdHJhbnNhY3Rpb24uCiAgICAgICov
CiAgICAgcHVibGljIHZvaWQgcm9sbGJhY2tUcmFuc2FjdGlvbihBYnN0cmFjdFNlc3Npb24gc2Vz
c2lvbikgdGhyb3dzIERhdGFiYXNlRXhjZXB0aW9uIHsKLSAgICAgICAgdGhpcy5yb2xsYmFja1Ry
YW5zYWN0aW9uKHNlc3Npb24sIHNlc3Npb24pOwotICAgIH0KLSAgICAKLSAgICAvKioKLSAgICAg
KiBBbGxvdyBjYWxsaW5nIHNlc3Npb24gdG8gYmUgcGFzc2VkLiAgICAgCi0gICAgICogCi0gICAg
ICogVGhlIGNhbGxpbmcgc2Vzc2lvbiBpcyB0aGUgc2Vzc2lvbiB3aG8gYWN0dWFsbHkgaW52b2tl
cyBjb21taXQgb3Igcm9sbGJhY2sgdHJhbnNhY3Rpb24sIAotICAgICAqIGl0IGlzIHVzZWQgdG8g
ZGV0ZXJtaW5lIHdoZXRoZXIgdGhlIGNvbm5lY3Rpb24gbmVlZHMgdG8gYmUgY2xvc2VkIHdoZW4g
dXNpbmcgZXh0ZXJuYWwgY29ubmVjdGlvbiBwb29sLgotICAgICAqIFRoZSBjb25uZWN0aW9uIHdp
dGggYSBleHRlcm5hbENvbm5lY3Rpb25Qb29sIHVzZWQgYnkgc3luY2hyb25pemVkIFVPVyBzaG91
bGQgbGVhdmUgb3BlbiB1bnRpbCAKLSAgICAgKiBhZnRlckNvbXBsZXRpb24gY2FsbCBiYWNrOyB0
aGUgY29ubmVjdGlvbiB3aXRoIGEgZXh0ZXJuYWxDb25uZWN0aW9uUG9vbCB1c2VkIGJ5IG90aGVy
IHR5cGUgb2Ygc2Vzc2lvbiAKLSAgICAgKiBzaG91bGQgYmUgY2xvc2VkIGFmdGVyIHRyYW5zYWN0
aW9uIHdhcyBmaW5pc2VkLgotICAgICAqCi0gICAgICogUm9sbGJhY2sgdGhlIHRyYW5zYWN0aW9u
IG9uIHRoZSBkYXRhc291cmNlLiBJZiBub3QgdXNpbmcgbWFuYWdlZCB0cmFuc2FjdGlvbiByb2xs
YmFjayB0aGUgbG9jYWwgdHJhbnNhY3Rpb24uCi0gICAgICovCi0gICAgcHVibGljIHZvaWQgcm9s
bGJhY2tUcmFuc2FjdGlvbihBYnN0cmFjdFNlc3Npb24gc2Vzc2lvbiwgQWJzdHJhY3RTZXNzaW9u
IGNhbGxpbmdTZXNzaW9uKSB0aHJvd3MgRGF0YWJhc2VFeGNlcHRpb24gewogICAgICAgICBpZiAo
dXNlc0V4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVyKCkpIHsKICAgICAgICAgICAgIC8vIGlm
IHRoZXJlIGlzIG5vIGV4dGVybmFsIFRYIGNvbnRyb2xsZXIsIHRoZW4gdGhhdCBtZWFucyB3ZSBh
cmUgY3VycmVudGx5IG5vdCBzeW5jaHJvbml6ZWQKICAgICAgICAgICAgIC8vIHdpdGggYSBnbG9i
YWwgSlRTIHRyYW5zYWN0aW9uLiAgSW4gdGhpcyBjYXNlLCB0aGVyZSB3b24ndCBiZSBhbnkgJ2Fm
dGVyQ29tcGxldGlvbicKICAgICAgICAgICAgIC8vIGNhbGxiYWNrcyBzbyB3ZSBoYXZlIHRvIHJl
bGVhc2UgdGhlIGNvbm5lY3Rpb24gaGVyZS4gIEl0IGlzIHBvc3NpYmxlIChXTFMgNS4xKSB0byBj
aG9vc2UKICAgICAgICAgICAgIC8vICd1c2VzRXh0ZXJuYWxUcmFuc2FjdGlvbkNvbnRyb2xsZXIn
IG9uIHRoZSBsb2dpbiwgYnV0IHN0aWxsIGFjcXVpcmUgYSB1b3cgdGhhdCBXT04nVCBiZQogICAg
ICAgICAgICAgLy8gc3luY2hyb25pemVkIHdpdGggYSBnbG9iYWwgVFguCi0gICAgICAgICAgICBp
ZiAoISgoY2FsbGluZ1Nlc3Npb24gaW5zdGFuY2VvZiBVbml0T2ZXb3JrSW1wbCkgJiYgKChVbml0
T2ZXb3JrSW1wbCljYWxsaW5nU2Vzc2lvbikuaXNTeW5jaHJvbml6ZWQoKSkpeworICAgICAgICAg
ICAgaWYgKCFzZXNzaW9uLmlzU3luY2hyb25pemVkKCkpIHsKICAgICAgICAgICAgICAgICBzZXRJ
c0luVHJhbnNhY3Rpb24oZmFsc2UpOwotICAgICAgICAgICAgICAgIGlmICgoZ2V0RGF0YXNvdXJj
ZUNvbm5lY3Rpb24oKSAhPSBudWxsKSAmJiB1c2VzRXh0ZXJuYWxDb25uZWN0aW9uUG9vbGluZygp
KSB7CisgICAgICAgICAgICAgICAgaWYgKHVzZXNFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCkp
IHsKICAgICAgICAgICAgICAgICAgICAgY2xvc2VDb25uZWN0aW9uKCk7Ci0gICAgICAgICAgICAg
ICAgICAgIHNldERhdGFzb3VyY2VDb25uZWN0aW9uKG51bGwpOwogICAgICAgICAgICAgICAgIH0K
ICAgICAgICAgICAgIH0KICAgICAgICAgICAgIHJldHVybjsKQEAgLTYwOCwxNSArNTg3LDEzIEBA
DQogICAgICAgICAgICAgaW5jcmVtZW50Q2FsbENvdW50KHNlc3Npb24pOwogICAgICAgICAgICAg
YmFzaWNSb2xsYmFja1RyYW5zYWN0aW9uKHNlc3Npb24pOwogICAgICAgICB9IGZpbmFsbHkgewot
ICAgICAgICAgICAgLy8gZmFsc2U9PSJyb2xsZWQgYmFjayI7IGZhbHNlPT0ibm90IGp0cyB0cmFu
c2FjdGlvaW4iCi0gICAgICAgICAgICBzZXNzaW9uLmFmdGVyVHJhbnNhY3Rpb24oZmFsc2UsIGZh
bHNlKTsKICAgICAgICAgICAgIHNldElzSW5UcmFuc2FjdGlvbihmYWxzZSk7CisgICAgICAgICAg
ICBzZXF1ZW5jaW5nQ2FsbGJhY2sgPSBudWxsOwogICAgICAgICAgICAgZGVjcmVtZW50Q2FsbENv
dW50KCk7CiAgICAgICAgICAgICBzZXNzaW9uLmVuZE9wZXJhdGlvblByb2ZpbGUoU2Vzc2lvblBy
b2ZpbGVyLlRSQU5TQUNUSU9OKTsKICAgICAgICAgfQogICAgIH0KIAotCiAgICAgLyoqCiAgICAg
ICogUmV0dXJuIHRydWUgaWYgc29tZSBleHRlcm5hbCB0cmFuc2FjdGlvbiBzZXJ2aWNlIGlzIGNv
bnRyb2xsaW5nIHRyYW5zYWN0aW9ucy4KICAgICAgKi8KQEAgLTY2OCw0ICs2NDUsMTQgQEANCiAg
ICAgcHVibGljIHZvaWQgd3JpdGVzQ29tcGxldGVkKEFic3RyYWN0U2Vzc2lvbiBzZXNzaW9uKSB7
CiAgICAgICAgIC8vdGhpcyBpcyBhIG5vLW9wIGluIHRoaXMgbWV0aG9kIGFzIHdlIGRvIG5vdCBi
YXRjaCBvbiB0aGlzIGFjY2Vzc29yCiAgICAgfQorCisgICAgLyoqCisgICAgICogUmV0dXJuIHNl
cXVlbmNpbmcgY2FsbGJhY2suCisgICAgICovCisgICAgcHVibGljIFNlcXVlbmNpbmdDYWxsYmFj
ayBnZXRTZXF1ZW5jaW5nQ2FsbGJhY2soU2VxdWVuY2luZ0NhbGxiYWNrRmFjdG9yeSBzZXF1ZW5j
aW5nQ2FsbGJhY2tGYWN0b3J5KSB7CisgICAgICAgIGlmKHNlcXVlbmNpbmdDYWxsYmFjayA9PSBu
dWxsKSB7CisgICAgICAgICAgICBzZXF1ZW5jaW5nQ2FsbGJhY2sgPSBzZXF1ZW5jaW5nQ2FsbGJh
Y2tGYWN0b3J5LmNyZWF0ZVNlcXVlbmNpbmdDYWxsYmFjaygpOworICAgICAgICB9CisgICAgICAg
IHJldHVybiBzZXF1ZW5jaW5nQ2FsbGJhY2s7CisgICAgfQogfQpJbmRleDogZm91bmRhdGlvbi9l
Y2xpcHNlbGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9pbnRlcm5hbC9zZXF1
ZW5jaW5nL1NlcXVlbmNpbmdDYWxsYmFjay5qYXZhDQo9PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLS0gZm91bmRhdGlv
bi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9pbnRlcm5hbC9z
ZXF1ZW5jaW5nL1NlcXVlbmNpbmdDYWxsYmFjay5qYXZhCShyZXZpc2lvbiA3NDU2KQ0KKysrIGZv
dW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lzdGVuY2UvaW50
ZXJuYWwvc2VxdWVuY2luZy9TZXF1ZW5jaW5nQ2FsbGJhY2suamF2YQkod29ya2luZyBjb3B5KQ0K
QEAgLTE1LDIzICsxNSwyMiBAQA0KICAqIDxwPgogICogPGI+UHVycG9zZTwvYj46IERlZmluZSBp
bnRlcmZhY2UgZm9yIHNlcXVlbmNpbmcgY2FsbGJhY2suCiAgKiA8cD4KLSAqIDxiPkRlc2NyaXB0
aW9uPC9iPjogVGhpcyBpbnRlcmZhY2UgYWNjZXNzZWQgdGhyb3VnaAotICogRGF0YWJhc2VTZXNz
aW9uLmdldFNlcXVlbmNpbmdIb21lKCkuZ2V0Q2FsbGJhY2soKSBtZXRob2QuCisgKiA8Yj5EZXNj
cmlwdGlvbjwvYj46IE9iamVjdHMgaW1wbGVtZW50aW5nIHRoaXMgaW50ZXJmYWNlCisgKiAgcHJv
ZHVjZWQgYnkgU2VxdWVuY2luZ0NhbGxiYWNrRmFjdG9yeS4KICAqIDxwPgogICogPGI+UmVzcG9u
c2liaWxpdGllczwvYj46CiAgKiA8dWw+CiAgKiA8bGk+IFByb3ZpZGVzIHNlcXVlbmNpbmcgY2Fs
bGJhY2sgdG8gYmUgY2FsbGVkIGFmdGVyIHRyYW5zYWN0aW9uLgogICogPC91bD4KLSAqIEBzZWUg
b3JnLmVjbGlwc2UucGVyc2lzdGVuY2Uuc2VxdWVuY2luZy5TZXF1ZW5jaW5nVmFsdWVHZW5lcmF0
aW9uUG9saWN5CiAgKiBAc2VlIG9yZy5lY2xpcHNlLnBlcnNpc3RlbmNlLnNlcXVlbmNpbmcuU2Vx
dWVuY2luZ0NvbnRyb2wKICAqLwogcHVibGljIGludGVyZmFjZSBTZXF1ZW5jaW5nQ2FsbGJhY2sg
ewogCiAgICAgLyoqCiAgICAgKiBJTlRFUk5BTDoKLSAgICAqIENhbGxlZCBvbmx5IGJ5IFNlc3Np
b24uYWZ0ZXJUcmFuc2FjdGlvbiBtZXRob2QuCi0gICAgKiBAcGFyYW0gYWNjZXNzb3IgQWNjZXNz
b3IgdXNlZCBieSB0cmFuc2FjdGlvbi4KLSAgICAqIEBwYXJhbSBjb21taXR0ZWQgYm9vbGVhbiB0
cnVlIC0gdHJhbnNhY3Rpb24gY29tbWl0dGVkLCBmYWxzZSAtIHRyYW5zYWN0aW9uIGZhaWxlZC4K
KyAgICAqIENhbGxlZCBhZnRlciB0cmFuc2FjdGlvbiBoYXMgY29tbWl0dGVkIGJ5IHRoZSBvYmpl
Y3QgdGhhdCBvd25zIGl0OgorICAgICogQWNjZXNzb3IgaW4gbm9uLWp0YSBjYXNlLCBTeW5jaHJv
bml6YXRpb25MaXN0ZW5lciBpbiBqdGEgY2FzZS4KKyAgICAqIFNob3VsZCBub3QgYmUgY2FsbGVk
IGFmdGVyIHJvbGxiYWNrLgogICAgICovCi0gICAgcHVibGljIHZvaWQgYWZ0ZXJUcmFuc2FjdGlv
bihBY2Nlc3NvciBhY2Nlc3NvciwgYm9vbGVhbiBjb21taXR0ZWQpOworICAgIHZvaWQgYWZ0ZXJD
b21taXQoQWNjZXNzb3IgYWNjZXNzb3IpOwogfQ0KXCBObyBuZXdsaW5lIGF0IGVuZCBvZiBmaWxl
DQpJbmRleDogZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJz
aXN0ZW5jZS9pbnRlcm5hbC9zZXF1ZW5jaW5nL1NlcXVlbmNpbmdIb21lLmphdmENCj09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT0NCi0tLSBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNp
c3RlbmNlL2ludGVybmFsL3NlcXVlbmNpbmcvU2VxdWVuY2luZ0hvbWUuamF2YQkocmV2aXNpb24g
NzQ1NikNCisrKyBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3Bl
cnNpc3RlbmNlL2ludGVybmFsL3NlcXVlbmNpbmcvU2VxdWVuY2luZ0hvbWUuamF2YQkod29ya2lu
ZyBjb3B5KQ0KQEAgLTM1LDUgKzM1LDUgQEANCiAKICAgICBwdWJsaWMgU2VxdWVuY2luZ1NlcnZl
ciBnZXRTZXF1ZW5jaW5nU2VydmVyKCk7CiAKLSAgICBwdWJsaWMgU2VxdWVuY2luZ0NhbGxiYWNr
IGdldFNlcXVlbmNpbmdDYWxsYmFjaygpOworICAgIHB1YmxpYyBib29sZWFuIGlzU2VxdWVuY2lu
Z0NhbGxiYWNrUmVxdWlyZWQoKTsKIH0KSW5kZXg6IGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29y
ZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lzdGVuY2UvaW50ZXJuYWwvc2VxdWVuY2luZy9TZXF1ZW5j
aW5nTWFuYWdlci5qYXZhDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLS0gZm91bmRhdGlvbi9lY2xpcHNlbGluay5j
b3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9pbnRlcm5hbC9zZXF1ZW5jaW5nL1NlcXVl
bmNpbmdNYW5hZ2VyLmphdmEJKHJldmlzaW9uIDc0NTYpDQorKysgZm91bmRhdGlvbi9lY2xpcHNl
bGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9pbnRlcm5hbC9zZXF1ZW5jaW5n
L1NlcXVlbmNpbmdNYW5hZ2VyLmphdmEJKHdvcmtpbmcgY29weSkNCkBAIC0zNSw3ICszNSw3IEBA
DQogICogU3RhdGU6IE5vdCBjb25uZWN0ZWQuCiAgKiAgICAgICAgaXNDb25uZWN0ZWQoKSByZXR1
cm5zIGZhbHNlOwogICogICAgICAgIGdldFNlcXVlbmNpbmdDb250cm9sKCkgY291bGQgYmUgdXNl
ZDsKLSAqICAgICAgICBnZXRTZXF1ZW5jaW5nKCkgPT0gZ2V0U2VxdWVuY2luZ1NlcnZlcigpID09
IGdldFNlcXVlbmNpbmdDYWxsYmFjaygpID09IG51bGw7CisgKiAgICAgICAgZ2V0U2VxdWVuY2lu
ZygpID09IGdldFNlcXVlbmNpbmdTZXJ2ZXIoKSA9PSBnZXRTZXF1ZW5jaW5nQ2FsbGJhY2tGYWN0
b3J5KCkgPT0gbnVsbDsKICAqICAgQWN0aW9uOiBvbkNvbm5lY3QgaXMgY2FsbGVkIC0+IENvbm5l
Y3RlZCBTdGF0ZS4KICAqIFN0YXRlOiBDb25uZWN0ZWQuCiAgKiAgICAgICAgaXNDb25uZWN0ZWQo
KSByZXR1cm5zIHRydWU7CkBAIC0xMDIsNyArMTAyLDcgQEANCiAgICAgcHJpdmF0ZSBzdGF0aWMg
ZmluYWwgaW50IE5VTUJFUl9PRl9TVEFURVMgPSA0OwogICAgIHByaXZhdGUgU3RhdGVbXSBzdGF0
ZXM7CiAgICAgcHJpdmF0ZSBNYXA8U3RyaW5nLCBDb25jdXJyZW5jeU1hbmFnZXI+IGxvY2tzOwot
ICAgIHByaXZhdGUgU2VxdWVuY2luZ0NhbGxiYWNrIGNhbGxiYWNrOworICAgIHByaXZhdGUgU2Vx
dWVuY2luZ0NhbGxiYWNrRmFjdG9yeSBjYWxsYmFja0ZhY3Rvcnk7CiAgICAgcHJpdmF0ZSBTZXF1
ZW5jaW5nU2VydmVyIHNlcnZlcjsKICAgICBwcml2YXRlIFNlcXVlbmNpbmcgc2VxOwogICAgIHBy
aXZhdGUgYm9vbGVhbiBzaG91bGRVc2VTZXBhcmF0ZUNvbm5lY3Rpb247CkBAIC0xNzcsMTIgKzE3
NywxMiBAQA0KICAgICAgICAgcmV0dXJuIHNlcnZlcjsKICAgICB9CiAKLSAgICBwcm90ZWN0ZWQg
dm9pZCBzZXRTZXF1ZW5jaW5nQ2FsbGJhY2soU2VxdWVuY2luZ0NhbGxiYWNrIGNhbGxiYWNrKSB7
Ci0gICAgICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjazsKKyAgICBwcm90ZWN0ZWQgdm9pZCBz
ZXRTZXF1ZW5jaW5nQ2FsbGJhY2tGYWN0b3J5KFNlcXVlbmNpbmdDYWxsYmFja0ZhY3RvcnkgY2Fs
bGJhY2tGYWN0b3J5KSB7CisgICAgICAgIHRoaXMuY2FsbGJhY2tGYWN0b3J5ID0gY2FsbGJhY2tG
YWN0b3J5OwogICAgIH0KIAotICAgIHB1YmxpYyBTZXF1ZW5jaW5nQ2FsbGJhY2sgZ2V0U2VxdWVu
Y2luZ0NhbGxiYWNrKCkgewotICAgICAgICByZXR1cm4gY2FsbGJhY2s7CisgICAgcHVibGljIGJv
b2xlYW4gaXNTZXF1ZW5jaW5nQ2FsbGJhY2tSZXF1aXJlZCgpIHsKKyAgICAgICAgcmV0dXJuIHRo
aXMuY2FsbGJhY2tGYWN0b3J5ICE9IG51bGw7CiAgICAgfQogCiAgICAgcHVibGljIGJvb2xlYW4g
c2hvdWxkVXNlU2VwYXJhdGVDb25uZWN0aW9uKCkgewpAQCAtMzA4LDcgKzMwOCw3IEBADQogICAg
IHN0YXRpYyBhYnN0cmFjdCBjbGFzcyBTdGF0ZSB7CiAgICAgICAgIGFic3RyYWN0IE9iamVjdCBn
ZXROZXh0VmFsdWUoU2VxdWVuY2Ugc2VxdWVuY2UsIEFic3RyYWN0U2Vzc2lvbiB3cml0ZVNlc3Np
b24pOwogCi0gICAgICAgIFNlcXVlbmNpbmdDYWxsYmFjayBnZXRTZXF1ZW5jaW5nQ2FsbGJhY2so
KSB7CisgICAgICAgIFNlcXVlbmNpbmdDYWxsYmFja0ZhY3RvcnkgZ2V0U2VxdWVuY2luZ0NhbGxi
YWNrRmFjdG9yeSgpIHsKICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICB9CiAKQEAg
LTMyNyw0NiArMzI3LDc3IEBADQogICAgICAqIFRoaXMgd2lsbCB1c2UgdGhlIHdyaXRlQ29ubmVj
dGlvbiwgYnV0IHVzZSBpbmRpdmlkdWFsIHRyYW5zYWN0aW9ucyBwZXIgc2VxdWVuY2UgYWxsb2Nh
dGlvbiwKICAgICAgKiB1bmxlc3MgdGhlIHVuaXQgb2Ygd29yayBpcyBpbiBhbiBlYXJseSB0cmFu
c2FjdGlvbiwgb3IgdGhlIGNvbm5lY3Rpb24gaXMgSlRBICh0aGlzIG1heSBkZWFkbG9jaykuCiAg
ICAgICovCi0gICAgY2xhc3MgUHJlYWxsb2NhdGlvbl9UcmFuc2FjdGlvbl9Ob0FjY2Vzc29yX1N0
YXRlIGV4dGVuZHMgU3RhdGUgaW1wbGVtZW50cyBTZXF1ZW5jaW5nQ2FsbGJhY2sgewotICAgICAg
ICBwcm90ZWN0ZWQgSGFzaHRhYmxlIGFjY2Vzc29yVG9QcmVhbGxvY2F0ZWQgPSBuZXcgSGFzaHRh
YmxlKDIwKTsKKyAgICBjbGFzcyBQcmVhbGxvY2F0aW9uX1RyYW5zYWN0aW9uX05vQWNjZXNzb3Jf
U3RhdGUgZXh0ZW5kcyBTdGF0ZSBpbXBsZW1lbnRzIFNlcXVlbmNpbmdDYWxsYmFja0ZhY3Rvcnkg
ewogCi0gICAgICAgIFNlcXVlbmNpbmdDYWxsYmFjayBnZXRTZXF1ZW5jaW5nQ2FsbGJhY2soKSB7
CisgICAgICAgIHB1YmxpYyBjbGFzcyBTZXF1ZW5jaW5nQ2FsbGJhY2tJbXBsIGltcGxlbWVudHMg
U2VxdWVuY2luZ0NhbGxiYWNrIHsKKyAgICAgICAgICAgIE1hcCBsb2NhbFNlcXVlbmNlcyA9IG5l
dyBIYXNoTWFwKCk7CisgICAgICAgICAgICAKKyAgICAgICAgICAgIC8qKgorICAgICAgICAgICAg
KiBJTlRFUk5BTDoKKyAgICAgICAgICAgICogQ2FsbGVkIGFmdGVyIHRyYW5zYWN0aW9uIGhhcyBj
b21taXR0ZWQgKGNvbW1pdCBpbiBub24tanRhIGNhc2U7IGFmdGVyIGNvbXBsZXRpb24gLSBqdGEg
Y2FzZSkuCisgICAgICAgICAgICAqIFNob3VsZCBub3QgYmUgY2FsbGVkIGFmdGVyIHJvbGxiYWNr
LgorICAgICAgICAgICAgKi8KKyAgICAgICAgICAgIHB1YmxpYyB2b2lkIGFmdGVyQ29tbWl0KEFj
Y2Vzc29yIGFjY2Vzc29yKSB7CisgICAgICAgICAgICAgICAgYWZ0ZXJDb21taXRJbnRlcm5hbChs
b2NhbFNlcXVlbmNlcywgYWNjZXNzb3IpOworICAgICAgICAgICAgfQorICAgICAgICAgICAgCisg
ICAgICAgICAgICBwdWJsaWMgTWFwIGdldFByZWFsbG9jYXRlZFNlcXVlbmNlVmFsdWVzKCkgewor
ICAgICAgICAgICAgICAgIHJldHVybiBsb2NhbFNlcXVlbmNlczsKKyAgICAgICAgICAgIH0KKyAg
ICAgICAgfQorICAgICAgICAKKyAgICAgICAgU2VxdWVuY2luZ0NhbGxiYWNrRmFjdG9yeSBnZXRT
ZXF1ZW5jaW5nQ2FsbGJhY2tGYWN0b3J5KCkgewogICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg
ICAgICAgIH0KIAogICAgICAgICAvKioKKyAgICAgICAgKiBJTlRFUk5BTDoKKyAgICAgICAgKiBD
cmVhdGVzIFNlcXVlbmNpbmdDYWxsYmFjay4KKyAgICAgICAgKi8KKyAgICAgICAgcHVibGljIFNl
cXVlbmNpbmdDYWxsYmFjayBjcmVhdGVTZXF1ZW5jaW5nQ2FsbGJhY2soKSB7CisgICAgICAgICAg
ICByZXR1cm4gbmV3IFNlcXVlbmNpbmdDYWxsYmFja0ltcGwoKTsKKyAgICAgICAgfQorICAgICAg
ICAKKyAgICAgICAgLyoqCiAgICAgICAgICAqIFJlbGVhc2UgYW55IGxvY2FsbHkgYWxsb2NhdGVk
IHNlcXVlbmNlIGJhY2sgdG8gdGhlIGdsb2JhbCBzZXF1ZW5jZSBwb29sLgogICAgICAgICAgKi8K
LSAgICAgICAgcHVibGljIHZvaWQgYWZ0ZXJUcmFuc2FjdGlvbihBY2Nlc3NvciBhY2Nlc3Nvciwg
Ym9vbGVhbiBjb21taXR0ZWQpIHsKLSAgICAgICAgICAgIEhhc2h0YWJsZSBsb2NhbFNlcXVlbmNl
cyA9IChIYXNodGFibGUpYWNjZXNzb3JUb1ByZWFsbG9jYXRlZC5nZXQoYWNjZXNzb3IpOwotICAg
ICAgICAgICAgaWYgKGxvY2FsU2VxdWVuY2VzICE9IG51bGwpIHsKLSAgICAgICAgICAgICAgICBp
ZiAoY29tbWl0dGVkKSB7Ci0gICAgICAgICAgICAgICAgICAgIGZvciAoRW51bWVyYXRpb24gZW51
bXRyID0gbG9jYWxTZXF1ZW5jZXMua2V5cygpOyBlbnVtdHIuaGFzTW9yZUVsZW1lbnRzKCk7KSB7
Ci0gICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcgc2VxTmFtZSA9IChTdHJpbmcpZW51bXRy
Lm5leHRFbGVtZW50KCk7Ci0gICAgICAgICAgICAgICAgICAgICAgICBWZWN0b3IgbG9jYWxTZXF1
ZW5jZUZvck5hbWUgPSAoVmVjdG9yKWxvY2FsU2VxdWVuY2VzLmdldChzZXFOYW1lKTsKLSAgICAg
ICAgICAgICAgICAgICAgICAgIGlmICghbG9jYWxTZXF1ZW5jZUZvck5hbWUuaXNFbXB0eSgpKSB7
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNxdWlyZUxvY2soc2VxTmFtZSk7Ci0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgZ2V0UHJlYWxsb2NhdGlvbkhhbmRsZXIoKS5zZXRQcmVhbGxvY2F0ZWQoc2VxTmFtZSwg
bG9jYWxTZXF1ZW5jZUZvck5hbWUpOwotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAv
LyBjbGVhciBhbGwgbG9jYWxTZXF1ZW5jZXNGb3JOYW1lCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGxvY2FsU2VxdWVuY2VGb3JOYW1lLmNsZWFyKCk7Ci0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgfSBmaW5hbGx5IHsKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
cmVsZWFzZUxvY2soc2VxTmFtZSk7Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgfQotICAg
ICAgICAgICAgICAgICAgICAgICAgfQorICAgICAgICB2b2lkIGFmdGVyQ29tbWl0SW50ZXJuYWwo
TWFwIGxvY2FsU2VxdWVuY2VzLCBBY2Nlc3NvciBhY2Nlc3NvcikgeworICAgICAgICAgICAgSXRl
cmF0b3IgaXQgPSBsb2NhbFNlcXVlbmNlcy5lbnRyeVNldCgpLml0ZXJhdG9yKCk7CisgICAgICAg
ICAgICB3aGlsZShpdC5oYXNOZXh0KCkpIHsKKyAgICAgICAgICAgICAgICBNYXAuRW50cnkgZW50
cnkgPSAoTWFwLkVudHJ5KWl0Lm5leHQoKTsKKyAgICAgICAgICAgICAgICBTdHJpbmcgc2VxTmFt
ZSA9IChTdHJpbmcpZW50cnkuZ2V0S2V5KCk7CisgICAgICAgICAgICAgICAgVmVjdG9yIGxvY2Fs
U2VxdWVuY2VGb3JOYW1lID0gKFZlY3RvcillbnRyeS5nZXRWYWx1ZSgpOworICAgICAgICAgICAg
ICAgIGlmICghbG9jYWxTZXF1ZW5jZUZvck5hbWUuaXNFbXB0eSgpKSB7CisgICAgICAgICAgICAg
ICAgICAgIGFjcXVpcmVMb2NrKHNlcU5hbWUpOworICAgICAgICAgICAgICAgICAgICB0cnkgewor
ICAgICAgICAgICAgICAgICAgICAgICAgZ2V0UHJlYWxsb2NhdGlvbkhhbmRsZXIoKS5zZXRQcmVh
bGxvY2F0ZWQoc2VxTmFtZSwgbG9jYWxTZXF1ZW5jZUZvck5hbWUpOworICAgICAgICAgICAgICAg
ICAgICAgICAgLy8gY2xlYXIgYWxsIGxvY2FsU2VxdWVuY2VzRm9yTmFtZQorICAgICAgICAgICAg
ICAgICAgICAgICAgbG9jYWxTZXF1ZW5jZUZvck5hbWUuY2xlYXIoKTsKKyAgICAgICAgICAgICAg
ICAgICAgfSBmaW5hbGx5IHsKKyAgICAgICAgICAgICAgICAgICAgICAgIHJlbGVhc2VMb2NrKHNl
cU5hbWUpOwogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgfQotCi0gICAg
ICAgICAgICAgICAgLy8gcmVtb3ZlIGxvY2FsU2VxdWVuY2luZyBjb3JyZXNwb25kaW5nIHRvIHRo
ZSBhY2Nlc3NvciBmcm9tIGFjY2Vzc29yVG9QcmVhbGxvY2F0ZWQKLSAgICAgICAgICAgICAgICBh
Y2Nlc3NvclRvUHJlYWxsb2NhdGVkLnJlbW92ZShhY2Nlc3Nvcik7Ci0KLSAgICAgICAgICAgICAg
ICBpZiAoY29tbWl0dGVkKSB7Ci0gICAgICAgICAgICAgICAgICAgIGdldE93bmVyU2Vzc2lvbigp
LmxvZyhTZXNzaW9uTG9nLkZJTkVTVCwgU2Vzc2lvbkxvZy5TRVFVRU5DSU5HLCAic2VxdWVuY2lu
Z19hZnRlclRyYW5zYWN0aW9uQ29tbWl0dGVkIiwgbnVsbCwgYWNjZXNzb3IpOwotICAgICAgICAg
ICAgICAgIH0gZWxzZSB7Ci0gICAgICAgICAgICAgICAgICAgIGdldE93bmVyU2Vzc2lvbigpLmxv
ZyhTZXNzaW9uTG9nLkZJTkVTVCwgU2Vzc2lvbkxvZy5TRVFVRU5DSU5HLCAic2VxdWVuY2luZ19h
ZnRlclRyYW5zYWN0aW9uUm9sbGVkQmFjayIsIG51bGwsIGFjY2Vzc29yKTsKLSAgICAgICAgICAg
ICAgICB9CiAgICAgICAgICAgICB9CisgICAgICAgICAgICBpZihhY2Nlc3NvciAhPSBudWxsKSB7
CisgICAgICAgICAgICAgICAgZ2V0T3duZXJTZXNzaW9uKCkubG9nKFNlc3Npb25Mb2cuRklORVNU
LCBTZXNzaW9uTG9nLlNFUVVFTkNJTkcsICJzZXF1ZW5jaW5nX2FmdGVyVHJhbnNhY3Rpb25Db21t
aXR0ZWQiLCBudWxsLCBhY2Nlc3Nvcik7CisgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAg
ICAgICAgIGdldE93bmVyU2Vzc2lvbigpLmxvZyhTZXNzaW9uTG9nLkZJTkVTVCwgU2Vzc2lvbkxv
Zy5TRVFVRU5DSU5HLCAic2VxdWVuY2luZ19hZnRlclRyYW5zYWN0aW9uQ29tbWl0dGVkIiwgbnVs
bCk7CisgICAgICAgICAgICB9CiAgICAgICAgIH0KKyAgICAgICAgCisgICAgICAgIFNlcXVlbmNp
bmdDYWxsYmFja0ltcGwgZ2V0Q2FsbGJhY2tJbXBsKEFic3RyYWN0U2Vzc2lvbiB3cml0ZVNlc3Np
b24sIEFjY2Vzc29yIGFjY2Vzc29yKSB7CisgICAgICAgICAgICBTZXF1ZW5jaW5nQ2FsbGJhY2tJ
bXBsIHNlcUNhbGxiYWNrSW1wbDsKKyAgICAgICAgICAgIGlmKHdyaXRlU2Vzc2lvbi5oYXNFeHRl
cm5hbFRyYW5zYWN0aW9uQ29udHJvbGxlcigpKSB7CisgICAgICAgICAgICAgICAgLy8gbm90ZSB0
aGF0IGNvbnRyb2xsZXIgb2J0YWluZWQgZnJvbSB3cml0ZVNlc3Npb24gKG5vdCBmcm9tIG93bmVy
U2Vzc2lvbikgLQorICAgICAgICAgICAgICAgIC8vIHRoZSBkaWZmZXJlbmNlIGlzIGltcG9ydGFu
dCBpbiBjYXNlIG9mIG93bmVyU2Vzc2lvbiBiZWluZyBhIG1lbWJlciBvZiBTZXNzaW9uQnJva2Vy
OgorICAgICAgICAgICAgICAgIC8vIGluIHRoYXQgY2FzZSBvbmx5IHdyaXRlU2Vzc2lvbiAod2hp
Y2ggaXMgZWl0aGVyIENsaWVudFNlc3Npb24gb3IgRGF0YWJhc2VTZXNzaW9uKSBhbHdheXMgaGFz
CisgICAgICAgICAgICAgICAgLy8gdGhlIGNvcnJlY3QgY29udHJvbGxlci4KKyAgICAgICAgICAg
ICAgICBzZXFDYWxsYmFja0ltcGwgPSAoU2VxdWVuY2luZ0NhbGxiYWNrSW1wbCl3cml0ZVNlc3Np
b24uZ2V0RXh0ZXJuYWxUcmFuc2FjdGlvbkNvbnRyb2xsZXIoKS5nZXRBY3RpdmVTZXF1ZW5jaW5n
Q2FsbGJhY2soZ2V0T3duZXJTZXNzaW9uKCksIGdldFNlcXVlbmNpbmdDYWxsYmFja0ZhY3Rvcnko
KSk7CisgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAgIHNlcUNhbGxiYWNrSW1w
bCA9IChTZXF1ZW5jaW5nQ2FsbGJhY2tJbXBsKWFjY2Vzc29yLmdldFNlcXVlbmNpbmdDYWxsYmFj
ayhnZXRTZXF1ZW5jaW5nQ2FsbGJhY2tGYWN0b3J5KCkpOworICAgICAgICAgICAgfQorICAgICAg
ICAgICAgcmV0dXJuIHNlcUNhbGxiYWNrSW1wbDsKKyAgICAgICAgfQogCiAgICAgICAgIC8qKgog
ICAgICAgICAgKiBSZXR1cm4gdGhlIG5leHQgc2VxdWVuY2UgdmFsdWUuCkBAIC00MTQsMTEgKzQ0
NSw4IEBADQogICAgICAgICAgICAgfQogICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg
ICBhY2Nlc3NvciA9IHdyaXRlU2Vzc2lvbi5nZXRBY2Nlc3NvcigpOwotICAgICAgICAgICAgICAg
IEhhc2h0YWJsZSBsb2NhbFNlcXVlbmNlcyA9IChIYXNodGFibGUpYWNjZXNzb3JUb1ByZWFsbG9j
YXRlZC5nZXQoYWNjZXNzb3IpOwotICAgICAgICAgICAgICAgIGlmIChsb2NhbFNlcXVlbmNlcyA9
PSBudWxsKSB7Ci0gICAgICAgICAgICAgICAgICAgIGxvY2FsU2VxdWVuY2VzID0gbmV3IEhhc2h0
YWJsZSgyMCk7Ci0gICAgICAgICAgICAgICAgICAgIGFjY2Vzc29yVG9QcmVhbGxvY2F0ZWQucHV0
KGFjY2Vzc29yLCBsb2NhbFNlcXVlbmNlcyk7Ci0gICAgICAgICAgICAgICAgfQorICAgICAgICAg
ICAgICAgIFNlcXVlbmNpbmdDYWxsYmFja0ltcGwgc2VxQ2FsbGJhY2tJbXBsID0gZ2V0Q2FsbGJh
Y2tJbXBsKHdyaXRlU2Vzc2lvbiwgYWNjZXNzb3IpOworICAgICAgICAgICAgICAgIE1hcCBsb2Nh
bFNlcXVlbmNlcyA9IHNlcUNhbGxiYWNrSW1wbC5nZXRQcmVhbGxvY2F0ZWRTZXF1ZW5jZVZhbHVl
cygpOwogICAgICAgICAgICAgICAgIGxvY2FsU2VxdWVuY2VzRm9yTmFtZSA9IChWZWN0b3IpbG9j
YWxTZXF1ZW5jZXMuZ2V0KHNlcU5hbWUpOwogICAgICAgICAgICAgICAgIGlmICgobG9jYWxTZXF1
ZW5jZXNGb3JOYW1lID09IG51bGwpIHx8IGxvY2FsU2VxdWVuY2VzRm9yTmFtZS5pc0VtcHR5KCkp
IHsKICAgICAgICAgICAgICAgICAgICAgbG9jYWxTZXF1ZW5jZXNGb3JOYW1lID0gc2VxdWVuY2Uu
Z2V0R2VuZXJhdGVkVmVjdG9yKG51bGwsIHdyaXRlU2Vzc2lvbik7CkBAIC00NDcsOCArNDc1LDgg
QEANCiAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgLy8gY29tbWl0
VHJhbnNhY3Rpb24gbWF5IGNvcHkgcHJlYWxsb2NhdGVkIHNlcXVlbmNlIG51bWJlcnMgCiAgICAg
ICAgICAgICAgICAgICAgIC8vIGZyb20gbG9jYWxTZXF1ZW5jZXMgdG8gcHJlYWxsb2NhdGlvbkhh
bmRsZXI6IHRoYXQgaGFwcGVucwotICAgICAgICAgICAgICAgICAgICAvLyBpZiBpdCBpc24ndCBh
IG5lc3RlZCB0cmFuc2FjdGlvbiwgYW5kIGFmdGVyVHJhbnNhY3Rpb24gbWV0aG9kIAotICAgICAg
ICAgICAgICAgICAgICAvLyBpcyBjYWxsZWQuCisgICAgICAgICAgICAgICAgICAgIC8vIGlmIGl0
IGlzbid0IGEgbmVzdGVkIHRyYW5zYWN0aW9uLCBhbmQgc2VxdWVuY2luZ0NhbGxiYWNrLmFmdGVy
Q29tbWl0IAorICAgICAgICAgICAgICAgICAgICAvLyBtZXRob2QgaGFzIGJlZW4gY2FsbGVkLgog
ICAgICAgICAgICAgICAgICAgICAvLyBJbiB0aGlzIGNhc2U6CiAgICAgICAgICAgICAgICAgICAg
IC8vIDEuIGxvY2FsU2VxdWVuY2VzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGFjY2Vzc29yCiAgICAg
ICAgICAgICAgICAgICAgIC8vICAgIGhhcyBiZWVuIHJlbW92ZWQgZnJvbSBhY2Nlc3NvclRvUHJl
YWxsb2NhdGVkOwpAQCAtNDY3LDEyICs0OTUsMTIgQEANCiAKICAgICAgICAgICAgICAgICBpZiAo
IWxvY2FsU2VxdWVuY2VzRm9yTmFtZS5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICAg
Ly8gbG9jYWxTZXFlbmNlc0Zvck5hbWUgaXMgbm90IGVtcHR5LCB0aGF0IG1lYW5zCi0gICAgICAg
ICAgICAgICAgICAgIC8vIGFmdGVyVHJhbnNhY3Rpb24oKSBoYXMgbm90IGJlZW4gY2FsbGVkLgor
ICAgICAgICAgICAgICAgICAgICAvLyBzZXF1ZW5jaW5nQ2FsbGJhY2sgaGFzIG5vdCBiZWVuIGNh
bGxlZC4KICAgICAgICAgICAgICAgICAgICAgc2VxdWVuY2VWYWx1ZSA9IGxvY2FsU2VxdWVuY2Vz
Rm9yTmFtZS5yZW1vdmUoMCk7CiAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXF1ZW5jZVZh
bHVlOwogICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgIC8vIGxv
Y2FsU2VxZW5jZXNGb3JOYW1lIGlzIGVtcHR5LCB0aGF0IG1lYW5zCi0gICAgICAgICAgICAgICAg
ICAgIC8vIGFmdGVyVHJhbnNhY3Rpb24oKSBoYXMgYmVlbiBjYWxsZWQuCisgICAgICAgICAgICAg
ICAgICAgIC8vIHNlcXVlbmNpbmdDYWxsYmFjayBoYXMgYmVlbiBjYWxsZWQuCiAgICAgICAgICAg
ICAgICAgICAgIHNlcXVlbmNlVmFsdWUgPSBzZXF1ZW5jZXNGb3JOYW1lLnBvbGwoKTsKICAgICAg
ICAgICAgICAgICAgICAgaWYgKHNlcXVlbmNlVmFsdWUgIT0gbnVsbCkgewogICAgICAgICAgICAg
ICAgICAgICAgICAgcmV0dXJuIHNlcXVlbmNlVmFsdWU7CkBAIC02NTUsNyArNjgzLDEwIEBADQog
ICAgICAgICBpZiAoYXRMZWFzdE9uZVNlcXVlbmNlU2hvdWxkVXNlUHJlYWxsb2NhdGlvbikgewog
ICAgICAgICAgICAgc2V0TG9ja3MobmV3IENvbmN1cnJlbnRIYXNoTWFwKDIwKSk7CiAgICAgICAg
IH0KLSAgICAgICAgY3JlYXRlU2VxdWVuY2luZ0NhbGxiYWNrKCk7CisgICAgICAgIGNyZWF0ZVNl
cXVlbmNpbmdDYWxsYmFja0ZhY3RvcnkoKTsKKyAgICAgICAgaWYoZ2V0T3duZXJTZXNzaW9uKCku
aGFzRXh0ZXJuYWxUcmFuc2FjdGlvbkNvbnRyb2xsZXIoKSkgeworICAgICAgICAgICAgZ2V0T3du
ZXJTZXNzaW9uKCkuZ2V0RXh0ZXJuYWxUcmFuc2FjdGlvbkNvbnRyb2xsZXIoKS5pbml0aWFsaXpl
U2VxdWVuY2luZ0xpc3RlbmVycygpOworICAgICAgICB9CiAgICAgICAgIGlmIChnZXRPd25lclNl
c3Npb24oKS5pc1NlcnZlclNlc3Npb24oKSkgewogICAgICAgICAgICAgc2V0U2VxdWVuY2luZ1Nl
cnZlcih0aGlzKTsKICAgICAgICAgfQpAQCAtNjcwLDcgKzcwMSwxMCBAQA0KIAogICAgICAgICBz
ZXRTZXF1ZW5jaW5nKG51bGwpOwogICAgICAgICBzZXRTZXF1ZW5jaW5nU2VydmVyKG51bGwpOwot
ICAgICAgICBzZXRTZXF1ZW5jaW5nQ2FsbGJhY2sobnVsbCk7CisgICAgICAgIHNldFNlcXVlbmNp
bmdDYWxsYmFja0ZhY3RvcnkobnVsbCk7CisgICAgICAgIGlmKGdldE93bmVyU2Vzc2lvbigpLmhh
c0V4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVyKCkpIHsKKyAgICAgICAgICAgIGdldE93bmVy
U2Vzc2lvbigpLmdldEV4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVyKCkuY2xlYXJTZXF1ZW5j
aW5nTGlzdGVuZXJzKCk7CisgICAgICAgIH0KICAgICAgICAgc2V0TG9ja3MobnVsbCk7CiAgICAg
ICAgIGNsZWFyU3RhdGVzKCk7CiAKQEAgLTgzMyw0MCArODY3LDE0IEBADQogICAgICAgICB9CiAg
ICAgfQogCi0gICAgcHJvdGVjdGVkIHZvaWQgY3JlYXRlU2VxdWVuY2luZ0NhbGxiYWNrKCkgewot
ICAgICAgICBWZWN0b3IgY2FsbGJhY2tWZWN0b3IgPSBuZXcgVmVjdG9yKCk7Ci0gICAgICAgIGZv
ciAoaW50IGkgPSAwOyBpIDwgTlVNQkVSX09GX1NUQVRFUzsgaSsrKSB7Ci0gICAgICAgICAgICBp
ZiAoc3RhdGVzW2ldICE9IG51bGwpIHsKLSAgICAgICAgICAgICAgICBTZXF1ZW5jaW5nQ2FsbGJh
Y2sgY2FsbGJhY2sgPSBzdGF0ZXNbaV0uZ2V0U2VxdWVuY2luZ0NhbGxiYWNrKCk7Ci0gICAgICAg
ICAgICAgICAgaWYgKGNhbGxiYWNrICE9IG51bGwpIHsKLSAgICAgICAgICAgICAgICAgICAgY2Fs
bGJhY2tWZWN0b3IuYWRkRWxlbWVudChjYWxsYmFjayk7Ci0gICAgICAgICAgICAgICAgfQotICAg
ICAgICAgICAgfQotICAgICAgICB9Ci0gICAgICAgIGlmIChjYWxsYmFja1ZlY3Rvci5pc0VtcHR5
KCkpIHsKLSAgICAgICAgICAgIHNldFNlcXVlbmNpbmdDYWxsYmFjayhudWxsKTsKLSAgICAgICAg
fSBlbHNlIGlmIChjYWxsYmFja1ZlY3Rvci5zaXplKCkgPT0gMSkgewotICAgICAgICAgICAgc2V0
U2VxdWVuY2luZ0NhbGxiYWNrKChTZXF1ZW5jaW5nQ2FsbGJhY2spY2FsbGJhY2tWZWN0b3IuZmly
c3RFbGVtZW50KCkpOworICAgIHByb3RlY3RlZCB2b2lkIGNyZWF0ZVNlcXVlbmNpbmdDYWxsYmFj
a0ZhY3RvcnkoKSB7CisgICAgICAgIGlmIChzdGF0ZXNbUFJFQUxMT0NBVElPTl9UUkFOU0FDVElP
Tl9OT0FDQ0VTU09SXSAhPSBudWxsKSB7CisgICAgICAgICAgICBzZXRTZXF1ZW5jaW5nQ2FsbGJh
Y2tGYWN0b3J5KHN0YXRlc1tQUkVBTExPQ0FUSU9OX1RSQU5TQUNUSU9OX05PQUNDRVNTT1JdLmdl
dFNlcXVlbmNpbmdDYWxsYmFja0ZhY3RvcnkoKSk7CiAgICAgICAgIH0gZWxzZSB7Ci0gICAgICAg
ICAgICBzZXRTZXF1ZW5jaW5nQ2FsbGJhY2sobmV3IFNlcXVlbmNpbmdDYWxsYmFja0NvbnRhaW5l
cihjYWxsYmFja1ZlY3RvcikpOworICAgICAgICAgICAgc2V0U2VxdWVuY2luZ0NhbGxiYWNrRmFj
dG9yeShudWxsKTsKICAgICAgICAgfQogICAgIH0KIAotICAgIHN0YXRpYyBjbGFzcyBTZXF1ZW5j
aW5nQ2FsbGJhY2tDb250YWluZXIgaW1wbGVtZW50cyBTZXF1ZW5jaW5nQ2FsbGJhY2sgewotICAg
ICAgICBTZXF1ZW5jaW5nQ2FsbGJhY2tbXSBjYWxsYmFja0FycmF5OwotCi0gICAgICAgIFNlcXVl
bmNpbmdDYWxsYmFja0NvbnRhaW5lcihWZWN0b3IgY2FsbGJhY2tWZWN0b3IpIHsKLSAgICAgICAg
ICAgIGNhbGxiYWNrQXJyYXkgPSBuZXcgU2VxdWVuY2luZ0NhbGxiYWNrW2NhbGxiYWNrVmVjdG9y
LnNpemUoKV07Ci0gICAgICAgICAgICBjYWxsYmFja1ZlY3Rvci5jb3B5SW50byhjYWxsYmFja0Fy
cmF5KTsKLSAgICAgICAgfQotCi0gICAgICAgIHB1YmxpYyB2b2lkIGFmdGVyVHJhbnNhY3Rpb24o
QWNjZXNzb3IgYWNjZXNzb3IsIGJvb2xlYW4gY29tbWl0dGVkKSB7Ci0gICAgICAgICAgICBmb3Ig
KGludCBpID0gMDsgaSA8IGNhbGxiYWNrQXJyYXkubGVuZ3RoOyBpKyspIHsKLSAgICAgICAgICAg
ICAgICBjYWxsYmFja0FycmF5W2ldLmFmdGVyVHJhbnNhY3Rpb24oYWNjZXNzb3IsIGNvbW1pdHRl
ZCk7Ci0gICAgICAgICAgICB9Ci0gICAgICAgIH0KLSAgICB9Ci0KICAgICBwdWJsaWMgT2JqZWN0
IGdldE5leHRWYWx1ZShBYnN0cmFjdFNlc3Npb24gd3JpdGVTZXNzaW9uLCBDbGFzcyBjbHMpIHsK
ICAgICAgICAgU2VxdWVuY2Ugc2VxdWVuY2UgPSBnZXRTZXF1ZW5jZShjbHMpOwogICAgICAgICBT
dGF0ZSBzdGF0ZSA9IGdldFN0YXRlKHNlcXVlbmNlLnNob3VsZFVzZVByZWFsbG9jYXRpb24oKSwg
c2VxdWVuY2Uuc2hvdWxkVXNlVHJhbnNhY3Rpb24oKSk7CkluZGV4OiBmb3VuZGF0aW9uL2VjbGlw
c2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL2ludGVybmFsL3Nlc3Npb25z
L0Fic3RyYWN0U2Vzc2lvbi5qYXZhDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLS0gZm91bmRhdGlvbi9lY2xpcHNl
bGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9pbnRlcm5hbC9zZXNzaW9ucy9B
YnN0cmFjdFNlc3Npb24uamF2YQkocmV2aXNpb24gNzQ1NikNCisrKyBmb3VuZGF0aW9uL2VjbGlw
c2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL2ludGVybmFsL3Nlc3Npb25z
L0Fic3RyYWN0U2Vzc2lvbi5qYXZhCSh3b3JraW5nIGNvcHkpDQpAQCAtMTYxLDYgKzE2MSwxMyBA
QA0KICAgICAvKiogTGlzdCBvZiBhY3RpdmUgY29tbWFuZCB0aHJlYWRzLiAqLwogICAgIHByb3Rl
Y3RlZCBFeHBvc2VkTm9kZUxpbmtlZExpc3QgYWN0aXZlQ29tbWFuZFRocmVhZHM7CiAKKyAgICAv
KiogCisgICAgICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHNlc3Npb24gaXMgc3luY2hyb25pemVk
LgorICAgICAqIEluIGNhc2UgZXh0ZXJuYWwgdHJhbnNhY3Rpb24gY29udHJvbGxlciBpcyB1c2Vk
IGlzU3luY2hyb25pemVkPT10cnVlIG1lYW5zCisgICAgICogdGhlIHNlc3Npb24ncyBqdGEgY29u
bmVjdGlvbiB3aWxsIGJlIGZyZWVkIGR1cmluZyBleHRlcm5hbCB0cmFuc2FjdGlvbiBjYWxsYmFj
ay4KKyAgICAgKi8KKyAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc1N5bmNocm9uaXplZDsKKyAgICAK
ICAgICAvKioKICAgICAgKiBJTlRFUk5BTDoKICAgICAgKiBDcmVhdGUgYW5kIHJldHVybiBhIG5l
dyBzZXNzaW9uLgpAQCAtMTc0LDYgKzE4MSw3IEBADQogICAgICAgICAvLyBQRVJGIC0gbW92ZSB0
byBsYXp5IGluaXQgKDMyODYwOTEpCiAgICAgICAgIHRoaXMubnVtYmVyT2ZBY3RpdmVVbml0c09m
V29yayA9IDA7CiAgICAgICAgIHRoaXMuaXNJbkJyb2tlciA9IGZhbHNlOworICAgICAgICB0aGlz
LmlzU3luY2hyb25pemVkID0gZmFsc2U7CiAgICAgfQogCiAgICAgLyoqCkBAIC0zMjcsNTEgKzMz
NSwzNCBAQA0KIAogICAgIC8qKgogICAgICAqIElOVEVSTkFMOgotICAgICAqIENhbGxlZCBhZnRl
ciB0cmFuc2FjdGlvbiBpcyBjb21wbGV0ZWQgKGNvbW1pdHRlZCBvciByb2xsZWQgYmFjaykKKyAg
ICAgKiBDYWxsZWQgaW4gdGhlIGVuZCBvZiBiZWZvcmVDb21wbGV0aW9uIG9mIGV4dGVybmFsIHRy
YW5zYWN0aW9uIHN5Y2hyb25pemF0aW9uIGxpc3RlbmVyLgorICAgICAqIENsb3NlIHRoZSBtYW5h
Z2VkIHNxbCBjb25uZWN0aW9uIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGV4dGVybmFsIHRyYW5zYWN0
aW9uLAorICAgICAqIGlmIGFwcGxpY2FibGUgcmVsZWFzZXMgYWNjZXNzb3IuCiAgICAgICovCi0g
ICAgcHVibGljIHZvaWQgYWZ0ZXJUcmFuc2FjdGlvbihib29sZWFuIGNvbW1pdHRlZCwgYm9vbGVh
biBpc0V4dGVybmFsVHJhbnNhY3Rpb24pIHsKKyAgICBwdWJsaWMgdm9pZCByZWxlYXNlSlRTQ29u
bmVjdGlvbigpIHsKICAgICB9CiAKLQotICAgIAogICAgIC8qKgogICAgICAqIElOVEVSTkFMOgot
ICAgICAqIEFsbG93IGNhbGxpbmcgc2Vzc2lvbiB0byBiZSBwYXNzZWQuICAgICAKLSAgICAgKiAK
LSAgICAgKiBUaGUgY2FsbGluZyBzZXNzaW9uIGlzIHRoZSBzZXNzaW9uIHdobyBhY3R1YWxseSBp
bnZva2VzIGNvbW1pdCBvciByb2xsYmFjayB0cmFuc2FjdGlvbiwgCi0gICAgICogaXQgaXMgdXNl
ZCB0byBkZXRlcm1pbmUgd2hldGhlciB0aGUgY29ubmVjdGlvbiBuZWVkcyB0byBiZSBjbG9zZWQg
d2hlbiB1c2luZyBleHRlcm5hbCBjb25uZWN0aW9uIHBvb2wuCi0gICAgICogVGhlIGNvbm5lY3Rp
b24gd2l0aCBhIGV4dGVybmFsQ29ubmVjdGlvblBvb2wgdXNlZCBieSBzeW5jaHJvbml6ZWQgVU9X
IHNob3VsZCBsZWF2ZSBvcGVuIHVudGlsIAotICAgICAqIGFmdGVyQ29tcGxldGlvbiBjYWxsIGJh
Y2s7IHRoZSBjb25uZWN0aW9uIHdpdGggYSBleHRlcm5hbENvbm5lY3Rpb25Qb29sIHVzZWQgYnkg
b3RoZXIgdHlwZSBvZiBzZXNzaW9uIAotICAgICAqIHNob3VsZCBiZSBjbG9zZWQgYWZ0ZXIgdHJh
bnNhY3Rpb24gd2FzIGZpbmlzZWQuCi0gICAgICogCiAgICAgICogQ2FsbGVkIGJ5IGNvbW1pdFRy
YW5zYWN0aW9uKCkgdG8gY29tbWl0IGEgdHJhbnNhY3Rpb24uCiAgICAgICogVGhpcyBjb21taXRz
IHRoZSBhY3RpdmUgdHJhbnNhY3Rpb24uCiAgICAgICovCi0gICAgcHJvdGVjdGVkIHZvaWQgYmFz
aWNDb21taXRUcmFuc2FjdGlvbihBYnN0cmFjdFNlc3Npb24gY2FsbGluZ1Nlc3Npb24pIHRocm93
cyBEYXRhYmFzZUV4Y2VwdGlvbiB7CisgICAgcHJvdGVjdGVkIHZvaWQgYmFzaWNDb21taXRUcmFu
c2FjdGlvbigpIHRocm93cyBEYXRhYmFzZUV4Y2VwdGlvbiB7CiAgICAgICAgIHRyeSB7Ci0gICAg
ICAgICAgICBnZXRBY2Nlc3NvcigpLmNvbW1pdFRyYW5zYWN0aW9uKHRoaXMsY2FsbGluZ1Nlc3Np
b24pOworICAgICAgICAgICAgZ2V0QWNjZXNzb3IoKS5jb21taXRUcmFuc2FjdGlvbih0aGlzKTsK
ICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAg
ICAgIGhhbmRsZUV4Y2VwdGlvbihleGNlcHRpb24pOwogICAgICAgICB9CiAgICAgfQogCi0gICAg
CiAgICAgLyoqCiAgICAgICogSU5URVJOQUw6Ci0gICAgICogQWxsb3cgY2FsbGluZyBzZXNzaW9u
IHRvIGJlIHBhc3NlZC4gICAgIAotICAgICAqIAotICAgICAqIFRoZSBjYWxsaW5nIHNlc3Npb24g
aXMgdGhlIHNlc3Npb24gd2hvIGFjdHVhbGx5IGludm9rZXMgY29tbWl0IG9yIHJvbGxiYWNrIHRy
YW5zYWN0aW9uLCAKLSAgICAgKiBpdCBpcyB1c2VkIHRvIGRldGVybWluZSB3aGV0aGVyIHRoZSBj
b25uZWN0aW9uIG5lZWRzIHRvIGJlIGNsb3NlZCB3aGVuIHVzaW5nIGV4dGVybmFsIGNvbm5lY3Rp
b24gcG9vbC4KLSAgICAgKiBUaGUgY29ubmVjdGlvbiB3aXRoIGEgZXh0ZXJuYWxDb25uZWN0aW9u
UG9vbCB1c2VkIGJ5IHN5bmNocm9uaXplZCBVT1cgc2hvdWxkIGxlYXZlIG9wZW4gdW50aWwgCi0g
ICAgICogYWZ0ZXJDb21wbGV0aW9uIGNhbGwgYmFjazsgdGhlIGNvbm5lY3Rpb24gd2l0aCBhIGV4
dGVybmFsQ29ubmVjdGlvblBvb2wgdXNlZCBieSBvdGhlciB0eXBlIG9mIHNlc3Npb24gCi0gICAg
ICogc2hvdWxkIGJlIGNsb3NlZCBhZnRlciB0cmFuc2FjdGlvbiB3YXMgZmluaXNlZC4KLSAgICAg
KiAKICAgICAgKiBDYWxsZWQgYnkgcm9sbGJhY2tUcmFuc2FjdGlvbigpIHRvIHJvbGxiYWNrIGEg
dHJhbnNhY3Rpb24uCiAgICAgICogVGhpcyByb2xsc2JhY2sgdGhlIGFjdGl2ZSB0cmFuc2FjdGlv
bi4KICAgICAgKi8KLSAgICBwcm90ZWN0ZWQgdm9pZCBiYXNpY1JvbGxiYWNrVHJhbnNhY3Rpb24o
QWJzdHJhY3RTZXNzaW9uIGNhbGxpbmdTZXNzaW9uKSB0aHJvd3MgRGF0YWJhc2VFeGNlcHRpb24g
eworICAgIHByb3RlY3RlZCB2b2lkIGJhc2ljUm9sbGJhY2tUcmFuc2FjdGlvbigpIHRocm93cyBE
YXRhYmFzZUV4Y2VwdGlvbiB7CiAgICAgICAgIHRyeSB7Ci0gICAgICAgICAgICBnZXRBY2Nlc3Nv
cigpLnJvbGxiYWNrVHJhbnNhY3Rpb24odGhpcyxjYWxsaW5nU2Vzc2lvbik7CisgICAgICAgICAg
ICBnZXRBY2Nlc3NvcigpLnJvbGxiYWNrVHJhbnNhY3Rpb24odGhpcyk7CiAgICAgICAgIH0gY2F0
Y2ggKFJ1bnRpbWVFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICBoYW5kbGVFeGNl
cHRpb24oZXhjZXB0aW9uKTsKICAgICAgICAgfQpAQCAtNTEyLDMzICs1MDMsMTAgQEANCiAgICAg
ICogQGV4Y2VwdGlvbiBDb25jdXJyZW5jeUV4Y2VwdGlvbiBpZiB0aGlzIHNlc3Npb24gaXMgbm90
IHdpdGhpbiBhIHRyYW5zYWN0aW9uLgogICAgICAqLwogICAgIHB1YmxpYyB2b2lkIGNvbW1pdFRy
YW5zYWN0aW9uKCkgdGhyb3dzIERhdGFiYXNlRXhjZXB0aW9uLCBDb25jdXJyZW5jeUV4Y2VwdGlv
biB7Ci0gICAgICAgIHRoaXMuY29tbWl0VHJhbnNhY3Rpb24odGhpcyk7Ci0gICAgfQotICAgIC8q
KgotICAgICAqIFBVQkxJQzoKLSAgICAgKiBBbGxvdyBjYWxsaW5nIHNlc3Npb24gdG8gYmUgcGFz
c2VkLiAgICAgCi0gICAgICogCi0gICAgICogVGhlIGNhbGxpbmcgc2Vzc2lvbiBpcyB0aGUgc2Vz
c2lvbiB3aG8gYWN0dWFsbHkgaW52b2tlcyBjb21taXQgb3Igcm9sbGJhY2sgdHJhbnNhY3Rpb24s
IAotICAgICAqIGl0IGlzIHVzZWQgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgdGhlIGNvbm5lY3Rpb24g
bmVlZHMgdG8gYmUgY2xvc2VkIHdoZW4gdXNpbmcgZXh0ZXJuYWwgY29ubmVjdGlvbiBwb29sLgot
ICAgICAqIFRoZSBjb25uZWN0aW9uIHdpdGggYSBleHRlcm5hbENvbm5lY3Rpb25Qb29sIHVzZWQg
Ynkgc3luY2hyb25pemVkIFVPVyBzaG91bGQgbGVhdmUgb3BlbiB1bnRpbCAKLSAgICAgKiBhZnRl
ckNvbXBsZXRpb24gY2FsbCBiYWNrOyB0aGUgY29ubmVjdGlvbiB3aXRoIGEgZXh0ZXJuYWxDb25u
ZWN0aW9uUG9vbCB1c2VkIGJ5IG90aGVyIHR5cGUgb2Ygc2Vzc2lvbiAKLSAgICAgKiBzaG91bGQg
YmUgY2xvc2VkIGFmdGVyIHRyYW5zYWN0aW9uIHdhcyBmaW5pc2VkLgotICAgICAqIAotICAgICAq
IENvbW1pdCB0aGUgYWN0aXZlIGRhdGFiYXNlIHRyYW5zYWN0aW9uLgotICAgICAqIFRoaXMgYWxs
b3dzIGEgZ3JvdXAgb2YgZGF0YWJhc2UgbW9kaWZpY2F0aW9uIHRvIGJlIGNvbW1pdGVkIG9yIHJv
bGxlZGJhY2sgYXMgYSB1bml0LgotICAgICAqIEFsbCB3cml0ZXMvZGVsZXRlcyB3aWxsIGJlIHNl
bnQgdG8gdGhlIGRhdGFiYXNlIGJlIHdpbGwgbm90IGJlIHZpc2libGUgdG8gb3RoZXIgdXNlcnMg
dW50aWwgY29tbWl0LgotICAgICAqIEFsdGhvdWdoIGRhdGFiYXNlcyBkbyBub3QgYWxsb3cgbmVz
dGVkIHRyYW5zYWN0aW9uLAotICAgICAqIFRvcExpbmsgc3VwcG9ydHMgbmVzdGluZyB0aHJvdWdo
IG9ubHkgY29tbWl0dGluZyB0byB0aGUgZGF0YWJhc2Ugb24gdGhlIG91dGVyIGNvbW1pdC4KLSAg
ICAgKgotICAgICAqIEBleGNlcHRpb24gRGF0YWJhc2VFeGNlcHRpb24gbW9zdCBkYXRhYmFzZXMg
dmFsaWRhdGUgY2hhbmdlcyBhcyB0aGV5IGFyZSBkb25lLAotICAgICAqIG5vcm1hbGx5IGVycm9y
cyBkbyBub3Qgb2NjdXIgb24gY29tbWl0IHVubGVzcyB0aGUgZGlzayBmYWlscyBvciB0aGUgY29u
bmVjdGlvbiBpcyBsb3N0LgotICAgICAqIEBleGNlcHRpb24gQ29uY3VycmVuY3lFeGNlcHRpb24g
aWYgdGhpcyBzZXNzaW9uIGlzIG5vdCB3aXRoaW4gYSB0cmFuc2FjdGlvbi4KLSAgICAgKi8KLSAg
ICBwdWJsaWMgdm9pZCBjb21taXRUcmFuc2FjdGlvbihBYnN0cmFjdFNlc3Npb24gY2FsbGluZ1Nl
c3Npb24pIHRocm93cyBEYXRhYmFzZUV4Y2VwdGlvbiwgQ29uY3VycmVuY3lFeGNlcHRpb24gewog
ICAgICAgICAvLyBSZWxlYXNlIG11dGV4IGFuZCBjYWxsIHN1YmNsYXNzIHNwZWNpZmljIGNvbW1p
dC4KICAgICAgICAgaWYgKCFnZXRUcmFuc2FjdGlvbk11dGV4KCkuaXNOZXN0ZWQoKSkgewogICAg
ICAgICAgICAgZ2V0RXZlbnRNYW5hZ2VyKCkucHJlQ29tbWl0VHJhbnNhY3Rpb24oKTsKLSAgICAg
ICAgICAgIGJhc2ljQ29tbWl0VHJhbnNhY3Rpb24oY2FsbGluZ1Nlc3Npb24pOworICAgICAgICAg
ICAgYmFzaWNDb21taXRUcmFuc2FjdGlvbigpOwogICAgICAgICAgICAgZ2V0RXZlbnRNYW5hZ2Vy
KCkucG9zdENvbW1pdFRyYW5zYWN0aW9uKCk7CiAgICAgICAgIH0KIApAQCAtNTUyLDggKzUyMCw3
IEBADQogICAgICAgICAgICAgY29tbWl0RXh0ZXJuYWxUcmFuc2FjdGlvbigpOwogICAgICAgICB9
CiAgICAgfQotICAgIAotICAgIAorCiAgICAgLyoqCiAgICAgICogSU5URVJOQUw6CiAgICAgICog
UmV0dXJuIGlmIHRoZSB0d28gb2JqZWN0IG1hdGNoIGNvbXBsZXRlbHkuCkBAIC0yMjI4LDYgKzIx
OTUsMTQgQEANCiAgICAgfQogCiAgICAgLyoqCisgICAgICogSU5URVJOQUw6CisgICAgICogUmV0
dXJuIGlmIHRoaXMgc2Vzc2lvbiBpcyBzeW5jaHJvbml6ZWQuCisgICAgICovCisgICAgcHVibGlj
IGJvb2xlYW4gaXNTeW5jaHJvbml6ZWQoKSB7CisgICAgICAgIHJldHVybiBpc1N5bmNocm9uaXpl
ZDsKKyAgICB9CisKKyAgICAvKioKICAgICAgKiBQVUJMSUM6CiAgICAgICogUmV0dXJuIGlmIHRo
aXMgc2Vzc2lvbiBpcyBhIHVuaXQgb2Ygd29yay4KICAgICAgKi8KQEAgLTI1NzMsMzQgKzI1NDgs
MTEgQEANCiAgICAgICogQGV4Y2VwdGlvbiBDb25jdXJyZW5jeUV4Y2VwdGlvbiBpZiB0aGlzIHNl
c3Npb24gaXMgbm90IHdpdGhpbiBhIHRyYW5zYWN0aW9uLgogICAgICAqLwogICAgIHB1YmxpYyB2
b2lkIHJvbGxiYWNrVHJhbnNhY3Rpb24oKSB0aHJvd3MgRGF0YWJhc2VFeGNlcHRpb24sIENvbmN1
cnJlbmN5RXhjZXB0aW9uIHsKLSAgICAgICAgdGhpcy5yb2xsYmFja1RyYW5zYWN0aW9uKHRoaXMp
OwotICAgIH0KLSAgICAKLSAgICAvKioKLSAgICAgKiBQVUJMSUM6Ci0gICAgICogQWxsb3cgY2Fs
bGluZyBzZXNzaW9uIHRvIGJlIHBhc3NlZC4gICAgIAotICAgICAqIAotICAgICAqIFRoZSBjYWxs
aW5nIHNlc3Npb24gaXMgdGhlIHNlc3Npb24gd2hvIGFjdHVhbGx5IGludm9rZXMgY29tbWl0IG9y
IHJvbGxiYWNrIHRyYW5zYWN0aW9uLCAKLSAgICAgKiBpdCBpcyB1c2VkIHRvIGRldGVybWluZSB3
aGV0aGVyIHRoZSBjb25uZWN0aW9uIG5lZWRzIHRvIGJlIGNsb3NlZCB3aGVuIHVzaW5nIGV4dGVy
bmFsIGNvbm5lY3Rpb24gcG9vbC4KLSAgICAgKiBUaGUgY29ubmVjdGlvbiB3aXRoIGEgZXh0ZXJu
YWxDb25uZWN0aW9uUG9vbCB1c2VkIGJ5IHN5bmNocm9uaXplZCBVT1cgc2hvdWxkIGxlYXZlIG9w
ZW4gdW50aWwgCi0gICAgICogYWZ0ZXJDb21wbGV0aW9uIGNhbGwgYmFjazsgdGhlIGNvbm5lY3Rp
b24gd2l0aCBhIGV4dGVybmFsQ29ubmVjdGlvblBvb2wgdXNlZCBieSBvdGhlciB0eXBlIG9mIHNl
c3Npb24gCi0gICAgICogc2hvdWxkIGJlIGNsb3NlZCBhZnRlciB0cmFuc2FjdGlvbiB3YXMgZmlu
aXNlZC4KLSAgICAgKiAKLSAgICAgKiBSb2xsYmFjayB0aGUgYWN0aXZlIGRhdGFiYXNlIHRyYW5z
YWN0aW9uLgotICAgICAqIFRoaXMgYWxsb3dzIGEgZ3JvdXAgb2YgZGF0YWJhc2UgbW9kaWZpY2F0
aW9uIHRvIGJlIGNvbW1pdGVkIG9yIHJvbGxlZGJhY2sgYXMgYSB1bml0LgotICAgICAqIEFsbCB3
cml0ZXMvZGVsZXRlcyB3aWxsIGJlIHNlbnQgdG8gdGhlIGRhdGFiYXNlIGJlIHdpbGwgbm90IGJl
IHZpc2libGUgdG8gb3RoZXIgdXNlcnMgdW50aWwgY29tbWl0LgotICAgICAqIEFsdGhvdWdoIGRh
dGFiYXNlcyBkbyBub3QgYWxsb3cgbmVzdGVkIHRyYW5zYWN0aW9uLAotICAgICAqIFRvcExpbmsg
c3VwcG9ydHMgbmVzdGluZyB0aHJvdWdoIG9ubHkgY29tbWl0dGluZyB0byB0aGUgZGF0YWJhc2Ug
b24gdGhlIG91dGVyIGNvbW1pdC4KLSAgICAgKgotICAgICAqIEBleGNlcHRpb24gRGF0YWJhc2VF
eGNlcHRpb24gaWYgdGhlIGRhdGFiYXNlIGNvbm5lY3Rpb24gaXMgbG9zdCBvciB0aGUgcm9sbGJh
Y2sgZmFpbHMuCi0gICAgICogQGV4Y2VwdGlvbiBDb25jdXJyZW5jeUV4Y2VwdGlvbiBpZiB0aGlz
IHNlc3Npb24gaXMgbm90IHdpdGhpbiBhIHRyYW5zYWN0aW9uLgotICAgICAqLwotICAgIHB1Ymxp
YyB2b2lkIHJvbGxiYWNrVHJhbnNhY3Rpb24oQWJzdHJhY3RTZXNzaW9uIGNhbGxpbmdTZXNzaW9u
KSB0aHJvd3MgRGF0YWJhc2VFeGNlcHRpb24sIENvbmN1cnJlbmN5RXhjZXB0aW9uIHsKICAgICAg
ICAgLy8gRW5zdXJlIHJlbGVhc2Ugb2YgbXV0ZXggYW5kIGNhbGwgc3ViY2xhc3Mgc3BlY2lmaWMg
cmVsZWFzZS4KICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgIGlmICghZ2V0VHJhbnNhY3Rpb25N
dXRleCgpLmlzTmVzdGVkKCkpIHsKICAgICAgICAgICAgICAgICBnZXRFdmVudE1hbmFnZXIoKS5w
cmVSb2xsYmFja1RyYW5zYWN0aW9uKCk7Ci0gICAgICAgICAgICAgICAgYmFzaWNSb2xsYmFja1Ry
YW5zYWN0aW9uKGNhbGxpbmdTZXNzaW9uKTsKKyAgICAgICAgICAgICAgICBiYXNpY1JvbGxiYWNr
VHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgICAgICBnZXRFdmVudE1hbmFnZXIoKS5wb3N0Um9s
bGJhY2tUcmFuc2FjdGlvbigpOwogICAgICAgICAgICAgfQogICAgICAgICB9IGZpbmFsbHkgewpA
QCAtMjYxNCw3ICsyNTY2LDYgQEANCiAgICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICB9Ci0g
ICAgCiAKICAgICAvKioKICAgICAgKiBJTlRFUk5BTDoKQEAgLTI3OTQsNiArMjc0NSwxNSBAQA0K
ICAgICAgICAgfQogICAgIH0KIAorICAgIC8qKgorICAgICAqIElOVEVSTkFMOgorICAgICAqIFNl
dCBpc1N5bmNocm9uaXplZCBmbGFnIHRvIGluZGljYXRlIHRoYXQgdGhpcyBzZXNzaW9uIGlzIHN5
bmNocm9uaXplZC4KKyAgICAgKiBUaGlzIG1ldGhvZCBzaG91bGQgb25seSBiZSBjYWxsZWQgYnkg
c2V0U3luY2hyb25pemVkIG1ldGhvZHMgb2YgZGVyaXZlZCBjbGFzc2VzLgorICAgICAqLworICAg
IHB1YmxpYyB2b2lkIHNldFN5bmNocm9uaXplZChib29sZWFuIHN5bmNoZWQpIHsKKyAgICAgICAg
aXNTeW5jaHJvbml6ZWQgPSBzeW5jaGVkOworICAgIH0KKwogICAgIHByb3RlY3RlZCB2b2lkIHNl
dFRyYW5zYWN0aW9uTXV0ZXgoQ29uY3VycmVuY3lNYW5hZ2VyIHRyYW5zYWN0aW9uTXV0ZXgpIHsK
ICAgICAgICAgdGhpcy50cmFuc2FjdGlvbk11dGV4ID0gdHJhbnNhY3Rpb25NdXRleDsKICAgICB9
CkluZGV4OiBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNp
c3RlbmNlL2ludGVybmFsL3Nlc3Npb25zL0RhdGFiYXNlU2Vzc2lvbkltcGwuamF2YQ0KPT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PQ0KLS0tIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVy
c2lzdGVuY2UvaW50ZXJuYWwvc2Vzc2lvbnMvRGF0YWJhc2VTZXNzaW9uSW1wbC5qYXZhCShyZXZp
c2lvbiA3NDU2KQ0KKysrIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlw
c2UvcGVyc2lzdGVuY2UvaW50ZXJuYWwvc2Vzc2lvbnMvRGF0YWJhc2VTZXNzaW9uSW1wbC5qYXZh
CSh3b3JraW5nIGNvcHkpDQpAQCAtMTE5LDYgKzExOSwxNSBAQA0KIAogICAgIC8qKgogICAgICAq
IElOVEVSTkFMOgorICAgICAqIEluZGljYXRlcyB3aGV0aGVyIFNlcXVlbmNpbmdDYWxsYmFjayBp
cyByZXF1aXJlZC4KKyAgICAgKiBBbHdheXMgcmV0dXJucyBmYWxzZSBpZiBzZXF1ZW5jaW5nIGlz
IG5vdCBjb25uZWN0ZWQuCisgICAgICovCisgICAgcHVibGljIGJvb2xlYW4gaXNTZXF1ZW5jaW5n
Q2FsbGJhY2tSZXF1aXJlZCgpIHsKKyAgICAgICAgcmV0dXJuIGdldFNlcXVlbmNpbmdIb21lKCku
aXNTZXF1ZW5jaW5nQ2FsbGJhY2tSZXF1aXJlZCgpOworICAgIH0KKworICAgIC8qKgorICAgICAq
IElOVEVSTkFMOgogICAgICAqIENyZWF0ZXMgc2VxdWVuY2luZyBvYmplY3QKICAgICAgKi8KICAg
ICBwdWJsaWMgdm9pZCBpbml0aWFsaXplU2VxdWVuY2luZygpIHsKQEAgLTEyOCwxMyArMTM3LDEx
IEBADQogCiAgICAgLyoqCiAgICAgICogSU5URVJOQUw6Ci0gICAgICogQ2FsbGVkIGFmdGVyIHRy
YW5zYWN0aW9uIGlzIGNvbXBsZXRlZCAoY29tbWl0dGVkIG9yIHJvbGxlZCBiYWNrKQorICAgICAq
IENhbGxlZCBpbiB0aGUgZW5kIG9mIGJlZm9yZUNvbXBsZXRpb24gb2YgZXh0ZXJuYWwgdHJhbnNh
Y3Rpb24gc3ljaHJvbml6YXRpb24gbGlzdGVuZXIuCisgICAgICogQ2xvc2UgdGhlIG1hbmFnZWQg
c3FsIGNvbm5lY3Rpb24gY29ycmVzcG9uZGluZyB0byB0aGUgZXh0ZXJuYWwgdHJhbnNhY3Rpb24u
CiAgICAgICovCi0gICAgcHVibGljIHZvaWQgYWZ0ZXJUcmFuc2FjdGlvbihib29sZWFuIGNvbW1p
dHRlZCwgYm9vbGVhbiBpc0V4dGVybmFsVHJhbnNhY3Rpb24pIHsKLSAgICAgICAgU2VxdWVuY2lu
Z0NhbGxiYWNrIGNhbGxiYWNrID0gZ2V0U2VxdWVuY2luZ0hvbWUoKS5nZXRTZXF1ZW5jaW5nQ2Fs
bGJhY2soKTsKLSAgICAgICAgaWYgKGNhbGxiYWNrICE9IG51bGwpIHsKLSAgICAgICAgICAgIGNh
bGxiYWNrLmFmdGVyVHJhbnNhY3Rpb24oZ2V0QWNjZXNzb3IoKSwgY29tbWl0dGVkKTsKLSAgICAg
ICAgfQorICAgIHB1YmxpYyB2b2lkIHJlbGVhc2VKVFNDb25uZWN0aW9uKCkgeworICAgICAgICBn
ZXRBY2Nlc3NvcigpLmNsb3NlSlRTQ29ubmVjdGlvbigpOwogICAgIH0KIAogICAgIC8qKgpJbmRl
eDogZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5j
ZS9pbnRlcm5hbC9zZXNzaW9ucy9FeGNsdXNpdmVJc29sYXRlZENsaWVudFNlc3Npb24uamF2YQ0K
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PQ0KLS0tIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlw
c2UvcGVyc2lzdGVuY2UvaW50ZXJuYWwvc2Vzc2lvbnMvRXhjbHVzaXZlSXNvbGF0ZWRDbGllbnRT
ZXNzaW9uLmphdmEJKHJldmlzaW9uIDc0NTYpDQorKysgZm91bmRhdGlvbi9lY2xpcHNlbGluay5j
b3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9pbnRlcm5hbC9zZXNzaW9ucy9FeGNsdXNp
dmVJc29sYXRlZENsaWVudFNlc3Npb24uamF2YQkod29ya2luZyBjb3B5KQ0KQEAgLTY2LDggKzY2
LDcgQEANCiANCiAgICAgICAgIC8vT25seSByZWxlYXNlZSBjb25uZWN0aW9uIHdoZW4gdHJhbnNh
Y3Rpb24gc3VjY2VlZHMuICANCiAgICAgICAgIC8vSWYgbm90LCBjb25uZWN0aW9uIHdpbGwgYmUg
cmVsZWFzZWQgaW4gcm9sbGJhY2suDQotICAgICAgICAvL0J1ZzYwNjU4ODIsbmVlZHMgaW5kaWNh
dGUgdGhpcyBjbGllbnQgc2Vzc2lvbiBpcyB0aGUgb25lIGludm9rZXMgY29tbWl0IHR4bi4gCi0g
ICAgICAgIHN1cGVyLmJhc2ljQ29tbWl0VHJhbnNhY3Rpb24odGhpcyk7DQorICAgICAgICBzdXBl
ci5iYXNpY0NvbW1pdFRyYW5zYWN0aW9uKCk7DQogICAgIH0NCiANCiAgICAgLyoqDQpJbmRleDog
Zm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9p
bnRlcm5hbC9zZXNzaW9ucy9yZW1vdGUvUmVtb3RlVW5pdE9mV29yay5qYXZhDQo9PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
DQotLS0gZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJzaXN0
ZW5jZS9pbnRlcm5hbC9zZXNzaW9ucy9yZW1vdGUvUmVtb3RlVW5pdE9mV29yay5qYXZhCShyZXZp
c2lvbiA3NDU2KQ0KKysrIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlw
c2UvcGVyc2lzdGVuY2UvaW50ZXJuYWwvc2Vzc2lvbnMvcmVtb3RlL1JlbW90ZVVuaXRPZldvcmsu
amF2YQkod29ya2luZyBjb3B5KQ0KQEAgLTIxLDcgKzIxLDYgQEANCiBpbXBvcnQgb3JnLmVjbGlw
c2UucGVyc2lzdGVuY2UucXVlcmllcy5EYXRhYmFzZVF1ZXJ5OwogaW1wb3J0IG9yZy5lY2xpcHNl
LnBlcnNpc3RlbmNlLnF1ZXJpZXMuT2JqZWN0TGV2ZWxSZWFkUXVlcnk7CiBpbXBvcnQgb3JnLmVj
bGlwc2UucGVyc2lzdGVuY2Uuc2Vzc2lvbnMucmVtb3RlLio7Ci1pbXBvcnQgb3JnLmVjbGlwc2Uu
cGVyc2lzdGVuY2Uuc2Vzc2lvbnMuU2Vzc2lvblByb2ZpbGVyOwogaW1wb3J0IG9yZy5lY2xpcHNl
LnBlcnNpc3RlbmNlLmxvZ2dpbmcuU2Vzc2lvbkxvZzsKIAogLyoqCkBAIC03NSwxOCArNzQsNyBA
QA0KICAgICAgICAgZGlzY292ZXJBbGxVbnJlZ2lzdGVyZWROZXdPYmplY3RzKCk7CiAgICAgICAg
IHJldHVybiBIZWxwZXIuYnVpbGRWZWN0b3JGcm9tSGFzaHRhYmxlRWxlbWVudHMoZ2V0VW5yZWdp
c3RlcmVkTmV3T2JqZWN0cygpKTsKICAgICB9Ci0gICAgCi0gICAgLyoqCi0gICAgICogSU5URVJO
QUw6Ci0gICAgICogVGhpcyBvdmVybG9hZGluZyBtZXRob2QgaXMgcmVxdWlyZWQsIGl0IGZvcmNl
cyBub24tY2FsbGluZ1Nlc3Npb24gc3BlY2lmaWVkIGNvbW1pdFRyYW5zYWN0aW9uIG1ldGhvZCAK
LSAgICAgKiBiZWluZyBpbnZva2VkIGZyb20gaXRzIHBhcmVudCBjbGFzcywgdGhpcyBndWFyYW50
ZWVzIHRoZSBtZXRob2QgYmVpbmcgaW52b2tlZCBmcm9tIGNvcnJlY3QgcGFyZW50IAotICAgICAq
IGNsYXNzIC0gUmVtb3RlU2Vzc2lvbiwgd2hpY2ggaGFzIG9ubHkgb25lIG5vbi1jYWxsaW5nU2Vz
c2lvbiBzcGVjaWZpZWQgY29tbWl0VHJhc2FjdGlvbiBtZXRob2QgZGVmaW5lZC4KLSAgICAgKi8K
LSAgICBwdWJsaWMgdm9pZCBjb21taXRUcmFuc2FjdGlvbigpIHRocm93cyBEYXRhYmFzZUV4Y2Vw
dGlvbiB7Ci0gICAgICAgIGdldFBhcmVudCgpLmNvbW1pdFRyYW5zYWN0aW9uKCk7Ci0gICAgfQog
Ci0KICAgICAvKioKICAgICAgKiBUaGUgcmVtb3RlIHVuaXQgb2Ygd29yayByZXR1cm5lZCBhZnRl
ciBpdHMgY29tbWl0IG9uIHRoZSBzZXJ2ZXIgaXMgbWVyZ2VkIHdpdGggcmVtb3RlIHVuaXQgb2Yg
d29yawogICAgICAqIG9uIHRoZSByZW1vdGUgc2lkZS4KQEAgLTQ3MiwxNyArNDYwLDYgQEANCiAg
ICAgICAgICAgICBnZXRQYXJlbnQoKS5nZXRFeHRlcm5hbFRyYW5zYWN0aW9uQ29udHJvbGxlcigp
LnJlZ2lzdGVyU3luY2hyb25pemF0aW9uTGlzdGVuZXIodGhpcywgZ2V0UGFyZW50KCkpOwogICAg
ICAgICB9CiAgICAgfQotICAgIAotICAgIC8qKgotICAgICAqIElOVEVSTkFMOgotICAgICAqIFRo
aXMgb3ZlcmxvYWRpbmcgbWV0aG9kIGlzIHJlcXVpcmVkLCBpdCBmb3JjZXMgbm9uLWNhbGxpbmdT
ZXNzaW9uIHNwZWNpZmllZCByb2xsYmFja1RyYW5zYWN0aW9uIG1ldGhvZCAKLSAgICAgKiBiZWlu
ZyBpbnZva2VkIGZyb20gaXRzIHBhcmVudCBjbGFzcywgdGhpcyBndWFyYW50ZWVzIHRoZSBtZXRo
b2QgYmVpbmcgaW52b2tlZCBmcm9tIGNvcnJlY3QgcGFyZW50IAotICAgICAqIGNsYXNzIC0gUmVt
b3RlU2Vzc2lvbiwgd2hpY2ggaGFzIG9ubHkgb25lIG5vbi1jYWxsaW5nU2Vzc2lvbiBzcGVjaWZp
ZWQgcm9sbGJhY2tUcmFuc2FjdGlvbiBtZXRob2QgZGVmaW5lZC4KLSAgICAgKi8KLSAgICBwdWJs
aWMgdm9pZCByb2xsYmFja1RyYW5zYWN0aW9uKCkgdGhyb3dzIERhdGFiYXNlRXhjZXB0aW9uIHsK
LSAgICAgICAgaW5jcmVtZW50UHJvZmlsZShTZXNzaW9uUHJvZmlsZXIuVW93Um9sbGJhY2tzKTsK
LSAgICAgICAgZ2V0UGFyZW50KCkucm9sbGJhY2tUcmFuc2FjdGlvbigpOwotICAgIH0KIAogICAg
IHByb3RlY3RlZCB2b2lkIHNldElzT25DbGllbnQoYm9vbGVhbiBpc09uQ2xpZW50KSB7CiAgICAg
ICAgIHRoaXMuaXNPbkNsaWVudCA9IGlzT25DbGllbnQ7CkluZGV4OiBmb3VuZGF0aW9uL2VjbGlw
c2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL2ludGVybmFsL3Nlc3Npb25z
L1VuaXRPZldvcmtJbXBsLmphdmENCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBmb3VuZGF0aW9uL2VjbGlwc2Vs
aW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL2ludGVybmFsL3Nlc3Npb25zL1Vu
aXRPZldvcmtJbXBsLmphdmEJKHJldmlzaW9uIDc0NTYpDQorKysgZm91bmRhdGlvbi9lY2xpcHNl
bGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9pbnRlcm5hbC9zZXNzaW9ucy9V
bml0T2ZXb3JrSW1wbC5qYXZhCSh3b3JraW5nIGNvcHkpDQpAQCAtMTMyLDcgKzEzMiw2IEBADQog
ICAgICAqIFdpdGggdGhlIG5ldyBzeW5jaHJvbml6ZWQgdW5pdCBvZiB3b3JrLCBuZWVkIGEgbGlm
ZWN5Y2xlIHN0YXRlIHZhcmlhYmxlIHRvCiAgICAgICogdHJhY2sgYmlydGgsIGNvbW1pdGVkLCBw
ZW5kaW5nX21lcmdlIGFuZCBkZWF0aC4KICAgICAgKi8KLSAgICBwcm90ZWN0ZWQgYm9vbGVhbiBp
c1N5bmNocm9uaXplZDsKICAgICBwcm90ZWN0ZWQgaW50IGxpZmVjeWNsZTsKICAgICBwdWJsaWMg
c3RhdGljIGZpbmFsIGludCBCaXJ0aCA9IDA7CiAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQg
Q29tbWl0UGVuZGluZyA9IDE7CkBAIC0yNTQsNyArMjUzLDYgQEANCiAgICAgICAgIHRoaXMuc2hv
dWxkVGhyb3dDb25mb3JtRXhjZXB0aW9ucyA9IERPX05PVF9USFJPV19DT05GT1JNX0VYQ0VQVElP
TlM7CiAKICAgICAgICAgLy8gaW5pdGlhbGl6ZSBsaWZlY3ljbGUgc3RhdGUgdmFyaWFibGUKLSAg
ICAgICAgdGhpcy5pc1N5bmNocm9uaXplZCA9IGZhbHNlOwogICAgICAgICB0aGlzLmxpZmVjeWNs
ZSA9IEJpcnRoOwogICAgICAgICAvLyBQRVJGOiBDYWNoZSB0aGUgd3JpdGUtbG9jayBjaGVjayB0
byBhdm9pZCBjb3N0IG9mIGNoZWNraW5nIGluIGV2ZXJ5IHJlZ2lzdGVyL2Nsb25lLgogICAgICAg
ICB0aGlzLnNob3VsZENoZWNrV3JpdGVMb2NrID0gcGFyZW50LmdldERhdGFzb3VyY2VMb2dpbigp
LnNob3VsZFN5bmNocm9uaXplZFJlYWRPbldyaXRlKCkgfHwgcGFyZW50LmdldERhdGFzb3VyY2VM
b2dpbigpLnNob3VsZFN5bmNocm9uaXplV3JpdGVzKCk7CkBAIC0xMzUyLDggKzEzNTAsNyBAQA0K
ICAgICAgKiBUaGUgdW93IHNoYXJlcyBpdHMgcGFyZW50cyB0cmFuc2FjdGlvbnMuCiAgICAgICov
CiAgICAgcHVibGljIHZvaWQgY29tbWl0VHJhbnNhY3Rpb24oKSB0aHJvd3MgRGF0YWJhc2VFeGNl
cHRpb24gewotICAgICAgICAvL0J1ZzYwNjU4ODIsbmVlZHMgaW5kaWNhdGUgdGhpcyBVT1cgaXMg
dGhlIG9uZSBpbnZva2VzIGNvbW1pdCB0eG4uIAotICAgICAgICBnZXRQYXJlbnQoKS5jb21taXRU
cmFuc2FjdGlvbih0aGlzKTsKKyAgICAgICAgZ2V0UGFyZW50KCkuY29tbWl0VHJhbnNhY3Rpb24o
KTsKICAgICB9CiAKICAgICAvKioKQEAgLTIwNjMsMjYgKzIwNjAsMzMgQEANCiAKICAgICAvKioK
ICAgICAgKiBJTlRFUk5BTDoKLSAgICAgKiBDYWxsZWQgYWZ0ZXIgdHJhbnNhY3Rpb24gaXMgY29t
cGxldGVkIChjb21taXR0ZWQgb3Igcm9sbGVkIGJhY2spCisgICAgICogQ2FsbGVkIGFmdGVyIGV4
dGVybmFsIHRyYW5zYWN0aW9uIHJvbGxlZCBiYWNrLgogICAgICAqLwotICAgIHB1YmxpYyB2b2lk
IGFmdGVyVHJhbnNhY3Rpb24oYm9vbGVhbiBjb21taXR0ZWQsIGJvb2xlYW4gaXNFeHRlcm5hbFRy
YW5zYWN0aW9uKSB7Ci0gICAgICAgIGlmICghY29tbWl0dGVkICYmIGlzRXh0ZXJuYWxUcmFuc2Fj
dGlvbikgewotICAgICAgICAgICAgLy8gSW4gY2FzZSBqdHMgdHJhbnNhY3Rpb24gd2FzIGludGVy
bmFsbHkgc3RhcnRlZCBidXQgcm9sbGVkIGJhY2sKLSAgICAgICAgICAgIC8vIGRpcmVjdGx5IGJ5
IFRyYW5zYWN0aW9uTWFuYWdlciB0aGlzIGZsYWcgbWF5IHN0aWxsIGJlIHRydWUgZHVyaW5nIGFm
dGVyQ29tcGxldGlvbgotICAgICAgICAgICAgZ2V0UGFyZW50KCkuc2V0V2FzSlRTVHJhbnNhY3Rp
b25JbnRlcm5hbGx5U3RhcnRlZChmYWxzZSk7Ci0gICAgICAgICAgICAvL2J1ZyM0Njk5NjE0IC0t
IGFkZGVkIGEgbmV3IGxpZmUgY3ljbGUgc3RhdHVzIHNvIHdlIGtub3cgaWYgdGhlIGV4dGVybmFs
IHRyYW5zYWN0aW9uIHdhcyByb2xsZWRiYWNrIGFuZCB3ZSBkb24ndCB0cnkgdG8gcm9sbGJhY2sg
YWdhaW4gbGF0ZXIgICAgICAgICAgICAKLSAgICAgICAgICAgIHNldExpZmVjeWNsZShBZnRlckV4
dGVybmFsVHJhbnNhY3Rpb25Sb2xsZWRCYWNrKTsKLSAgICAgICAgfQotICAgICAgICBpZiAoKCFj
b21taXR0ZWQpICYmIChnZXRNZXJnZU1hbmFnZXIoKSAhPSBudWxsKSAmJiAoZ2V0TWVyZ2VNYW5h
Z2VyKCkuZ2V0QWNxdWlyZWRMb2NrcygpICE9IG51bGwpICYmICghZ2V0TWVyZ2VNYW5hZ2VyKCku
Z2V0QWNxdWlyZWRMb2NrcygpLmlzRW1wdHkoKSkpIHsKKyAgICBwdWJsaWMgdm9pZCBhZnRlckV4
dGVybmFsVHJhbnNhY3Rpb25Sb2xsYmFjaygpIHsKKyAgICAgICAgLy8gSW4gY2FzZSBqdHMgdHJh
bnNhY3Rpb24gd2FzIGludGVybmFsbHkgc3RhcnRlZCBidXQgcm9sbGVkIGJhY2sKKyAgICAgICAg
Ly8gZGlyZWN0bHkgYnkgVHJhbnNhY3Rpb25NYW5hZ2VyIHRoaXMgZmxhZyBtYXkgc3RpbGwgYmUg
dHJ1ZSBkdXJpbmcgYWZ0ZXJDb21wbGV0aW9uCisgICAgICAgIGdldFBhcmVudCgpLnNldFdhc0pU
U1RyYW5zYWN0aW9uSW50ZXJuYWxseVN0YXJ0ZWQoZmFsc2UpOworICAgICAgICAvL2J1ZyM0Njk5
NjE0IC0tIGFkZGVkIGEgbmV3IGxpZmUgY3ljbGUgc3RhdHVzIHNvIHdlIGtub3cgaWYgdGhlIGV4
dGVybmFsIHRyYW5zYWN0aW9uIHdhcyByb2xsZWRiYWNrIGFuZCB3ZSBkb24ndCB0cnkgdG8gcm9s
bGJhY2sgYWdhaW4gbGF0ZXIgICAgICAgICAgICAKKyAgICAgICAgc2V0TGlmZWN5Y2xlKEFmdGVy
RXh0ZXJuYWxUcmFuc2FjdGlvblJvbGxlZEJhY2spOworCisgICAgICAgIGlmICgoZ2V0TWVyZ2VN
YW5hZ2VyKCkgIT0gbnVsbCkgJiYgKGdldE1lcmdlTWFuYWdlcigpLmdldEFjcXVpcmVkTG9ja3Mo
KSAhPSBudWxsKSAmJiAoIWdldE1lcmdlTWFuYWdlcigpLmdldEFjcXVpcmVkTG9ja3MoKS5pc0Vt
cHR5KCkpKSB7CiAgICAgICAgICAgICAvL21heSBoYXZlIHVucmVsZWFzZWQgY2FjaGUgbG9ja3Mg
YmVjYXVzZSBvZiBhIHJvbGxiYWNrLi4uCiAgICAgICAgICAgICBnZXRQYXJlbnQoKS5nZXRJZGVu
dGl0eU1hcEFjY2Vzc29ySW5zdGFuY2UoKS5nZXRXcml0ZUxvY2tNYW5hZ2VyKCkucmVsZWFzZUFs
bEFjcXVpcmVkTG9ja3MoZ2V0TWVyZ2VNYW5hZ2VyKCkpOwogICAgICAgICAgICAgdGhpcy5zZXRN
ZXJnZU1hbmFnZXIobnVsbCk7CiAgICAgICAgIH0KLSAgICAgICAgZ2V0UGFyZW50KCkuYWZ0ZXJU
cmFuc2FjdGlvbihjb21taXR0ZWQsIGlzRXh0ZXJuYWxUcmFuc2FjdGlvbik7CiAgICAgfQogCiAg
ICAgLyoqCiAgICAgICogSU5URVJOQUw6CisgICAgICogQ2FsbGVkIGluIHRoZSBlbmQgb2YgYmVm
b3JlQ29tcGxldGlvbiBvZiBleHRlcm5hbCB0cmFuc2FjdGlvbiBzeWNocm9uaXphdGlvbiBsaXN0
ZW5lci4KKyAgICAgKiBDbG9zZSB0aGUgbWFuYWdlZCBzcWwgY29ubmVjdGlvbiBjb3JyZXNwb25k
aW5nIHRvIHRoZSBleHRlcm5hbCB0cmFuc2FjdGlvbi4KKyAgICAgKi8KKyAgICBwdWJsaWMgdm9p
ZCByZWxlYXNlSlRTQ29ubmVjdGlvbigpIHsKKyAgICAgICAgZ2V0UGFyZW50KCkucmVsZWFzZUpU
U0Nvbm5lY3Rpb24oKTsKKyAgICB9CisKKyAgICAvKioKKyAgICAgKiBJTlRFUk5BTDoKICAgICAg
KiBSZXR1cm4gYW55IG5ldyBvYmplY3QgbWF0Y2hpbmcgdGhlIGV4cHJlc3Npb24uCiAgICAgICog
VXNlZCBmb3IgaW4tbWVtb3J5IHF1ZXJ5aW5nLgogICAgICAqLwpAQCAtMjg0MSwxNCArMjg0NSw2
IEBADQogICAgIH0KIAogICAgIC8qKgotICAgICAqIElOVEVSTkFMOgotICAgICAqIFJldHVybiBp
ZiB0aGlzIHNlc3Npb24gaXMgYSBzeW5jaHJvbml6ZWQgdW5pdCBvZiB3b3JrLgotICAgICAqLwot
ICAgIHB1YmxpYyBib29sZWFuIGlzU3luY2hyb25pemVkKCkgewotICAgICAgICByZXR1cm4gaXNT
eW5jaHJvbml6ZWQ7Ci0gICAgfQotCi0gICAgLyoqCiAgICAgICogUFVCTElDOgogICAgICAqIFJl
dHVybiBpZiB0aGlzIHNlc3Npb24gaXMgYSB1bml0IG9mIHdvcmsuCiAgICAgICovCkBAIC0zOTky
LDYgKzM5ODgsOCBAQA0KICAgICAgKi8KICAgICBwdWJsaWMgdm9pZCByZWdpc3RlcldpdGhUcmFu
c2FjdGlvbklmUmVxdWlyZWQoKSB7CiAgICAgICAgIGlmIChnZXRQYXJlbnQoKS5oYXNFeHRlcm5h
bFRyYW5zYWN0aW9uQ29udHJvbGxlcigpICYmICEgaXNTeW5jaHJvbml6ZWQoKSkgeworICAgICAg
ICAgICAgLy9UT0RPOiBUaHJvdyBhbiBleGNlcHRpb24gaW4gY2FzZSB0aGUgcGFyZW50IGlzIGFs
cmVhZHkgc3luY2hyb25pemVkOgorICAgICAgICAgICAgLy8gRGF0YWJhc2VTZXNzaW9uIG9yIENs
aWVudFNlc3Npb24gbWF5IGhhdmUgb25seSBvbmUgc3luY2hyb25pemVkIHVvdyBhdCBhIHRpbWUu
CiAgICAgICAgICAgICBib29sZWFuIGhhc0FscmVhZHlTdGFydGVkID0gZ2V0UGFyZW50KCkud2Fz
SlRTVHJhbnNhY3Rpb25JbnRlcm5hbGx5U3RhcnRlZCgpOwogICAgICAgICAgICAgZ2V0UGFyZW50
KCkuZ2V0RXh0ZXJuYWxUcmFuc2FjdGlvbkNvbnRyb2xsZXIoKS5yZWdpc3RlclN5bmNocm9uaXph
dGlvbkxpc3RlbmVyKHRoaXMsIGdldFBhcmVudCgpKTsKIApAQCAtNDIwNiw4ICs0MjA0LDcgQEAN
CiAgICAgICovCiAgICAgcHVibGljIHZvaWQgcm9sbGJhY2tUcmFuc2FjdGlvbigpIHRocm93cyBE
YXRhYmFzZUV4Y2VwdGlvbiB7CiAgICAgICAgIGluY3JlbWVudFByb2ZpbGUoU2Vzc2lvblByb2Zp
bGVyLlVvd1JvbGxiYWNrcyk7Ci0gICAgICAgIC8vQnVnNjA2NTg4MixuZWVkcyBpbmRpY2F0ZSB0
aGlzIFVPVyBpcyB0aGUgb25lIGludm9rZXMgcm9sbGJhY2sgdHhuLiAKLSAgICAgICAgZ2V0UGFy
ZW50KCkucm9sbGJhY2tUcmFuc2FjdGlvbih0aGlzKTsKKyAgICAgICAgZ2V0UGFyZW50KCkucm9s
bGJhY2tUcmFuc2FjdGlvbigpOwogICAgIH0KIAogICAgIC8qKgpAQCAtNDQ4NSw3ICs0NDgyLDgg
QEANCiAgICAgICogU2V0IGlzU3luY2hyb25pemVkIGZsYWcgdG8gaW5kaWNhdGUgdGhhdCB0aGlz
IHNlc3Npb24gaXMgYSBzeW5jaHJvbml6ZWQgdW5pdCBvZiB3b3JrLgogICAgICAqLwogICAgIHB1
YmxpYyB2b2lkIHNldFN5bmNocm9uaXplZChib29sZWFuIHN5bmNoZWQpIHsKLSAgICAgICAgaXNT
eW5jaHJvbml6ZWQgPSBzeW5jaGVkOworICAgICAgICBzdXBlci5zZXRTeW5jaHJvbml6ZWQoc3lu
Y2hlZCk7CisgICAgICAgIGdldFBhcmVudCgpLnNldFN5bmNocm9uaXplZChzeW5jaGVkKTsKICAg
ICB9CiAKICAgICAvKioKSW5kZXg6IGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3Jn
L2VjbGlwc2UvcGVyc2lzdGVuY2Uvc2Vzc2lvbnMvYnJva2VyL1Nlc3Npb25Ccm9rZXIuamF2YQ0K
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PQ0KLS0tIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlw
c2UvcGVyc2lzdGVuY2Uvc2Vzc2lvbnMvYnJva2VyL1Nlc3Npb25Ccm9rZXIuamF2YQkocmV2aXNp
b24gNzQ1NikNCisrKyBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNl
L3BlcnNpc3RlbmNlL3Nlc3Npb25zL2Jyb2tlci9TZXNzaW9uQnJva2VyLmphdmEJKHdvcmtpbmcg
Y29weSkNCkBAIC0zNyw2ICszNyw3IEBADQogICogPC91bD4KICAqLwogcHVibGljIGNsYXNzIFNl
c3Npb25Ccm9rZXIgZXh0ZW5kcyBEYXRhYmFzZVNlc3Npb25JbXBsIHsKKyAgICBwcm90ZWN0ZWQg
U2Vzc2lvbkJyb2tlciBwYXJlbnQ7CiAgICAgcHJvdGVjdGVkIE1hcCBzZXNzaW9uTmFtZXNCeUNs
YXNzOwogICAgIHByb3RlY3RlZCBNYXAgc2Vzc2lvbnNCeU5hbWU7CiAgICAgcHJvdGVjdGVkIFNl
cXVlbmNpbmcgc2VxdWVuY2luZzsKQEAgLTc3LDYgKzc4LDcgQEANCiAgICAgcHVibGljIFNlc3Np
b25Ccm9rZXIgYWNxdWlyZUNsaWVudFNlc3Npb25Ccm9rZXIoKSB7CiAgICAgICAgIGxvZyhTZXNz
aW9uTG9nLkZJTkVSLCBTZXNzaW9uTG9nLkNPTk5FQ1RJT04sICJhY3F1aXJlX2NsaWVudF9zZXNz
aW9uX2Jyb2tlciIpOwogICAgICAgICBTZXNzaW9uQnJva2VyIGNsaWVudEJyb2tlciA9IGNvcHlT
ZXNzaW9uQnJva2VyKCk7CisgICAgICAgIGNsaWVudEJyb2tlci5wYXJlbnQgPSB0aGlzOwogICAg
ICAgICBjbGllbnRCcm9rZXIuZ2V0SWRlbnRpdHlNYXBBY2Nlc3Nvckluc3RhbmNlKCkuc2V0SWRl
bnRpdHlNYXBNYW5hZ2VyKGdldElkZW50aXR5TWFwQWNjZXNzb3JJbnN0YW5jZSgpLmdldElkZW50
aXR5TWFwTWFuYWdlcigpKTsKICAgICAgICAgY2xpZW50QnJva2VyLmNvbW1pdE1hbmFnZXIgPSBn
ZXRDb21taXRNYW5hZ2VyKCk7CiAgICAgICAgIGNsaWVudEJyb2tlci5jb21tYW5kTWFuYWdlciA9
IGdldENvbW1hbmRNYW5hZ2VyKCk7CkBAIC0xMjUsMTMgKzEyNywxNSBAQA0KIAogICAgIC8qKgog
ICAgICAqIElOVEVSTkFMOgotICAgICAqIENhbGxlZCBhZnRlciB0cmFuc2FjdGlvbiBpcyBjb21w
bGV0ZWQgKGNvbW1pdHRlZCBvciByb2xsZWQgYmFjaykKKyAgICAgKiBDYWxsZWQgaW4gdGhlIGVu
ZCBvZiBiZWZvcmVDb21wbGV0aW9uIG9mIGV4dGVybmFsIHRyYW5zYWN0aW9uIHN5Y2hyb25pemF0
aW9uIGxpc3RlbmVyLgorICAgICAqIENsb3NlIHRoZSBtYW5hZ2VkIHNxbCBjb25uZWN0aW9uIGNv
cnJlc3BvbmRpbmcgdG8gdGhlIGV4dGVybmFsIHRyYW5zYWN0aW9uLAorICAgICAqIGlmIGFwcGxp
Y2FibGUgcmVsZWFzZXMgYWNjZXNzb3IuCiAgICAgICovCi0gICAgcHVibGljIHZvaWQgYWZ0ZXJU
cmFuc2FjdGlvbihib29sZWFuIGNvbW1pdHRlZCwgYm9vbGVhbiBpc0V4dGVybmFsVHJhbnNhY3Rp
b24pIHsKKyAgICBwdWJsaWMgdm9pZCByZWxlYXNlSlRTQ29ubmVjdGlvbigpIHsKICAgICAgICAg
Zm9yIChJdGVyYXRvciBzZXNzaW9uRW51bSA9IGdldFNlc3Npb25zQnlOYW1lKCkudmFsdWVzKCku
aXRlcmF0b3IoKTsKICAgICAgICAgICAgICAgICAgc2Vzc2lvbkVudW0uaGFzTmV4dCgpOykgewog
ICAgICAgICAgICAgQWJzdHJhY3RTZXNzaW9uIHNlc3Npb24gPSAoQWJzdHJhY3RTZXNzaW9uKXNl
c3Npb25FbnVtLm5leHQoKTsKLSAgICAgICAgICAgIHNlc3Npb24uYWZ0ZXJUcmFuc2FjdGlvbihj
b21taXR0ZWQsIGlzRXh0ZXJuYWxUcmFuc2FjdGlvbik7CisgICAgICAgICAgICBzZXNzaW9uLnJl
bGVhc2VKVFNDb25uZWN0aW9uKCk7CiAgICAgICAgIH0KICAgICB9CiAKQEAgLTE4NiwyMiArMTkw
LDEzIEBADQogICAgICAgICB9CiAgICAgfQogCi0gICAgCiAgICAgLyoqCiAgICAgICogSU5URVJO
QUw6Ci0gICAgICogQWxsb3cgY2FsbGluZyBzZXNzaW9uIHRvIGJlIHBhc3NlZC4KLSAgICAgKiAg
ICAgIAotICAgICAqIFRoZSBjYWxsaW5nIHNlc3Npb24gaXMgdGhlIHNlc3Npb24gd2hvIGFjdHVh
bGx5IGludm9rZXMgY29tbWl0IG9yIHJvbGxiYWNrIHRyYW5zYWN0aW9uLCAKLSAgICAgKiBpdCBp
cyB1c2VkIHRvIGRldGVybWluZSB3aGV0aGVyIHRoZSBjb25uZWN0aW9uIG5lZWRzIHRvIGJlIGNs
b3NlZCB3aGVuIHVzaW5nIGV4dGVybmFsIGNvbm5lY3Rpb24gcG9vbC4KLSAgICAgKiBUaGUgY29u
bmVjdGlvbiB3aXRoIGEgZXh0ZXJuYWxDb25uZWN0aW9uUG9vbCB1c2VkIGJ5IHN5bmNocm9uaXpl
ZCBVT1cgc2hvdWxkIGxlYXZlIG9wZW4gdW50aWwgCi0gICAgICogYWZ0ZXJDb21wbGV0aW9uIGNh
bGwgYmFjazsgdGhlIGNvbm5lY3Rpb24gd2l0aCBhIGV4dGVybmFsQ29ubmVjdGlvblBvb2wgdXNl
ZCBieSBvdGhlciB0eXBlIG9mIHNlc3Npb24gCi0gICAgICogc2hvdWxkIGJlIGNsb3NlZCBhZnRl
ciB0cmFuc2FjdGlvbiB3YXMgZmluaXNlZC4KLSAgICAgKiAKICAgICAgKiBDb21taXQgdGhlIHRy
YW5zYWN0aW9uIG9uIGFsbCBjaGlsZCBzZXNzaW9ucy4KICAgICAgKiBUaGlzIGFzc3VtZXMgdGhh
dCB0aGUgY29tbWl0IG9mIHRoZSB0cmFuc2FjdGlvbiB3aWxsIG5vdCBmYWlsIGJlY2F1c2UgYWxs
IG9mIHRoZQogICAgICAqIG1vZGlmaWNhdGlvbiBoYXMgYWxyZWFkeSB0YWtlbiBwbGFjZSBhbmQg
bm8gZXJyb3JzIHdvdWxkIGhhdmUgb2NjdXJlZC4KICAgICAgKi8KLSAgICBwcm90ZWN0ZWQgdm9p
ZCBiYXNpY0NvbW1pdFRyYW5zYWN0aW9uKEFic3RyYWN0U2Vzc2lvbiBjYWxsaW5nU2Vzc2lvbikg
dGhyb3dzIERhdGFiYXNlRXhjZXB0aW9uIHsKKyAgICBwcm90ZWN0ZWQgdm9pZCBiYXNpY0NvbW1p
dFRyYW5zYWN0aW9uKCkgdGhyb3dzIERhdGFiYXNlRXhjZXB0aW9uIHsKICAgICAgICAgLy8gRG8g
b25lIGxhc3QgY2hlY2sgaXQgbWFrZSBzdXJlIHRoYXQgYWxsIHNlc3Npb25zIGFyZSBzdGlsbCBj
b25uZWN0ZWQuCiAgICAgICAgIGZvciAoSXRlcmF0b3Igc2Vzc2lvbkVudW0gPSBnZXRTZXNzaW9u
c0J5TmFtZSgpLnZhbHVlcygpLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAgICAgIHNlc3Npb25F
bnVtLmhhc05leHQoKTspIHsKQEAgLTIxMywzMiArMjA4LDIxIEBADQogICAgICAgICBmb3IgKEl0
ZXJhdG9yIHNlc3Npb25FbnVtID0gZ2V0U2Vzc2lvbnNCeU5hbWUoKS52YWx1ZXMoKS5pdGVyYXRv
cigpOwogICAgICAgICAgICAgICAgICBzZXNzaW9uRW51bS5oYXNOZXh0KCk7KSB7CiAgICAgICAg
ICAgICBBYnN0cmFjdFNlc3Npb24gc2Vzc2lvbiA9IChBYnN0cmFjdFNlc3Npb24pc2Vzc2lvbkVu
dW0ubmV4dCgpOwotICAgICAgICAgICAgc2Vzc2lvbi5jb21taXRUcmFuc2FjdGlvbihjYWxsaW5n
U2Vzc2lvbik7CisgICAgICAgICAgICBzZXNzaW9uLmNvbW1pdFRyYW5zYWN0aW9uKCk7CiAgICAg
ICAgIH0KICAgICB9CiAKLSAgICAKLQogICAgIC8qKgogICAgICAqIElOVEVSTkFMOgotICAgICAq
IAotICAgICAqIEFsbG93IGNhbGxpbmcgc2Vzc2lvbiB0byBiZSBwYXNzZWQuCi0gICAgICogICAg
ICAKLSAgICAgKiBUaGUgY2FsbGluZyBzZXNzaW9uIGlzIHRoZSBzZXNzaW9uIHdobyBhY3R1YWxs
eSBpbnZva2VzIGNvbW1pdCBvciByb2xsYmFjayB0cmFuc2FjdGlvbiwgCi0gICAgICogaXQgaXMg
dXNlZCB0byBkZXRlcm1pbmUgd2hldGhlciB0aGUgY29ubmVjdGlvbiBuZWVkcyB0byBiZSBjbG9z
ZWQgd2hlbiB1c2luZyBleHRlcm5hbCBjb25uZWN0aW9uIHBvb2wuCi0gICAgICogVGhlIGNvbm5l
Y3Rpb24gd2l0aCBhIGV4dGVybmFsQ29ubmVjdGlvblBvb2wgdXNlZCBieSBzeW5jaHJvbml6ZWQg
VU9XIHNob3VsZCBsZWF2ZSBvcGVuIHVudGlsIAotICAgICAqIGFmdGVyQ29tcGxldGlvbiBjYWxs
IGJhY2s7IHRoZSBjb25uZWN0aW9uIHdpdGggYSBleHRlcm5hbENvbm5lY3Rpb25Qb29sIHVzZWQg
Ynkgb3RoZXIgdHlwZSBvZiBzZXNzaW9uIAotICAgICAqIHNob3VsZCBiZSBjbG9zZWQgYWZ0ZXIg
dHJhbnNhY3Rpb24gd2FzIGZpbmlzZWQuCi0gICAgICogCiAgICAgICogUm9sbGJhY2sgdGhlIHRy
YW5zYWN0aW9uIG9uIGFsbCBjaGlsZCBzZXNzaW9ucy4KICAgICAgKi8KLSAgICBwcm90ZWN0ZWQg
dm9pZCBiYXNpY1JvbGxiYWNrVHJhbnNhY3Rpb24oQWJzdHJhY3RTZXNzaW9uIGNhbGxpbmdTZXNz
aW9uKSB0aHJvd3MgRGF0YWJhc2VFeGNlcHRpb24geworICAgIHByb3RlY3RlZCB2b2lkIGJhc2lj
Um9sbGJhY2tUcmFuc2FjdGlvbigpIHRocm93cyBEYXRhYmFzZUV4Y2VwdGlvbiB7CiAgICAgICAg
IERhdGFiYXNlRXhjZXB0aW9uIGdsb2JhbEV4Y2VwdGlvbiA9IG51bGw7CiAgICAgICAgIGZvciAo
SXRlcmF0b3Igc2Vzc2lvbkVudW0gPSBnZXRTZXNzaW9uc0J5TmFtZSgpLnZhbHVlcygpLml0ZXJh
dG9yKCk7CiAgICAgICAgICAgICAgICAgIHNlc3Npb25FbnVtLmhhc05leHQoKTspIHsKICAgICAg
ICAgICAgIEFic3RyYWN0U2Vzc2lvbiBzZXNzaW9uID0gKEFic3RyYWN0U2Vzc2lvbilzZXNzaW9u
RW51bS5uZXh0KCk7CiAgICAgICAgICAgICB0cnkgewotICAgICAgICAgICAgICAgIHNlc3Npb24u
cm9sbGJhY2tUcmFuc2FjdGlvbihjYWxsaW5nU2Vzc2lvbik7CisgICAgICAgICAgICAgICAgc2Vz
c2lvbi5yb2xsYmFja1RyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgICB9IGNhdGNoIChEYXRhYmFz
ZUV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgICAgICBnbG9iYWxFeGNlcHRpb24g
PSBleGNlcHRpb247CiAgICAgICAgICAgICB9CkBAIC0yNDcsOCArMjMxLDYgQEANCiAgICAgICAg
ICAgICB0aHJvdyBnbG9iYWxFeGNlcHRpb247CiAgICAgICAgIH0KICAgICB9Ci0gICAgCi0gICAg
CiAKICAgICAvKioKICAgICAgKiBQVUJMSUM6CkBAIC0zNDEsNiArMzIzLDE0IEBADQogCiAgICAg
LyoqCiAgICAgICogSU5URVJOQUw6CisgICAgICogR2V0cyB0aGUgcGFyZW50IFNlc3Npb25Ccm9r
ZXIuCisgICAgICovCisgICAgcHVibGljIFNlc3Npb25Ccm9rZXIgZ2V0UGFyZW50KCkgeworICAg
ICAgICByZXR1cm4gcGFyZW50OworICAgIH0KKworICAgIC8qKgorICAgICAqIElOVEVSTkFMOgog
ICAgICAqIEdldHMgdGhlIG5leHQgbGluayBpbiB0aGUgY2hhaW4gb2Ygc2Vzc2lvbnMgZm9sbG93
ZWQgYnkgYSBxdWVyeSdzIGNoZWNrCiAgICAgICogZWFybHkgcmV0dXJuLCB0aGUgY2hhaW4gb2Yg
c2Vzc2lvbnMgd2l0aCBpZGVudGl0eSBtYXBzIGFsbCB0aGUgd2F5IHVwIHRvCiAgICAgICogdGhl
IHJvb3Qgc2Vzc2lvbi4KQEAgLTUzNyw2ICs1MjcsMTAgQEANCiAgICAgICAgICAgICAgICAgRGF0
YWJhc2VTZXNzaW9uSW1wbCBkYXRhYmFzZVNlc3Npb24gPSAoRGF0YWJhc2VTZXNzaW9uSW1wbCll
bnVtdHIubmV4dCgpOwogICAgICAgICAgICAgICAgIGRhdGFiYXNlU2Vzc2lvbi5pbml0aWFsaXpl
U2VxdWVuY2luZygpOwogICAgICAgICAgICAgfQorICAgICAgICAgICAgaWYoaGFzRXh0ZXJuYWxU
cmFuc2FjdGlvbkNvbnRyb2xsZXIoKSkgeworICAgICAgICAgICAgICAgIGdldEV4dGVybmFsVHJh
bnNhY3Rpb25Db250cm9sbGVyKCkuaW5pdGlhbGl6ZVNlcXVlbmNpbmdMaXN0ZW5lcnMoKTsKKyAg
ICAgICAgICAgIH0KKwogICAgICAgICB9CiAgICAgICAgIHN1cGVyLmluaXRpYWxpemVEZXNjcmlw
dG9ycygpOwogICAgICAgICAvLyBNdXN0IHJlc2V0IHByb2plY3Qgb3B0aW9ucyB0byBzZXNzaW9u
IGJyb2tlciBwcm9qZWN0LCBhcyBpbml0aWFsaXphdGlvbiBvY2N1cnMKQEAgLTczMSw2ICs3MjUs
MTEgQEANCiAgICAgICAgICAgICBEYXRhYmFzZVNlc3Npb25JbXBsIHNlc3Npb24gPSAoRGF0YWJh
c2VTZXNzaW9uSW1wbClzZXNzaW9uRW51bS5uZXh0KCk7CiAgICAgICAgICAgICBzZXNzaW9uLmxv
Z291dCgpOwogICAgICAgICB9CisgICAgICAgIGlmICghaXNDbGllbnRTZXNzaW9uQnJva2VyKCkp
IHsKKyAgICAgICAgICAgIGlmKGhhc0V4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVyKCkpIHsK
KyAgICAgICAgICAgICAgICBnZXRFeHRlcm5hbFRyYW5zYWN0aW9uQ29udHJvbGxlcigpLmNsZWFy
U2VxdWVuY2luZ0xpc3RlbmVycygpOworICAgICAgICAgICAgfQorICAgICAgICB9CiAgICAgICAg
IHNlcXVlbmNpbmcgPSBudWxsOwogICAgICAgICBpc0xvZ2dlZEluID0gZmFsc2U7CiAgICAgfQpA
QCAtODg5LDYgKzg4OCwyMiBAQA0KIAogICAgIC8qKgogICAgICAqIElOVEVSTkFMOgorICAgICAq
IFNldCBpc1N5bmNocm9uaXplZCBmbGFnIHRvIGluZGljYXRlIHRoYXQgbWVtYmVycyBvZiBzZXNz
aW9uIGJyb2tlciBhcmUgc3luY2hyb25pemVkLgorICAgICAqIFRoaXMgbWV0aG9kIHNob3VsZCBv
bmx5IGJlIGNhbGxlZCBieSBzZXRTeW5jaHJvbml6ZWQgbWV0aG9kIG9mIFVuaXRPZldvcmsKKyAg
ICAgKiBvYnRhaW5lZCBmcm9tIGVpdGhlciBEYXRhYmFzZVNlc3Npb24gQnJva2VyIG9yIENsaWVu
dFNlc3Npb24gQnJva2VyLgorICAgICAqLworICAgIHB1YmxpYyB2b2lkIHNldFN5bmNocm9uaXpl
ZChib29sZWFuIHN5bmNoZWQpIHsKKyAgICAgICAgaWYoIWlzU2VydmVyU2Vzc2lvbkJyb2tlcigp
KSB7CisgICAgICAgICAgICBzdXBlci5zZXRTeW5jaHJvbml6ZWQoc3luY2hlZCk7CisgICAgICAg
ICAgICBJdGVyYXRvciBpdFNlc3Npb25zID0gZ2V0U2Vzc2lvbnNCeU5hbWUoKS52YWx1ZXMoKS5p
dGVyYXRvcigpOworICAgICAgICAgICAgd2hpbGUoaXRTZXNzaW9ucy5oYXNOZXh0KCkpIHsKKyAg
ICAgICAgICAgICAgICAoKEFic3RyYWN0U2Vzc2lvbilpdFNlc3Npb25zLm5leHQoKSkuc2V0U3lu
Y2hyb25pemVkKHN5bmNoZWQpOworICAgICAgICAgICAgfQorICAgICAgICB9CisgICAgfQorCisg
ICAgLyoqCisgICAgICogSU5URVJOQUw6CiAgICAgICogVGhpcyBtZXRob2Qgbm90aWZpZXMgdGhl
IGFjY2Vzc29yIHRoYXQgYSBwYXJ0aWN1bGFyIHNldHMgb2Ygd3JpdGVzIGhhcwogICAgICAqIGNv
bXBsZXRlZC4gIFRoaXMgbm90aWZpY2F0aW9uIGNhbiBiZSB1c2VkIGZvciBzdWNoIHRoaW5nIGFz
IGZsdXNoaW5nIHRoZQogICAgICAqIGJhdGNoIG1lY2hhbmlzbQpAQCAtOTMzLDQgKzk0OCwzMyBA
QA0KICAgICBwdWJsaWMgU2VxdWVuY2luZyBnZXRTZXF1ZW5jaW5nKCkgewogICAgICAgICByZXR1
cm4gc2VxdWVuY2luZzsKICAgICB9CisKKyAgICAvKioKKyAgICAgKiBJTlRFUk5BTDoKKyAgICAg
KiBSZXR1cm5zIGEgbnVtYmVyIG9mIG1lbWJlciBzZXNzaW9ucyB0aGF0IHJlcXVpcmUgc2VxdWVu
Y2luZyBjYWxsYmFjay4KKyAgICAgKiBBbHdheXMgcmV0dXJucyAwIGlmIHNlcXVlbmNpbmcgaXMg
bm90IGNvbm5lY3RlZC4KKyAgICAgKi8KKyAgICBwdWJsaWMgaW50IGhvd01hbnlTZXF1ZW5jaW5n
Q2FsbGJhY2tzKCkgeworICAgICAgICBpZih0aGlzLmlzQ2xpZW50U2Vzc2lvbkJyb2tlcigpKSB7
CisgICAgICAgICAgICByZXR1cm4gZ2V0UGFyZW50KCkuaG93TWFueVNlcXVlbmNpbmdDYWxsYmFj
a3MoKTsKKyAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgIGludCBuQ2FsbGJhY2tzID0gMDsK
KyAgICAgICAgICAgIEl0ZXJhdG9yIGl0U2Vzc2lvbnMgPSBnZXRTZXNzaW9uc0J5TmFtZSgpLnZh
bHVlcygpLml0ZXJhdG9yKCk7CisgICAgICAgICAgICB3aGlsZShpdFNlc3Npb25zLmhhc05leHQo
KSkgeworICAgICAgICAgICAgICAgIGlmKCgoRGF0YWJhc2VTZXNzaW9uSW1wbClpdFNlc3Npb25z
Lm5leHQoKSkuaXNTZXF1ZW5jaW5nQ2FsbGJhY2tSZXF1aXJlZCgpKSB7CisgICAgICAgICAgICAg
ICAgICAgIG5DYWxsYmFja3MrKzsKKyAgICAgICAgICAgICAgICB9CisgICAgICAgICAgICB9Cisg
ICAgICAgICAgICByZXR1cm4gbkNhbGxiYWNrczsKKyAgICAgICAgfQorICAgIH0KKworICAgIC8q
KgorICAgICAqIElOVEVSTkFMOgorICAgICAqIEluZGljYXRlcyB3aGV0aGVyIFNlcXVlbmNpbmdD
YWxsYmFjayBpcyByZXF1aXJlZC4KKyAgICAgKiBBbHdheXMgcmV0dXJucyBmYWxzZSBpZiBzZXF1
ZW5jaW5nIGlzIG5vdCBjb25uZWN0ZWQuCisgICAgICovCisgICAgcHVibGljIGJvb2xlYW4gaXNT
ZXF1ZW5jaW5nQ2FsbGJhY2tSZXF1aXJlZCgpIHsKKyAgICAgICAgcmV0dXJuIGhvd01hbnlTZXF1
ZW5jaW5nQ2FsbGJhY2tzKCkgPiAwOworICAgIH0KIH0KSW5kZXg6IGZvdW5kYXRpb24vZWNsaXBz
ZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lzdGVuY2Uvc2Vzc2lvbnMvRXh0ZXJuYWxU
cmFuc2FjdGlvbkNvbnRyb2xsZXIuamF2YQ0KPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0tIGZvdW5kYXRpb24vZWNs
aXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lzdGVuY2Uvc2Vzc2lvbnMvRXh0ZXJu
YWxUcmFuc2FjdGlvbkNvbnRyb2xsZXIuamF2YQkocmV2aXNpb24gNzQ1NikNCisrKyBmb3VuZGF0
aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL3Nlc3Npb25z
L0V4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVyLmphdmEJKHdvcmtpbmcgY29weSkNCkBAIC05
LDYgKzksOCBAQA0KICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovICAKIHBhY2thZ2Ugb3JnLmVjbGlw
c2UucGVyc2lzdGVuY2Uuc2Vzc2lvbnM7CiAKK2ltcG9ydCBvcmcuZWNsaXBzZS5wZXJzaXN0ZW5j
ZS5pbnRlcm5hbC5zZXF1ZW5jaW5nLlNlcXVlbmNpbmdDYWxsYmFjazsKK2ltcG9ydCBvcmcuZWNs
aXBzZS5wZXJzaXN0ZW5jZS5pbnRlcm5hbC5zZXF1ZW5jaW5nLlNlcXVlbmNpbmdDYWxsYmFja0Zh
Y3Rvcnk7CiBpbXBvcnQgb3JnLmVjbGlwc2UucGVyc2lzdGVuY2UuaW50ZXJuYWwuc2Vzc2lvbnMu
QWJzdHJhY3RTZXNzaW9uOwogaW1wb3J0IG9yZy5lY2xpcHNlLnBlcnNpc3RlbmNlLmludGVybmFs
LnNlc3Npb25zLlVuaXRPZldvcmtJbXBsOwogaW1wb3J0IG9yZy5lY2xpcHNlLnBlcnNpc3RlbmNl
LmV4Y2VwdGlvbnMuKjsKQEAgLTc5LDQgKzgxLDMzIEBADQogICAgICAqIFNldCB0aGUgbWFuYWdl
cidzIHNlc3Npb24uCiAgICAgICovCiAgICAgdm9pZCBzZXRTZXNzaW9uKEFic3RyYWN0U2Vzc2lv
biBzZXNzaW9uKTsKKyAgICAKKyAgICAvKioKKyAgICAgKiBJTlRFUk5BTDoKKyAgICAgKiBJbml0
aWFsaXplcyBzZXF1ZW5jaW5nIGxpc3RlbmVycy4KKyAgICAgKiBBbHdheXMgY2xlYXJzIHNlcXVl
bmNpbmcgbGlzdGVuZXJzIGZpcnN0LgorICAgICAqIFRoZXJlIGFyZSB0d28gbWV0aG9kcyBjYWxs
aW5nIHRoaXMgbWV0aG9kOgorICAgICAqIDEuIHNldFNlc3Npb24gbWV0aG9kIC0gdGhpcyBjb3Vs
ZCBsZWFkIHRvIGluaXRpYWxpemF0aW9uIG9mIHNlcXVlbmNpbmcgbGlzdGVuZXJzCisgICAgICog
b25seSBpZiBzZXF1ZW5jaW5nIGFscmVhZHkgY29ubmVjdGVkICh0aGF0IHdvdWxkIGhhcHBlbiBp
ZiBzZXRTZXNzaW9uIGlzIGNhbGxlZAorICAgICAqIGFmdGVyIHNlc3Npb24ubG9naW4sIHdoaWNo
IGlzIG5vcm1hbGx5IG5vdCB0aGUgY2FzZSkuCisgICAgICogMi4gaW4gdGhlIHZlcnkgZW5kIG9m
IGNvbm5lY3Rpbmcgc2VxdWVuY2luZywKKyAgICAgKiBhZnRlciBpdCdzIGRldGVybWluZWQgd2hl
dGhlciBzZXF1ZW5jaW5nIGNhbGxiYWNrcyAoYW5kIHRoZXJlZm9yZSBsaXN0ZW5lcnMpCisgICAg
ICogd2lsbCBiZSByZXF1aXJlZC4KKyAgICAgKi8KKyAgICBwdWJsaWMgdm9pZCBpbml0aWFsaXpl
U2VxdWVuY2luZ0xpc3RlbmVycygpOworCisgICAgLyoqCisgICAgICogSU5URVJOQUw6CisgICAg
ICogUmV0dXJucyBzZXF1ZW5jaW5nQ2FsbGJhY2sgZm9yIHRoZSBjdXJyZW50IGFjdGl2ZSBleHRl
cm5hbCB0cmFuc2FjdGlvbi4KKyAgICAgKiBEYXRhYmFzZVNlc3Npb24gaXMgcGFzc2VkIGZvciB0
aGUgc2FrZSBvZiBTZXNzaW9uQnJva2VyIGNhc2UuCisgICAgICogVGhpcyBtZXRob2QgcmVxdWly
ZXMgYWN0aXZlIGV4dGVybmFsIHRyYW5zYWN0aW9uLgorICAgICAqLworICAgIHB1YmxpYyBTZXF1
ZW5jaW5nQ2FsbGJhY2sgZ2V0QWN0aXZlU2VxdWVuY2luZ0NhbGxiYWNrKERhdGFiYXNlU2Vzc2lv
biBkYlNlc3Npb24sIFNlcXVlbmNpbmdDYWxsYmFja0ZhY3Rvcnkgc2VxdWVuY2luZ0NhbGxiYWNr
RmFjdG9yeSk7CisgICAgCisgICAgLyoqCisgICAgICogSU5URVJOQUw6CisgICAgICogQ2xlYXJz
IHNlcXVlbmNpbmcgbGlzdGVuZXJzLgorICAgICAqIENhbGxlZCBieSBpbml0aWFsaXplU2VxdWVu
Y2luZ0xpc3RlbmVycyBhbmQgYnkgc2VxdWVuY2luZyBvbiBkaXNjb25uZWN0LgorICAgICAqLwor
ICAgIHB1YmxpYyB2b2lkIGNsZWFyU2VxdWVuY2luZ0xpc3RlbmVycygpOwogfQ0KXCBObyBuZXds
aW5lIGF0IGVuZCBvZiBmaWxlDQpJbmRleDogZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3Ny
Yy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9zZXNzaW9ucy9zZXJ2ZXIvQ2xpZW50U2Vzc2lvbi5q
YXZhDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09DQotLS0gZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcv
ZWNsaXBzZS9wZXJzaXN0ZW5jZS9zZXNzaW9ucy9zZXJ2ZXIvQ2xpZW50U2Vzc2lvbi5qYXZhCShy
ZXZpc2lvbiA3NDU2KQ0KKysrIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2Vj
bGlwc2UvcGVyc2lzdGVuY2Uvc2Vzc2lvbnMvc2VydmVyL0NsaWVudFNlc3Npb24uamF2YQkod29y
a2luZyBjb3B5KQ0KQEAgLTg1LDE1ICs4NSwxNCBAQA0KIAogICAgIC8qKgogICAgICAqIElOVEVS
TkFMOgotICAgICAqIENhbGxlZCBhZnRlciB0cmFuc2FjdGlvbiBpcyBjb21wbGV0ZWQgKGNvbW1p
dHRlZCBvciByb2xsZWQgYmFjaykKKyAgICAgKiBDYWxsZWQgaW4gdGhlIGVuZCBvZiBiZWZvcmVD
b21wbGV0aW9uIG9mIGV4dGVybmFsIHRyYW5zYWN0aW9uIHN5Y2hyb25pemF0aW9uIGxpc3RlbmVy
LgorICAgICAqIENsb3NlIHRoZSBtYW5hZ2VkIHNxbCBjb25uZWN0aW9uIGNvcnJlc3BvbmRpbmcg
dG8gdGhlIGV4dGVybmFsIHRyYW5zYWN0aW9uCisgICAgICogYW5kIHJlbGVhc2VzIGFjY2Vzc29y
LgogICAgICAqLwotICAgIHB1YmxpYyB2b2lkIGFmdGVyVHJhbnNhY3Rpb24oYm9vbGVhbiBjb21t
aXR0ZWQsIGJvb2xlYW4gaXNFeHRlcm5hbFRyYW5zYWN0aW9uKSB7CisgICAgcHVibGljIHZvaWQg
cmVsZWFzZUpUU0Nvbm5lY3Rpb24oKSB7CiAgICAgICAgIGlmIChoYXNXcml0ZUNvbm5lY3Rpb24o
KSkgewotICAgICAgICAgICAgZ2V0UGFyZW50KCkuYWZ0ZXJUcmFuc2FjdGlvbihjb21taXR0ZWQs
IGlzRXh0ZXJuYWxUcmFuc2FjdGlvbiwgZ2V0V3JpdGVDb25uZWN0aW9uKCkpOwotICAgICAgICAg
ICAgaWYgKGlzRXh0ZXJuYWxUcmFuc2FjdGlvbikgewotICAgICAgICAgICAgICAgIGdldFdyaXRl
Q29ubmVjdGlvbigpLmFmdGVySlRTVHJhbnNhY3Rpb24oKTsKLSAgICAgICAgICAgICAgICByZWxl
YXNlV3JpdGVDb25uZWN0aW9uKCk7Ci0gICAgICAgICAgICB9CisgICAgICAgICAgICBnZXRXcml0
ZUNvbm5lY3Rpb24oKS5jbG9zZUpUU0Nvbm5lY3Rpb24oKTsKKyAgICAgICAgICAgIHJlbGVhc2VX
cml0ZUNvbm5lY3Rpb24oKTsKICAgICAgICAgfQogICAgIH0KIApAQCAtMTEzLDIzICsxMTIsMjEg
QEANCiAgICAgICAgIHN1cGVyLmJhc2ljQmVnaW5UcmFuc2FjdGlvbigpOwogICAgIH0KIAotICAg
IAogICAgIC8qKgogICAgICAqIElOVEVSTkFMOgogICAgICAqIFRoaXMgaXMgaW50ZXJuYWwgdG8g
dGhlIHVuaXQgb2Ygd29yayBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgb3RoZXJ3aXNlLgogICAg
ICAqLwotICAgIHB1YmxpYyB2b2lkIGJhc2ljQ29tbWl0VHJhbnNhY3Rpb24oQWJzdHJhY3RTZXNz
aW9uIGNhbGxpbmdTZXNzaW9uKSB7CisgICAgcHVibGljIHZvaWQgYmFzaWNDb21taXRUcmFuc2Fj
dGlvbigpIHsKICAgICAgICAgLy9Pbmx5IHJlbGVhc2VlIGNvbm5lY3Rpb24gd2hlbiB0cmFuc2Fj
dGlvbiBzdWNjZWVkcy4gIAogICAgICAgICAvL0lmIG5vdCwgY29ubmVjdGlvbiB3aWxsIGJlIHJl
bGVhc2VkIGluIHJvbGxiYWNrLgotICAgICAgICBzdXBlci5iYXNpY0NvbW1pdFRyYW5zYWN0aW9u
KGNhbGxpbmdTZXNzaW9uKTsKLSAgICAgICAgLy8gdGhlIGNvbm5lY3Rpb24gd2lsbCBiZSByZWxl
YXNlZCBieSBhZnRlckNvbXBsZXRpb24gY2FsbGJhY2sgdG8KLSAgICAgICAgLy8gYWZ0ZXJUcmFu
c2FjdGlvbiguLCB0cnVlKTsKLSAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gZXh0ZXJuYWwgVFgg
Y29udHJvbGxlciwgdGhlbiB0aGF0IG1lYW5zIHdlIGFyZSBjdXJyZW50bHkgbm90IHN5bmNocm9u
aXplZAotICAgICAgICAvLyB3aXRoIGEgZ2xvYmFsIEpUUyB0cmFuc2FjdGlvbi4gIEluIHRoaXMg
Y2FzZSwgdGhlcmUgd29uJ3QgYmUgYW55ICdhZnRlckNvbXBsZXRpb24nCi0gICAgICAgIC8vIGNh
bGxiYWNrcyBzbyB3ZSBoYXZlIHRvIHJlbGVhc2UgdGhlIGNvbm5lY3Rpb24gaGVyZS4gIEl0IGlz
IHBvc3NpYmxlIChXTFMgNS4xKSB0byBjaG9vc2UKLSAgICAgICAgLy8gJ3VzZXNFeHRlcm5hbFRy
YW5zYWN0aW9uQ29udHJvbGxlcicgb24gdGhlIGxvZ2luLCBidXQgc3RpbGwgYWNxdWlyZSBhIHVv
dyB0aGF0IFdPTidUIGJlCi0gICAgICAgIC8vIHN5bmNocm9uaXplZCB3aXRoIGEgZ2xvYmFsIFRY
LgotICAgICAgICBpZiAoISgoY2FsbGluZ1Nlc3Npb24gaW5zdGFuY2VvZiBVbml0T2ZXb3JrSW1w
bCkgJiYgKChVbml0T2ZXb3JrSW1wbCljYWxsaW5nU2Vzc2lvbikuaXNTeW5jaHJvbml6ZWQoKSkp
eworICAgICAgICBzdXBlci5iYXNpY0NvbW1pdFRyYW5zYWN0aW9uKCk7CisKKyAgICAgICAgLy8g
aWYgc3luY2hyb25pemVkIHRoZW4gdGhlIGNvbm5lY3Rpb24gd2lsbCBiZSByZWxlYXNlZCBpbiBl
eHRlcm5hbCB0cmFuc2FjdGlvbiBjYWxsYmFjay4KKyAgICAgICAgaWYgKGhhc0V4dGVybmFsVHJh
bnNhY3Rpb25Db250cm9sbGVyKCkpIHsKKyAgICAgICAgICAgIGlmKCFpc1N5bmNocm9uaXplZCgp
KSB7CisgICAgICAgICAgICAgICAgcmVsZWFzZUpUU0Nvbm5lY3Rpb24oKTsKKyAgICAgICAgICAg
IH0KKyAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIHJlbGVhc2VXcml0ZUNvbm5lY3Rpb24o
KTsKICAgICAgICAgfQogICAgIH0KQEAgLTEzNywyNCArMTM0LDIxIEBADQogICAgIC8qKgogICAg
ICAqIElOVEVSTkFMOgogICAgICAqIFRoaXMgaXMgaW50ZXJuYWwgdG8gdGhlIHVuaXQgb2Ygd29y
ayBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgb3RoZXJ3aXNlLgotICAgICAqIFRoZSBjYWxsaW5n
IHNlc3Npb24gaXMgdGhlIHNlc3Npb24gdGhhdCByZXF1aXJlcyByb2xsYmFjayB0cmFuc2FjdGlv
bi4KICAgICAgKi8KLSAgICBwdWJsaWMgdm9pZCBiYXNpY1JvbGxiYWNrVHJhbnNhY3Rpb24oQWJz
dHJhY3RTZXNzaW9uIGNhbGxpbmdTZXNzaW9uKSB7CisgICAgcHVibGljIHZvaWQgYmFzaWNSb2xs
YmFja1RyYW5zYWN0aW9uKCkgewogICAgICAgICB0cnkgewogICAgICAgICAgICAgLy9CVUcgMjY2
MDQ3MTogTWFrZSBzdXJlIHRoZXJlIGlzIGFuIGFjY2Vzc29yIChtb3ZlZCBoZXJlIGZyb20gU2Vz
c2lvbikKICAgICAgICAgICAgIC8vQlVHIDI4NDY3ODU6IEVYQ0VQVElPTiBUSFJPV04gSU4gUFJF
QkVHSU5UUkFOU0FDVElPTiBFVkVOVCBDQVVTRVMgTlBFCiAgICAgICAgICAgICBpZiAoaGFzV3Jp
dGVDb25uZWN0aW9uKCkpIHsKLSAgICAgICAgICAgICAgICBzdXBlci5iYXNpY1JvbGxiYWNrVHJh
bnNhY3Rpb24oY2FsbGluZ1Nlc3Npb24pOworICAgICAgICAgICAgICAgIHN1cGVyLmJhc2ljUm9s
bGJhY2tUcmFuc2FjdGlvbigpOwogICAgICAgICAgICAgfQogICAgICAgICB9IGZpbmFsbHkgewot
ICAgICAgICAgICAgLy8gdGhlIGNvbm5lY3Rpb24gd2lsbCBiZSByZWxlYXNlZCBieSBhZnRlckNv
bXBsZXRpb24gY2FsbGJhY2sgdG8KLSAgICAgICAgICAgIC8vIGFmdGVyVHJhbnNhY3Rpb24oLiwg
dHJ1ZSk7Ci0gICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBubyBleHRlcm5hbCBUWCBjb250cm9s
bGVyLCB0aGVuIHRoYXQgbWVhbnMgd2UgYXJlIGN1cnJlbnRseSBub3Qgc3luY2hyb25pemVkCi0g
ICAgICAgICAgICAvLyB3aXRoIGEgZ2xvYmFsIEpUUyB0cmFuc2FjdGlvbi4gIEluIHRoaXMgY2Fz
ZSwgdGhlcmUgd29uJ3QgYmUgYW55ICdhZnRlckNvbXBsZXRpb24nCi0gICAgICAgICAgICAvLyBj
YWxsYmFja3Mgc28gd2UgaGF2ZSB0byByZWxlYXNlIHRoZSBjb25uZWN0aW9uIGhlcmUuICBJdCBp
cyBwb3NzaWJsZSAoV0xTIDUuMSkgdG8gY2hvb3NlCi0gICAgICAgICAgICAvLyAndXNlc0V4dGVy
bmFsVHJhbnNhY3Rpb25Db250cm9sbGVyJyBvbiB0aGUgbG9naW4sIGJ1dCBzdGlsbCBhY3F1aXJl
IGEgdW93IHRoYXQgV09OJ1QgYmUKLSAgICAgICAgICAgIC8vIHN5bmNocm9uaXplZCB3aXRoIGEg
Z2xvYmFsIFRYLgotICAgICAgICAgICAgaWYgKCEoKGNhbGxpbmdTZXNzaW9uIGluc3RhbmNlb2Yg
VW5pdE9mV29ya0ltcGwpICYmICgoVW5pdE9mV29ya0ltcGwpY2FsbGluZ1Nlc3Npb24pLmlzU3lu
Y2hyb25pemVkKCkpKXsKKyAgICAgICAgICAgIC8vIGlmIHN5bmNocm9uaXplZCB0aGVuIHRoZSBj
b25uZWN0aW9uIHdpbGwgYmUgcmVsZWFzZWQgaW4gZXh0ZXJuYWwgdHJhbnNhY3Rpb24gY2FsbGJh
Y2suCisgICAgICAgICAgICBpZiAoaGFzRXh0ZXJuYWxUcmFuc2FjdGlvbkNvbnRyb2xsZXIoKSkg
eworICAgICAgICAgICAgICAgIGlmKCFpc1N5bmNocm9uaXplZCgpKSB7CisgICAgICAgICAgICAg
ICAgICAgIHJlbGVhc2VKVFNDb25uZWN0aW9uKCk7CisgICAgICAgICAgICAgICAgfQorICAgICAg
ICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICByZWxlYXNlV3JpdGVDb25uZWN0aW9uKCk7
CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KSW5kZXg6IGZvdW5kYXRpb24vZWNsaXBzZWxpbmsu
Y29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lzdGVuY2Uvc2Vzc2lvbnMvc2VydmVyL1NlcnZlclNl
c3Npb24uamF2YQ0KPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PQ0KLS0tIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9z
cmMvb3JnL2VjbGlwc2UvcGVyc2lzdGVuY2Uvc2Vzc2lvbnMvc2VydmVyL1NlcnZlclNlc3Npb24u
amF2YQkocmV2aXNpb24gNzQ1NikNCisrKyBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3Jj
L29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL3Nlc3Npb25zL3NlcnZlci9TZXJ2ZXJTZXNzaW9uLmph
dmEJKHdvcmtpbmcgY29weSkNCkBAIC00MTIsMTcgKzQxMiw2IEBADQogCiAgICAgLyoqCiAgICAg
ICogSU5URVJOQUw6Ci0gICAgICogQ2FsbGVkIGFmdGVyIHRyYW5zYWN0aW9uIGlzIGNvbXBsZXRl
ZCAoY29tbWl0dGVkIG9yIHJvbGxlZCBiYWNrKQotICAgICAqLwotICAgIHB1YmxpYyB2b2lkIGFm
dGVyVHJhbnNhY3Rpb24oYm9vbGVhbiBjb21taXR0ZWQsIGJvb2xlYW4gaXNFeHRlcm5hbFRyYW5z
YWN0aW9uLCBBY2Nlc3NvciBhY2Nlc3NvcikgewotICAgICAgICBTZXF1ZW5jaW5nQ2FsbGJhY2sg
Y2FsbGJhY2sgPSBnZXRTZXF1ZW5jaW5nSG9tZSgpLmdldFNlcXVlbmNpbmdDYWxsYmFjaygpOwot
ICAgICAgICBpZiAoY2FsbGJhY2sgIT0gbnVsbCkgewotICAgICAgICAgICAgY2FsbGJhY2suYWZ0
ZXJUcmFuc2FjdGlvbihhY2Nlc3NvciwgY29tbWl0dGVkKTsKLSAgICAgICAgfQotICAgIH0KLQot
ICAgIC8qKgotICAgICAqIElOVEVSTkFMOgogICAgICAqIFJldHVybiBhIHJlYWQgY29ubmVjdGlv
biBmcm9tIHRoZSByZWFkIHBvb2wuCiAgICAgICogTm90ZSB0aGF0IGRlcGVuZGluZyBvbiB0aGUg
dHlwZSBvZiBwb29sIHRoaXMgbWF5IGJlIGEgc2hhcmVkIG9yIGV4Y2x1c2l2ZSBjb25uZWN0aW9u
LgogICAgICAqIEVhY2ggcXVlcnkgZXhlY3V0aW9uIGlzIGFzc2lnbmVkIGEgcmVhZCBjb25uZWN0
aW9uLgpAQCAtNzM4LDYgKzcyNywxNCBAQA0KIAogICAgIC8qKgogICAgICAqIElOVEVSTkFMOgor
ICAgICAqIFNldCBpc1N5bmNocm9uaXplZCBmbGFnIHRvIGluZGljYXRlIHRoYXQgdGhpcyBzZXNz
aW9uIGlzIHN5bmNocm9uaXplZC4KKyAgICAgKiBUaGUgbWV0aG9kIGlzIGlnbm9yZWQgb24gU2Vy
dmVyU2Vzc2lvbiBhbmQgc2hvdWxkIG5ldmVyIGJlIGNhbGxlZC4KKyAgICAgKi8KKyAgICBwdWJs
aWMgdm9pZCBzZXRTeW5jaHJvbml6ZWQoYm9vbGVhbiBzeW5jaGVkKSB7CisgICAgfQorCisgICAg
LyoqCisgICAgICogSU5URVJOQUw6CiAgICAgICogVXBkYXRlcyBzdGFuZGFyZCBjb25uZWN0aW9u
IHBvb2xzLiBTaG91bGQgbm90IGJlIGNhbGxlZCBhZnRlciBzZXNzaW9uIGlzIGNvbm5lY3RlZC4K
ICAgICAgKiBUaGlzIGlzIG5lZWRlZCBpbiBjYXNlIG9mIHBvb2xzJyBsb2dpbnMgYmVlbiBhbHRl
cmVkIGFmdGVyIHRoZSBwb29sIGhhcyBiZWVuIGNyZWF0ZWQKICAgICAgKiAoU2Vzc2lvbk1hbmFn
ZXIgZG9lcyB0aGF0KQpJbmRleDogZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcv
ZWNsaXBzZS9wZXJzaXN0ZW5jZS90cmFuc2FjdGlvbi9BYnN0cmFjdFN5bmNocm9uaXphdGlvbkxp
c3RlbmVyLmphdmENCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUv
c3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL3RyYW5zYWN0aW9uL0Fic3RyYWN0U3luY2hyb25p
emF0aW9uTGlzdGVuZXIuamF2YQkocmV2aXNpb24gNzQ1NikNCisrKyBmb3VuZGF0aW9uL2VjbGlw
c2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL3RyYW5zYWN0aW9uL0Fic3Ry
YWN0U3luY2hyb25pemF0aW9uTGlzdGVuZXIuamF2YQkod29ya2luZyBjb3B5KQ0KQEAgLTksMTEg
KzksMTkgQEANCiAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLyAgCiBwYWNrYWdlIG9yZy5lY2xpcHNl
LnBlcnNpc3RlbmNlLnRyYW5zYWN0aW9uOwogCitpbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7Citp
bXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOworaW1wb3J0IGphdmEudXRpbC5NYXA7CisKIGltcG9y
dCBvcmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS5leGNlcHRpb25zLlRyYW5zYWN0aW9uRXhjZXB0aW9u
OwogaW1wb3J0IG9yZy5lY2xpcHNlLnBlcnNpc3RlbmNlLmludGVybmFsLnNlc3Npb25zLkFic3Ry
YWN0U2Vzc2lvbjsKIGltcG9ydCBvcmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS5pbnRlcm5hbC5zZXNz
aW9ucy5Vbml0T2ZXb3JrSW1wbDsKK2ltcG9ydCBvcmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS5pbnRl
cm5hbC5zZXF1ZW5jaW5nLlNlcXVlbmNpbmdDYWxsYmFjazsKK2ltcG9ydCBvcmcuZWNsaXBzZS5w
ZXJzaXN0ZW5jZS5pbnRlcm5hbC5zZXF1ZW5jaW5nLlNlcXVlbmNpbmdDYWxsYmFja0ZhY3Rvcnk7
CiBpbXBvcnQgb3JnLmVjbGlwc2UucGVyc2lzdGVuY2UubG9nZ2luZy4qOworaW1wb3J0IG9yZy5l
Y2xpcHNlLnBlcnNpc3RlbmNlLnNlc3Npb25zLmJyb2tlci5TZXNzaW9uQnJva2VyOwogaW1wb3J0
IG9yZy5lY2xpcHNlLnBlcnNpc3RlbmNlLnNlc3Npb25zLlNlc3Npb25Qcm9maWxlcjsKK2ltcG9y
dCBvcmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS5zZXNzaW9ucy5EYXRhYmFzZVNlc3Npb247CiAKIC8q
KgogICogPHA+CkBAIC00Myw3ICs1MSw4IEBADQogCiAgICAgLyoqCiAgICAgICogVGhlIHVuaXQg
b2Ygd29yayBhc3NvY2lhdGVkIHdpdGggdGhlIGdsb2JhbCB0eG4gdGhhdCB0aGlzIGxpc3RlbmVy
IGlzCi0gICAgICogYm91bmQgdG8uCisgICAgICogYm91bmQgdG8uIAorICAgICAqIE5vdGUgdGhh
dCB1bml0T2ZXb3JrIGlzIG51bGwgaW4gY2FzZSBpdCdzIGEgcHVyZWx5IHNlcXVlbmNpbmcgbGlz
dGVuZXIuCiAgICAgICovCiAgICAgcHJvdGVjdGVkIFVuaXRPZldvcmtJbXBsIHVuaXRPZldvcms7
CiAKQEAgLTUzLDYgKzYyLDIyIEBADQogICAgIHByb3RlY3RlZCBPYmplY3QgdHJhbnNhY3Rpb247
CiAKICAgICAvKioKKyAgICAgKiBUaGUgZ2xvYmFsIHRyYW5zYWN0aW9uIGtleS4KKyAgICAgKi8K
KyAgICBwcm90ZWN0ZWQgT2JqZWN0IHRyYW5zYWN0aW9uS2V5OworCisgICAgLyoqCisgICAgICog
c2VxdWVuY2luZ0NhbGxiYWNrIHVzZWQgaW4gY2FzZSBsaXN0ZW5lciBoYXMgYSBzaW5nbGUgY2Fs
bGJhY2suCisgICAgICovCisgICAgcHJvdGVjdGVkIFNlcXVlbmNpbmdDYWxsYmFjayBzZXF1ZW5j
aW5nQ2FsbGJhY2s7CisKKyAgICAvKioKKyAgICAgKiBzZXF1ZW5jaW5nQ2FsbGJhY2tNYXAgdXNl
ZCBpbiBjYXNlIGxpc3RlbmVyIGhhcyBtb3JlIHRoYW4gb25lIGNhbGxiYWNrOgorICAgICAqIFNl
c3Npb25Ccm9rZXIgd2l0aCBhdCBsZWFzdCB0d28gbWVtYmVycyByZXF1aXJpbmcgY2FsbGJhY2tz
LgorICAgICAqLworICAgIHByb3RlY3RlZCBNYXA8RGF0YWJhc2VTZXNzaW9uLCBTZXF1ZW5jaW5n
Q2FsbGJhY2s+IHNlcXVlbmNpbmdDYWxsYmFja01hcDsKKworICAgIC8qKgogICAgICAqIElOVEVS
TkFMOgogICAgICAqLwogICAgIHB1YmxpYyBBYnN0cmFjdFN5bmNocm9uaXphdGlvbkxpc3RlbmVy
KCkgewpAQCAtNjcsNiArOTIsNyBAQA0KICAgICAgICAgdGhpcy51bml0T2ZXb3JrID0gdW5pdE9m
V29yazsKICAgICAgICAgdGhpcy50cmFuc2FjdGlvbiA9IHRyYW5zYWN0aW9uOwogICAgICAgICB0
aGlzLmNvbnRyb2xsZXIgPSBjb250cm9sbGVyOworICAgICAgICB0aGlzLnRyYW5zYWN0aW9uS2V5
ID0gY29udHJvbGxlci5nZXRUcmFuc2FjdGlvbktleSh0cmFuc2FjdGlvbik7CiAgICAgfQogCiAg
ICAgLyoqCkBAIC03OSwxMiArMTA1LDIwIEBADQogICAgICAqLwogICAgIHB1YmxpYyB2b2lkIGJl
Zm9yZUNvbXBsZXRpb24oKSB7CiAgICAgICAgIFVuaXRPZldvcmtJbXBsIHVvdyA9IGdldFVuaXRP
ZldvcmsoKTsKKyAgICAgICAgLy8gaXQncyBhIHB1cmVseSBzZXF1ZW5jaW5nIGxpc3RlbmVyIC0g
bm90aGluZyB0byBkbyBpbiBiZWZvcmVDb21wbGV0aW9uLgorICAgICAgICBpZih1bml0T2ZXb3Jr
ID09IG51bGwpIHsKKyAgICAgICAgICAgIHJldHVybjsKKyAgICAgICAgfQogICAgICAgICB0cnkg
ewogICAgICAgICAgICAgT2JqZWN0IHN0YXR1cyA9IGdldFRyYW5zYWN0aW9uQ29udHJvbGxlcigp
LmdldFRyYW5zYWN0aW9uU3RhdHVzKCk7CiAgICAgICAgICAgICBnZXRUcmFuc2FjdGlvbkNvbnRy
b2xsZXIoKS5sb2dUeFN0YXRlVHJhY2UodW93LCAiVFhfYmVmb3JlQ29tcGxldGlvbiIsIHN0YXR1
cyk7CiAgICAgICAgICAgICAvL0NSIyAzNDUyMDUzIAogICAgICAgICAgICAgc2Vzc2lvbi5zdGFy
dE9wZXJhdGlvblByb2ZpbGUoU2Vzc2lvblByb2ZpbGVyLkp0c0JlZm9yZUNvbXBsZXRpb24pOwog
CisgICAgICAgICAgICAvLyBJbiBjYXNlIGp0cyB0cmFuc2FjdGlvbiB3YXMgaW50ZXJuYWxseSBz
dGFydGVkIGJ1dCBjb21wbGV0ZWQKKyAgICAgICAgICAgIC8vIGRpcmVjdGx5IGJ5IFRyYW5zYWN0
aW9uTWFuYWdlciB0aGlzIGZsYWcgaXMgc3RpbGwgc2V0IHRvIHRydWUuCisgICAgICAgICAgICBn
ZXRTZXNzaW9uKCkuc2V0V2FzSlRTVHJhbnNhY3Rpb25JbnRlcm5hbGx5U3RhcnRlZChmYWxzZSk7
CisgICAgICAgICAgICAKICAgICAgICAgICAgIC8vIElmIHRoZSB1b3cgaXMgbm90IGFjdGl2ZSB0
aGVuIHNvbWVib2R5IHNvbWV3aGVyZSBtZXNzZWQgdXAgCiAgICAgICAgICAgICBpZiAoIXVvdy5p
c0FjdGl2ZSgpKSB7CiAgICAgICAgICAgICAgICAgdGhyb3cgVHJhbnNhY3Rpb25FeGNlcHRpb24u
aW5hY3RpdmVVbml0T2ZXb3JrKHVvdyk7CkBAIC05Miw2ICsxMjYsMTUgQEANCiAKICAgICAgICAg
ICAgIC8vIEJhaWwgb3V0IGlmIHdlIGRvbid0IHRoaW5rIHdlIHNob3VsZCBhY3R1YWxseSBpc3N1
ZSB0aGUgU1FMCiAgICAgICAgICAgICBpZiAoIWdldFRyYW5zYWN0aW9uQ29udHJvbGxlcigpLmNh
bklzc3VlU1FMVG9EYXRhYmFzZV9pbXBsKHN0YXR1cykpIHsKKyAgICAgICAgICAgICAgICAvLyBN
dXN0IGZvcmNlIGNvbmN1cnJlbmN5IG1ncnMgYWN0aXZlIHRocmVhZCBpZiBpbiBuZXN0ZWQgdHJh
bnNhY3Rpb24KKyAgICAgICAgICAgICAgICBpZiAoZ2V0U2Vzc2lvbigpLmlzSW5UcmFuc2FjdGlv
bigpKSB7CisgICAgICAgICAgICAgICAgICAgIGdldFNlc3Npb24oKS5nZXRUcmFuc2FjdGlvbk11
dGV4KCkuc2V0QWN0aXZlVGhyZWFkKFRocmVhZC5jdXJyZW50VGhyZWFkKCkpOworICAgICAgICAg
ICAgICAgICAgICBpZihnZXRVbml0T2ZXb3JrKCkud2FzVHJhbnNhY3Rpb25CZWd1blByZW1hdHVy
ZWx5KCkpIHsKKyAgICAgICAgICAgICAgICAgICAgICAgIGdldFVuaXRPZldvcmsoKS5zZXRXYXNU
cmFuc2FjdGlvbkJlZ3VuUHJlbWF0dXJlbHkoZmFsc2UpOworICAgICAgICAgICAgICAgICAgICB9
CisgICAgICAgICAgICAgICAgICAgIGdldFNlc3Npb24oKS5yb2xsYmFja1RyYW5zYWN0aW9uKCk7
CisgICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgICAgIGdldFNlc3Npb24oKS5yZWxlYXNl
SlRTQ29ubmVjdGlvbigpOwogICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgIH0K
IApAQCAtMTAwLDYgKzE0MywxMyBAQA0KICAgICAgICAgICAgICAgICBnZXRTZXNzaW9uKCkuZ2V0
VHJhbnNhY3Rpb25NdXRleCgpLnNldEFjdGl2ZVRocmVhZChUaHJlYWQuY3VycmVudFRocmVhZCgp
KTsKICAgICAgICAgICAgIH0KIAorICAgICAgICAgICAgLy8gSWYgc2VxdWVuY2luZyBjYWxsYmFj
ayBmb3IgdGhpcyB0cmFuc2FjdGlvbiB3aWxsIGJlIHJlcXVpcmVkCisgICAgICAgICAgICAvLyBp
biBjYXNlIGl0IGRvZXNuJ3QgYWxyZWFkeSBleGlzdCBpdCB3aWxsIGJlIGNyZWF0ZWQgb24gdGhp
cyB2ZXJ5IGxpc3RlbmVyCisgICAgICAgICAgICAvLyBhdm9pZGluZyBhZGRpbmcgbW9yZSBsaXN0
ZW5lcnMgd2hpbGUgcHJvY2Vzc2luZyBhIGxpc3RlbmVyLgorICAgICAgICAgICAgaWYoZ2V0VHJh
bnNhY3Rpb25Db250cm9sbGVyKCkuaXNTZXF1ZW5jaW5nQ2FsbGJhY2tSZXF1aXJlZCgpKSB7Cisg
ICAgICAgICAgICAgICAgZ2V0VHJhbnNhY3Rpb25Db250cm9sbGVyKCkuY3VycmVudGx5UHJvY2Vz
c2VkTGlzdGVuZXJzLnB1dChnZXRUcmFuc2FjdGlvbktleSgpLCB0aGlzKTsKKyAgICAgICAgICAg
IH0KKyAgICAgICAgICAgIAogICAgICAgICAgICAgLy8gU2VuZCB0aGUgU1FMIHRvIHRoZSBEQgog
ICAgICAgICAgICAgdW93Lmlzc3VlU1FMYmVmb3JlQ29tcGxldGlvbigpOwogCkBAIC0xMTIsNiAr
MTYyLDEwIEBADQogICAgICAgICAgICAgLy8gSGFuZGxlIHRoZSBleGNlcHRpb24gYWNjb3JkaW5n
IHRvIHRyYW5zYWN0aW9uIG1hbmFnZXIgcmVxdWlyZW1lbnRzCiAgICAgICAgICAgICBoYW5kbGVF
eGNlcHRpb24oZXhjZXB0aW9uKTsKICAgICAgICAgfSBmaW5hbGx5IHsKKyAgICAgICAgICAgIGlm
KGdldFRyYW5zYWN0aW9uQ29udHJvbGxlcigpLmlzU2VxdWVuY2luZ0NhbGxiYWNrUmVxdWlyZWQo
KSkgeworICAgICAgICAgICAgICAgIGdldFRyYW5zYWN0aW9uQ29udHJvbGxlcigpLmN1cnJlbnRs
eVByb2Nlc3NlZExpc3RlbmVycy5yZW1vdmUoZ2V0VHJhbnNhY3Rpb25LZXkoKSk7CisgICAgICAg
ICAgICB9CisgICAgICAgICAgICBnZXRTZXNzaW9uKCkucmVsZWFzZUpUU0Nvbm5lY3Rpb24oKTsK
ICAgICAgICAgICAgIHNlc3Npb24uZW5kT3BlcmF0aW9uUHJvZmlsZShTZXNzaW9uUHJvZmlsZXIu
SnRzQmVmb3JlQ29tcGxldGlvbik7CiAgICAgICAgIH0KICAgICB9CkBAIC0xMjgsNTAgKzE4Miw3
MCBAQA0KICAgICAgKi8KICAgICBwdWJsaWMgdm9pZCBhZnRlckNvbXBsZXRpb24oT2JqZWN0IHN0
YXR1cykgewogICAgICAgICBVbml0T2ZXb3JrSW1wbCB1b3cgPSBnZXRVbml0T2ZXb3JrKCk7Ci0g
ICAgICAgIHRyeSB7Ci0gICAgICAgICAgICAvLyBMb2cgdGhlIGZhY3QgdGhhdCB3ZSBnb3QgaW52
b2tlZAotICAgICAgICAgICAgZ2V0VHJhbnNhY3Rpb25Db250cm9sbGVyKCkubG9nVHhTdGF0ZVRy
YWNlKHVvdywgIlRYX2FmdGVyQ29tcGxldGlvbiIsIHN0YXR1cyk7Ci0gICAgICAgICAgICAvL0Ny
IzM0NTIwNTMKLSAgICAgICAgICAgIHNlc3Npb24uc3RhcnRPcGVyYXRpb25Qcm9maWxlKFNlc3Np
b25Qcm9maWxlci5KdHNBZnRlckNvbXBsZXRpb24pOwotICAgICAgICAgICAgLy8gVGhlIHVvdyBz
aG91bGQgc3RpbGwgYmUgYWN0aXZlIGV2ZW4gaW4gcm9sbGJhY2sgY2FzZQotICAgICAgICAgICAg
aWYgKCF1b3cuaXNBY3RpdmUoKSkgewotICAgICAgICAgICAgICAgIHRocm93IFRyYW5zYWN0aW9u
RXhjZXB0aW9uLmluYWN0aXZlVW5pdE9mV29yayh1b3cpOworICAgICAgICAvLyBpdCdzIGEgcHVy
ZWx5IHNlcXVlbmNpbmcgbGlzdGVuZXIgLSBjYWxsIHNlcXVlbmNpbmcgY2FsbGJhY2sgaWYgdGhl
IHRyYW5zYWN0aW9uIGhhcyBjb21taXR0ZWQuCisgICAgICAgIGlmKHVvdyA9PSBudWxsKSB7Cisg
ICAgICAgICAgICBpZihnZXRUcmFuc2FjdGlvbkNvbnRyb2xsZXIoKS5pc1NlcXVlbmNpbmdDYWxs
YmFja1JlcXVpcmVkKCkpIHsKKyAgICAgICAgICAgICAgICBpZihnZXRUcmFuc2FjdGlvbkNvbnRy
b2xsZXIoKS5jYW5NZXJnZVVuaXRPZldvcmtfaW1wbChzdGF0dXMpKSB7CisgICAgICAgICAgICAg
ICAgICAgIGNhbGxTZXF1ZW5jaW5nQ2FsbGJhY2soKTsKKyAgICAgICAgICAgICAgICB9CiAgICAg
ICAgICAgICB9Ci0KLSAgICAgICAgICAgIC8vIE9ubHkgZG8gbWVyZ2UgaWYgdHhuIHdhcyBjb21t
aXR0ZWQKLSAgICAgICAgICAgIGlmIChnZXRUcmFuc2FjdGlvbkNvbnRyb2xsZXIoKS5jYW5NZXJn
ZVVuaXRPZldvcmtfaW1wbChzdGF0dXMpKSB7Ci0gICAgICAgICAgICAgICAgdW93LmFmdGVyVHJh
bnNhY3Rpb24odHJ1ZSwgdHJ1ZSk7Ly8gY29tbWl0dGVkPXRydWU7IGV4dGVybmFsVHhuPXRydWUK
LSAgICAgICAgICAgICAgICBpZiAodW93LmlzTWVyZ2VQZW5kaW5nKCkpIHsKLSAgICAgICAgICAg
ICAgICAgICAgLy8gdW93IGluIFBFTkRJTkdfTUVSR0Ugc3RhdGUsIG1lcmdlIGNsb25lcwotICAg
ICAgICAgICAgICAgICAgICB1b3cubWVyZ2VDbG9uZXNBZnRlckNvbXBsZXRpb24oKTsKKyAgICAg
ICAgfSBlbHNlIHsKKyAgICAgICAgICAgIHRyeSB7CisgICAgICAgICAgICAgICAgLy8gTG9nIHRo
ZSBmYWN0IHRoYXQgd2UgZ290IGludm9rZWQKKyAgICAgICAgICAgICAgICBnZXRUcmFuc2FjdGlv
bkNvbnRyb2xsZXIoKS5sb2dUeFN0YXRlVHJhY2UodW93LCAiVFhfYWZ0ZXJDb21wbGV0aW9uIiwg
c3RhdHVzKTsKKyAgICAgICAgICAgICAgICAvL0NyIzM0NTIwNTMKKyAgICAgICAgICAgICAgICBz
ZXNzaW9uLnN0YXJ0T3BlcmF0aW9uUHJvZmlsZShTZXNzaW9uUHJvZmlsZXIuSnRzQWZ0ZXJDb21w
bGV0aW9uKTsKKyAgICAgICAgICAgICAgICAvLyBUaGUgdW93IHNob3VsZCBzdGlsbCBiZSBhY3Rp
dmUgZXZlbiBpbiByb2xsYmFjayBjYXNlCisgICAgICAgICAgICAgICAgaWYgKCF1b3cuaXNBY3Rp
dmUoKSkgeworICAgICAgICAgICAgICAgICAgICB0aHJvdyBUcmFuc2FjdGlvbkV4Y2VwdGlvbi5p
bmFjdGl2ZVVuaXRPZldvcmsodW93KTsKICAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICB9
IGVsc2UgewotICAgICAgICAgICAgICAgIHVvdy5hZnRlclRyYW5zYWN0aW9uKGZhbHNlLCB0cnVl
KTsvLyBjb21taXR0ZWQ9ZmFsc2U7IGV4dGVybmFsVHhuPXRydWUKKyAgICAKKyAgICAgICAgICAg
ICAgICAvLyBPbmx5IGRvIG1lcmdlIGlmIHR4biB3YXMgY29tbWl0dGVkCisgICAgICAgICAgICAg
ICAgaWYgKGdldFRyYW5zYWN0aW9uQ29udHJvbGxlcigpLmNhbk1lcmdlVW5pdE9mV29ya19pbXBs
KHN0YXR1cykpIHsKKyAgICAgICAgICAgICAgICAgICAgaWYoZ2V0VHJhbnNhY3Rpb25Db250cm9s
bGVyKCkuaXNTZXF1ZW5jaW5nQ2FsbGJhY2tSZXF1aXJlZCgpKSB7CisgICAgICAgICAgICAgICAg
ICAgICAgICBjYWxsU2VxdWVuY2luZ0NhbGxiYWNrKCk7CisgICAgICAgICAgICAgICAgICAgIH0K
KyAgICAgICAgICAgICAgICAgICAgaWYgKHVvdy5pc01lcmdlUGVuZGluZygpKSB7CisgICAgICAg
ICAgICAgICAgICAgICAgICAvLyB1b3cgaW4gUEVORElOR19NRVJHRSBzdGF0ZSwgbWVyZ2UgY2xv
bmVzCisgICAgICAgICAgICAgICAgICAgICAgICB1b3cubWVyZ2VDbG9uZXNBZnRlckNvbXBsZXRp
b24oKTsKKyAgICAgICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgICAgIH0gZWxzZSB7Cisg
ICAgICAgICAgICAgICAgICAgIC8vIGNhbGwgdGhpcyBtZXRob2QgYWdhaW4gYmVjYXVzZSB0aGVy
ZSBtYXkgaGF2ZSBiZWVuIG5vIGJlZm9yZUNvbXBsZXRpb24gY2FsbAorICAgICAgICAgICAgICAg
ICAgICAvLyBpZiBjYXNlIHRyYW5zYWN0aW9uIGlzIHRvIGJlIHJvbGxlZCBiYWNrLgorICAgICAg
ICAgICAgICAgICAgICBnZXRTZXNzaW9uKCkucmVsZWFzZUpUU0Nvbm5lY3Rpb24oKTsKKyAgICAg
ICAgICAgICAgICAgICAgdW93LmFmdGVyRXh0ZXJuYWxUcmFuc2FjdGlvblJvbGxiYWNrKCk7Cisg
ICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy
dEV4KSB7CisgICAgICAgICAgICAgICAgLy8gRmlyc3QgbG9nIHRoZSBleGNlcHRpb24gc28gaXQg
Z2V0cyBzZWVuCisgICAgICAgICAgICAgICAgdW93LmxvZyhuZXcgU2Vzc2lvbkxvZ0VudHJ5KHVv
dywgU2Vzc2lvbkxvZy5XQVJOSU5HLCBTZXNzaW9uTG9nLlRSQU5TQUNUSU9OLCBydEV4KSk7Cisg
ICAgICAgICAgICAgICAgLy8gUmV0aHJvdyBpdCBqdXN0IGZvciBmdW4gKGFwcCBzZXJ2ZXJzIHRl
bmQgdG8gaWdub3JlIHRoZW0gYXQgdGhpcyBzdGFnZSkKKyAgICAgICAgICAgICAgICB0aHJvdyBy
dEV4OworICAgICAgICAgICAgfSBmaW5hbGx5IHsKKyAgICAgICAgICAgICAgICBzZXNzaW9uLmVu
ZE9wZXJhdGlvblByb2ZpbGUoU2Vzc2lvblByb2ZpbGVyLkp0c0FmdGVyQ29tcGxldGlvbik7CiAg
ICAgICAgICAgICB9Ci0gICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcnRFeCkgewot
ICAgICAgICAgICAgLy8gRmlyc3QgbG9nIHRoZSBleGNlcHRpb24gc28gaXQgZ2V0cyBzZWVuCi0g
ICAgICAgICAgICB1b3cubG9nKG5ldyBTZXNzaW9uTG9nRW50cnkodW93LCBTZXNzaW9uTG9nLldB
Uk5JTkcsIFNlc3Npb25Mb2cuVFJBTlNBQ1RJT04sIHJ0RXgpKTsKLSAgICAgICAgICAgIC8vIFJl
dGhyb3cgaXQganVzdCBmb3IgZnVuIChhcHAgc2VydmVycyB0ZW5kIHRvIGlnbm9yZSB0aGVtIGF0
IHRoaXMgc3RhZ2UpCi0gICAgICAgICAgICB0aHJvdyBydEV4OwotICAgICAgICB9IGZpbmFsbHkg
ewotICAgICAgICAgICAgc2Vzc2lvbi5lbmRPcGVyYXRpb25Qcm9maWxlKFNlc3Npb25Qcm9maWxl
ci5KdHNBZnRlckNvbXBsZXRpb24pOwotICAgICAgICB9Ci0KLSAgICAgICAgLy8gQ2xlYW4gdXAg
YnkgcmVsZWFzaW5nIHRoZSB1b3cgYW5kIGNsaWVudCBzZXNzaW9uCi0gICAgICAgIGlmICh1b3cu
c2hvdWxkUmVzdW1lVW5pdE9mV29ya09uVHJhbnNhY3Rpb25Db21wbGV0aW9uKCkgJiYgZ2V0VHJh
bnNhY3Rpb25Db250cm9sbGVyKCkuY2FuTWVyZ2VVbml0T2ZXb3JrX2ltcGwoc3RhdHVzKSl7Ci0g
ICAgICAgICAgICB1b3cuc3luY2hyb25pemVBbmRSZXN1bWUoKTsKLSAgICAgICAgICAgIHVvdy5z
ZXRTeW5jaHJvbml6ZWQoZmFsc2UpOwotICAgICAgICB9ZWxzZXsKLSAgICAgICAgICAgIHVvdy5y
ZWxlYXNlKCk7Ci0gICAgICAgICAgICAvLyBSZWxlYXNlIHRoZSBzZXNzaW9uIGV4cGxpY2l0bHkK
LSAgICAgICAgICAgIGlmIChnZXRTZXNzaW9uKCkuaXNDbGllbnRTZXNzaW9uKCkpIHsKLSAgICAg
ICAgICAgICAgICBnZXRTZXNzaW9uKCkucmVsZWFzZSgpOworICAgIAorICAgICAgICAgICAgLy8g
Q2xlYW4gdXAgYnkgcmVsZWFzaW5nIHRoZSB1b3cgYW5kIGNsaWVudCBzZXNzaW9uCisgICAgICAg
ICAgICBpZiAodW93LnNob3VsZFJlc3VtZVVuaXRPZldvcmtPblRyYW5zYWN0aW9uQ29tcGxldGlv
bigpICYmIGdldFRyYW5zYWN0aW9uQ29udHJvbGxlcigpLmNhbk1lcmdlVW5pdE9mV29ya19pbXBs
KHN0YXR1cykpeworICAgICAgICAgICAgICAgIHVvdy5zeW5jaHJvbml6ZUFuZFJlc3VtZSgpOwor
ICAgICAgICAgICAgICAgIHVvdy5zZXRTeW5jaHJvbml6ZWQoZmFsc2UpOworICAgICAgICAgICAg
fWVsc2V7CisgICAgICAgICAgICAgICAgdW93LnJlbGVhc2UoKTsKKyAgICAgICAgICAgICAgICAv
LyBSZWxlYXNlIHRoZSBzZXNzaW9uIGV4cGxpY2l0bHkKKyAgICAgICAgICAgICAgICBpZiAoZ2V0
U2Vzc2lvbigpLmlzQ2xpZW50U2Vzc2lvbigpIHx8IChnZXRTZXNzaW9uKCkuaXNTZXNzaW9uQnJv
a2VyKCkgJiYgKChTZXNzaW9uQnJva2VyKWdldFNlc3Npb24oKSkuaXNDbGllbnRTZXNzaW9uQnJv
a2VyKCkpKSB7CisgICAgICAgICAgICAgICAgICAgIGdldFNlc3Npb24oKS5yZWxlYXNlKCk7Cisg
ICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQorICAgICAgICAgICAgZ2V0VHJhbnNhY3Rp
b25Db250cm9sbGVyKCkucmVtb3ZlVW5pdE9mV29yayhnZXRUcmFuc2FjdGlvbktleSgpKTsKKyAg
ICAgICAgICAgIHNldFVuaXRPZldvcmsobnVsbCk7CisgICAgICAgICAgICBzZXRTZXNzaW9uKG51
bGwpOwogICAgICAgICB9Ci0gICAgICAgIGdldFRyYW5zYWN0aW9uQ29udHJvbGxlcigpLnJlbW92
ZVVuaXRPZldvcmsoZ2V0VHJhbnNhY3Rpb24oKSk7Ci0gICAgICAgIHNldFVuaXRPZldvcmsobnVs
bCk7CisgICAgICAgIGlmKGdldFRyYW5zYWN0aW9uQ29udHJvbGxlcigpLmlzU2VxdWVuY2luZ0Nh
bGxiYWNrUmVxdWlyZWQoKSkgeworICAgICAgICAgICAgZ2V0VHJhbnNhY3Rpb25Db250cm9sbGVy
KCkucmVtb3ZlU2VxdWVuY2luZ0xpc3RlbmVyKGdldFRyYW5zYWN0aW9uS2V5KCkpOworICAgICAg
ICAgICAgc2VxdWVuY2luZ0NhbGxiYWNrID0gbnVsbDsKKyAgICAgICAgICAgIHNlcXVlbmNpbmdD
YWxsYmFja01hcCA9IG51bGw7CisgICAgICAgIH0KICAgICAgICAgc2V0VHJhbnNhY3Rpb24obnVs
bCk7Ci0gICAgICAgIHNldFNlc3Npb24obnVsbCk7CisgICAgICAgIHNldFRyYW5zYWN0aW9uS2V5
KG51bGwpOwogICAgIH0KIAogICAgIC8qKgpAQCAtMjA4LDYgKzI4MiwxNCBAQA0KICAgICAgICAg
dGhpcy50cmFuc2FjdGlvbiA9IHRyYW5zYWN0aW9uOwogICAgIH0KIAorICAgIHByb3RlY3RlZCBP
YmplY3QgZ2V0VHJhbnNhY3Rpb25LZXkoKSB7CisgICAgICAgIHJldHVybiB0cmFuc2FjdGlvbktl
eTsKKyAgICB9CisKKyAgICBwcm90ZWN0ZWQgdm9pZCBzZXRUcmFuc2FjdGlvbktleShPYmplY3Qg
dHJhbnNhY3Rpb25LZXkpIHsKKyAgICAgICAgdGhpcy50cmFuc2FjdGlvbktleSA9IHRyYW5zYWN0
aW9uS2V5OworICAgIH0KKwogICAgIHByb3RlY3RlZCBBYnN0cmFjdFNlc3Npb24gZ2V0U2Vzc2lv
bigpIHsKICAgICAgICAgcmV0dXJuIHNlc3Npb247CiAgICAgfQpAQCAtMjIzLDQgKzMwNSw0MiBA
QA0KICAgICBwcm90ZWN0ZWQgdm9pZCBzZXRVbml0T2ZXb3JrKFVuaXRPZldvcmtJbXBsIHVuaXRP
ZldvcmspIHsKICAgICAgICAgdGhpcy51bml0T2ZXb3JrID0gdW5pdE9mV29yazsKICAgICB9Cisg
ICAgCisgICAgcHJvdGVjdGVkIHZvaWQgY2FsbFNlcXVlbmNpbmdDYWxsYmFjaygpIHsKKyAgICAg
ICAgaWYoc2VxdWVuY2luZ0NhbGxiYWNrICE9IG51bGwpIHsKKyAgICAgICAgICAgIHNlcXVlbmNp
bmdDYWxsYmFjay5hZnRlckNvbW1pdChudWxsKTsKKyAgICAgICAgfSBlbHNlIGlmIChzZXF1ZW5j
aW5nQ2FsbGJhY2tNYXAgIT0gbnVsbCkgeworICAgICAgICAgICAgSXRlcmF0b3I8U2VxdWVuY2lu
Z0NhbGxiYWNrPiBpdENhbGxiYWNrID0gc2VxdWVuY2luZ0NhbGxiYWNrTWFwLnZhbHVlcygpLml0
ZXJhdG9yKCk7CisgICAgICAgICAgICB3aGlsZShpdENhbGxiYWNrLmhhc05leHQoKSkgeworICAg
ICAgICAgICAgICAgIGl0Q2FsbGJhY2submV4dCgpLmFmdGVyQ29tbWl0KG51bGwpOworICAgICAg
ICAgICAgfQorICAgICAgICB9CisgICAgfQorCisgICAgLyoqCisgICAgICogUmV0dXJuIHNlcXVl
bmNpbmdDYWxsYmFjayBjb3JyZXNwb25kaW5nIHRvIHRoZSBwYXNzZWQgc2Vzc2lvbi4KKyAgICAg
Ki8KKyAgICBwdWJsaWMgU2VxdWVuY2luZ0NhbGxiYWNrIGdldFNlcXVlbmNpbmdDYWxsYmFjayhE
YXRhYmFzZVNlc3Npb24gZGJTZXNzaW9uLCBTZXF1ZW5jaW5nQ2FsbGJhY2tGYWN0b3J5IHNlcXVl
bmNpbmdDYWxsYmFja0ZhY3RvcnkpIHsKKyAgICAgICAgaWYoZ2V0VHJhbnNhY3Rpb25Db250cm9s
bGVyKCkubnVtU2Vzc2lvbnNSZXF1aXJpbmdTZXF1ZW5jaW5nQ2FsbGJhY2soKSA9PSAxKSB7Cisg
ICAgICAgICAgICBpZihzZXF1ZW5jaW5nQ2FsbGJhY2sgPT0gbnVsbCkgeworICAgICAgICAgICAg
ICAgIHNlcXVlbmNpbmdDYWxsYmFjayA9IHNlcXVlbmNpbmdDYWxsYmFja0ZhY3RvcnkuY3JlYXRl
U2VxdWVuY2luZ0NhbGxiYWNrKCk7CisgICAgICAgICAgICB9CisgICAgICAgICAgICByZXR1cm4g
c2VxdWVuY2luZ0NhbGxiYWNrOworICAgICAgICB9IGVsc2UgaWYoZ2V0VHJhbnNhY3Rpb25Db250
cm9sbGVyKCkubnVtU2Vzc2lvbnNSZXF1aXJpbmdTZXF1ZW5jaW5nQ2FsbGJhY2soKSA+IDEpIHsK
KyAgICAgICAgICAgIFNlcXVlbmNpbmdDYWxsYmFjayBjYWxsYmFjayA9IG51bGw7CisgICAgICAg
ICAgICBpZihzZXF1ZW5jaW5nQ2FsbGJhY2tNYXAgPT0gbnVsbCkgeworICAgICAgICAgICAgICAg
IHNlcXVlbmNpbmdDYWxsYmFja01hcCA9IG5ldyBIYXNoTWFwKGdldFRyYW5zYWN0aW9uQ29udHJv
bGxlcigpLm51bVNlc3Npb25zUmVxdWlyaW5nU2VxdWVuY2luZ0NhbGxiYWNrKCkpOworICAgICAg
ICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICBjYWxsYmFjayA9IHNlcXVlbmNpbmdDYWxs
YmFja01hcC5nZXQoZGJTZXNzaW9uKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIGlmKGNh
bGxiYWNrID09IG51bGwpIHsKKyAgICAgICAgICAgICAgICBjYWxsYmFjayA9IHNlcXVlbmNpbmdD
YWxsYmFja0ZhY3RvcnkuY3JlYXRlU2VxdWVuY2luZ0NhbGxiYWNrKCk7CisgICAgICAgICAgICAg
ICAgc2VxdWVuY2luZ0NhbGxiYWNrTWFwLnB1dChkYlNlc3Npb24sIGNhbGxiYWNrKTsKKyAgICAg
ICAgICAgIH0KKyAgICAgICAgICAgIHJldHVybiBjYWxsYmFjazsKKyAgICAgICAgfSBlbHNlIHsK
KyAgICAgICAgICAgIC8vIHNob3VsZCBuZXZlciBoYXBwZW4uCisgICAgICAgICAgICByZXR1cm4g
bnVsbDsKKyAgICAgICAgfQorICAgIH0KIH0NClwgTm8gbmV3bGluZSBhdCBlbmQgb2YgZmlsZQ0K
SW5kZXg6IGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lz
dGVuY2UvdHJhbnNhY3Rpb24vQWJzdHJhY3RUcmFuc2FjdGlvbkNvbnRyb2xsZXIuamF2YQ0KPT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PQ0KLS0tIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2Uv
cGVyc2lzdGVuY2UvdHJhbnNhY3Rpb24vQWJzdHJhY3RUcmFuc2FjdGlvbkNvbnRyb2xsZXIuamF2
YQkocmV2aXNpb24gNzQ1NikNCisrKyBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29y
Zy9lY2xpcHNlL3BlcnNpc3RlbmNlL3RyYW5zYWN0aW9uL0Fic3RyYWN0VHJhbnNhY3Rpb25Db250
cm9sbGVyLmphdmEJKHdvcmtpbmcgY29weSkNCkBAIC0xMSwxMyArMTEsMTkgQEANCiAKIGltcG9y
dCBqYXZhLnV0aWwuKjsKIGltcG9ydCBqYXZheC5uYW1pbmcuKjsKKworaW1wb3J0IG9yZy5lY2xp
cHNlLnBlcnNpc3RlbmNlLnNlc3Npb25zLmJyb2tlci5TZXNzaW9uQnJva2VyOworaW1wb3J0IG9y
Zy5lY2xpcHNlLnBlcnNpc3RlbmNlLnNlc3Npb25zLkRhdGFiYXNlU2Vzc2lvbjsKIGltcG9ydCBv
cmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS5zZXNzaW9ucy5FeHRlcm5hbFRyYW5zYWN0aW9uQ29udHJv
bGxlcjsKIGltcG9ydCBvcmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS5pbnRlcm5hbC5zZXNzaW9ucy5B
YnN0cmFjdFNlc3Npb247CitpbXBvcnQgb3JnLmVjbGlwc2UucGVyc2lzdGVuY2UuaW50ZXJuYWwu
c2Vzc2lvbnMuRGF0YWJhc2VTZXNzaW9uSW1wbDsKIGltcG9ydCBvcmcuZWNsaXBzZS5wZXJzaXN0
ZW5jZS5pbnRlcm5hbC5zZXNzaW9ucy5Vbml0T2ZXb3JrSW1wbDsKIGltcG9ydCBvcmcuZWNsaXBz
ZS5wZXJzaXN0ZW5jZS5sb2dnaW5nLlNlc3Npb25Mb2c7CiBpbXBvcnQgb3JnLmVjbGlwc2UucGVy
c2lzdGVuY2UuZXhjZXB0aW9ucy5UcmFuc2FjdGlvbkV4Y2VwdGlvbjsKIGltcG9ydCBvcmcuZWNs
aXBzZS5wZXJzaXN0ZW5jZS5leGNlcHRpb25zLkRhdGFiYXNlRXhjZXB0aW9uOwogaW1wb3J0IG9y
Zy5lY2xpcHNlLnBlcnNpc3RlbmNlLmludGVybmFsLmhlbHBlci5KYXZhUGxhdGZvcm07CitpbXBv
cnQgb3JnLmVjbGlwc2UucGVyc2lzdGVuY2UuaW50ZXJuYWwuc2VxdWVuY2luZy5TZXF1ZW5jaW5n
Q2FsbGJhY2s7CitpbXBvcnQgb3JnLmVjbGlwc2UucGVyc2lzdGVuY2UuaW50ZXJuYWwuc2VxdWVu
Y2luZy5TZXF1ZW5jaW5nQ2FsbGJhY2tGYWN0b3J5OwogCiAvKioKICAqIDxwPgpAQCAtNDcsNiAr
NTMsMjQgQEANCiAgICAgLyoqIFBFUkY6IENhY2hlIHRoZSBhY3RpdmUgdW93IGluIGEgdGhyZWFk
IGxvY2FsLiAqLwogICAgIHByb3RlY3RlZCBUaHJlYWRMb2NhbCBhY3RpdmVVbml0T2ZXb3JrVGhy
ZWFkTG9jYWw7CiAKKyAgICAvKiogVGFibGUgb2YgZXh0ZXJuYWwgdHJhbnNhY3Rpb24gb2JqZWN0
IGtleXMgYW5kIHNlcXVlbmNpbmcgbGlzdGVuZXJzIHZhbHVlcy4gKi8KKyAgICAvKiogTm9uLW51
bGwgb25seSBpbiBjYXNlIHNlcXVlbmNpbmcgY2FsbGJhY2tzIGFyZSB1c2VkOiBudW1TZXNzaW9u
c1JlcXVpcmluZ1NlcXVlbmNpbmdDYWxsYmFjayA+IDAgKi8KKyAgICBwcm90ZWN0ZWQgTWFwPE9i
amVjdCwgQWJzdHJhY3RTeW5jaHJvbml6YXRpb25MaXN0ZW5lcj4gc2VxdWVuY2luZ0xpc3RlbmVy
czsKKworICAgIC8qKiBUYWJsZSBvZiBleHRlcm5hbCB0cmFuc2FjdGlvbiBvYmplY3Qga2V5cyBh
bmQgbGlzdGVuZXJzIHRoYXQgYXJlIGN1cnJlbnRseSBpbiBiZWZvcmVDb21wbGV0aW9uLiAqLwor
ICAgIC8qKiBSZXF1ZXN0IGZvciBhIG5ldyBzZXF1ZW5jaW5nIGNhbGxiYWNrIG1heSBiZSB0cmln
Z2VyZWQgYnkgYmVmb3JlQ29tcGxldGlvbiBvZiBleGlzdGluZyBsaXN0ZW5lciAtICovCisgICAg
LyoqIGluIHRoaXMgY2FzZSBhdm9pZCBjcmVhdGluZyB5ZXQgYW5vdGhlciBsaXN0ZW5lciBmb3Ig
c2VxdWVuY2luZyBidXQgcmF0aGVyIHVzZSB0aGUgbGlzdGVuZXIgKi8KKyAgICAvKiogdGhhdCBo
YXMgaW5pdGlhdGVkIHRoZSByZXF1ZXN0ICovCisgICAgLyoqIE5vbi1udWxsIG9ubHkgaW4gY2Fz
ZSBzZXF1ZW5jaW5nIGNhbGxiYWNrcyBhcmUgdXNlZDogbnVtU2Vzc2lvbnNSZXF1aXJpbmdTZXF1
ZW5jaW5nQ2FsbGJhY2sgPiAwICovCisgICAgcHJvdGVjdGVkIE1hcDxPYmplY3QsIEFic3RyYWN0
U3luY2hyb25pemF0aW9uTGlzdGVuZXI+IGN1cnJlbnRseVByb2Nlc3NlZExpc3RlbmVyczsKKwor
ICAgIC8qKiBJbmRpY2F0ZXMgaG93IG1hbnkgc2Vzc2lvbnMgcmVxdWlyZSBzZXF1ZW5jaW5nIGNh
bGxiYWNrczogKi8KKyAgICAvKiogMCAtIHNlcXVlbmNpbmcgY2FsbGJhY2tzIG5vdCB1c2VkOyAq
LworICAgIC8qKiAxIC0gdGhlIHNlc3Npb24gaXMgRGF0YWJhc2VTZXNzaW9uIG9yIFNlcnZlclNl
c3Npb24gYW5kIHJlcXVpcmVzIHNlcXVlbmNpbmcgY2FsbGJhY2tzLCAqLworICAgIC8qKiBvciB0
aGUgc2Vzc2lvbiBpcyBhIHNlc3Npb24gYnJva2VyIHdpdGggb25seSBvbmUgbWVtYmVyIHJlcXVp
cmluZyBzZXF1ZW5jaW5nIGNhbGxiYWNrcy4gKi8KKyAgICAvKiogbW9yZSAtIHRoZSBzZXNzaW9u
IGlzIGEgc2Vzc2lvbiBicm9rZXIgd2l0aCBzZXZlcmFsIG1lbWJlcnMgcmVxdWlyaW5nIHNlcXVl
bmNpbmcgY2FsbGJhY2tzLiAqLworICAgIHByb3RlY3RlZCBpbnQgbnVtU2Vzc2lvbnNSZXF1aXJp
bmdTZXF1ZW5jaW5nQ2FsbGJhY2s7CisKICAgICAvKioKICAgICAgKiBJTlRFUk5BTDoKICAgICAg
KiBSZXR1cm4gYSBuZXcgY29udHJvbGxlci4KQEAgLTMwOCwxOCArMzMyLDE4IEBADQogICAgICAq
IElOVEVSTkFMOgogICAgICAqIEFkZCBhIFVuaXRPZldvcmsgb2JqZWN0IHRvIHRoZSBIYXNodGFi
bGUga2V5ZWQgb24gdGhlIGV4dGVybmFsIHRyYW5zYWN0aW9uIG9iamVjdC4KICAgICAgKi8KLSAg
ICBwdWJsaWMgdm9pZCBhZGRVbml0T2ZXb3JrKE9iamVjdCB0cmFuc2FjdGlvbiwgVW5pdE9mV29y
a0ltcGwgYWN0aXZlVW5pdE9mV29yaykgeworICAgIHB1YmxpYyB2b2lkIGFkZFVuaXRPZldvcmso
T2JqZWN0IHRyYW5zYWN0aW9uS2V5LCBVbml0T2ZXb3JrSW1wbCBhY3RpdmVVbml0T2ZXb3JrKSB7
CiAgICAgICAgIHRoaXMuYWN0aXZlVW5pdE9mV29ya1RocmVhZExvY2FsLnNldChudWxsKTsKLSAg
ICAgICAgZ2V0VW5pdHNPZldvcmsoKS5wdXQodHJhbnNhY3Rpb24sIGFjdGl2ZVVuaXRPZldvcmsp
OworICAgICAgICBnZXRVbml0c09mV29yaygpLnB1dCh0cmFuc2FjdGlvbktleSwgYWN0aXZlVW5p
dE9mV29yayk7CiAgICAgfQogCiAgICAgLyoqCiAgICAgICogSU5URVJOQUw6CiAgICAgICogUmVt
b3ZlIHRoZSB1bml0IG9mIHdvcmsgYXNzb2NpYXRlZCB3aXRoIHRoZSB0cmFuc2FjdGlvbiBwYXNz
ZWQgaW4uCiAgICAgICovCi0gICAgcHVibGljIHZvaWQgcmVtb3ZlVW5pdE9mV29yayhPYmplY3Qg
dHJhbnNhY3Rpb24pIHsKLSAgICAgICAgaWYgKHRyYW5zYWN0aW9uICE9IG51bGwpIHsKLSAgICAg
ICAgICAgIGdldFVuaXRzT2ZXb3JrKCkucmVtb3ZlKHRyYW5zYWN0aW9uKTsKKyAgICBwdWJsaWMg
dm9pZCByZW1vdmVVbml0T2ZXb3JrKE9iamVjdCB0cmFuc2FjdGlvbktleSkgeworICAgICAgICBp
ZiAodHJhbnNhY3Rpb25LZXkgIT0gbnVsbCkgeworICAgICAgICAgICAgZ2V0VW5pdHNPZldvcmso
KS5yZW1vdmUodHJhbnNhY3Rpb25LZXkpOwogICAgICAgICB9CiAgICAgICAgIHRoaXMuYWN0aXZl
VW5pdE9mV29ya1RocmVhZExvY2FsLnNldChudWxsKTsKICAgICB9CkBAIC0zMzgsNiArMzYyLDcg
QEANCiAgICAgICovCiAgICAgcHVibGljIHZvaWQgc2V0U2Vzc2lvbihBYnN0cmFjdFNlc3Npb24g
c2Vzc2lvbikgewogICAgICAgICB0aGlzLnNlc3Npb24gPSBzZXNzaW9uOworICAgICAgICBpbml0
aWFsaXplU2VxdWVuY2luZ0xpc3RlbmVycygpOwogICAgIH0KIAogICAgIC8qKgpAQCAtNDEzLDYg
KzQzOCwxMTUgQEANCiAgICAgICAgIHJldHVybiBqbmRpT2JqZWN0OwogICAgIH0KIAorICAgIC8q
KgorICAgICAqIElOVEVSTkFMOgorICAgICAqIEluaXRpYWxpemVzIHNlcXVlbmNpbmcgbGlzdGVu
ZXJzLgorICAgICAqIEFsd2F5cyBjbGVhcnMgc2VxdWVuY2luZyBsaXN0ZW5lcnMgZmlyc3QuCisg
ICAgICogVGhlcmUgYXJlIHR3byBtZXRob2RzIGNhbGxpbmcgdGhpcyBtZXRob2Q6CisgICAgICog
MS4gc2V0U2Vzc2lvbiBtZXRob2QgLSB0aGlzIGNvdWxkIGxlYWQgdG8gaW5pdGlhbGl6YXRpb24g
b2Ygc2VxdWVuY2luZyBsaXN0ZW5lcnMKKyAgICAgKiBvbmx5IGlmIHNlcXVlbmNpbmcgYWxyZWFk
eSBjb25uZWN0ZWQgKHRoYXQgd291bGQgaGFwcGVuIGlmIHNldFNlc3Npb24gaXMgY2FsbGVkCisg
ICAgICogYWZ0ZXIgc2Vzc2lvbi5sb2dpbiwgd2hpY2ggaXMgbm9ybWFsbHkgbm90IHRoZSBjYXNl
KS4KKyAgICAgKiAyLiBpbiB0aGUgdmVyeSBlbmQgb2YgY29ubmVjdGluZyBzZXF1ZW5jaW5nLAor
ICAgICAqIGFmdGVyIGl0J3MgZGV0ZXJtaW5lZCB3aGV0aGVyIHNlcXVlbmNpbmcgY2FsbGJhY2tz
IChhbmQgdGhlcmVmb3JlIGxpc3RlbmVycykKKyAgICAgKiB3aWxsIGJlIHJlcXVpcmVkLgorICAg
ICAqLworICAgIHB1YmxpYyB2b2lkIGluaXRpYWxpemVTZXF1ZW5jaW5nTGlzdGVuZXJzKCkgewor
ICAgICAgICAvLyBzZXRzIG51bVNlc3Npb25zUmVxdWlyaW5nU2VxdWVuY2luZ0NhbGxiYWNrIHRv
IDA7IHJlbW92ZXMgc2VxdWVuY2VMaXN0ZW5lcnMuCisgICAgICAgIGNsZWFyU2VxdWVuY2luZ0xp
c3RlbmVycygpOworICAgICAgICBpZihzZXNzaW9uID09IG51bGwpIHsKKyAgICAgICAgICAgIHJl
dHVybjsKKyAgICAgICAgfQorICAgICAgICBBYnN0cmFjdFNlc3Npb24gcGFyZW50U2Vzc2lvbiA9
IHNlc3Npb247CisgICAgICAgIHdoaWxlKHBhcmVudFNlc3Npb24uZ2V0UGFyZW50KCkgIT0gbnVs
bCkgeworICAgICAgICAgICAgcGFyZW50U2Vzc2lvbiA9IHBhcmVudFNlc3Npb24uZ2V0UGFyZW50
KCk7CisgICAgICAgIH0KKyAgICAgICAgLy8gdG9wIHBhcmVudFNlc3Npb24gbXVzdCBiZSBEYXRh
YmFzZVNlc3Npb25JbXBsCisgICAgICAgIGlmKHBhcmVudFNlc3Npb24uaXNCcm9rZXIoKSkgewor
ICAgICAgICAgICAgLy8gaXQgY291bGQgYmUgZWl0aGVyIFNlc3Npb25Ccm9rZXIKKyAgICAgICAg
ICAgIG51bVNlc3Npb25zUmVxdWlyaW5nU2VxdWVuY2luZ0NhbGxiYWNrID0gKChTZXNzaW9uQnJv
a2VyKXBhcmVudFNlc3Npb24pLmhvd01hbnlTZXF1ZW5jaW5nQ2FsbGJhY2tzKCk7CisgICAgICAg
IH0gZWxzZSB7CisgICAgICAgICAgICAvLyBvciBEYXRhYmFzZVNlc3Npb25JbXBsIG9yIFNlcnZl
clNlc3Npb24KKyAgICAgICAgICAgIGlmKCgoRGF0YWJhc2VTZXNzaW9uSW1wbClwYXJlbnRTZXNz
aW9uKS5pc1NlcXVlbmNpbmdDYWxsYmFja1JlcXVpcmVkKCkpIHsKKyAgICAgICAgICAgICAgICBu
dW1TZXNzaW9uc1JlcXVpcmluZ1NlcXVlbmNpbmdDYWxsYmFjayA9IDE7CisgICAgICAgICAgICB9
CisgICAgICAgIH0KKyAgICAgICAgaWYobnVtU2Vzc2lvbnNSZXF1aXJpbmdTZXF1ZW5jaW5nQ2Fs
bGJhY2sgIT0gMCkgeworICAgICAgICAgICAgdGhpcy5zZXF1ZW5jaW5nTGlzdGVuZXJzID0gSmF2
YVBsYXRmb3JtLmdldENvbmN1cnJlbnRNYXAoKTsKKyAgICAgICAgICAgIHRoaXMuY3VycmVudGx5
UHJvY2Vzc2VkTGlzdGVuZXJzID0gSmF2YVBsYXRmb3JtLmdldENvbmN1cnJlbnRNYXAoKTsKKyAg
ICAgICAgfQorICAgIH0KKworICAgIC8qKgorICAgICAqIElOVEVSTkFMOgorICAgICAqIFJldHVy
bnMgc2VxdWVuY2luZ0NhbGxiYWNrIGZvciB0aGUgY3VycmVudCBhY3RpdmUgZXh0ZXJuYWwgdHJh
bnNhY3Rpb24uCisgICAgICogRGF0YWJhc2VTZXNzaW9uIGlzIHBhc3NlZCBmb3IgdGhlIHNha2Ug
b2YgU2Vzc2lvbkJyb2tlciBjYXNlLgorICAgICAqIFRoaXMgbWV0aG9kIHJlcXVpcmVzIGFjdGl2
ZSBleHRlcm5hbCB0cmFuc2FjdGlvbi4KKyAgICAgKi8KKyAgICBwdWJsaWMgU2VxdWVuY2luZ0Nh
bGxiYWNrIGdldEFjdGl2ZVNlcXVlbmNpbmdDYWxsYmFjayhEYXRhYmFzZVNlc3Npb24gZGJTZXNz
aW9uLCBTZXF1ZW5jaW5nQ2FsbGJhY2tGYWN0b3J5IHNlcXVlbmNpbmdDYWxsYmFja0ZhY3Rvcnkp
IHsKKyAgICAgICAgT2JqZWN0IHRyYW5zYWN0aW9uID0gZ2V0VHJhbnNhY3Rpb24oKTsKKyAgICAg
ICAgLy8gVGhpcyBtZXRob2QgcmVxdWlyZXMgYWN0aXZlIGV4dGVybmFsIHRyYW5zYWN0aW9uLgor
ICAgICAgICBpZiAodHJhbnNhY3Rpb24gPT0gbnVsbCkgeworICAgICAgICAgICAgdGhyb3cgVHJh
bnNhY3Rpb25FeGNlcHRpb24uZXh0ZXJuYWxUcmFuc2FjdGlvbk5vdEFjdGl2ZSgpOworICAgICAg
ICB9CisgICAgICAgIE9iamVjdCB0cmFuc2FjdGlvbktleSA9IGdldFRyYW5zYWN0aW9uS2V5KHRy
YW5zYWN0aW9uKTsKKworICAgICAgICBBYnN0cmFjdFN5bmNocm9uaXphdGlvbkxpc3RlbmVyIGxp
c3RlbmVyID0gc2VxdWVuY2luZ0xpc3RlbmVycy5nZXQodHJhbnNhY3Rpb25LZXkpOworICAgICAg
ICBpZihsaXN0ZW5lciA9PSBudWxsKSB7CisgICAgICAgICAgICAvLyBJbiBjYXNlIHRoaXMgcmVx
dWVzdCB3YXMgdHJpZ2dlcmVkIGZyb20gYmVmb3JlQ29tcGxldGlvbiBtZXRob2Qgb2YgZXhpc3Rp
bmcgbGlzdGVuZXIgLQorICAgICAgICAgICAgLy8gZmluZCB0aGlzIGxpc3RlbmVyLgorICAgICAg
ICAgICAgbGlzdGVuZXIgPSBjdXJyZW50bHlQcm9jZXNzZWRMaXN0ZW5lcnMuZ2V0KHRyYW5zYWN0
aW9uS2V5KTsKKyAgICAgICAgICAgIGlmKGxpc3RlbmVyID09IG51bGwpIHsKKyAgICAgICAgICAg
ICAgICAvLyBDcmVhdGUgYW5kIHJlZ2lzdGVyIHRoZSBuZXcgc3luY2hyb25pemF0aW9uIGxpc3Rl
bmVyIHdpdGggdW93PT1zZXNzaW9uPT1udWxsLgorICAgICAgICAgICAgICAgIGxpc3RlbmVyID0g
Z2V0TGlzdGVuZXJGYWN0b3J5KCkubmV3U3luY2hyb25pemF0aW9uTGlzdGVuZXIobnVsbCwgbnVs
bCwgdHJhbnNhY3Rpb24sIHRoaXMpOworICAgICAgICAgICAgICAgIHRyeSB7CisgICAgICAgICAg
ICAgICAgICAgIHJlZ2lzdGVyU3luY2hyb25pemF0aW9uX2ltcGwobGlzdGVuZXIsIHRyYW5zYWN0
aW9uKTsKKyAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZXhjZXB0aW9uKSB7Cisg
ICAgICAgICAgICAgICAgICAgIHRocm93IFRyYW5zYWN0aW9uRXhjZXB0aW9uLmVycm9yQmluZGlu
Z1RvRXh0ZXJuYWxUcmFuc2FjdGlvbihleGNlcHRpb24pOworICAgICAgICAgICAgICAgIH0KKyAg
ICAgICAgICAgIH0KKyAgICAgICAgICAgIHNlcXVlbmNpbmdMaXN0ZW5lcnMucHV0KHRyYW5zYWN0
aW9uS2V5LCBsaXN0ZW5lcik7CisgICAgICAgIH0KKyAgICAgICAgcmV0dXJuIGxpc3RlbmVyLmdl
dFNlcXVlbmNpbmdDYWxsYmFjayhkYlNlc3Npb24sIHNlcXVlbmNpbmdDYWxsYmFja0ZhY3Rvcnkp
OworICAgIH0KKyAgICAKKyAgICAvKioKKyAgICAgKiBJTlRFUk5BTDoKKyAgICAgKiBDbGVhcnMg
c2VxdWVuY2luZyBsaXN0ZW5lcnMuCisgICAgICogQ2FsbGVkIGJ5IGluaXRpYWxpemVTZXF1ZW5j
aW5nTGlzdGVuZXJzIGFuZCBieSBzZXF1ZW5jaW5nIG9uIGRpc2Nvbm5lY3QuCisgICAgICovCisg
ICAgcHVibGljIHZvaWQgY2xlYXJTZXF1ZW5jaW5nTGlzdGVuZXJzKCkgeworICAgICAgICB0aGlz
LnNlcXVlbmNpbmdMaXN0ZW5lcnMgPSBudWxsOworICAgICAgICB0aGlzLmN1cnJlbnRseVByb2Nl
c3NlZExpc3RlbmVycyA9IG51bGw7CisgICAgICAgIHRoaXMubnVtU2Vzc2lvbnNSZXF1aXJpbmdT
ZXF1ZW5jaW5nQ2FsbGJhY2sgPSAwOworICAgIH0KKworICAgIC8qKgorICAgICAqIElOVEVSTkFM
OgorICAgICAqIEluZGljYXRlcyB3aGV0aGVyIHNlcXVlbmNpbmcgY2FsbGJhY2sgbWF5IGJlIHJl
cXVpcmVkLgorICAgICAqLworICAgIHB1YmxpYyBib29sZWFuIGlzU2VxdWVuY2luZ0NhbGxiYWNr
UmVxdWlyZWQoKSB7CisgICAgICAgIHJldHVybiB0aGlzLm51bVNlc3Npb25zUmVxdWlyaW5nU2Vx
dWVuY2luZ0NhbGxiYWNrID4gMDsKKyAgICB9CisKKyAgICAvKioKKyAgICAgKiBJTlRFUk5BTDoK
KyAgICAgKiBJbmRpY2F0ZXMgaG93IG1hbnkgc2Vzc2lvbnMgcmVxdWlyZSBzZXF1ZW5jaW5nIGNh
bGxiYWNrcy4KKyAgICAgKi8KKyAgICBwdWJsaWMgaW50IG51bVNlc3Npb25zUmVxdWlyaW5nU2Vx
dWVuY2luZ0NhbGxiYWNrKCkgeworICAgICAgICByZXR1cm4gdGhpcy5udW1TZXNzaW9uc1JlcXVp
cmluZ1NlcXVlbmNpbmdDYWxsYmFjazsKKyAgICB9CisKKyAgICAvKioKKyAgICAgKiBJTlRFUk5B
TDoKKyAgICAgKiBDbGVhcnMgc2VxdWVuY2luZ0NhbGxiYWNrcy4KKyAgICAgKiBDYWxsZWQgYnkg
aW5pdGlhbGl6ZVNlcXVlbmNpbmdDYWxsYmFja3MgYW5kIGJ5IHNlcXVlbmNpbmcgb24gZGlzY29u
bmVjdC4KKyAgICAgKi8KKyAgICBwdWJsaWMgdm9pZCByZW1vdmVTZXF1ZW5jaW5nTGlzdGVuZXIo
T2JqZWN0IHRyYW5zYWN0aW9uS2V5KSB7CisgICAgICAgIGlmICh0cmFuc2FjdGlvbktleSAhPSBu
dWxsKSB7CisgICAgICAgICAgICBzZXF1ZW5jaW5nTGlzdGVuZXJzLnJlbW92ZSh0cmFuc2FjdGlv
bktleSk7CisgICAgICAgIH0KKyAgICB9CisKICAgICAvKgogICAgICAqIElOVEVSTkFMOgogICAg
ICAqIEhlbHBlciBtZXRob2QgdG8gbG9nIHRyYWNlIHN0YXRlbWVudHMgdG8gdGhlIHRyYW5zYWN0
aW9uIGNoYW5uZWwuCg==
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>86612</attachid>
            <date>2008-01-10 16:21:00 -0500</date>
            <delta_ts>2008-01-10 16:21:11 -0500</delta_ts>
            <desc>SequencingCallbackFactory class I forgot to put into the originalpatch</desc>
            <filename>214958_SeqCallbackFactory080110.patch</filename>
            <type>text/plain</type>
            <size>18856</size>
            <attacher name="Andrei Ilitchev">andrei.ilitchev</attacher>
            
              <data encoding="base64">SW5kZXg6IGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lz
dGVuY2UvaW50ZXJuYWwvZGF0YWJhc2VhY2Nlc3MvRGF0YXNvdXJjZUFjY2Vzc29yLmphdmENCj09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT0NCi0tLSBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNl
L3BlcnNpc3RlbmNlL2ludGVybmFsL2RhdGFiYXNlYWNjZXNzL0RhdGFzb3VyY2VBY2Nlc3Nvci5q
YXZhCShyZXZpc2lvbiA3NTUxKQ0KKysrIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMv
b3JnL2VjbGlwc2UvcGVyc2lzdGVuY2UvaW50ZXJuYWwvZGF0YWJhc2VhY2Nlc3MvRGF0YXNvdXJj
ZUFjY2Vzc29yLmphdmEJKHdvcmtpbmcgY29weSkNCkBAIC05Niw4ICs5NiwzMyBAQA0KICAgICAg
KiAgYWZ0ZXIgdHJhbnNhY3Rpb24gaXMgY29tcGxldGVkIHRoZSBjYWxsYmFjayBpcyBkaXNjYXJk
ZWQuCiAgICAgICovCiAgICAgcHJvdGVjdGVkIHRyYW5zaWVudCBTZXF1ZW5jaW5nQ2FsbGJhY2sg
c2VxdWVuY2luZ0NhbGxiYWNrOworICAgIAorICAgIC8qKgorICAgICAqICBVc2VkIG9ubHkgaW4g
ZXh0ZXJuYWxDb25uZWN0aW9uUG9vbGluZyBjYXNlLiBJbmRpY2F0ZXMgd2hpY2ggc2Vzc2lvbiBp
cyBjdXJyZW50bHkgdXNpbmcgY29ubmVjdGlvbi4KKyAgICAgKiAgQWxsb3dzIHRvIHJpc2UgYXBw
cm9wcmlhdGUgc2Vzc2lvbidzIGV2ZW50IHdoZW4gY29ubmVjdGlvbiBpcyBhbHJlYWR5L3N0aWxs
IGFsaXZlLgorICAgICAqICBFdmVudHMgd2lsbCBiZSByaXNlbiB3aGVuIENsaWVudFNlc3Npb24g
b3IgRGF0YWJhc2VTZXNzaW9uIGFjcXVpcmVzIGNvbm5lY3Rpb24gaW4gdGhlIGJlZ2lubmluZwor
ICAgICAqICBhbmQgcmVsZWFzZXMgY29ubmVjdGlvbiBpbiB0aGUgZW5kIG9mIHRyYW5zYWN0aW9u
IChpbiBhZnRlckNvbXBsZXRpb24gaW4ganRhIGNhc2UpLgorICAgICAqICBJbiBjYXNlIHRoZSBz
ZXNzaW9uIHJlcXVpcmVzIGV4Y2x1c2l2ZSBjb25uZWN0aW9uIChFeGNsdXNpdmVJc29sYXRlZENs
aWVudFNlc3Npb24pIHRoZSBldmVudHMKKyAgICAgKiAgd2lsbCBiZSByaXNlbiBldmVyeSB0aW1l
IHRoZSBzZXNzaW9uIGFjcXVpcmVzIG9yIHJlbGVhc2VzIGNvbm5lY3Rpb24gLQorICAgICAqICB3
aGljaCBpcyBhIHJhcmUgZXZlbnQgLSB0aGUgY29ubmVjdGlvbiBpcyBrZXB0IGZvciB0aGUgZHVy
YXRpb24gb2YganRhIHRyYW5zYWN0aW9uLAorICAgICAqICBhZnRlciBqdGEgdHJhbnNhY3Rpb24g
aXMgY29tcGxldGVkIHRoZSBuZXcgY29ubmVjdGlvbiBpcyBhY3F1aXJlZCBvbiBhIGZpcnN0IHF1
ZXJ5IGV4ZWN1dGlvbgorICAgICAqICBhbmQga2VwdCB1bnRpbCB0aGUgbmV4dCBiZWdpblRyYW5z
YWN0aW9uIGNhbGwuCisgICAgICogIEluIG5vbi1qdGEgY2FzZSB0aGUgY29ubmVjdGlvbiBpcyBh
Y3F1aXJlZCBmb3Igc2Vzc2lvbidzIGxpZmUgYW5kIHJlbGVhc2Ugb25seSBieSBzZXNzaW9uJ3Mg
cmVsZWFzZS4KKyAgICAgKiAgTm90ZSB0aGF0IHRoZSBhdHRyaWJ1dGUgaXMgbnVsbGlmaWVkIG9u
bHkgaW4gb25lIHBsYWNlIC0gYnkgY2xvc2VDb25uZWN0aW9uIG1ldGhvZC4KKyAgICAgKi8KKyAg
ICBwcm90ZWN0ZWQgdHJhbnNpZW50IEFic3RyYWN0U2Vzc2lvbiBjdXJyZW50U2Vzc2lvbjsKIAog
ICAgIC8qKgorICAgICAqICBJbmRpY2F0ZXMgdGhhdCBpc0luVHJhbnNhY3Rpb24gZmxhZyBpcyBh
Ym91dCB0byBjaGFuZ2UgZnJvbSBmYWxzZSB0byB0cnVlLgorICAgICAqLworICAgIHByb3RlY3Rl
ZCB0cmFuc2llbnQgYm9vbGVhbiBpc0JlZ2lubmluZ1RyYW5zYWN0aW9uOworCisgICAgLyoqCisg
ICAgICogIEluZGljYXRlcyB0aGF0IGlzSW5UcmFuc2FjdGlvbiBmbGFnIGlzIGFib3V0IHRvIGNo
YW5nZSBmcm9tIHRydWUgdG8gZmFsc2UKKyAgICAgKi8KKyAgICBwcm90ZWN0ZWQgdHJhbnNpZW50
IGJvb2xlYW4gaXNDb21wbGV0aW5nVHJhbnNhY3Rpb247CisKKyAgICAvKioKICAgICAgKiAgICBE
ZWZhdWx0IENvbnN0cnVjdG9yLgogICAgICAqLwogICAgIHB1YmxpYyBEYXRhc291cmNlQWNjZXNz
b3IoKSB7CkBAIC0xNDIsNyArMTY3LDcgQEANCiAgICAgfQogCiAgICAgLyoqCi0gICAgICogVGhp
cyBzaG91bGQgYmUgc2V0IHRvIGZhbHNlIGlmIGEgY29tbXVuaWNhdGlvbiBmYWlsdXJlIG9jY3Vy
cmVkIGR1cnJpbmcgYSBjYWxsIGV4ZWN1dGlvbi4gIAorICAgICAqIFRoaXMgc2hvdWxkIGJlIHNl
dCB0byBmYWxzZSBpZiBhIGNvbW11bmljYXRpb24gZmFpbHVyZSBvY2N1cnJlZCBkdXJpbmcgYSBj
YWxsIGV4ZWN1dGlvbi4gIAogICAgICAqIEluIHRoZSBjYXNlIG9mIGFuIGludmFsaWQgYWNjZXNz
b3IgdGhlIEFjY2Vzc29yIHdpbGwgbm90IGJlIHJldHVybmVkIHRvIHRoZSBwb29sLgogICAgICAq
LwogICAgIHB1YmxpYyB2b2lkIHNldElzVmFsaWQoYm9vbGVhbiBpc1ZhbGlkKXsKQEAgLTE1OCw3
ICsxODMsNyBAQA0KIAogICAgIC8qKgogICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIEFjY2Vz
c29yIGNhbiBjb250aW51ZSB0byBiZSB1c2VkLiAgVGhpcyB3aWxsIGJlIGZhbHNlIGlmIGEgY29t
bXVuaWNhdGlvbgotICAgICAqIGZhaWx1cmUgb2NjdXJyZWQgZHVycmluZyBhIGNhbGwgZXhlY3V0
aW9uLiAgSW4gdGhlIGNhc2Ugb2YgYW4gaW52YWxpZCBhY2Nlc3NvciB0aGUgQWNjZXNzb3IKKyAg
ICAgKiBmYWlsdXJlIG9jY3VycmVkIGR1cmluZyBhIGNhbGwgZXhlY3V0aW9uLiAgSW4gdGhlIGNh
c2Ugb2YgYW4gaW52YWxpZCBhY2Nlc3NvciB0aGUgQWNjZXNzb3IKICAgICAgKiB3aWxsIG5vdCBi
ZSByZXR1cm5lZCB0byB0aGUgcG9vbC4KICAgICAgKi8KICAgICBwdWJsaWMgYm9vbGVhbiBpc1Zh
bGlkKCl7CkBAIC0xODAsNiArMjA1LDkgQEANCiAgICAgICovCiAgICAgcHVibGljIHZvaWQgYmVn
aW5UcmFuc2FjdGlvbihBYnN0cmFjdFNlc3Npb24gc2Vzc2lvbikgdGhyb3dzIERhdGFiYXNlRXhj
ZXB0aW9uIHsKICAgICAgICAgaWYgKHVzZXNFeHRlcm5hbFRyYW5zYWN0aW9uQ29udHJvbGxlcigp
KSB7CisgICAgICAgICAgICBpZihzZXNzaW9uLmlzRXhjbHVzaXZlQ29ubmVjdGlvblJlcXVpcmVk
KCkgJiYgIWlzSW5UcmFuc2FjdGlvbigpICYmIHVzZXNFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5n
KCkpIHsKKyAgICAgICAgICAgICAgICBjbG9zZUNvbm5lY3Rpb24oKTsKKyAgICAgICAgICAgIH0K
ICAgICAgICAgICAgIHNldElzSW5UcmFuc2FjdGlvbih0cnVlKTsKICAgICAgICAgICAgIHJldHVy
bjsKICAgICAgICAgfQpAQCAtMTg4LDEwICsyMTYsMTIgQEANCiAKICAgICAgICAgdHJ5IHsKICAg
ICAgICAgICAgIHNlc3Npb24uc3RhcnRPcGVyYXRpb25Qcm9maWxlKFNlc3Npb25Qcm9maWxlci5U
UkFOU0FDVElPTik7CisgICAgICAgICAgICBpc0JlZ2lubmluZ1RyYW5zYWN0aW9uID0gdHJ1ZTsK
ICAgICAgICAgICAgIGluY3JlbWVudENhbGxDb3VudChzZXNzaW9uKTsKICAgICAgICAgICAgIGJh
c2ljQmVnaW5UcmFuc2FjdGlvbihzZXNzaW9uKTsKICAgICAgICAgICAgIHNldElzSW5UcmFuc2Fj
dGlvbih0cnVlKTsKICAgICAgICAgfSBmaW5hbGx5IHsKKyAgICAgICAgICAgIGlzQmVnaW5uaW5n
VHJhbnNhY3Rpb24gPSBmYWxzZTsKICAgICAgICAgICAgIGRlY3JlbWVudENhbGxDb3VudCgpOwog
ICAgICAgICAgICAgc2Vzc2lvbi5lbmRPcGVyYXRpb25Qcm9maWxlKFNlc3Npb25Qcm9maWxlci5U
UkFOU0FDVElPTik7CiAgICAgICAgIH0KQEAgLTIyMiw3ICsyNTIsNyBAQA0KICAgICAgICAgICAg
IHJldHVybjsKICAgICAgICAgfQogICAgICAgICBzZXRDYWxsQ291bnQoY291bnQgLSAxKTsKLSAg
ICAgICAgaWYgKHVzZXNFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCkgJiYgKCFpc0luVHJhbnNh
Y3Rpb24oKSkgJiYgKGNvdW50ID09IDEpKSB7CisgICAgICAgIGlmICh1c2VzRXh0ZXJuYWxDb25u
ZWN0aW9uUG9vbGluZygpICYmICghaXNJblRyYW5zYWN0aW9uKCkpICYmIChjdXJyZW50U2Vzc2lv
biA9PSBudWxsIHx8ICFjdXJyZW50U2Vzc2lvbi5pc0V4Y2x1c2l2ZUNvbm5lY3Rpb25SZXF1aXJl
ZCgpKSAmJiAoY291bnQgPT0gMSkpIHsKICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg
ICAgY2xvc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgICB9IGNhdGNoIChEYXRhYmFzZUV4Y2Vw
dGlvbiBpZ25vcmUpIHsKQEAgLTI1Niw2ICsyODYsMTYgQEANCiAgICAgICAgICAgICAgICAgLy8g
SWYgRXh0ZXJuYWxDb25uZWN0aW9uUG9vbGluZyBpcyB1c2VkLCB0aGUgY29ubmVjdGlvbiBjYW4g
YmUgcmUtZXN0YWJsaXNoZWQuCiAgICAgICAgICAgICAgICAgaWYgKHVzZXNFeHRlcm5hbENvbm5l
Y3Rpb25Qb29saW5nKCkpIHsKICAgICAgICAgICAgICAgICAgICAgcmVjb25uZWN0KHNlc3Npb24p
OworICAgICAgICAgICAgICAgICAgICAvLyBlaXRoZXIgdHJhbnNhY3Rpb24gaXMgc3RhcnRpbmcg
KHRoZSBtZXRob2QgaXMgY2FsbGVkIGZyb20gYmVnaW5UcmFuc2FjdGlvbiwgbm8gZXh0ZXJuYWxU
cmFuc2FjdGlvbkNvbnRyb2xsZXIgY2FzZSkKKyAgICAgICAgICAgICAgICAgICAgLy8gb3IgdGhl
IGNvbm5lY3Rpb24gaXMgcmVxdWlyZWQgZm9yIHRoZSBzZXNzaW9uIHdoaWNoIGlzCisgICAgICAg
ICAgICAgICAgICAgIC8vICAgZWl0aGVyIGluIHRyYW5zYWN0aW9uIGFscmVhZHkgKHdpbGwgaGFw
cGVuIGluIGV4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVyIGNhc2UpOworICAgICAgICAgICAg
ICAgICAgICAvLyAgIG9yIHJlcXVpcmVzIGV4Y2x1c2l2ZSBjb25uZWN0aW9uLgorICAgICAgICAg
ICAgICAgICAgICBpZihpc0JlZ2lubmluZ1RyYW5zYWN0aW9uIHx8IGlzSW5UcmFuc2FjdGlvbigp
IHx8IHNlc3Npb24uaXNFeGNsdXNpdmVDb25uZWN0aW9uUmVxdWlyZWQoKSkgeworICAgICAgICAg
ICAgICAgICAgICAgICAgc2Vzc2lvbi5wb3N0Q29ubmVjdEV4dGVybmFsQ29ubmVjdGlvbih0aGlz
KTsKKyAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTZXNzaW9uID0gc2Vzc2lvbjsKKyAg
ICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKGlzQ29tcGxldGluZ1RyYW5zYWN0aW9uKSB7Cisg
ICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U2Vzc2lvbiA9IHNlc3Npb247CisgICAgICAg
ICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg
ICAgICB0aHJvdyBEYXRhYmFzZUV4Y2VwdGlvbi5kYXRhYmFzZUFjY2Vzc29yTm90Q29ubmVjdGVk
KCk7CiAgICAgICAgICAgICAgICAgfQpAQCAtMjY0LDcgKzMwNCw3IEBADQogICAgIH0KIAogICAg
IC8qKgotICAgICAqIFJlc2V0IHN0YXRtZW50IGNvdW50LgorICAgICAqIFJlc2V0IHN0YXRlbWVu
dCBjb3VudC4KICAgICAgKi8KICAgICBwdWJsaWMgdm9pZCByZXNldFN0YXRtZW50c0NvdW50KCkg
ewogICAgICAgICByZWFkU3RhdGVtZW50c0NvdW50PTA7CkBAIC0zMTUsNiArMzU1LDggQEANCiAg
ICAgICAgICAgICBpZiAoIXNlc3Npb24uaXNTeW5jaHJvbml6ZWQoKSkgewogICAgICAgICAgICAg
ICAgIHNldElzSW5UcmFuc2FjdGlvbihmYWxzZSk7CiAgICAgICAgICAgICAgICAgaWYgKHVzZXNF
eHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCkpIHsKKyAgICAgICAgICAgICAgICAgICAgLy8gY2xv
c2VDb25uZWN0aW9uIG1ldGhvZCB1c2VzIGN1cnJlbnRTZXNzaW9uIGFuZCB0aGVuIHNldHMgaXQg
dG8gbnVsbC4KKyAgICAgICAgICAgICAgICAgICAgY3VycmVudFNlc3Npb24gPSBzZXNzaW9uOwog
ICAgICAgICAgICAgICAgICAgICBjbG9zZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgICAgICB9
CiAgICAgICAgICAgICB9CkBAIC0zMjUsNiArMzY3LDcgQEANCiAKICAgICAgICAgdHJ5IHsKICAg
ICAgICAgICAgIHNlc3Npb24uc3RhcnRPcGVyYXRpb25Qcm9maWxlKFNlc3Npb25Qcm9maWxlci5U
UkFOU0FDVElPTik7CisgICAgICAgICAgICBpc0NvbXBsZXRpbmdUcmFuc2FjdGlvbiA9IHRydWU7
CiAgICAgICAgICAgICBpbmNyZW1lbnRDYWxsQ291bnQoc2Vzc2lvbik7CiAgICAgICAgICAgICBi
YXNpY0NvbW1pdFRyYW5zYWN0aW9uKHNlc3Npb24pOwogCkBAIC0zMzMsNiArMzc2LDcgQEANCiAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICBzZXRJc0luVHJhbnNhY3Rpb24oZmFsc2UpOwogICAg
ICAgICB9IGZpbmFsbHkgeworICAgICAgICAgICAgaXNDb21wbGV0aW5nVHJhbnNhY3Rpb24gPSBm
YWxzZTsKICAgICAgICAgICAgIHNlcXVlbmNpbmdDYWxsYmFjayA9IG51bGw7CiAgICAgICAgICAg
ICBkZWNyZW1lbnRDYWxsQ291bnQoKTsKICAgICAgICAgICAgIHNlc3Npb24uZW5kT3BlcmF0aW9u
UHJvZmlsZShTZXNzaW9uUHJvZmlsZXIuVFJBTlNBQ1RJT04pOwpAQCAtNDI3LDYgKzQ3MSw5IEBA
DQogICAgICAgICB0cnkgewogICAgICAgICAgICAgaWYgKGdldERhdGFzb3VyY2VDb25uZWN0aW9u
KCkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgIGlmIChpc0RhdGFzb3VyY2VDb25uZWN0ZWQo
KSkgeworICAgICAgICAgICAgICAgICAgICBpZihjdXJyZW50U2Vzc2lvbiAhPSBudWxsKSB7Cisg
ICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U2Vzc2lvbi5wcmVEaXNjb25uZWN0RXh0ZXJu
YWxDb25uZWN0aW9uKHRoaXMpOworICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg
ICAgICAgIGNsb3NlRGF0YXNvdXJjZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgICAgICB9CiAg
ICAgICAgICAgICAgICAgc2V0RGF0YXNvdXJjZUNvbm5lY3Rpb24obnVsbCk7CkBAIC00MzQsNiAr
NDgxLDggQEANCiAgICAgICAgIH0gY2F0Y2ggKERhdGFiYXNlRXhjZXB0aW9uIGV4Y2VwdGlvbikg
ewogICAgICAgICAgICAgLy8gSWdub3JlCiAgICAgICAgICAgICBzZXREYXRhc291cmNlQ29ubmVj
dGlvbihudWxsKTsKKyAgICAgICAgfSBmaW5hbGx5IHsKKyAgICAgICAgICAgIGN1cnJlbnRTZXNz
aW9uID0gbnVsbDsKICAgICAgICAgfQogICAgIH0KIApAQCAtNTc0LDYgKzYyMyw4IEBADQogICAg
ICAgICAgICAgaWYgKCFzZXNzaW9uLmlzU3luY2hyb25pemVkKCkpIHsKICAgICAgICAgICAgICAg
ICBzZXRJc0luVHJhbnNhY3Rpb24oZmFsc2UpOwogICAgICAgICAgICAgICAgIGlmICh1c2VzRXh0
ZXJuYWxDb25uZWN0aW9uUG9vbGluZygpKSB7CisgICAgICAgICAgICAgICAgICAgIC8vIGNsb3Nl
Q29ubmVjdGlvbiBtZXRob2QgdXNlcyBjdXJyZW50U2Vzc2lvbiBhbmQgdGhlbiBzZXRzIGl0IHRv
IG51bGwuCisgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTZXNzaW9uID0gc2Vzc2lvbjsKICAg
ICAgICAgICAgICAgICAgICAgY2xvc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgfQog
ICAgICAgICAgICAgfQpAQCAtNTg0LDEwICs2MzUsMTIgQEANCiAKICAgICAgICAgdHJ5IHsKICAg
ICAgICAgICAgIHNlc3Npb24uc3RhcnRPcGVyYXRpb25Qcm9maWxlKFNlc3Npb25Qcm9maWxlci5U
UkFOU0FDVElPTik7CisgICAgICAgICAgICBpc0NvbXBsZXRpbmdUcmFuc2FjdGlvbiA9IHRydWU7
CiAgICAgICAgICAgICBpbmNyZW1lbnRDYWxsQ291bnQoc2Vzc2lvbik7CiAgICAgICAgICAgICBi
YXNpY1JvbGxiYWNrVHJhbnNhY3Rpb24oc2Vzc2lvbik7CiAgICAgICAgIH0gZmluYWxseSB7CiAg
ICAgICAgICAgICBzZXRJc0luVHJhbnNhY3Rpb24oZmFsc2UpOworICAgICAgICAgICAgaXNDb21w
bGV0aW5nVHJhbnNhY3Rpb24gPSBmYWxzZTsKICAgICAgICAgICAgIHNlcXVlbmNpbmdDYWxsYmFj
ayA9IG51bGw7CiAgICAgICAgICAgICBkZWNyZW1lbnRDYWxsQ291bnQoKTsKICAgICAgICAgICAg
IHNlc3Npb24uZW5kT3BlcmF0aW9uUHJvZmlsZShTZXNzaW9uUHJvZmlsZXIuVFJBTlNBQ1RJT04p
OwpJbmRleDogZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJz
aXN0ZW5jZS9pbnRlcm5hbC9zZXNzaW9ucy9BYnN0cmFjdFNlc3Npb24uamF2YQ0KPT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PQ0KLS0tIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lz
dGVuY2UvaW50ZXJuYWwvc2Vzc2lvbnMvQWJzdHJhY3RTZXNzaW9uLmphdmEJKHJldmlzaW9uIDc1
NTEpDQorKysgZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJz
aXN0ZW5jZS9pbnRlcm5hbC9zZXNzaW9ucy9BYnN0cmFjdFNlc3Npb24uamF2YQkod29ya2luZyBj
b3B5KQ0KQEAgLTM1MDEsNCArMzUwMSwzMiBAQA0KICAgICAgICAgICAgIH0KICAgICAgICAgfQog
ICAgIH0KKworICAgIC8qKgorICAgICAqIElOVEVSTkFMOgorICAgICAqIFRoaXMgbWV0aG9kIGlz
IGNhbGxlZCBpbiBjYXNlIGV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcgaXMgdXNlZAorICAgICAq
IHJpZ2h0IGFmdGVyIHRoZSBhY2Nlc3NvciBpcyBjb25uZWN0ZWQuIAorICAgICAqIFVzZWQgYnkg
dGhlIHNlc3Npb24gdG8gcmlzZSBhbiBhcHByb3ByaWF0ZSBldmVudC4KKyAgICAgKi8KKyAgICBw
dWJsaWMgdm9pZCBwb3N0Q29ubmVjdEV4dGVybmFsQ29ubmVjdGlvbihBY2Nlc3NvciBhY2Nlc3Nv
cikgeworICAgIH0KKworICAgIC8qKgorICAgICAqIElOVEVSTkFMOgorICAgICAqIFRoaXMgbWV0
aG9kIGlzIGNhbGxlZCBpbiBjYXNlIGV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcgaXMgdXNlZAor
ICAgICAqIHJpZ2h0IGJlZm9yZSB0aGUgYWNjZXNzb3IgaXMgZGlzY29ubmVjdGVkLiAKKyAgICAg
KiBVc2VkIGJ5IHRoZSBzZXNzaW9uIHRvIHJpc2UgYW4gYXBwcm9wcmlhdGUgZXZlbnQuCisgICAg
ICovCisgICAgcHVibGljIHZvaWQgcHJlRGlzY29ubmVjdEV4dGVybmFsQ29ubmVjdGlvbihBY2Nl
c3NvciBhY2Nlc3NvcikgeworICAgIH0KKyAgICAKKyAgICAvKioKKyAgICAgKiBJTlRFUk5BTDoK
KyAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgaW4gY2FzZSBleHRlcm5hbENvbm5lY3Rpb25Q
b29saW5nIGlzIHVzZWQuCisgICAgICogSWYgcmV0dXJucyB0cnVlLCBhY2Nlc3NvciB1c2VkIGJ5
IHRoZSBzZXNzaW9uIGtlZXBzIGl0cworICAgICAqIGNvbm5lY3Rpb24gb3BlbiB1bnRpbCByZWxl
YXNlZCBieSB0aGUgc2Vzc2lvbi4gCisgICAgICovCisgICAgcHVibGljIGJvb2xlYW4gaXNFeGNs
dXNpdmVDb25uZWN0aW9uUmVxdWlyZWQoKSB7CisgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICB9
CiB9CkluZGV4OiBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3Bl
cnNpc3RlbmNlL2ludGVybmFsL3Nlc3Npb25zL0V4Y2x1c2l2ZUlzb2xhdGVkQ2xpZW50U2Vzc2lv
bi5qYXZhDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09DQotLS0gZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9v
cmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9pbnRlcm5hbC9zZXNzaW9ucy9FeGNsdXNpdmVJc29sYXRl
ZENsaWVudFNlc3Npb24uamF2YQkocmV2aXNpb24gNzU1MSkNCisrKyBmb3VuZGF0aW9uL2VjbGlw
c2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL2ludGVybmFsL3Nlc3Npb25z
L0V4Y2x1c2l2ZUlzb2xhdGVkQ2xpZW50U2Vzc2lvbi5qYXZhCSh3b3JraW5nIGNvcHkpDQpAQCAt
MjQsNTMgKzI0LDYgQEANCiANCiAgICAgLyoqDQogICAgICAqIElOVEVSTkFMOg0KLSAgICAgKiBU
aGlzIGlzIGludGVybmFsIHRvIHRoZSB1bml0IG9mIHdvcmsgYW5kIHNob3VsZCBuZXZlciBiZSBj
YWxsZWQgb3RoZXJ3aXNlLg0KLSAgICAgKi8NCi0gICAgcHVibGljIHZvaWQgYmFzaWNCZWdpblRy
YW5zYWN0aW9uKCkgew0KLSAgICAgICAgLy9pZiB3ZSBhcmUgYmVnaW5pbmcgdGhlIHRyYW5zYWN0
aW9uIHRoZW4gd2Ugc2hvdWxkIGFsbG93IHRoZSBhY2Nlc3NvciB0bw0KLSAgICAgICAgLy9yZWxl
YXNlIHRoZSBjb25uZWN0aW9uIGFuZCByZS1hY3F1aXJlIGEgbmV3IG9uZS4gIFRoaXMgaXMgdXNl
ZnVsbCBpbg0KLSAgICAgICAgLy90aGUgY2FzZSBvZiBleHRlcm5hbCBjb25uZWN0aW9uIHBvb2xz
IHdpdGggSlRBLg0KLSAgICAgICAgaWYgKCh0aGlzLmdldFdyaXRlQ29ubmVjdGlvbigpICE9IG51
bGwpICYmIHRoaXMuZ2V0TG9naW4oKS5zaG91bGRVc2VFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5n
KCkpIHsNCi0gICAgICAgICAgICAvLyBsZXQgdGhlIHVzZXIgcmVtb3ZlIHRoZSBwcml2bGVkZ2Vz
DQotICAgICAgICAgICAgZ2V0RXZlbnRNYW5hZ2VyKCkucHJlUmVsZWFzZUV4Y2x1c2l2ZUNvbm5l
Y3Rpb24odGhpcywgdGhpcy5nZXRXcml0ZUNvbm5lY3Rpb24oKSk7DQotICAgICAgICAgICAgLy9s
ZXQgdGhlIGFjY2Vzc29yIHJlbGVhc2UgdGhlIGNvbm5lY3Rpb24NCi0gICAgICAgICAgICB0aGlz
LmdldFdyaXRlQ29ubmVjdGlvbigpLmRlY3JlbWVudENhbGxDb3VudCgpOw0KLSAgICAgICAgICAg
IC8vbWFrZSB0aGUgYWNjZXNzb3IgcmUtYWNxdWlyZSBhIG5ldyBjb25uZWN0aW9uLiAgVGhpcyBz
dXBwb3J0cyB0aGUgY2FzZQ0KLSAgICAgICAgICAgIC8vd2hlcmUgYSBKVEEgdHJhbnNhY3Rpb24g
d2FzIHN0YXJ0ZWQgc2luY2UgdGhlIGNsaWVudCBzZXNzaW9uIHdhcyBmaXJzdCBhY3F1aXJlZC4N
Ci0gICAgICAgICAgICB0aGlzLmdldFdyaXRlQ29ubmVjdGlvbigpLmluY3JlbWVudENhbGxDb3Vu
dCh0aGlzKTsNCi0gICAgICAgICAgICAvLyBsZXQgdGhlIHVzZXIgdXBkYXRlIHRoZSBjb25uZWN0
aW9uIHdpdGggcmVxdWlyZWQgcHJpdmxlZGdlcy4NCi0gICAgICAgICAgICBnZXRFdmVudE1hbmFn
ZXIoKS5wb3N0QWNxdWlyZUV4Y2x1c2l2ZUNvbm5lY3Rpb24odGhpcywgdGhpcy5nZXRXcml0ZUNv
bm5lY3Rpb24oKSk7DQotICAgICAgICB9DQotICAgICAgICBzdXBlci5iYXNpY0JlZ2luVHJhbnNh
Y3Rpb24oKTsNCi0gICAgfQ0KLQ0KLSAgICAvKioNCi0gICAgICogSU5URVJOQUw6DQotICAgICAq
IFRoaXMgaXMgaW50ZXJuYWwgdG8gdGhlIHVuaXQgb2Ygd29yayBhbmQgc2hvdWxkIG5vdCBiZSBj
YWxsZWQgb3RoZXJ3aXNlLg0KLSAgICAgKi8NCi0gICAgcHVibGljIHZvaWQgYmFzaWNDb21taXRU
cmFuc2FjdGlvbigpIHsNCi0gICAgICAgIC8vaWYgd2UgYXJlIGVuZGluZyB0aGUgdHJhbnNhY3Rp
b24gdGhlbiB3ZSBzaG91bGQgYWxsb3cgdGhlIGFjY2Vzc29yIHRvDQotICAgICAgICAvL3JlbGVh
c2UgdGhlIGNvbm5lY3Rpb24gYW5kIHJlLWFjcXVpcmUgYSBuZXcgb25lLiAgVGhpcyBpcyB1c2Vm
dWxsIGluDQotICAgICAgICAvL3RoZSBjYXNlIG9mIGV4dGVybmFsIGNvbm5lY3Rpb24gcG9vbHMg
d2l0aCBKVEEuDQotICAgICAgICBpZiAoKHRoaXMuZ2V0V3JpdGVDb25uZWN0aW9uKCkgIT0gbnVs
bCkgJiYgdGhpcy5nZXRMb2dpbigpLnNob3VsZFVzZUV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmco
KSkgew0KLSAgICAgICAgICAgIC8vIGxldCB0aGUgdXNlciByZW1vdmUgdGhlIHByaXZsZWRnZXMN
Ci0gICAgICAgICAgICBnZXRFdmVudE1hbmFnZXIoKS5wcmVSZWxlYXNlRXhjbHVzaXZlQ29ubmVj
dGlvbih0aGlzLCB0aGlzLmdldFdyaXRlQ29ubmVjdGlvbigpKTsNCi0gICAgICAgICAgICAvL2xl
dCB0aGUgYWNjZXNzb3IgcmVsZWFzZSB0aGUgY29ubmVjdGlvbg0KLSAgICAgICAgICAgIHRoaXMu
Z2V0V3JpdGVDb25uZWN0aW9uKCkuZGVjcmVtZW50Q2FsbENvdW50KCk7DQotICAgICAgICAgICAg
Ly9tYWtlIHRoZSBhY2Nlc3NvciByZS1hY3F1aXJlIGEgbmV3IGNvbm5lY3Rpb24uICBUaGlzIHN1
cHBvcnRzIHRoZSBjYXNlDQotICAgICAgICAgICAgLy93aGVyZSBhIEpUQSB0cmFuc2FjdGlvbiB3
YXMgc3RhcnRlZCBzaW5jZSB0aGUgY2xpZW50IHNlc3Npb24gd2FzIGZpcnN0IGFjcXVpcmVkLg0K
LSAgICAgICAgICAgIHRoaXMuZ2V0V3JpdGVDb25uZWN0aW9uKCkuaW5jcmVtZW50Q2FsbENvdW50
KHRoaXMpOw0KLSAgICAgICAgICAgIC8vIGxldCB0aGUgdXNlciB1cGRhdGUgdGhlIGNvbm5lY3Rp
b24gd2l0aCByZXF1aXJlZCBwcml2bGVkZ2VzLg0KLSAgICAgICAgICAgIGdldEV2ZW50TWFuYWdl
cigpLnBvc3RBY3F1aXJlRXhjbHVzaXZlQ29ubmVjdGlvbih0aGlzLCB0aGlzLmdldFdyaXRlQ29u
bmVjdGlvbigpKTsNCi0gICAgICAgIH0NCi0NCi0gICAgICAgIC8vT25seSByZWxlYXNlZSBjb25u
ZWN0aW9uIHdoZW4gdHJhbnNhY3Rpb24gc3VjY2VlZHMuICANCi0gICAgICAgIC8vSWYgbm90LCBj
b25uZWN0aW9uIHdpbGwgYmUgcmVsZWFzZWQgaW4gcm9sbGJhY2suDQotICAgICAgICBzdXBlci5i
YXNpY0NvbW1pdFRyYW5zYWN0aW9uKCk7DQotICAgIH0NCi0NCi0gICAgLyoqDQotICAgICAqIElO
VEVSTkFMOg0KICAgICAgKiBPdmVycmlkZSB0byBhY3F1aXJlIHRoZSBjb25uZWN0aW9uIGZyb20g
dGhlIHBvb2wgYXQgdGhlIGxhc3QgbWludXRlDQogICAgICAqLw0KICAgICBwdWJsaWMgT2JqZWN0
IGV4ZWN1dGVDYWxsKENhbGwgY2FsbCwgQWJzdHJhY3RSZWNvcmQgdHJhbnNsYXRpb25Sb3csIERh
dGFiYXNlUXVlcnkgcXVlcnkpIHRocm93cyBEYXRhYmFzZUV4Y2VwdGlvbiB7DQpAQCAtMTU1LDEz
ICsxMDgsMzYgQEANCiAgICAgICogYWNjZXNzDQogICAgICAqLw0KICAgICBwdWJsaWMgdm9pZCBz
ZXRXcml0ZUNvbm5lY3Rpb24oQWNjZXNzb3IgYWNjZXNzb3IpIHsNCi0gICAgICAgIGlmIChnZXRM
b2dpbigpLnNob3VsZFVzZUV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcoKSkgew0KLSAgICAgICAg
ICAgIGlmIChhY2Nlc3NvciAhPSBudWxsKSB7DQotICAgICAgICAgICAgICAgIGFjY2Vzc29yLmlu
Y3JlbWVudENhbGxDb3VudCh0aGlzKTsvLyBsZXRzIGVuc3VyZSB0aGF0IFRvcExpbmsgZG9lcyBu
b3QgcmVsZWFzZSB0aGlzIGNvbm5lY3Rpb24uDQotICAgICAgICAgICAgfSBlbHNlIHsvL3RoZSBh
Y2Nlc3NvciBpcyBiZWluZyByZWxlYXNlZA0KLSAgICAgICAgICAgICAgICB0aGlzLmFjY2Vzc29y
LmRlY3JlbWVudENhbGxDb3VudCgpOy8vIGxldCB0aGUgYWNjZXNzb3IgcmVsYXNlIHRoZSBjb25u
ZWN0aW9uDQotICAgICAgICAgICAgfQ0KLSAgICAgICAgfQ0KICAgICAgICAgdGhpcy5hY2Nlc3Nv
ciA9IGFjY2Vzc29yOw0KICAgICB9DQorDQorICAgIC8qKgorICAgICAqIElOVEVSTkFMOgorICAg
ICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBpbiBjYXNlIGV4dGVybmFsQ29ubmVjdGlvblBvb2xp
bmcgaXMgdXNlZAorICAgICAqIHJpZ2h0IGFmdGVyIHRoZSBhY2Nlc3NvciBpcyBjb25uZWN0ZWQu
IAorICAgICAqIFVzZWQgYnkgdGhlIHNlc3Npb24gdG8gcmlzZSBhbiBhcHByb3ByaWF0ZSBldmVu
dC4KKyAgICAgKi8KKyAgIHB1YmxpYyB2b2lkIHBvc3RDb25uZWN0RXh0ZXJuYWxDb25uZWN0aW9u
KEFjY2Vzc29yIGFjY2Vzc29yKSB7DQorICAgICAgICBnZXRFdmVudE1hbmFnZXIoKS5wb3N0QWNx
dWlyZUV4Y2x1c2l2ZUNvbm5lY3Rpb24odGhpcywgYWNjZXNzb3IpOworICAgIH0NCisKKyAgIC8q
KgorICAgICogSU5URVJOQUw6CisgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgaW4gY2FzZSBl
eHRlcm5hbENvbm5lY3Rpb25Qb29saW5nIGlzIHVzZWQKKyAgICAqIHJpZ2h0IGJlZm9yZSB0aGUg
YWNjZXNzb3IgaXMgZGlzY29ubmVjdGVkLiAKKyAgICAqIFVzZWQgYnkgdGhlIHNlc3Npb24gdG8g
cmlzZSBhbiBhcHByb3ByaWF0ZSBldmVudC4KKyAgICAqLworICAgcHVibGljIHZvaWQgcHJlRGlz
Y29ubmVjdEV4dGVybmFsQ29ubmVjdGlvbihBY2Nlc3NvciBhY2Nlc3NvcikgeworICAgICAgICBn
ZXRFdmVudE1hbmFnZXIoKS5wcmVSZWxlYXNlRXhjbHVzaXZlQ29ubmVjdGlvbih0aGlzLCBhY2Nl
c3Nvcik7CisgICAgfQ0KKworICAgLyoqCisgICAgKiBJTlRFUk5BTDoKKyAgICAqIFRoaXMgbWV0
aG9kIGlzIGNhbGxlZCBpbiBjYXNlIGV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcgaXMgdXNlZC4K
KyAgICAqIElmIHJldHVybnMgdHJ1ZSwgYWNjZXNzb3IgdXNlZCBieSB0aGUgc2Vzc2lvbiBrZWVw
cyBpdHMKKyAgICAqIGNvbm5lY3Rpb24gb3BlbiB1bnRpbCByZWxlYXNlZCBieSB0aGUgc2Vzc2lv
bi4gCisgICAgKi8KKyAgIHB1YmxpYyBib29sZWFuIGlzRXhjbHVzaXZlQ29ubmVjdGlvblJlcXVp
cmVkKCkgeworICAgICAgICByZXR1cm4gdHJ1ZTsNCisgICAgfQ0KIH0NClwgTm8gbmV3bGluZSBh
dCBlbmQgb2YgZmlsZQ0KSW5kZXg6IGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3Jn
L2VjbGlwc2UvcGVyc2lzdGVuY2Uvc2Vzc2lvbnMvc2VydmVyL0NsaWVudFNlc3Npb24uamF2YQ0K
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PQ0KLS0tIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlw
c2UvcGVyc2lzdGVuY2Uvc2Vzc2lvbnMvc2VydmVyL0NsaWVudFNlc3Npb24uamF2YQkocmV2aXNp
b24gNzU1MSkNCisrKyBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNl
L3BlcnNpc3RlbmNlL3Nlc3Npb25zL3NlcnZlci9DbGllbnRTZXNzaW9uLmphdmEJKHdvcmtpbmcg
Y29weSkNCkBAIC01MjksNCArNTI5LDI0IEBADQogICAgICAgICAvL2J1ZyA0NjY4MjM0IC0tIHVz
ZWQgdG8gb25seSByZWxlYXNlIGNvbm5lY3Rpb25zIG9uIHNlcnZlciBzZXNzaW9ucyBidXQgc2hv
dWxkIGFsd2F5cyByZWxlYXNlCiAgICAgICAgIGdldFBhcmVudCgpLnJlbGVhc2VSZWFkQ29ubmVj
dGlvbihjb25uZWN0aW9uKTsKICAgICB9CisKKyAgICAvKioKKyAgICAgKiBJTlRFUk5BTDoKKyAg
ICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgaW4gY2FzZSBleHRlcm5hbENvbm5lY3Rpb25Qb29s
aW5nIGlzIHVzZWQKKyAgICAgKiByaWdodCBhZnRlciB0aGUgYWNjZXNzb3IgaXMgY29ubmVjdGVk
LiAKKyAgICAgKiBVc2VkIGJ5IHRoZSBzZXNzaW9uIHRvIHJpc2UgYW4gYXBwcm9wcmlhdGUgZXZl
bnQuCisgICAgICovCisgICAgcHVibGljIHZvaWQgcG9zdENvbm5lY3RFeHRlcm5hbENvbm5lY3Rp
b24oQWNjZXNzb3IgYWNjZXNzb3IpIHsKKyAgICAgICAgZ2V0RXZlbnRNYW5hZ2VyKCkucG9zdEFj
cXVpcmVDb25uZWN0aW9uKGFjY2Vzc29yKTsKKyAgICB9CisKKyAgICAvKioKKyAgICAgKiBJTlRF
Uk5BTDoKKyAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgaW4gY2FzZSBleHRlcm5hbENvbm5l
Y3Rpb25Qb29saW5nIGlzIHVzZWQKKyAgICAgKiByaWdodCBiZWZvcmUgdGhlIGFjY2Vzc29yIGlz
IGRpc2Nvbm5lY3RlZC4gCisgICAgICogVXNlZCBieSB0aGUgc2Vzc2lvbiB0byByaXNlIGFuIGFw
cHJvcHJpYXRlIGV2ZW50LgorICAgICAqLworICAgIHB1YmxpYyB2b2lkIHByZURpc2Nvbm5lY3RF
eHRlcm5hbENvbm5lY3Rpb24oQWNjZXNzb3IgYWNjZXNzb3IpIHsKKyAgICAgICAgZ2V0RXZlbnRN
YW5hZ2VyKCkucHJlUmVsZWFzZUNvbm5lY3Rpb24oYWNjZXNzb3IpOworICAgIH0KIH0KSW5kZXg6
IGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lzdGVuY2Uv
c2Vzc2lvbnMvc2VydmVyL1NlcnZlclNlc3Npb24uamF2YQ0KPT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0tIGZvdW5k
YXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lzdGVuY2Uvc2Vzc2lv
bnMvc2VydmVyL1NlcnZlclNlc3Npb24uamF2YQkocmV2aXNpb24gNzU1MSkNCisrKyBmb3VuZGF0
aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL3Nlc3Npb25z
L3NlcnZlci9TZXJ2ZXJTZXNzaW9uLmphdmEJKHdvcmtpbmcgY29weSkNCkBAIC0yNTAsNyArMjUw
LDEwIEBADQogICAgICAgICAgICAgQ29ubmVjdGlvblBvb2wgcG9vbCA9IChDb25uZWN0aW9uUG9v
bClnZXRDb25uZWN0aW9uUG9vbHMoKS5nZXQoY2xpZW50U2Vzc2lvbi5nZXRDb25uZWN0aW9uUG9s
aWN5KCkuZ2V0UG9vbE5hbWUoKSk7CiAgICAgICAgICAgICBBY2Nlc3NvciBjb25uZWN0aW9uID0g
cG9vbC5hY3F1aXJlQ29ubmVjdGlvbigpOwogICAgICAgICAgICAgY2xpZW50U2Vzc2lvbi5zZXRX
cml0ZUNvbm5lY3Rpb24oY29ubmVjdGlvbik7Ci0gICAgICAgICAgICBnZXRFdmVudE1hbmFnZXIo
KS5wb3N0QWNxdWlyZUNvbm5lY3Rpb24oY29ubmVjdGlvbik7CisgICAgICAgICAgICAvL2lmIHdl
IGFyZSB1c2luZyBleHRlcm5hbCBjb25uZWN0aW9uIHBvb2xpbmcgdGhlIGV2ZW50IHdpbGwgYmUg
dGhyb3duIHdoZW4gdGhlIGNvbm5lY3Rpb24gaXMgYWN0dWFsbHkgYWNxdWlyZWQKKyAgICAgICAg
ICAgIGlmKCFjb25uZWN0aW9uLnVzZXNFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCkpIHsKKyAg
ICAgICAgICAgICAgICBnZXRFdmVudE1hbmFnZXIoKS5wb3N0QWNxdWlyZUNvbm5lY3Rpb24oY29u
bmVjdGlvbik7CisgICAgICAgICAgICB9CiAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICBp
ZiAodGhpcy5tYXhOdW1iZXJPZk5vblBvb2xlZENvbm5lY3Rpb25zICE9IE5PX01BWCkgewogICAg
ICAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewpAQCAtMjY5LDcgKzI3Miw5IEBADQog
ICAgICAgICB9CiAgICAgICAgIGlmIChjbGllbnRTZXNzaW9uLmdldENvbm5lY3Rpb25Qb2xpY3ko
KS5zaG91bGRVc2VFeGNsdXNpdmVDb25uZWN0aW9uKCkpIHsKICAgICAgICAgICAgIC8vaWYgd2Ug
YXJlIHVzaW5nIGV4dGVybmFsIGNvbm5lY3Rpb24gcG9vbGluZyB0aGUgZXZlbnQgd2lsbCBiZSB0
aHJvd24gd2hlbiB0aGUgY29ubmVjdGlvbiBpcyBhY3R1YWxseSBhY3F1aXJlZAotICAgICAgICAg
ICAgZ2V0RXZlbnRNYW5hZ2VyKCkucG9zdEFjcXVpcmVFeGNsdXNpdmVDb25uZWN0aW9uKGNsaWVu
dFNlc3Npb24sIGNsaWVudFNlc3Npb24uZ2V0V3JpdGVDb25uZWN0aW9uKCkpOworICAgICAgICAg
ICAgaWYoIWNsaWVudFNlc3Npb24uZ2V0V3JpdGVDb25uZWN0aW9uKCkudXNlc0V4dGVybmFsQ29u
bmVjdGlvblBvb2xpbmcoKSkgeworICAgICAgICAgICAgICAgIGdldEV2ZW50TWFuYWdlcigpLnBv
c3RBY3F1aXJlRXhjbHVzaXZlQ29ubmVjdGlvbihjbGllbnRTZXNzaW9uLCBjbGllbnRTZXNzaW9u
LmdldFdyaXRlQ29ubmVjdGlvbigpKTsKKyAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgIH0K
IApAQCAtNjE4LDcgKzYyMywxMCBAQA0KICAgICBwdWJsaWMgdm9pZCByZWxlYXNlQ2xpZW50U2Vz
c2lvbihDbGllbnRTZXNzaW9uIGNsaWVudFNlc3Npb24pIHRocm93cyBEYXRhYmFzZUV4Y2VwdGlv
biB7CiAgICAgICAgIGlmIChjbGllbnRTZXNzaW9uLmdldENvbm5lY3Rpb25Qb2xpY3koKS5pc1Bv
b2xlZCgpKSB7CiAgICAgICAgICAgICBDb25uZWN0aW9uUG9vbCBwb29sID0gKENvbm5lY3Rpb25Q
b29sKWdldENvbm5lY3Rpb25Qb29scygpLmdldChjbGllbnRTZXNzaW9uLmdldENvbm5lY3Rpb25Q
b2xpY3koKS5nZXRQb29sTmFtZSgpKTsKLSAgICAgICAgICAgIGdldEV2ZW50TWFuYWdlcigpLnBy
ZVJlbGVhc2VDb25uZWN0aW9uKGNsaWVudFNlc3Npb24uZ2V0V3JpdGVDb25uZWN0aW9uKCkpOwor
ICAgICAgICAgICAgLy9pZiB3ZSBhcmUgdXNpbmcgZXh0ZXJuYWwgY29ubmVjdGlvbiBwb29saW5n
IHRoZSBldmVudCB3aWxsIGJlIHRocm93biByaWdodCBiZWZvcmUgdGhlIGNvbm5lY3Rpb24gY2xv
c2VzLgorICAgICAgICAgICAgaWYoIWNsaWVudFNlc3Npb24uZ2V0V3JpdGVDb25uZWN0aW9uKCku
dXNlc0V4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcoKSkgeworICAgICAgICAgICAgICAgIGdldEV2
ZW50TWFuYWdlcigpLnByZVJlbGVhc2VDb25uZWN0aW9uKGNsaWVudFNlc3Npb24uZ2V0V3JpdGVD
b25uZWN0aW9uKCkpOworICAgICAgICAgICAgfQogICAgICAgICAgICAgcG9vbC5yZWxlYXNlQ29u
bmVjdGlvbihjbGllbnRTZXNzaW9uLmdldFdyaXRlQ29ubmVjdGlvbigpKTsKICAgICAgICAgICAg
IGNsaWVudFNlc3Npb24uc2V0V3JpdGVDb25uZWN0aW9uKG51bGwpOwogICAgICAgICB9IGVsc2Ug
ewpAQCAtNjMyLDggKzY0MCwxMCBAQA0KICAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgICAg
ICBpZiAoY2xpZW50U2Vzc2lvbi5nZXRDb25uZWN0aW9uUG9saWN5KCkuc2hvdWxkVXNlRXhjbHVz
aXZlQ29ubmVjdGlvbigpKSB7Ci0gICAgICAgICAgICAvL2lmIHdlIGFyZSB1c2luZyBleHRlcm5h
bCBjb25uZWN0aW9uIHBvb2xpbmcgdGhlIGV2ZW50IHdpbGwgYmUgdGhyb3duIHdoZW4gdGhlIGNv
bm5lY3Rpb24gaXMgYWN0dWFsbHkgcmVsZWFzZWQKLSAgICAgICAgICAgIGdldEV2ZW50TWFuYWdl
cigpLnByZVJlbGVhc2VFeGNsdXNpdmVDb25uZWN0aW9uKGNsaWVudFNlc3Npb24sIGNsaWVudFNl
c3Npb24uZ2V0V3JpdGVDb25uZWN0aW9uKCkpOworICAgICAgICAgICAgLy9pZiB3ZSBhcmUgdXNp
bmcgZXh0ZXJuYWwgY29ubmVjdGlvbiBwb29saW5nIHRoZSBldmVudCB3aWxsIGJlIHRocm93biBy
aWdodCBiZWZvcmUgdGhlIGNvbm5lY3Rpb24gY2xvc2VzLgorICAgICAgICAgICAgaWYoIWNsaWVu
dFNlc3Npb24uZ2V0V3JpdGVDb25uZWN0aW9uKCkudXNlc0V4dGVybmFsQ29ubmVjdGlvblBvb2xp
bmcoKSkgeworICAgICAgICAgICAgICAgIGdldEV2ZW50TWFuYWdlcigpLnByZVJlbGVhc2VFeGNs
dXNpdmVDb25uZWN0aW9uKGNsaWVudFNlc3Npb24sIGNsaWVudFNlc3Npb24uZ2V0V3JpdGVDb25u
ZWN0aW9uKCkpOworICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgfQogCg==
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>86617</attachid>
            <date>2008-01-10 16:29:00 -0500</date>
            <delta_ts>2008-01-10 16:29:43 -0500</delta_ts>
            <desc>The forgotten SequencingCallbackFactory - please disreguard the prev. attachment</desc>
            <filename>214826-214827_SeqCallbackFactory_080110.patch</filename>
            <type>text/plain</type>
            <size>1586</size>
            <attacher name="Andrei Ilitchev">andrei.ilitchev</attacher>
            
              <data encoding="base64">SW5kZXg6IGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lz
dGVuY2UvaW50ZXJuYWwvc2VxdWVuY2luZy9TZXF1ZW5jaW5nQ2FsbGJhY2tGYWN0b3J5LmphdmEN
Cj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT0NCi0tLSBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xp
cHNlL3BlcnNpc3RlbmNlL2ludGVybmFsL3NlcXVlbmNpbmcvU2VxdWVuY2luZ0NhbGxiYWNrRmFj
dG9yeS5qYXZhCShyZXZpc2lvbiAwKQ0KKysrIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9z
cmMvb3JnL2VjbGlwc2UvcGVyc2lzdGVuY2UvaW50ZXJuYWwvc2VxdWVuY2luZy9TZXF1ZW5jaW5n
Q2FsbGJhY2tGYWN0b3J5LmphdmEJKHJldmlzaW9uIDApDQpAQCAtMCwwICsxLDMxIEBADQorLyoq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioKKyAqIENvcHlyaWdodCAoYykgMTk5OCwgMjAwNyBPcmFjbGUu
IEFsbCByaWdodHMgcmVzZXJ2ZWQuCisgKiBUaGlzIHByb2dyYW0gYW5kIHRoZSBhY2NvbXBhbnlp
bmcgbWF0ZXJpYWxzIGFyZSBtYWRlIGF2YWlsYWJsZSB1bmRlciB0aGUKKyAqIHRlcm1zIG9mIHRo
ZSBFY2xpcHNlIFB1YmxpYyBMaWNlbnNlIHYxLjAsIHdoaWNoIGFjY29tcGFuaWVzIHRoaXMgZGlz
dHJpYnV0aW9uCisgKiBhbmQgaXMgYXZhaWxhYmxlIGF0IGh0dHA6Ly93d3cuZWNsaXBzZS5vcmcv
bGVnYWwvZXBsLXYxMC5odG1sLgorICoKKyAqIENvbnRyaWJ1dG9yczoKKyAqICAgICBPcmFjbGUg
LSBpbml0aWFsIEFQSSBhbmQgaW1wbGVtZW50YXRpb24gZnJvbSBPcmFjbGUgVG9wTGluaworICoq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKi8gIAorcGFja2FnZSBvcmcuZWNsaXBzZS5wZXJzaXN0ZW5jZS5p
bnRlcm5hbC5zZXF1ZW5jaW5nOworCisvKioKKyAqIDxwPgorICogPGI+UHVycG9zZTwvYj46IERl
ZmluZSBpbnRlcmZhY2UgZm9yIHNlcXVlbmNpbmcgY2FsbGJhY2sgZmFjdG9yeS4KKyAqIDxwPgor
ICogPGI+RGVzY3JpcHRpb248L2I+OiBJbnN0YW50aWF0ZWQgaW50ZXJuYWx5IGJ5IFNlcXVlbmNp
bmdNYW5hZ2VyLgorICogPHA+CisgKiA8Yj5SZXNwb25zaWJpbGl0aWVzPC9iPjoKKyAqIDx1bD4K
KyAqIDxsaT4gUHJvdmlkZXMgc2VxdWVuY2luZyBjYWxsYmFjayB0byBiZSBjYWxsZWQgYWZ0ZXIg
dHJhbnNhY3Rpb24gaGFzIGNvbW1pdHRlZC4KKyAqIDwvdWw+CisgKiBAc2VlIG9yZy5lY2xpcHNl
LnBlcnNpc3RlbmNlLnNlcXVlbmNpbmcuU2VxdWVuY2luZ0NvbnRyb2wKKyAqLworcHVibGljIGlu
dGVyZmFjZSBTZXF1ZW5jaW5nQ2FsbGJhY2tGYWN0b3J5IHsKKworICAgIC8qKgorICAgICogSU5U
RVJOQUw6CisgICAgKiBDcmVhdGUgU2VxdWVuY2luZ0NhbGxiYWNrLgorICAgICovCisgICAgU2Vx
dWVuY2luZ0NhbGxiYWNrIGNyZWF0ZVNlcXVlbmNpbmdDYWxsYmFjaygpOworfQo=
</data>

          </attachment>
      

    </bug>

</bugzilla>