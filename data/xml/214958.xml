<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.1"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>214958</bug_id>
          
          <creation_ts>2008-01-10 15:57:00 -0500</creation_ts>
          <short_desc>bad timing of postConnect and preRelease events if externalConnectionPooling is used</short_desc>
          <delta_ts>2009-09-15 10:56:16 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>12</classification_id>
          <classification>RT</classification>
          <product>EclipseLink</product>
          <component>Foundation</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>Fixed in 1.0M4</status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>1.0</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Andrei Ilitchev">andrei.ilitchev</reporter>
          <assigned_to name="Project Inbox">eclipselink.foundation-inbox</assigned_to>
          <cc>peter.krogh</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>1129262</commentid>
    <comment_count>0</comment_count>
    <who name="Andrei Ilitchev">andrei.ilitchev</who>
    <bug_when>2008-01-10 15:57:54 -0500</bug_when>
    <thetext>For both ClientSession and ExclusiveIsolatedClientSession in case external connection pooling is used, the events thrown when the actual connection either not yet opened or already closed. That precludes users from running sql in these events (for instance to setup VPD).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1129289</commentid>
    <comment_count>1</comment_count>
      <attachid>86615</attachid>
    <who name="Andrei Ilitchev">andrei.ilitchev</who>
    <bug_when>2008-01-10 16:26:16 -0500</bug_when>
    <thetext>Created attachment 86615
The suggested fix</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1129718</commentid>
    <comment_count>2</comment_count>
      <attachid>86682</attachid>
    <who name="Andrei Ilitchev">andrei.ilitchev</who>
    <bug_when>2008-01-11 11:20:05 -0500</bug_when>
    <thetext>Created attachment 86682
the revised patch, please ignore the previous one.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1129778</commentid>
    <comment_count>3</comment_count>
    <who name="Andrei Ilitchev">andrei.ilitchev</who>
    <bug_when>2008-01-11 12:09:47 -0500</bug_when>
    <thetext>fixed</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>86615</attachid>
            <date>2008-01-10 16:26:00 -0500</date>
            <delta_ts>2008-01-10 16:26:16 -0500</delta_ts>
            <desc>The suggested fix</desc>
            <filename>214958_080110.patch</filename>
            <type>text/plain</type>
            <size>18856</size>
            <attacher name="Andrei Ilitchev">andrei.ilitchev</attacher>
            
              <data encoding="base64">SW5kZXg6IGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lz
dGVuY2UvaW50ZXJuYWwvZGF0YWJhc2VhY2Nlc3MvRGF0YXNvdXJjZUFjY2Vzc29yLmphdmENCj09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT0NCi0tLSBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNl
L3BlcnNpc3RlbmNlL2ludGVybmFsL2RhdGFiYXNlYWNjZXNzL0RhdGFzb3VyY2VBY2Nlc3Nvci5q
YXZhCShyZXZpc2lvbiA3NTUxKQ0KKysrIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMv
b3JnL2VjbGlwc2UvcGVyc2lzdGVuY2UvaW50ZXJuYWwvZGF0YWJhc2VhY2Nlc3MvRGF0YXNvdXJj
ZUFjY2Vzc29yLmphdmEJKHdvcmtpbmcgY29weSkNCkBAIC05Niw4ICs5NiwzMyBAQA0KICAgICAg
KiAgYWZ0ZXIgdHJhbnNhY3Rpb24gaXMgY29tcGxldGVkIHRoZSBjYWxsYmFjayBpcyBkaXNjYXJk
ZWQuCiAgICAgICovCiAgICAgcHJvdGVjdGVkIHRyYW5zaWVudCBTZXF1ZW5jaW5nQ2FsbGJhY2sg
c2VxdWVuY2luZ0NhbGxiYWNrOworICAgIAorICAgIC8qKgorICAgICAqICBVc2VkIG9ubHkgaW4g
ZXh0ZXJuYWxDb25uZWN0aW9uUG9vbGluZyBjYXNlLiBJbmRpY2F0ZXMgd2hpY2ggc2Vzc2lvbiBp
cyBjdXJyZW50bHkgdXNpbmcgY29ubmVjdGlvbi4KKyAgICAgKiAgQWxsb3dzIHRvIHJpc2UgYXBw
cm9wcmlhdGUgc2Vzc2lvbidzIGV2ZW50IHdoZW4gY29ubmVjdGlvbiBpcyBhbHJlYWR5L3N0aWxs
IGFsaXZlLgorICAgICAqICBFdmVudHMgd2lsbCBiZSByaXNlbiB3aGVuIENsaWVudFNlc3Npb24g
b3IgRGF0YWJhc2VTZXNzaW9uIGFjcXVpcmVzIGNvbm5lY3Rpb24gaW4gdGhlIGJlZ2lubmluZwor
ICAgICAqICBhbmQgcmVsZWFzZXMgY29ubmVjdGlvbiBpbiB0aGUgZW5kIG9mIHRyYW5zYWN0aW9u
IChpbiBhZnRlckNvbXBsZXRpb24gaW4ganRhIGNhc2UpLgorICAgICAqICBJbiBjYXNlIHRoZSBz
ZXNzaW9uIHJlcXVpcmVzIGV4Y2x1c2l2ZSBjb25uZWN0aW9uIChFeGNsdXNpdmVJc29sYXRlZENs
aWVudFNlc3Npb24pIHRoZSBldmVudHMKKyAgICAgKiAgd2lsbCBiZSByaXNlbiBldmVyeSB0aW1l
IHRoZSBzZXNzaW9uIGFjcXVpcmVzIG9yIHJlbGVhc2VzIGNvbm5lY3Rpb24gLQorICAgICAqICB3
aGljaCBpcyBhIHJhcmUgZXZlbnQgLSB0aGUgY29ubmVjdGlvbiBpcyBrZXB0IGZvciB0aGUgZHVy
YXRpb24gb2YganRhIHRyYW5zYWN0aW9uLAorICAgICAqICBhZnRlciBqdGEgdHJhbnNhY3Rpb24g
aXMgY29tcGxldGVkIHRoZSBuZXcgY29ubmVjdGlvbiBpcyBhY3F1aXJlZCBvbiBhIGZpcnN0IHF1
ZXJ5IGV4ZWN1dGlvbgorICAgICAqICBhbmQga2VwdCB1bnRpbCB0aGUgbmV4dCBiZWdpblRyYW5z
YWN0aW9uIGNhbGwuCisgICAgICogIEluIG5vbi1qdGEgY2FzZSB0aGUgY29ubmVjdGlvbiBpcyBh
Y3F1aXJlZCBmb3Igc2Vzc2lvbidzIGxpZmUgYW5kIHJlbGVhc2Ugb25seSBieSBzZXNzaW9uJ3Mg
cmVsZWFzZS4KKyAgICAgKiAgTm90ZSB0aGF0IHRoZSBhdHRyaWJ1dGUgaXMgbnVsbGlmaWVkIG9u
bHkgaW4gb25lIHBsYWNlIC0gYnkgY2xvc2VDb25uZWN0aW9uIG1ldGhvZC4KKyAgICAgKi8KKyAg
ICBwcm90ZWN0ZWQgdHJhbnNpZW50IEFic3RyYWN0U2Vzc2lvbiBjdXJyZW50U2Vzc2lvbjsKIAog
ICAgIC8qKgorICAgICAqICBJbmRpY2F0ZXMgdGhhdCBpc0luVHJhbnNhY3Rpb24gZmxhZyBpcyBh
Ym91dCB0byBjaGFuZ2UgZnJvbSBmYWxzZSB0byB0cnVlLgorICAgICAqLworICAgIHByb3RlY3Rl
ZCB0cmFuc2llbnQgYm9vbGVhbiBpc0JlZ2lubmluZ1RyYW5zYWN0aW9uOworCisgICAgLyoqCisg
ICAgICogIEluZGljYXRlcyB0aGF0IGlzSW5UcmFuc2FjdGlvbiBmbGFnIGlzIGFib3V0IHRvIGNo
YW5nZSBmcm9tIHRydWUgdG8gZmFsc2UKKyAgICAgKi8KKyAgICBwcm90ZWN0ZWQgdHJhbnNpZW50
IGJvb2xlYW4gaXNDb21wbGV0aW5nVHJhbnNhY3Rpb247CisKKyAgICAvKioKICAgICAgKiAgICBE
ZWZhdWx0IENvbnN0cnVjdG9yLgogICAgICAqLwogICAgIHB1YmxpYyBEYXRhc291cmNlQWNjZXNz
b3IoKSB7CkBAIC0xNDIsNyArMTY3LDcgQEANCiAgICAgfQogCiAgICAgLyoqCi0gICAgICogVGhp
cyBzaG91bGQgYmUgc2V0IHRvIGZhbHNlIGlmIGEgY29tbXVuaWNhdGlvbiBmYWlsdXJlIG9jY3Vy
cmVkIGR1cnJpbmcgYSBjYWxsIGV4ZWN1dGlvbi4gIAorICAgICAqIFRoaXMgc2hvdWxkIGJlIHNl
dCB0byBmYWxzZSBpZiBhIGNvbW11bmljYXRpb24gZmFpbHVyZSBvY2N1cnJlZCBkdXJpbmcgYSBj
YWxsIGV4ZWN1dGlvbi4gIAogICAgICAqIEluIHRoZSBjYXNlIG9mIGFuIGludmFsaWQgYWNjZXNz
b3IgdGhlIEFjY2Vzc29yIHdpbGwgbm90IGJlIHJldHVybmVkIHRvIHRoZSBwb29sLgogICAgICAq
LwogICAgIHB1YmxpYyB2b2lkIHNldElzVmFsaWQoYm9vbGVhbiBpc1ZhbGlkKXsKQEAgLTE1OCw3
ICsxODMsNyBAQA0KIAogICAgIC8qKgogICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIEFjY2Vz
c29yIGNhbiBjb250aW51ZSB0byBiZSB1c2VkLiAgVGhpcyB3aWxsIGJlIGZhbHNlIGlmIGEgY29t
bXVuaWNhdGlvbgotICAgICAqIGZhaWx1cmUgb2NjdXJyZWQgZHVycmluZyBhIGNhbGwgZXhlY3V0
aW9uLiAgSW4gdGhlIGNhc2Ugb2YgYW4gaW52YWxpZCBhY2Nlc3NvciB0aGUgQWNjZXNzb3IKKyAg
ICAgKiBmYWlsdXJlIG9jY3VycmVkIGR1cmluZyBhIGNhbGwgZXhlY3V0aW9uLiAgSW4gdGhlIGNh
c2Ugb2YgYW4gaW52YWxpZCBhY2Nlc3NvciB0aGUgQWNjZXNzb3IKICAgICAgKiB3aWxsIG5vdCBi
ZSByZXR1cm5lZCB0byB0aGUgcG9vbC4KICAgICAgKi8KICAgICBwdWJsaWMgYm9vbGVhbiBpc1Zh
bGlkKCl7CkBAIC0xODAsNiArMjA1LDkgQEANCiAgICAgICovCiAgICAgcHVibGljIHZvaWQgYmVn
aW5UcmFuc2FjdGlvbihBYnN0cmFjdFNlc3Npb24gc2Vzc2lvbikgdGhyb3dzIERhdGFiYXNlRXhj
ZXB0aW9uIHsKICAgICAgICAgaWYgKHVzZXNFeHRlcm5hbFRyYW5zYWN0aW9uQ29udHJvbGxlcigp
KSB7CisgICAgICAgICAgICBpZihzZXNzaW9uLmlzRXhjbHVzaXZlQ29ubmVjdGlvblJlcXVpcmVk
KCkgJiYgIWlzSW5UcmFuc2FjdGlvbigpICYmIHVzZXNFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5n
KCkpIHsKKyAgICAgICAgICAgICAgICBjbG9zZUNvbm5lY3Rpb24oKTsKKyAgICAgICAgICAgIH0K
ICAgICAgICAgICAgIHNldElzSW5UcmFuc2FjdGlvbih0cnVlKTsKICAgICAgICAgICAgIHJldHVy
bjsKICAgICAgICAgfQpAQCAtMTg4LDEwICsyMTYsMTIgQEANCiAKICAgICAgICAgdHJ5IHsKICAg
ICAgICAgICAgIHNlc3Npb24uc3RhcnRPcGVyYXRpb25Qcm9maWxlKFNlc3Npb25Qcm9maWxlci5U
UkFOU0FDVElPTik7CisgICAgICAgICAgICBpc0JlZ2lubmluZ1RyYW5zYWN0aW9uID0gdHJ1ZTsK
ICAgICAgICAgICAgIGluY3JlbWVudENhbGxDb3VudChzZXNzaW9uKTsKICAgICAgICAgICAgIGJh
c2ljQmVnaW5UcmFuc2FjdGlvbihzZXNzaW9uKTsKICAgICAgICAgICAgIHNldElzSW5UcmFuc2Fj
dGlvbih0cnVlKTsKICAgICAgICAgfSBmaW5hbGx5IHsKKyAgICAgICAgICAgIGlzQmVnaW5uaW5n
VHJhbnNhY3Rpb24gPSBmYWxzZTsKICAgICAgICAgICAgIGRlY3JlbWVudENhbGxDb3VudCgpOwog
ICAgICAgICAgICAgc2Vzc2lvbi5lbmRPcGVyYXRpb25Qcm9maWxlKFNlc3Npb25Qcm9maWxlci5U
UkFOU0FDVElPTik7CiAgICAgICAgIH0KQEAgLTIyMiw3ICsyNTIsNyBAQA0KICAgICAgICAgICAg
IHJldHVybjsKICAgICAgICAgfQogICAgICAgICBzZXRDYWxsQ291bnQoY291bnQgLSAxKTsKLSAg
ICAgICAgaWYgKHVzZXNFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCkgJiYgKCFpc0luVHJhbnNh
Y3Rpb24oKSkgJiYgKGNvdW50ID09IDEpKSB7CisgICAgICAgIGlmICh1c2VzRXh0ZXJuYWxDb25u
ZWN0aW9uUG9vbGluZygpICYmICghaXNJblRyYW5zYWN0aW9uKCkpICYmIChjdXJyZW50U2Vzc2lv
biA9PSBudWxsIHx8ICFjdXJyZW50U2Vzc2lvbi5pc0V4Y2x1c2l2ZUNvbm5lY3Rpb25SZXF1aXJl
ZCgpKSAmJiAoY291bnQgPT0gMSkpIHsKICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg
ICAgY2xvc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgICB9IGNhdGNoIChEYXRhYmFzZUV4Y2Vw
dGlvbiBpZ25vcmUpIHsKQEAgLTI1Niw2ICsyODYsMTYgQEANCiAgICAgICAgICAgICAgICAgLy8g
SWYgRXh0ZXJuYWxDb25uZWN0aW9uUG9vbGluZyBpcyB1c2VkLCB0aGUgY29ubmVjdGlvbiBjYW4g
YmUgcmUtZXN0YWJsaXNoZWQuCiAgICAgICAgICAgICAgICAgaWYgKHVzZXNFeHRlcm5hbENvbm5l
Y3Rpb25Qb29saW5nKCkpIHsKICAgICAgICAgICAgICAgICAgICAgcmVjb25uZWN0KHNlc3Npb24p
OworICAgICAgICAgICAgICAgICAgICAvLyBlaXRoZXIgdHJhbnNhY3Rpb24gaXMgc3RhcnRpbmcg
KHRoZSBtZXRob2QgaXMgY2FsbGVkIGZyb20gYmVnaW5UcmFuc2FjdGlvbiwgbm8gZXh0ZXJuYWxU
cmFuc2FjdGlvbkNvbnRyb2xsZXIgY2FzZSkKKyAgICAgICAgICAgICAgICAgICAgLy8gb3IgdGhl
IGNvbm5lY3Rpb24gaXMgcmVxdWlyZWQgZm9yIHRoZSBzZXNzaW9uIHdoaWNoIGlzCisgICAgICAg
ICAgICAgICAgICAgIC8vICAgZWl0aGVyIGluIHRyYW5zYWN0aW9uIGFscmVhZHkgKHdpbGwgaGFw
cGVuIGluIGV4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVyIGNhc2UpOworICAgICAgICAgICAg
ICAgICAgICAvLyAgIG9yIHJlcXVpcmVzIGV4Y2x1c2l2ZSBjb25uZWN0aW9uLgorICAgICAgICAg
ICAgICAgICAgICBpZihpc0JlZ2lubmluZ1RyYW5zYWN0aW9uIHx8IGlzSW5UcmFuc2FjdGlvbigp
IHx8IHNlc3Npb24uaXNFeGNsdXNpdmVDb25uZWN0aW9uUmVxdWlyZWQoKSkgeworICAgICAgICAg
ICAgICAgICAgICAgICAgc2Vzc2lvbi5wb3N0Q29ubmVjdEV4dGVybmFsQ29ubmVjdGlvbih0aGlz
KTsKKyAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTZXNzaW9uID0gc2Vzc2lvbjsKKyAg
ICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKGlzQ29tcGxldGluZ1RyYW5zYWN0aW9uKSB7Cisg
ICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U2Vzc2lvbiA9IHNlc3Npb247CisgICAgICAg
ICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg
ICAgICB0aHJvdyBEYXRhYmFzZUV4Y2VwdGlvbi5kYXRhYmFzZUFjY2Vzc29yTm90Q29ubmVjdGVk
KCk7CiAgICAgICAgICAgICAgICAgfQpAQCAtMjY0LDcgKzMwNCw3IEBADQogICAgIH0KIAogICAg
IC8qKgotICAgICAqIFJlc2V0IHN0YXRtZW50IGNvdW50LgorICAgICAqIFJlc2V0IHN0YXRlbWVu
dCBjb3VudC4KICAgICAgKi8KICAgICBwdWJsaWMgdm9pZCByZXNldFN0YXRtZW50c0NvdW50KCkg
ewogICAgICAgICByZWFkU3RhdGVtZW50c0NvdW50PTA7CkBAIC0zMTUsNiArMzU1LDggQEANCiAg
ICAgICAgICAgICBpZiAoIXNlc3Npb24uaXNTeW5jaHJvbml6ZWQoKSkgewogICAgICAgICAgICAg
ICAgIHNldElzSW5UcmFuc2FjdGlvbihmYWxzZSk7CiAgICAgICAgICAgICAgICAgaWYgKHVzZXNF
eHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCkpIHsKKyAgICAgICAgICAgICAgICAgICAgLy8gY2xv
c2VDb25uZWN0aW9uIG1ldGhvZCB1c2VzIGN1cnJlbnRTZXNzaW9uIGFuZCB0aGVuIHNldHMgaXQg
dG8gbnVsbC4KKyAgICAgICAgICAgICAgICAgICAgY3VycmVudFNlc3Npb24gPSBzZXNzaW9uOwog
ICAgICAgICAgICAgICAgICAgICBjbG9zZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgICAgICB9
CiAgICAgICAgICAgICB9CkBAIC0zMjUsNiArMzY3LDcgQEANCiAKICAgICAgICAgdHJ5IHsKICAg
ICAgICAgICAgIHNlc3Npb24uc3RhcnRPcGVyYXRpb25Qcm9maWxlKFNlc3Npb25Qcm9maWxlci5U
UkFOU0FDVElPTik7CisgICAgICAgICAgICBpc0NvbXBsZXRpbmdUcmFuc2FjdGlvbiA9IHRydWU7
CiAgICAgICAgICAgICBpbmNyZW1lbnRDYWxsQ291bnQoc2Vzc2lvbik7CiAgICAgICAgICAgICBi
YXNpY0NvbW1pdFRyYW5zYWN0aW9uKHNlc3Npb24pOwogCkBAIC0zMzMsNiArMzc2LDcgQEANCiAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICBzZXRJc0luVHJhbnNhY3Rpb24oZmFsc2UpOwogICAg
ICAgICB9IGZpbmFsbHkgeworICAgICAgICAgICAgaXNDb21wbGV0aW5nVHJhbnNhY3Rpb24gPSBm
YWxzZTsKICAgICAgICAgICAgIHNlcXVlbmNpbmdDYWxsYmFjayA9IG51bGw7CiAgICAgICAgICAg
ICBkZWNyZW1lbnRDYWxsQ291bnQoKTsKICAgICAgICAgICAgIHNlc3Npb24uZW5kT3BlcmF0aW9u
UHJvZmlsZShTZXNzaW9uUHJvZmlsZXIuVFJBTlNBQ1RJT04pOwpAQCAtNDI3LDYgKzQ3MSw5IEBA
DQogICAgICAgICB0cnkgewogICAgICAgICAgICAgaWYgKGdldERhdGFzb3VyY2VDb25uZWN0aW9u
KCkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgIGlmIChpc0RhdGFzb3VyY2VDb25uZWN0ZWQo
KSkgeworICAgICAgICAgICAgICAgICAgICBpZihjdXJyZW50U2Vzc2lvbiAhPSBudWxsKSB7Cisg
ICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U2Vzc2lvbi5wcmVEaXNjb25uZWN0RXh0ZXJu
YWxDb25uZWN0aW9uKHRoaXMpOworICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg
ICAgICAgIGNsb3NlRGF0YXNvdXJjZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgICAgICB9CiAg
ICAgICAgICAgICAgICAgc2V0RGF0YXNvdXJjZUNvbm5lY3Rpb24obnVsbCk7CkBAIC00MzQsNiAr
NDgxLDggQEANCiAgICAgICAgIH0gY2F0Y2ggKERhdGFiYXNlRXhjZXB0aW9uIGV4Y2VwdGlvbikg
ewogICAgICAgICAgICAgLy8gSWdub3JlCiAgICAgICAgICAgICBzZXREYXRhc291cmNlQ29ubmVj
dGlvbihudWxsKTsKKyAgICAgICAgfSBmaW5hbGx5IHsKKyAgICAgICAgICAgIGN1cnJlbnRTZXNz
aW9uID0gbnVsbDsKICAgICAgICAgfQogICAgIH0KIApAQCAtNTc0LDYgKzYyMyw4IEBADQogICAg
ICAgICAgICAgaWYgKCFzZXNzaW9uLmlzU3luY2hyb25pemVkKCkpIHsKICAgICAgICAgICAgICAg
ICBzZXRJc0luVHJhbnNhY3Rpb24oZmFsc2UpOwogICAgICAgICAgICAgICAgIGlmICh1c2VzRXh0
ZXJuYWxDb25uZWN0aW9uUG9vbGluZygpKSB7CisgICAgICAgICAgICAgICAgICAgIC8vIGNsb3Nl
Q29ubmVjdGlvbiBtZXRob2QgdXNlcyBjdXJyZW50U2Vzc2lvbiBhbmQgdGhlbiBzZXRzIGl0IHRv
IG51bGwuCisgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTZXNzaW9uID0gc2Vzc2lvbjsKICAg
ICAgICAgICAgICAgICAgICAgY2xvc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgfQog
ICAgICAgICAgICAgfQpAQCAtNTg0LDEwICs2MzUsMTIgQEANCiAKICAgICAgICAgdHJ5IHsKICAg
ICAgICAgICAgIHNlc3Npb24uc3RhcnRPcGVyYXRpb25Qcm9maWxlKFNlc3Npb25Qcm9maWxlci5U
UkFOU0FDVElPTik7CisgICAgICAgICAgICBpc0NvbXBsZXRpbmdUcmFuc2FjdGlvbiA9IHRydWU7
CiAgICAgICAgICAgICBpbmNyZW1lbnRDYWxsQ291bnQoc2Vzc2lvbik7CiAgICAgICAgICAgICBi
YXNpY1JvbGxiYWNrVHJhbnNhY3Rpb24oc2Vzc2lvbik7CiAgICAgICAgIH0gZmluYWxseSB7CiAg
ICAgICAgICAgICBzZXRJc0luVHJhbnNhY3Rpb24oZmFsc2UpOworICAgICAgICAgICAgaXNDb21w
bGV0aW5nVHJhbnNhY3Rpb24gPSBmYWxzZTsKICAgICAgICAgICAgIHNlcXVlbmNpbmdDYWxsYmFj
ayA9IG51bGw7CiAgICAgICAgICAgICBkZWNyZW1lbnRDYWxsQ291bnQoKTsKICAgICAgICAgICAg
IHNlc3Npb24uZW5kT3BlcmF0aW9uUHJvZmlsZShTZXNzaW9uUHJvZmlsZXIuVFJBTlNBQ1RJT04p
OwpJbmRleDogZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJz
aXN0ZW5jZS9pbnRlcm5hbC9zZXNzaW9ucy9BYnN0cmFjdFNlc3Npb24uamF2YQ0KPT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PQ0KLS0tIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lz
dGVuY2UvaW50ZXJuYWwvc2Vzc2lvbnMvQWJzdHJhY3RTZXNzaW9uLmphdmEJKHJldmlzaW9uIDc1
NTEpDQorKysgZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJz
aXN0ZW5jZS9pbnRlcm5hbC9zZXNzaW9ucy9BYnN0cmFjdFNlc3Npb24uamF2YQkod29ya2luZyBj
b3B5KQ0KQEAgLTM1MDEsNCArMzUwMSwzMiBAQA0KICAgICAgICAgICAgIH0KICAgICAgICAgfQog
ICAgIH0KKworICAgIC8qKgorICAgICAqIElOVEVSTkFMOgorICAgICAqIFRoaXMgbWV0aG9kIGlz
IGNhbGxlZCBpbiBjYXNlIGV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcgaXMgdXNlZAorICAgICAq
IHJpZ2h0IGFmdGVyIHRoZSBhY2Nlc3NvciBpcyBjb25uZWN0ZWQuIAorICAgICAqIFVzZWQgYnkg
dGhlIHNlc3Npb24gdG8gcmlzZSBhbiBhcHByb3ByaWF0ZSBldmVudC4KKyAgICAgKi8KKyAgICBw
dWJsaWMgdm9pZCBwb3N0Q29ubmVjdEV4dGVybmFsQ29ubmVjdGlvbihBY2Nlc3NvciBhY2Nlc3Nv
cikgeworICAgIH0KKworICAgIC8qKgorICAgICAqIElOVEVSTkFMOgorICAgICAqIFRoaXMgbWV0
aG9kIGlzIGNhbGxlZCBpbiBjYXNlIGV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcgaXMgdXNlZAor
ICAgICAqIHJpZ2h0IGJlZm9yZSB0aGUgYWNjZXNzb3IgaXMgZGlzY29ubmVjdGVkLiAKKyAgICAg
KiBVc2VkIGJ5IHRoZSBzZXNzaW9uIHRvIHJpc2UgYW4gYXBwcm9wcmlhdGUgZXZlbnQuCisgICAg
ICovCisgICAgcHVibGljIHZvaWQgcHJlRGlzY29ubmVjdEV4dGVybmFsQ29ubmVjdGlvbihBY2Nl
c3NvciBhY2Nlc3NvcikgeworICAgIH0KKyAgICAKKyAgICAvKioKKyAgICAgKiBJTlRFUk5BTDoK
KyAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgaW4gY2FzZSBleHRlcm5hbENvbm5lY3Rpb25Q
b29saW5nIGlzIHVzZWQuCisgICAgICogSWYgcmV0dXJucyB0cnVlLCBhY2Nlc3NvciB1c2VkIGJ5
IHRoZSBzZXNzaW9uIGtlZXBzIGl0cworICAgICAqIGNvbm5lY3Rpb24gb3BlbiB1bnRpbCByZWxl
YXNlZCBieSB0aGUgc2Vzc2lvbi4gCisgICAgICovCisgICAgcHVibGljIGJvb2xlYW4gaXNFeGNs
dXNpdmVDb25uZWN0aW9uUmVxdWlyZWQoKSB7CisgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICB9
CiB9CkluZGV4OiBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3Bl
cnNpc3RlbmNlL2ludGVybmFsL3Nlc3Npb25zL0V4Y2x1c2l2ZUlzb2xhdGVkQ2xpZW50U2Vzc2lv
bi5qYXZhDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09DQotLS0gZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9v
cmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9pbnRlcm5hbC9zZXNzaW9ucy9FeGNsdXNpdmVJc29sYXRl
ZENsaWVudFNlc3Npb24uamF2YQkocmV2aXNpb24gNzU1MSkNCisrKyBmb3VuZGF0aW9uL2VjbGlw
c2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL2ludGVybmFsL3Nlc3Npb25z
L0V4Y2x1c2l2ZUlzb2xhdGVkQ2xpZW50U2Vzc2lvbi5qYXZhCSh3b3JraW5nIGNvcHkpDQpAQCAt
MjQsNTMgKzI0LDYgQEANCiANCiAgICAgLyoqDQogICAgICAqIElOVEVSTkFMOg0KLSAgICAgKiBU
aGlzIGlzIGludGVybmFsIHRvIHRoZSB1bml0IG9mIHdvcmsgYW5kIHNob3VsZCBuZXZlciBiZSBj
YWxsZWQgb3RoZXJ3aXNlLg0KLSAgICAgKi8NCi0gICAgcHVibGljIHZvaWQgYmFzaWNCZWdpblRy
YW5zYWN0aW9uKCkgew0KLSAgICAgICAgLy9pZiB3ZSBhcmUgYmVnaW5pbmcgdGhlIHRyYW5zYWN0
aW9uIHRoZW4gd2Ugc2hvdWxkIGFsbG93IHRoZSBhY2Nlc3NvciB0bw0KLSAgICAgICAgLy9yZWxl
YXNlIHRoZSBjb25uZWN0aW9uIGFuZCByZS1hY3F1aXJlIGEgbmV3IG9uZS4gIFRoaXMgaXMgdXNl
ZnVsbCBpbg0KLSAgICAgICAgLy90aGUgY2FzZSBvZiBleHRlcm5hbCBjb25uZWN0aW9uIHBvb2xz
IHdpdGggSlRBLg0KLSAgICAgICAgaWYgKCh0aGlzLmdldFdyaXRlQ29ubmVjdGlvbigpICE9IG51
bGwpICYmIHRoaXMuZ2V0TG9naW4oKS5zaG91bGRVc2VFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5n
KCkpIHsNCi0gICAgICAgICAgICAvLyBsZXQgdGhlIHVzZXIgcmVtb3ZlIHRoZSBwcml2bGVkZ2Vz
DQotICAgICAgICAgICAgZ2V0RXZlbnRNYW5hZ2VyKCkucHJlUmVsZWFzZUV4Y2x1c2l2ZUNvbm5l
Y3Rpb24odGhpcywgdGhpcy5nZXRXcml0ZUNvbm5lY3Rpb24oKSk7DQotICAgICAgICAgICAgLy9s
ZXQgdGhlIGFjY2Vzc29yIHJlbGVhc2UgdGhlIGNvbm5lY3Rpb24NCi0gICAgICAgICAgICB0aGlz
LmdldFdyaXRlQ29ubmVjdGlvbigpLmRlY3JlbWVudENhbGxDb3VudCgpOw0KLSAgICAgICAgICAg
IC8vbWFrZSB0aGUgYWNjZXNzb3IgcmUtYWNxdWlyZSBhIG5ldyBjb25uZWN0aW9uLiAgVGhpcyBz
dXBwb3J0cyB0aGUgY2FzZQ0KLSAgICAgICAgICAgIC8vd2hlcmUgYSBKVEEgdHJhbnNhY3Rpb24g
d2FzIHN0YXJ0ZWQgc2luY2UgdGhlIGNsaWVudCBzZXNzaW9uIHdhcyBmaXJzdCBhY3F1aXJlZC4N
Ci0gICAgICAgICAgICB0aGlzLmdldFdyaXRlQ29ubmVjdGlvbigpLmluY3JlbWVudENhbGxDb3Vu
dCh0aGlzKTsNCi0gICAgICAgICAgICAvLyBsZXQgdGhlIHVzZXIgdXBkYXRlIHRoZSBjb25uZWN0
aW9uIHdpdGggcmVxdWlyZWQgcHJpdmxlZGdlcy4NCi0gICAgICAgICAgICBnZXRFdmVudE1hbmFn
ZXIoKS5wb3N0QWNxdWlyZUV4Y2x1c2l2ZUNvbm5lY3Rpb24odGhpcywgdGhpcy5nZXRXcml0ZUNv
bm5lY3Rpb24oKSk7DQotICAgICAgICB9DQotICAgICAgICBzdXBlci5iYXNpY0JlZ2luVHJhbnNh
Y3Rpb24oKTsNCi0gICAgfQ0KLQ0KLSAgICAvKioNCi0gICAgICogSU5URVJOQUw6DQotICAgICAq
IFRoaXMgaXMgaW50ZXJuYWwgdG8gdGhlIHVuaXQgb2Ygd29yayBhbmQgc2hvdWxkIG5vdCBiZSBj
YWxsZWQgb3RoZXJ3aXNlLg0KLSAgICAgKi8NCi0gICAgcHVibGljIHZvaWQgYmFzaWNDb21taXRU
cmFuc2FjdGlvbigpIHsNCi0gICAgICAgIC8vaWYgd2UgYXJlIGVuZGluZyB0aGUgdHJhbnNhY3Rp
b24gdGhlbiB3ZSBzaG91bGQgYWxsb3cgdGhlIGFjY2Vzc29yIHRvDQotICAgICAgICAvL3JlbGVh
c2UgdGhlIGNvbm5lY3Rpb24gYW5kIHJlLWFjcXVpcmUgYSBuZXcgb25lLiAgVGhpcyBpcyB1c2Vm
dWxsIGluDQotICAgICAgICAvL3RoZSBjYXNlIG9mIGV4dGVybmFsIGNvbm5lY3Rpb24gcG9vbHMg
d2l0aCBKVEEuDQotICAgICAgICBpZiAoKHRoaXMuZ2V0V3JpdGVDb25uZWN0aW9uKCkgIT0gbnVs
bCkgJiYgdGhpcy5nZXRMb2dpbigpLnNob3VsZFVzZUV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmco
KSkgew0KLSAgICAgICAgICAgIC8vIGxldCB0aGUgdXNlciByZW1vdmUgdGhlIHByaXZsZWRnZXMN
Ci0gICAgICAgICAgICBnZXRFdmVudE1hbmFnZXIoKS5wcmVSZWxlYXNlRXhjbHVzaXZlQ29ubmVj
dGlvbih0aGlzLCB0aGlzLmdldFdyaXRlQ29ubmVjdGlvbigpKTsNCi0gICAgICAgICAgICAvL2xl
dCB0aGUgYWNjZXNzb3IgcmVsZWFzZSB0aGUgY29ubmVjdGlvbg0KLSAgICAgICAgICAgIHRoaXMu
Z2V0V3JpdGVDb25uZWN0aW9uKCkuZGVjcmVtZW50Q2FsbENvdW50KCk7DQotICAgICAgICAgICAg
Ly9tYWtlIHRoZSBhY2Nlc3NvciByZS1hY3F1aXJlIGEgbmV3IGNvbm5lY3Rpb24uICBUaGlzIHN1
cHBvcnRzIHRoZSBjYXNlDQotICAgICAgICAgICAgLy93aGVyZSBhIEpUQSB0cmFuc2FjdGlvbiB3
YXMgc3RhcnRlZCBzaW5jZSB0aGUgY2xpZW50IHNlc3Npb24gd2FzIGZpcnN0IGFjcXVpcmVkLg0K
LSAgICAgICAgICAgIHRoaXMuZ2V0V3JpdGVDb25uZWN0aW9uKCkuaW5jcmVtZW50Q2FsbENvdW50
KHRoaXMpOw0KLSAgICAgICAgICAgIC8vIGxldCB0aGUgdXNlciB1cGRhdGUgdGhlIGNvbm5lY3Rp
b24gd2l0aCByZXF1aXJlZCBwcml2bGVkZ2VzLg0KLSAgICAgICAgICAgIGdldEV2ZW50TWFuYWdl
cigpLnBvc3RBY3F1aXJlRXhjbHVzaXZlQ29ubmVjdGlvbih0aGlzLCB0aGlzLmdldFdyaXRlQ29u
bmVjdGlvbigpKTsNCi0gICAgICAgIH0NCi0NCi0gICAgICAgIC8vT25seSByZWxlYXNlZSBjb25u
ZWN0aW9uIHdoZW4gdHJhbnNhY3Rpb24gc3VjY2VlZHMuICANCi0gICAgICAgIC8vSWYgbm90LCBj
b25uZWN0aW9uIHdpbGwgYmUgcmVsZWFzZWQgaW4gcm9sbGJhY2suDQotICAgICAgICBzdXBlci5i
YXNpY0NvbW1pdFRyYW5zYWN0aW9uKCk7DQotICAgIH0NCi0NCi0gICAgLyoqDQotICAgICAqIElO
VEVSTkFMOg0KICAgICAgKiBPdmVycmlkZSB0byBhY3F1aXJlIHRoZSBjb25uZWN0aW9uIGZyb20g
dGhlIHBvb2wgYXQgdGhlIGxhc3QgbWludXRlDQogICAgICAqLw0KICAgICBwdWJsaWMgT2JqZWN0
IGV4ZWN1dGVDYWxsKENhbGwgY2FsbCwgQWJzdHJhY3RSZWNvcmQgdHJhbnNsYXRpb25Sb3csIERh
dGFiYXNlUXVlcnkgcXVlcnkpIHRocm93cyBEYXRhYmFzZUV4Y2VwdGlvbiB7DQpAQCAtMTU1LDEz
ICsxMDgsMzYgQEANCiAgICAgICogYWNjZXNzDQogICAgICAqLw0KICAgICBwdWJsaWMgdm9pZCBz
ZXRXcml0ZUNvbm5lY3Rpb24oQWNjZXNzb3IgYWNjZXNzb3IpIHsNCi0gICAgICAgIGlmIChnZXRM
b2dpbigpLnNob3VsZFVzZUV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcoKSkgew0KLSAgICAgICAg
ICAgIGlmIChhY2Nlc3NvciAhPSBudWxsKSB7DQotICAgICAgICAgICAgICAgIGFjY2Vzc29yLmlu
Y3JlbWVudENhbGxDb3VudCh0aGlzKTsvLyBsZXRzIGVuc3VyZSB0aGF0IFRvcExpbmsgZG9lcyBu
b3QgcmVsZWFzZSB0aGlzIGNvbm5lY3Rpb24uDQotICAgICAgICAgICAgfSBlbHNlIHsvL3RoZSBh
Y2Nlc3NvciBpcyBiZWluZyByZWxlYXNlZA0KLSAgICAgICAgICAgICAgICB0aGlzLmFjY2Vzc29y
LmRlY3JlbWVudENhbGxDb3VudCgpOy8vIGxldCB0aGUgYWNjZXNzb3IgcmVsYXNlIHRoZSBjb25u
ZWN0aW9uDQotICAgICAgICAgICAgfQ0KLSAgICAgICAgfQ0KICAgICAgICAgdGhpcy5hY2Nlc3Nv
ciA9IGFjY2Vzc29yOw0KICAgICB9DQorDQorICAgIC8qKgorICAgICAqIElOVEVSTkFMOgorICAg
ICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBpbiBjYXNlIGV4dGVybmFsQ29ubmVjdGlvblBvb2xp
bmcgaXMgdXNlZAorICAgICAqIHJpZ2h0IGFmdGVyIHRoZSBhY2Nlc3NvciBpcyBjb25uZWN0ZWQu
IAorICAgICAqIFVzZWQgYnkgdGhlIHNlc3Npb24gdG8gcmlzZSBhbiBhcHByb3ByaWF0ZSBldmVu
dC4KKyAgICAgKi8KKyAgIHB1YmxpYyB2b2lkIHBvc3RDb25uZWN0RXh0ZXJuYWxDb25uZWN0aW9u
KEFjY2Vzc29yIGFjY2Vzc29yKSB7DQorICAgICAgICBnZXRFdmVudE1hbmFnZXIoKS5wb3N0QWNx
dWlyZUV4Y2x1c2l2ZUNvbm5lY3Rpb24odGhpcywgYWNjZXNzb3IpOworICAgIH0NCisKKyAgIC8q
KgorICAgICogSU5URVJOQUw6CisgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgaW4gY2FzZSBl
eHRlcm5hbENvbm5lY3Rpb25Qb29saW5nIGlzIHVzZWQKKyAgICAqIHJpZ2h0IGJlZm9yZSB0aGUg
YWNjZXNzb3IgaXMgZGlzY29ubmVjdGVkLiAKKyAgICAqIFVzZWQgYnkgdGhlIHNlc3Npb24gdG8g
cmlzZSBhbiBhcHByb3ByaWF0ZSBldmVudC4KKyAgICAqLworICAgcHVibGljIHZvaWQgcHJlRGlz
Y29ubmVjdEV4dGVybmFsQ29ubmVjdGlvbihBY2Nlc3NvciBhY2Nlc3NvcikgeworICAgICAgICBn
ZXRFdmVudE1hbmFnZXIoKS5wcmVSZWxlYXNlRXhjbHVzaXZlQ29ubmVjdGlvbih0aGlzLCBhY2Nl
c3Nvcik7CisgICAgfQ0KKworICAgLyoqCisgICAgKiBJTlRFUk5BTDoKKyAgICAqIFRoaXMgbWV0
aG9kIGlzIGNhbGxlZCBpbiBjYXNlIGV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcgaXMgdXNlZC4K
KyAgICAqIElmIHJldHVybnMgdHJ1ZSwgYWNjZXNzb3IgdXNlZCBieSB0aGUgc2Vzc2lvbiBrZWVw
cyBpdHMKKyAgICAqIGNvbm5lY3Rpb24gb3BlbiB1bnRpbCByZWxlYXNlZCBieSB0aGUgc2Vzc2lv
bi4gCisgICAgKi8KKyAgIHB1YmxpYyBib29sZWFuIGlzRXhjbHVzaXZlQ29ubmVjdGlvblJlcXVp
cmVkKCkgeworICAgICAgICByZXR1cm4gdHJ1ZTsNCisgICAgfQ0KIH0NClwgTm8gbmV3bGluZSBh
dCBlbmQgb2YgZmlsZQ0KSW5kZXg6IGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3Jn
L2VjbGlwc2UvcGVyc2lzdGVuY2Uvc2Vzc2lvbnMvc2VydmVyL0NsaWVudFNlc3Npb24uamF2YQ0K
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PQ0KLS0tIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlw
c2UvcGVyc2lzdGVuY2Uvc2Vzc2lvbnMvc2VydmVyL0NsaWVudFNlc3Npb24uamF2YQkocmV2aXNp
b24gNzU1MSkNCisrKyBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNl
L3BlcnNpc3RlbmNlL3Nlc3Npb25zL3NlcnZlci9DbGllbnRTZXNzaW9uLmphdmEJKHdvcmtpbmcg
Y29weSkNCkBAIC01MjksNCArNTI5LDI0IEBADQogICAgICAgICAvL2J1ZyA0NjY4MjM0IC0tIHVz
ZWQgdG8gb25seSByZWxlYXNlIGNvbm5lY3Rpb25zIG9uIHNlcnZlciBzZXNzaW9ucyBidXQgc2hv
dWxkIGFsd2F5cyByZWxlYXNlCiAgICAgICAgIGdldFBhcmVudCgpLnJlbGVhc2VSZWFkQ29ubmVj
dGlvbihjb25uZWN0aW9uKTsKICAgICB9CisKKyAgICAvKioKKyAgICAgKiBJTlRFUk5BTDoKKyAg
ICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgaW4gY2FzZSBleHRlcm5hbENvbm5lY3Rpb25Qb29s
aW5nIGlzIHVzZWQKKyAgICAgKiByaWdodCBhZnRlciB0aGUgYWNjZXNzb3IgaXMgY29ubmVjdGVk
LiAKKyAgICAgKiBVc2VkIGJ5IHRoZSBzZXNzaW9uIHRvIHJpc2UgYW4gYXBwcm9wcmlhdGUgZXZl
bnQuCisgICAgICovCisgICAgcHVibGljIHZvaWQgcG9zdENvbm5lY3RFeHRlcm5hbENvbm5lY3Rp
b24oQWNjZXNzb3IgYWNjZXNzb3IpIHsKKyAgICAgICAgZ2V0RXZlbnRNYW5hZ2VyKCkucG9zdEFj
cXVpcmVDb25uZWN0aW9uKGFjY2Vzc29yKTsKKyAgICB9CisKKyAgICAvKioKKyAgICAgKiBJTlRF
Uk5BTDoKKyAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgaW4gY2FzZSBleHRlcm5hbENvbm5l
Y3Rpb25Qb29saW5nIGlzIHVzZWQKKyAgICAgKiByaWdodCBiZWZvcmUgdGhlIGFjY2Vzc29yIGlz
IGRpc2Nvbm5lY3RlZC4gCisgICAgICogVXNlZCBieSB0aGUgc2Vzc2lvbiB0byByaXNlIGFuIGFw
cHJvcHJpYXRlIGV2ZW50LgorICAgICAqLworICAgIHB1YmxpYyB2b2lkIHByZURpc2Nvbm5lY3RF
eHRlcm5hbENvbm5lY3Rpb24oQWNjZXNzb3IgYWNjZXNzb3IpIHsKKyAgICAgICAgZ2V0RXZlbnRN
YW5hZ2VyKCkucHJlUmVsZWFzZUNvbm5lY3Rpb24oYWNjZXNzb3IpOworICAgIH0KIH0KSW5kZXg6
IGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lzdGVuY2Uv
c2Vzc2lvbnMvc2VydmVyL1NlcnZlclNlc3Npb24uamF2YQ0KPT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0tIGZvdW5k
YXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lzdGVuY2Uvc2Vzc2lv
bnMvc2VydmVyL1NlcnZlclNlc3Npb24uamF2YQkocmV2aXNpb24gNzU1MSkNCisrKyBmb3VuZGF0
aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL3Nlc3Npb25z
L3NlcnZlci9TZXJ2ZXJTZXNzaW9uLmphdmEJKHdvcmtpbmcgY29weSkNCkBAIC0yNTAsNyArMjUw
LDEwIEBADQogICAgICAgICAgICAgQ29ubmVjdGlvblBvb2wgcG9vbCA9IChDb25uZWN0aW9uUG9v
bClnZXRDb25uZWN0aW9uUG9vbHMoKS5nZXQoY2xpZW50U2Vzc2lvbi5nZXRDb25uZWN0aW9uUG9s
aWN5KCkuZ2V0UG9vbE5hbWUoKSk7CiAgICAgICAgICAgICBBY2Nlc3NvciBjb25uZWN0aW9uID0g
cG9vbC5hY3F1aXJlQ29ubmVjdGlvbigpOwogICAgICAgICAgICAgY2xpZW50U2Vzc2lvbi5zZXRX
cml0ZUNvbm5lY3Rpb24oY29ubmVjdGlvbik7Ci0gICAgICAgICAgICBnZXRFdmVudE1hbmFnZXIo
KS5wb3N0QWNxdWlyZUNvbm5lY3Rpb24oY29ubmVjdGlvbik7CisgICAgICAgICAgICAvL2lmIHdl
IGFyZSB1c2luZyBleHRlcm5hbCBjb25uZWN0aW9uIHBvb2xpbmcgdGhlIGV2ZW50IHdpbGwgYmUg
dGhyb3duIHdoZW4gdGhlIGNvbm5lY3Rpb24gaXMgYWN0dWFsbHkgYWNxdWlyZWQKKyAgICAgICAg
ICAgIGlmKCFjb25uZWN0aW9uLnVzZXNFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCkpIHsKKyAg
ICAgICAgICAgICAgICBnZXRFdmVudE1hbmFnZXIoKS5wb3N0QWNxdWlyZUNvbm5lY3Rpb24oY29u
bmVjdGlvbik7CisgICAgICAgICAgICB9CiAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICBp
ZiAodGhpcy5tYXhOdW1iZXJPZk5vblBvb2xlZENvbm5lY3Rpb25zICE9IE5PX01BWCkgewogICAg
ICAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewpAQCAtMjY5LDcgKzI3Miw5IEBADQog
ICAgICAgICB9CiAgICAgICAgIGlmIChjbGllbnRTZXNzaW9uLmdldENvbm5lY3Rpb25Qb2xpY3ko
KS5zaG91bGRVc2VFeGNsdXNpdmVDb25uZWN0aW9uKCkpIHsKICAgICAgICAgICAgIC8vaWYgd2Ug
YXJlIHVzaW5nIGV4dGVybmFsIGNvbm5lY3Rpb24gcG9vbGluZyB0aGUgZXZlbnQgd2lsbCBiZSB0
aHJvd24gd2hlbiB0aGUgY29ubmVjdGlvbiBpcyBhY3R1YWxseSBhY3F1aXJlZAotICAgICAgICAg
ICAgZ2V0RXZlbnRNYW5hZ2VyKCkucG9zdEFjcXVpcmVFeGNsdXNpdmVDb25uZWN0aW9uKGNsaWVu
dFNlc3Npb24sIGNsaWVudFNlc3Npb24uZ2V0V3JpdGVDb25uZWN0aW9uKCkpOworICAgICAgICAg
ICAgaWYoIWNsaWVudFNlc3Npb24uZ2V0V3JpdGVDb25uZWN0aW9uKCkudXNlc0V4dGVybmFsQ29u
bmVjdGlvblBvb2xpbmcoKSkgeworICAgICAgICAgICAgICAgIGdldEV2ZW50TWFuYWdlcigpLnBv
c3RBY3F1aXJlRXhjbHVzaXZlQ29ubmVjdGlvbihjbGllbnRTZXNzaW9uLCBjbGllbnRTZXNzaW9u
LmdldFdyaXRlQ29ubmVjdGlvbigpKTsKKyAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgIH0K
IApAQCAtNjE4LDcgKzYyMywxMCBAQA0KICAgICBwdWJsaWMgdm9pZCByZWxlYXNlQ2xpZW50U2Vz
c2lvbihDbGllbnRTZXNzaW9uIGNsaWVudFNlc3Npb24pIHRocm93cyBEYXRhYmFzZUV4Y2VwdGlv
biB7CiAgICAgICAgIGlmIChjbGllbnRTZXNzaW9uLmdldENvbm5lY3Rpb25Qb2xpY3koKS5pc1Bv
b2xlZCgpKSB7CiAgICAgICAgICAgICBDb25uZWN0aW9uUG9vbCBwb29sID0gKENvbm5lY3Rpb25Q
b29sKWdldENvbm5lY3Rpb25Qb29scygpLmdldChjbGllbnRTZXNzaW9uLmdldENvbm5lY3Rpb25Q
b2xpY3koKS5nZXRQb29sTmFtZSgpKTsKLSAgICAgICAgICAgIGdldEV2ZW50TWFuYWdlcigpLnBy
ZVJlbGVhc2VDb25uZWN0aW9uKGNsaWVudFNlc3Npb24uZ2V0V3JpdGVDb25uZWN0aW9uKCkpOwor
ICAgICAgICAgICAgLy9pZiB3ZSBhcmUgdXNpbmcgZXh0ZXJuYWwgY29ubmVjdGlvbiBwb29saW5n
IHRoZSBldmVudCB3aWxsIGJlIHRocm93biByaWdodCBiZWZvcmUgdGhlIGNvbm5lY3Rpb24gY2xv
c2VzLgorICAgICAgICAgICAgaWYoIWNsaWVudFNlc3Npb24uZ2V0V3JpdGVDb25uZWN0aW9uKCku
dXNlc0V4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcoKSkgeworICAgICAgICAgICAgICAgIGdldEV2
ZW50TWFuYWdlcigpLnByZVJlbGVhc2VDb25uZWN0aW9uKGNsaWVudFNlc3Npb24uZ2V0V3JpdGVD
b25uZWN0aW9uKCkpOworICAgICAgICAgICAgfQogICAgICAgICAgICAgcG9vbC5yZWxlYXNlQ29u
bmVjdGlvbihjbGllbnRTZXNzaW9uLmdldFdyaXRlQ29ubmVjdGlvbigpKTsKICAgICAgICAgICAg
IGNsaWVudFNlc3Npb24uc2V0V3JpdGVDb25uZWN0aW9uKG51bGwpOwogICAgICAgICB9IGVsc2Ug
ewpAQCAtNjMyLDggKzY0MCwxMCBAQA0KICAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgICAg
ICBpZiAoY2xpZW50U2Vzc2lvbi5nZXRDb25uZWN0aW9uUG9saWN5KCkuc2hvdWxkVXNlRXhjbHVz
aXZlQ29ubmVjdGlvbigpKSB7Ci0gICAgICAgICAgICAvL2lmIHdlIGFyZSB1c2luZyBleHRlcm5h
bCBjb25uZWN0aW9uIHBvb2xpbmcgdGhlIGV2ZW50IHdpbGwgYmUgdGhyb3duIHdoZW4gdGhlIGNv
bm5lY3Rpb24gaXMgYWN0dWFsbHkgcmVsZWFzZWQKLSAgICAgICAgICAgIGdldEV2ZW50TWFuYWdl
cigpLnByZVJlbGVhc2VFeGNsdXNpdmVDb25uZWN0aW9uKGNsaWVudFNlc3Npb24sIGNsaWVudFNl
c3Npb24uZ2V0V3JpdGVDb25uZWN0aW9uKCkpOworICAgICAgICAgICAgLy9pZiB3ZSBhcmUgdXNp
bmcgZXh0ZXJuYWwgY29ubmVjdGlvbiBwb29saW5nIHRoZSBldmVudCB3aWxsIGJlIHRocm93biBy
aWdodCBiZWZvcmUgdGhlIGNvbm5lY3Rpb24gY2xvc2VzLgorICAgICAgICAgICAgaWYoIWNsaWVu
dFNlc3Npb24uZ2V0V3JpdGVDb25uZWN0aW9uKCkudXNlc0V4dGVybmFsQ29ubmVjdGlvblBvb2xp
bmcoKSkgeworICAgICAgICAgICAgICAgIGdldEV2ZW50TWFuYWdlcigpLnByZVJlbGVhc2VFeGNs
dXNpdmVDb25uZWN0aW9uKGNsaWVudFNlc3Npb24sIGNsaWVudFNlc3Npb24uZ2V0V3JpdGVDb25u
ZWN0aW9uKCkpOworICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgfQogCg==
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>86682</attachid>
            <date>2008-01-11 11:20:00 -0500</date>
            <delta_ts>2008-01-11 11:20:05 -0500</delta_ts>
            <desc>the revised patch, please ignore the previous one.</desc>
            <filename>214958_080111.patch</filename>
            <type>text/plain</type>
            <size>19781</size>
            <attacher name="Andrei Ilitchev">andrei.ilitchev</attacher>
            
              <data encoding="base64">SW5kZXg6IGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lz
dGVuY2UvaW50ZXJuYWwvZGF0YWJhc2VhY2Nlc3MvRGF0YXNvdXJjZUFjY2Vzc29yLmphdmENCj09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT0NCi0tLSBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNl
L3BlcnNpc3RlbmNlL2ludGVybmFsL2RhdGFiYXNlYWNjZXNzL0RhdGFzb3VyY2VBY2Nlc3Nvci5q
YXZhCShyZXZpc2lvbiA3NTUxKQ0KKysrIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMv
b3JnL2VjbGlwc2UvcGVyc2lzdGVuY2UvaW50ZXJuYWwvZGF0YWJhc2VhY2Nlc3MvRGF0YXNvdXJj
ZUFjY2Vzc29yLmphdmEJKHdvcmtpbmcgY29weSkNCkBAIC05Niw4ICs5NiwzMyBAQA0KICAgICAg
KiAgYWZ0ZXIgdHJhbnNhY3Rpb24gaXMgY29tcGxldGVkIHRoZSBjYWxsYmFjayBpcyBkaXNjYXJk
ZWQuCiAgICAgICovCiAgICAgcHJvdGVjdGVkIHRyYW5zaWVudCBTZXF1ZW5jaW5nQ2FsbGJhY2sg
c2VxdWVuY2luZ0NhbGxiYWNrOworICAgIAorICAgIC8qKgorICAgICAqICBVc2VkIG9ubHkgaW4g
ZXh0ZXJuYWxDb25uZWN0aW9uUG9vbGluZyBjYXNlLiBJbmRpY2F0ZXMgd2hpY2ggc2Vzc2lvbiBp
cyBjdXJyZW50bHkgdXNpbmcgY29ubmVjdGlvbi4KKyAgICAgKiAgQWxsb3dzIHRvIHJpc2UgYXBw
cm9wcmlhdGUgc2Vzc2lvbidzIGV2ZW50IHdoZW4gY29ubmVjdGlvbiBpcyBhbHJlYWR5L3N0aWxs
IGFsaXZlLgorICAgICAqICBFdmVudHMgd2lsbCBiZSByaXNlbiB3aGVuIENsaWVudFNlc3Npb24g
b3IgRGF0YWJhc2VTZXNzaW9uIGFjcXVpcmVzIGNvbm5lY3Rpb24gaW4gdGhlIGJlZ2lubmluZwor
ICAgICAqICBhbmQgcmVsZWFzZXMgY29ubmVjdGlvbiBpbiB0aGUgZW5kIG9mIHRyYW5zYWN0aW9u
IChpbiBhZnRlckNvbXBsZXRpb24gaW4ganRhIGNhc2UpLgorICAgICAqICBJbiBjYXNlIHRoZSBz
ZXNzaW9uIHJlcXVpcmVzIGV4Y2x1c2l2ZSBjb25uZWN0aW9uIChFeGNsdXNpdmVJc29sYXRlZENs
aWVudFNlc3Npb24pIHRoZSBldmVudHMKKyAgICAgKiAgd2lsbCBiZSByaXNlbiBldmVyeSB0aW1l
IHRoZSBzZXNzaW9uIGFjcXVpcmVzIG9yIHJlbGVhc2VzIGNvbm5lY3Rpb24gLQorICAgICAqICB3
aGljaCBpcyBhIHJhcmUgZXZlbnQgLSB0aGUgY29ubmVjdGlvbiBpcyBrZXB0IGZvciB0aGUgZHVy
YXRpb24gb2YganRhIHRyYW5zYWN0aW9uLAorICAgICAqICBhZnRlciBqdGEgdHJhbnNhY3Rpb24g
aXMgY29tcGxldGVkIHRoZSBuZXcgY29ubmVjdGlvbiBpcyBhY3F1aXJlZCBvbiBhIGZpcnN0IHF1
ZXJ5IGV4ZWN1dGlvbgorICAgICAqICBhbmQga2VwdCB1bnRpbCB0aGUgbmV4dCBiZWdpblRyYW5z
YWN0aW9uIGNhbGwuCisgICAgICogIEluIG5vbi1qdGEgY2FzZSB0aGUgY29ubmVjdGlvbiBpcyBh
Y3F1aXJlZCBmb3Igc2Vzc2lvbidzIGxpZmUgYW5kIHJlbGVhc2Ugb25seSBieSBzZXNzaW9uJ3Mg
cmVsZWFzZS4KKyAgICAgKiAgTm90ZSB0aGF0IHRoZSBhdHRyaWJ1dGUgaXMgbnVsbGlmaWVkIG9u
bHkgaW4gb25lIHBsYWNlIC0gYnkgY2xvc2VDb25uZWN0aW9uIG1ldGhvZC4KKyAgICAgKi8KKyAg
ICBwcm90ZWN0ZWQgdHJhbnNpZW50IEFic3RyYWN0U2Vzc2lvbiBjdXJyZW50U2Vzc2lvbjsKIAog
ICAgIC8qKgorICAgICAqICBJbmRpY2F0ZXMgdGhhdCBpc0luVHJhbnNhY3Rpb24gZmxhZyBpcyBh
Ym91dCB0byBjaGFuZ2UgZnJvbSBmYWxzZSB0byB0cnVlLgorICAgICAqLworICAgIHByb3RlY3Rl
ZCB0cmFuc2llbnQgYm9vbGVhbiBpc0JlZ2lubmluZ1RyYW5zYWN0aW9uOworCisgICAgLyoqCisg
ICAgICogIEluZGljYXRlcyB0aGF0IGlzSW5UcmFuc2FjdGlvbiBmbGFnIGlzIGFib3V0IHRvIGNo
YW5nZSBmcm9tIHRydWUgdG8gZmFsc2UKKyAgICAgKi8KKyAgICBwcm90ZWN0ZWQgdHJhbnNpZW50
IGJvb2xlYW4gaXNDb21wbGV0aW5nVHJhbnNhY3Rpb247CisKKyAgICAvKioKICAgICAgKiAgICBE
ZWZhdWx0IENvbnN0cnVjdG9yLgogICAgICAqLwogICAgIHB1YmxpYyBEYXRhc291cmNlQWNjZXNz
b3IoKSB7CkBAIC0xNDIsNyArMTY3LDcgQEANCiAgICAgfQogCiAgICAgLyoqCi0gICAgICogVGhp
cyBzaG91bGQgYmUgc2V0IHRvIGZhbHNlIGlmIGEgY29tbXVuaWNhdGlvbiBmYWlsdXJlIG9jY3Vy
cmVkIGR1cnJpbmcgYSBjYWxsIGV4ZWN1dGlvbi4gIAorICAgICAqIFRoaXMgc2hvdWxkIGJlIHNl
dCB0byBmYWxzZSBpZiBhIGNvbW11bmljYXRpb24gZmFpbHVyZSBvY2N1cnJlZCBkdXJpbmcgYSBj
YWxsIGV4ZWN1dGlvbi4gIAogICAgICAqIEluIHRoZSBjYXNlIG9mIGFuIGludmFsaWQgYWNjZXNz
b3IgdGhlIEFjY2Vzc29yIHdpbGwgbm90IGJlIHJldHVybmVkIHRvIHRoZSBwb29sLgogICAgICAq
LwogICAgIHB1YmxpYyB2b2lkIHNldElzVmFsaWQoYm9vbGVhbiBpc1ZhbGlkKXsKQEAgLTE1OCw3
ICsxODMsNyBAQA0KIAogICAgIC8qKgogICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIEFjY2Vz
c29yIGNhbiBjb250aW51ZSB0byBiZSB1c2VkLiAgVGhpcyB3aWxsIGJlIGZhbHNlIGlmIGEgY29t
bXVuaWNhdGlvbgotICAgICAqIGZhaWx1cmUgb2NjdXJyZWQgZHVycmluZyBhIGNhbGwgZXhlY3V0
aW9uLiAgSW4gdGhlIGNhc2Ugb2YgYW4gaW52YWxpZCBhY2Nlc3NvciB0aGUgQWNjZXNzb3IKKyAg
ICAgKiBmYWlsdXJlIG9jY3VycmVkIGR1cmluZyBhIGNhbGwgZXhlY3V0aW9uLiAgSW4gdGhlIGNh
c2Ugb2YgYW4gaW52YWxpZCBhY2Nlc3NvciB0aGUgQWNjZXNzb3IKICAgICAgKiB3aWxsIG5vdCBi
ZSByZXR1cm5lZCB0byB0aGUgcG9vbC4KICAgICAgKi8KICAgICBwdWJsaWMgYm9vbGVhbiBpc1Zh
bGlkKCl7CkBAIC0xODAsNiArMjA1LDkgQEANCiAgICAgICovCiAgICAgcHVibGljIHZvaWQgYmVn
aW5UcmFuc2FjdGlvbihBYnN0cmFjdFNlc3Npb24gc2Vzc2lvbikgdGhyb3dzIERhdGFiYXNlRXhj
ZXB0aW9uIHsKICAgICAgICAgaWYgKHVzZXNFeHRlcm5hbFRyYW5zYWN0aW9uQ29udHJvbGxlcigp
KSB7CisgICAgICAgICAgICBpZihzZXNzaW9uLmlzRXhjbHVzaXZlQ29ubmVjdGlvblJlcXVpcmVk
KCkgJiYgIWlzSW5UcmFuc2FjdGlvbigpICYmIHVzZXNFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5n
KCkpIHsKKyAgICAgICAgICAgICAgICBjbG9zZUNvbm5lY3Rpb24oKTsKKyAgICAgICAgICAgIH0K
ICAgICAgICAgICAgIHNldElzSW5UcmFuc2FjdGlvbih0cnVlKTsKICAgICAgICAgICAgIHJldHVy
bjsKICAgICAgICAgfQpAQCAtMTg4LDEwICsyMTYsMTIgQEANCiAKICAgICAgICAgdHJ5IHsKICAg
ICAgICAgICAgIHNlc3Npb24uc3RhcnRPcGVyYXRpb25Qcm9maWxlKFNlc3Npb25Qcm9maWxlci5U
UkFOU0FDVElPTik7CisgICAgICAgICAgICBpc0JlZ2lubmluZ1RyYW5zYWN0aW9uID0gdHJ1ZTsK
ICAgICAgICAgICAgIGluY3JlbWVudENhbGxDb3VudChzZXNzaW9uKTsKICAgICAgICAgICAgIGJh
c2ljQmVnaW5UcmFuc2FjdGlvbihzZXNzaW9uKTsKICAgICAgICAgICAgIHNldElzSW5UcmFuc2Fj
dGlvbih0cnVlKTsKICAgICAgICAgfSBmaW5hbGx5IHsKKyAgICAgICAgICAgIGlzQmVnaW5uaW5n
VHJhbnNhY3Rpb24gPSBmYWxzZTsKICAgICAgICAgICAgIGRlY3JlbWVudENhbGxDb3VudCgpOwog
ICAgICAgICAgICAgc2Vzc2lvbi5lbmRPcGVyYXRpb25Qcm9maWxlKFNlc3Npb25Qcm9maWxlci5U
UkFOU0FDVElPTik7CiAgICAgICAgIH0KQEAgLTIyMiw3ICsyNTIsNyBAQA0KICAgICAgICAgICAg
IHJldHVybjsKICAgICAgICAgfQogICAgICAgICBzZXRDYWxsQ291bnQoY291bnQgLSAxKTsKLSAg
ICAgICAgaWYgKHVzZXNFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCkgJiYgKCFpc0luVHJhbnNh
Y3Rpb24oKSkgJiYgKGNvdW50ID09IDEpKSB7CisgICAgICAgIGlmICh1c2VzRXh0ZXJuYWxDb25u
ZWN0aW9uUG9vbGluZygpICYmICghaXNJblRyYW5zYWN0aW9uKCkpICYmIChjdXJyZW50U2Vzc2lv
biA9PSBudWxsIHx8ICFjdXJyZW50U2Vzc2lvbi5pc0V4Y2x1c2l2ZUNvbm5lY3Rpb25SZXF1aXJl
ZCgpKSAmJiAoY291bnQgPT0gMSkpIHsKICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg
ICAgY2xvc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgICB9IGNhdGNoIChEYXRhYmFzZUV4Y2Vw
dGlvbiBpZ25vcmUpIHsKQEAgLTI1Niw2ICsyODYsMTYgQEANCiAgICAgICAgICAgICAgICAgLy8g
SWYgRXh0ZXJuYWxDb25uZWN0aW9uUG9vbGluZyBpcyB1c2VkLCB0aGUgY29ubmVjdGlvbiBjYW4g
YmUgcmUtZXN0YWJsaXNoZWQuCiAgICAgICAgICAgICAgICAgaWYgKHVzZXNFeHRlcm5hbENvbm5l
Y3Rpb25Qb29saW5nKCkpIHsKICAgICAgICAgICAgICAgICAgICAgcmVjb25uZWN0KHNlc3Npb24p
OworICAgICAgICAgICAgICAgICAgICAvLyBlaXRoZXIgdHJhbnNhY3Rpb24gaXMgc3RhcnRpbmcg
KHRoZSBtZXRob2QgaXMgY2FsbGVkIGZyb20gYmVnaW5UcmFuc2FjdGlvbiwgbm8gZXh0ZXJuYWxU
cmFuc2FjdGlvbkNvbnRyb2xsZXIgY2FzZSkKKyAgICAgICAgICAgICAgICAgICAgLy8gb3IgdGhl
IGNvbm5lY3Rpb24gaXMgcmVxdWlyZWQgZm9yIHRoZSBzZXNzaW9uIHdoaWNoIGlzCisgICAgICAg
ICAgICAgICAgICAgIC8vICAgZWl0aGVyIGluIHRyYW5zYWN0aW9uIGFscmVhZHkgKHdpbGwgaGFw
cGVuIGluIGV4dGVybmFsVHJhbnNhY3Rpb25Db250cm9sbGVyIGNhc2UpOworICAgICAgICAgICAg
ICAgICAgICAvLyAgIG9yIHJlcXVpcmVzIGV4Y2x1c2l2ZSBjb25uZWN0aW9uLgorICAgICAgICAg
ICAgICAgICAgICBpZihpc0JlZ2lubmluZ1RyYW5zYWN0aW9uIHx8IGlzSW5UcmFuc2FjdGlvbigp
IHx8IHNlc3Npb24uaXNFeGNsdXNpdmVDb25uZWN0aW9uUmVxdWlyZWQoKSkgeworICAgICAgICAg
ICAgICAgICAgICAgICAgc2Vzc2lvbi5wb3N0Q29ubmVjdEV4dGVybmFsQ29ubmVjdGlvbih0aGlz
KTsKKyAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTZXNzaW9uID0gc2Vzc2lvbjsKKyAg
ICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKGlzQ29tcGxldGluZ1RyYW5zYWN0aW9uKSB7Cisg
ICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U2Vzc2lvbiA9IHNlc3Npb247CisgICAgICAg
ICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg
ICAgICB0aHJvdyBEYXRhYmFzZUV4Y2VwdGlvbi5kYXRhYmFzZUFjY2Vzc29yTm90Q29ubmVjdGVk
KCk7CiAgICAgICAgICAgICAgICAgfQpAQCAtMjY0LDcgKzMwNCw3IEBADQogICAgIH0KIAogICAg
IC8qKgotICAgICAqIFJlc2V0IHN0YXRtZW50IGNvdW50LgorICAgICAqIFJlc2V0IHN0YXRlbWVu
dCBjb3VudC4KICAgICAgKi8KICAgICBwdWJsaWMgdm9pZCByZXNldFN0YXRtZW50c0NvdW50KCkg
ewogICAgICAgICByZWFkU3RhdGVtZW50c0NvdW50PTA7CkBAIC0zMTUsNiArMzU1LDggQEANCiAg
ICAgICAgICAgICBpZiAoIXNlc3Npb24uaXNTeW5jaHJvbml6ZWQoKSkgewogICAgICAgICAgICAg
ICAgIHNldElzSW5UcmFuc2FjdGlvbihmYWxzZSk7CiAgICAgICAgICAgICAgICAgaWYgKHVzZXNF
eHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCkpIHsKKyAgICAgICAgICAgICAgICAgICAgLy8gY2xv
c2VDb25uZWN0aW9uIG1ldGhvZCB1c2VzIGN1cnJlbnRTZXNzaW9uIGFuZCB0aGVuIHNldHMgaXQg
dG8gbnVsbC4KKyAgICAgICAgICAgICAgICAgICAgY3VycmVudFNlc3Npb24gPSBzZXNzaW9uOwog
ICAgICAgICAgICAgICAgICAgICBjbG9zZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgICAgICB9
CiAgICAgICAgICAgICB9CkBAIC0zMjUsNiArMzY3LDcgQEANCiAKICAgICAgICAgdHJ5IHsKICAg
ICAgICAgICAgIHNlc3Npb24uc3RhcnRPcGVyYXRpb25Qcm9maWxlKFNlc3Npb25Qcm9maWxlci5U
UkFOU0FDVElPTik7CisgICAgICAgICAgICBpc0NvbXBsZXRpbmdUcmFuc2FjdGlvbiA9IHRydWU7
CiAgICAgICAgICAgICBpbmNyZW1lbnRDYWxsQ291bnQoc2Vzc2lvbik7CiAgICAgICAgICAgICBi
YXNpY0NvbW1pdFRyYW5zYWN0aW9uKHNlc3Npb24pOwogCkBAIC0zMzMsNiArMzc2LDcgQEANCiAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICBzZXRJc0luVHJhbnNhY3Rpb24oZmFsc2UpOwogICAg
ICAgICB9IGZpbmFsbHkgeworICAgICAgICAgICAgaXNDb21wbGV0aW5nVHJhbnNhY3Rpb24gPSBm
YWxzZTsKICAgICAgICAgICAgIHNlcXVlbmNpbmdDYWxsYmFjayA9IG51bGw7CiAgICAgICAgICAg
ICBkZWNyZW1lbnRDYWxsQ291bnQoKTsKICAgICAgICAgICAgIHNlc3Npb24uZW5kT3BlcmF0aW9u
UHJvZmlsZShTZXNzaW9uUHJvZmlsZXIuVFJBTlNBQ1RJT04pOwpAQCAtNDI3LDYgKzQ3MSw5IEBA
DQogICAgICAgICB0cnkgewogICAgICAgICAgICAgaWYgKGdldERhdGFzb3VyY2VDb25uZWN0aW9u
KCkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgIGlmIChpc0RhdGFzb3VyY2VDb25uZWN0ZWQo
KSkgeworICAgICAgICAgICAgICAgICAgICBpZihjdXJyZW50U2Vzc2lvbiAhPSBudWxsKSB7Cisg
ICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U2Vzc2lvbi5wcmVEaXNjb25uZWN0RXh0ZXJu
YWxDb25uZWN0aW9uKHRoaXMpOworICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg
ICAgICAgIGNsb3NlRGF0YXNvdXJjZUNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgICAgICB9CiAg
ICAgICAgICAgICAgICAgc2V0RGF0YXNvdXJjZUNvbm5lY3Rpb24obnVsbCk7CkBAIC00MzQsNiAr
NDgxLDggQEANCiAgICAgICAgIH0gY2F0Y2ggKERhdGFiYXNlRXhjZXB0aW9uIGV4Y2VwdGlvbikg
ewogICAgICAgICAgICAgLy8gSWdub3JlCiAgICAgICAgICAgICBzZXREYXRhc291cmNlQ29ubmVj
dGlvbihudWxsKTsKKyAgICAgICAgfSBmaW5hbGx5IHsKKyAgICAgICAgICAgIGN1cnJlbnRTZXNz
aW9uID0gbnVsbDsKICAgICAgICAgfQogICAgIH0KIApAQCAtNTc0LDYgKzYyMyw4IEBADQogICAg
ICAgICAgICAgaWYgKCFzZXNzaW9uLmlzU3luY2hyb25pemVkKCkpIHsKICAgICAgICAgICAgICAg
ICBzZXRJc0luVHJhbnNhY3Rpb24oZmFsc2UpOwogICAgICAgICAgICAgICAgIGlmICh1c2VzRXh0
ZXJuYWxDb25uZWN0aW9uUG9vbGluZygpKSB7CisgICAgICAgICAgICAgICAgICAgIC8vIGNsb3Nl
Q29ubmVjdGlvbiBtZXRob2QgdXNlcyBjdXJyZW50U2Vzc2lvbiBhbmQgdGhlbiBzZXRzIGl0IHRv
IG51bGwuCisgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTZXNzaW9uID0gc2Vzc2lvbjsKICAg
ICAgICAgICAgICAgICAgICAgY2xvc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgfQog
ICAgICAgICAgICAgfQpAQCAtNTg0LDEwICs2MzUsMTIgQEANCiAKICAgICAgICAgdHJ5IHsKICAg
ICAgICAgICAgIHNlc3Npb24uc3RhcnRPcGVyYXRpb25Qcm9maWxlKFNlc3Npb25Qcm9maWxlci5U
UkFOU0FDVElPTik7CisgICAgICAgICAgICBpc0NvbXBsZXRpbmdUcmFuc2FjdGlvbiA9IHRydWU7
CiAgICAgICAgICAgICBpbmNyZW1lbnRDYWxsQ291bnQoc2Vzc2lvbik7CiAgICAgICAgICAgICBi
YXNpY1JvbGxiYWNrVHJhbnNhY3Rpb24oc2Vzc2lvbik7CiAgICAgICAgIH0gZmluYWxseSB7CiAg
ICAgICAgICAgICBzZXRJc0luVHJhbnNhY3Rpb24oZmFsc2UpOworICAgICAgICAgICAgaXNDb21w
bGV0aW5nVHJhbnNhY3Rpb24gPSBmYWxzZTsKICAgICAgICAgICAgIHNlcXVlbmNpbmdDYWxsYmFj
ayA9IG51bGw7CiAgICAgICAgICAgICBkZWNyZW1lbnRDYWxsQ291bnQoKTsKICAgICAgICAgICAg
IHNlc3Npb24uZW5kT3BlcmF0aW9uUHJvZmlsZShTZXNzaW9uUHJvZmlsZXIuVFJBTlNBQ1RJT04p
OwpJbmRleDogZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJz
aXN0ZW5jZS9pbnRlcm5hbC9zZXNzaW9ucy9BYnN0cmFjdFNlc3Npb24uamF2YQ0KPT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PQ0KLS0tIGZvdW5kYXRpb24vZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lz
dGVuY2UvaW50ZXJuYWwvc2Vzc2lvbnMvQWJzdHJhY3RTZXNzaW9uLmphdmEJKHJldmlzaW9uIDc1
NTEpDQorKysgZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJz
aXN0ZW5jZS9pbnRlcm5hbC9zZXNzaW9ucy9BYnN0cmFjdFNlc3Npb24uamF2YQkod29ya2luZyBj
b3B5KQ0KQEAgLTM1MDEsNCArMzUwMSwzMiBAQA0KICAgICAgICAgICAgIH0KICAgICAgICAgfQog
ICAgIH0KKworICAgIC8qKgorICAgICAqIElOVEVSTkFMOgorICAgICAqIFRoaXMgbWV0aG9kIGlz
IGNhbGxlZCBpbiBjYXNlIGV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcgaXMgdXNlZAorICAgICAq
IHJpZ2h0IGFmdGVyIHRoZSBhY2Nlc3NvciBpcyBjb25uZWN0ZWQuIAorICAgICAqIFVzZWQgYnkg
dGhlIHNlc3Npb24gdG8gcmlzZSBhbiBhcHByb3ByaWF0ZSBldmVudC4KKyAgICAgKi8KKyAgICBw
dWJsaWMgdm9pZCBwb3N0Q29ubmVjdEV4dGVybmFsQ29ubmVjdGlvbihBY2Nlc3NvciBhY2Nlc3Nv
cikgeworICAgIH0KKworICAgIC8qKgorICAgICAqIElOVEVSTkFMOgorICAgICAqIFRoaXMgbWV0
aG9kIGlzIGNhbGxlZCBpbiBjYXNlIGV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcgaXMgdXNlZAor
ICAgICAqIHJpZ2h0IGJlZm9yZSB0aGUgYWNjZXNzb3IgaXMgZGlzY29ubmVjdGVkLiAKKyAgICAg
KiBVc2VkIGJ5IHRoZSBzZXNzaW9uIHRvIHJpc2UgYW4gYXBwcm9wcmlhdGUgZXZlbnQuCisgICAg
ICovCisgICAgcHVibGljIHZvaWQgcHJlRGlzY29ubmVjdEV4dGVybmFsQ29ubmVjdGlvbihBY2Nl
c3NvciBhY2Nlc3NvcikgeworICAgIH0KKyAgICAKKyAgICAvKioKKyAgICAgKiBJTlRFUk5BTDoK
KyAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgaW4gY2FzZSBleHRlcm5hbENvbm5lY3Rpb25Q
b29saW5nIGlzIHVzZWQuCisgICAgICogSWYgcmV0dXJucyB0cnVlLCBhY2Nlc3NvciB1c2VkIGJ5
IHRoZSBzZXNzaW9uIGtlZXBzIGl0cworICAgICAqIGNvbm5lY3Rpb24gb3BlbiB1bnRpbCByZWxl
YXNlZCBieSB0aGUgc2Vzc2lvbi4gCisgICAgICovCisgICAgcHVibGljIGJvb2xlYW4gaXNFeGNs
dXNpdmVDb25uZWN0aW9uUmVxdWlyZWQoKSB7CisgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICB9
CiB9CkluZGV4OiBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3Bl
cnNpc3RlbmNlL2ludGVybmFsL3Nlc3Npb25zL0V4Y2x1c2l2ZUlzb2xhdGVkQ2xpZW50U2Vzc2lv
bi5qYXZhDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09DQotLS0gZm91bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9v
cmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9pbnRlcm5hbC9zZXNzaW9ucy9FeGNsdXNpdmVJc29sYXRl
ZENsaWVudFNlc3Npb24uamF2YQkocmV2aXNpb24gNzU1MSkNCisrKyBmb3VuZGF0aW9uL2VjbGlw
c2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL2ludGVybmFsL3Nlc3Npb25z
L0V4Y2x1c2l2ZUlzb2xhdGVkQ2xpZW50U2Vzc2lvbi5qYXZhCSh3b3JraW5nIGNvcHkpDQpAQCAt
MjQsNTMgKzI0LDYgQEANCiANCiAgICAgLyoqDQogICAgICAqIElOVEVSTkFMOg0KLSAgICAgKiBU
aGlzIGlzIGludGVybmFsIHRvIHRoZSB1bml0IG9mIHdvcmsgYW5kIHNob3VsZCBuZXZlciBiZSBj
YWxsZWQgb3RoZXJ3aXNlLg0KLSAgICAgKi8NCi0gICAgcHVibGljIHZvaWQgYmFzaWNCZWdpblRy
YW5zYWN0aW9uKCkgew0KLSAgICAgICAgLy9pZiB3ZSBhcmUgYmVnaW5pbmcgdGhlIHRyYW5zYWN0
aW9uIHRoZW4gd2Ugc2hvdWxkIGFsbG93IHRoZSBhY2Nlc3NvciB0bw0KLSAgICAgICAgLy9yZWxl
YXNlIHRoZSBjb25uZWN0aW9uIGFuZCByZS1hY3F1aXJlIGEgbmV3IG9uZS4gIFRoaXMgaXMgdXNl
ZnVsbCBpbg0KLSAgICAgICAgLy90aGUgY2FzZSBvZiBleHRlcm5hbCBjb25uZWN0aW9uIHBvb2xz
IHdpdGggSlRBLg0KLSAgICAgICAgaWYgKCh0aGlzLmdldFdyaXRlQ29ubmVjdGlvbigpICE9IG51
bGwpICYmIHRoaXMuZ2V0TG9naW4oKS5zaG91bGRVc2VFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5n
KCkpIHsNCi0gICAgICAgICAgICAvLyBsZXQgdGhlIHVzZXIgcmVtb3ZlIHRoZSBwcml2bGVkZ2Vz
DQotICAgICAgICAgICAgZ2V0RXZlbnRNYW5hZ2VyKCkucHJlUmVsZWFzZUV4Y2x1c2l2ZUNvbm5l
Y3Rpb24odGhpcywgdGhpcy5nZXRXcml0ZUNvbm5lY3Rpb24oKSk7DQotICAgICAgICAgICAgLy9s
ZXQgdGhlIGFjY2Vzc29yIHJlbGVhc2UgdGhlIGNvbm5lY3Rpb24NCi0gICAgICAgICAgICB0aGlz
LmdldFdyaXRlQ29ubmVjdGlvbigpLmRlY3JlbWVudENhbGxDb3VudCgpOw0KLSAgICAgICAgICAg
IC8vbWFrZSB0aGUgYWNjZXNzb3IgcmUtYWNxdWlyZSBhIG5ldyBjb25uZWN0aW9uLiAgVGhpcyBz
dXBwb3J0cyB0aGUgY2FzZQ0KLSAgICAgICAgICAgIC8vd2hlcmUgYSBKVEEgdHJhbnNhY3Rpb24g
d2FzIHN0YXJ0ZWQgc2luY2UgdGhlIGNsaWVudCBzZXNzaW9uIHdhcyBmaXJzdCBhY3F1aXJlZC4N
Ci0gICAgICAgICAgICB0aGlzLmdldFdyaXRlQ29ubmVjdGlvbigpLmluY3JlbWVudENhbGxDb3Vu
dCh0aGlzKTsNCi0gICAgICAgICAgICAvLyBsZXQgdGhlIHVzZXIgdXBkYXRlIHRoZSBjb25uZWN0
aW9uIHdpdGggcmVxdWlyZWQgcHJpdmxlZGdlcy4NCi0gICAgICAgICAgICBnZXRFdmVudE1hbmFn
ZXIoKS5wb3N0QWNxdWlyZUV4Y2x1c2l2ZUNvbm5lY3Rpb24odGhpcywgdGhpcy5nZXRXcml0ZUNv
bm5lY3Rpb24oKSk7DQotICAgICAgICB9DQotICAgICAgICBzdXBlci5iYXNpY0JlZ2luVHJhbnNh
Y3Rpb24oKTsNCi0gICAgfQ0KLQ0KLSAgICAvKioNCi0gICAgICogSU5URVJOQUw6DQotICAgICAq
IFRoaXMgaXMgaW50ZXJuYWwgdG8gdGhlIHVuaXQgb2Ygd29yayBhbmQgc2hvdWxkIG5vdCBiZSBj
YWxsZWQgb3RoZXJ3aXNlLg0KLSAgICAgKi8NCi0gICAgcHVibGljIHZvaWQgYmFzaWNDb21taXRU
cmFuc2FjdGlvbigpIHsNCi0gICAgICAgIC8vaWYgd2UgYXJlIGVuZGluZyB0aGUgdHJhbnNhY3Rp
b24gdGhlbiB3ZSBzaG91bGQgYWxsb3cgdGhlIGFjY2Vzc29yIHRvDQotICAgICAgICAvL3JlbGVh
c2UgdGhlIGNvbm5lY3Rpb24gYW5kIHJlLWFjcXVpcmUgYSBuZXcgb25lLiAgVGhpcyBpcyB1c2Vm
dWxsIGluDQotICAgICAgICAvL3RoZSBjYXNlIG9mIGV4dGVybmFsIGNvbm5lY3Rpb24gcG9vbHMg
d2l0aCBKVEEuDQotICAgICAgICBpZiAoKHRoaXMuZ2V0V3JpdGVDb25uZWN0aW9uKCkgIT0gbnVs
bCkgJiYgdGhpcy5nZXRMb2dpbigpLnNob3VsZFVzZUV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmco
KSkgew0KLSAgICAgICAgICAgIC8vIGxldCB0aGUgdXNlciByZW1vdmUgdGhlIHByaXZsZWRnZXMN
Ci0gICAgICAgICAgICBnZXRFdmVudE1hbmFnZXIoKS5wcmVSZWxlYXNlRXhjbHVzaXZlQ29ubmVj
dGlvbih0aGlzLCB0aGlzLmdldFdyaXRlQ29ubmVjdGlvbigpKTsNCi0gICAgICAgICAgICAvL2xl
dCB0aGUgYWNjZXNzb3IgcmVsZWFzZSB0aGUgY29ubmVjdGlvbg0KLSAgICAgICAgICAgIHRoaXMu
Z2V0V3JpdGVDb25uZWN0aW9uKCkuZGVjcmVtZW50Q2FsbENvdW50KCk7DQotICAgICAgICAgICAg
Ly9tYWtlIHRoZSBhY2Nlc3NvciByZS1hY3F1aXJlIGEgbmV3IGNvbm5lY3Rpb24uICBUaGlzIHN1
cHBvcnRzIHRoZSBjYXNlDQotICAgICAgICAgICAgLy93aGVyZSBhIEpUQSB0cmFuc2FjdGlvbiB3
YXMgc3RhcnRlZCBzaW5jZSB0aGUgY2xpZW50IHNlc3Npb24gd2FzIGZpcnN0IGFjcXVpcmVkLg0K
LSAgICAgICAgICAgIHRoaXMuZ2V0V3JpdGVDb25uZWN0aW9uKCkuaW5jcmVtZW50Q2FsbENvdW50
KHRoaXMpOw0KLSAgICAgICAgICAgIC8vIGxldCB0aGUgdXNlciB1cGRhdGUgdGhlIGNvbm5lY3Rp
b24gd2l0aCByZXF1aXJlZCBwcml2bGVkZ2VzLg0KLSAgICAgICAgICAgIGdldEV2ZW50TWFuYWdl
cigpLnBvc3RBY3F1aXJlRXhjbHVzaXZlQ29ubmVjdGlvbih0aGlzLCB0aGlzLmdldFdyaXRlQ29u
bmVjdGlvbigpKTsNCi0gICAgICAgIH0NCi0NCi0gICAgICAgIC8vT25seSByZWxlYXNlZSBjb25u
ZWN0aW9uIHdoZW4gdHJhbnNhY3Rpb24gc3VjY2VlZHMuICANCi0gICAgICAgIC8vSWYgbm90LCBj
b25uZWN0aW9uIHdpbGwgYmUgcmVsZWFzZWQgaW4gcm9sbGJhY2suDQotICAgICAgICBzdXBlci5i
YXNpY0NvbW1pdFRyYW5zYWN0aW9uKCk7DQotICAgIH0NCi0NCi0gICAgLyoqDQotICAgICAqIElO
VEVSTkFMOg0KICAgICAgKiBPdmVycmlkZSB0byBhY3F1aXJlIHRoZSBjb25uZWN0aW9uIGZyb20g
dGhlIHBvb2wgYXQgdGhlIGxhc3QgbWludXRlDQogICAgICAqLw0KICAgICBwdWJsaWMgT2JqZWN0
IGV4ZWN1dGVDYWxsKENhbGwgY2FsbCwgQWJzdHJhY3RSZWNvcmQgdHJhbnNsYXRpb25Sb3csIERh
dGFiYXNlUXVlcnkgcXVlcnkpIHRocm93cyBEYXRhYmFzZUV4Y2VwdGlvbiB7DQpAQCAtMTU1LDEz
ICsxMDgsNiBAQA0KICAgICAgKiBhY2Nlc3MNCiAgICAgICovDQogICAgIHB1YmxpYyB2b2lkIHNl
dFdyaXRlQ29ubmVjdGlvbihBY2Nlc3NvciBhY2Nlc3Nvcikgew0KLSAgICAgICAgaWYgKGdldExv
Z2luKCkuc2hvdWxkVXNlRXh0ZXJuYWxDb25uZWN0aW9uUG9vbGluZygpKSB7DQotICAgICAgICAg
ICAgaWYgKGFjY2Vzc29yICE9IG51bGwpIHsNCi0gICAgICAgICAgICAgICAgYWNjZXNzb3IuaW5j
cmVtZW50Q2FsbENvdW50KHRoaXMpOy8vIGxldHMgZW5zdXJlIHRoYXQgVG9wTGluayBkb2VzIG5v
dCByZWxlYXNlIHRoaXMgY29ubmVjdGlvbi4NCi0gICAgICAgICAgICB9IGVsc2Ugey8vdGhlIGFj
Y2Vzc29yIGlzIGJlaW5nIHJlbGVhc2VkDQotICAgICAgICAgICAgICAgIHRoaXMuYWNjZXNzb3Iu
ZGVjcmVtZW50Q2FsbENvdW50KCk7Ly8gbGV0IHRoZSBhY2Nlc3NvciByZWxhc2UgdGhlIGNvbm5l
Y3Rpb24NCi0gICAgICAgICAgICB9DQotICAgICAgICB9DQogICAgICAgICB0aGlzLmFjY2Vzc29y
ID0gYWNjZXNzb3I7DQogICAgIH0NCiB9DQpcIE5vIG5ld2xpbmUgYXQgZW5kIG9mIGZpbGUNCklu
ZGV4OiBmb3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3Rl
bmNlL3Nlc3Npb25zL3NlcnZlci9DbGllbnRTZXNzaW9uLmphdmENCj09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBm
b3VuZGF0aW9uL2VjbGlwc2VsaW5rLmNvcmUvc3JjL29yZy9lY2xpcHNlL3BlcnNpc3RlbmNlL3Nl
c3Npb25zL3NlcnZlci9DbGllbnRTZXNzaW9uLmphdmEJKHJldmlzaW9uIDc1NTEpDQorKysgZm91
bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9zZXNz
aW9ucy9zZXJ2ZXIvQ2xpZW50U2Vzc2lvbi5qYXZhCSh3b3JraW5nIGNvcHkpDQpAQCAtNTI5LDQg
KzUyOSw0NCBAQA0KICAgICAgICAgLy9idWcgNDY2ODIzNCAtLSB1c2VkIHRvIG9ubHkgcmVsZWFz
ZSBjb25uZWN0aW9ucyBvbiBzZXJ2ZXIgc2Vzc2lvbnMgYnV0IHNob3VsZCBhbHdheXMgcmVsZWFz
ZQogICAgICAgICBnZXRQYXJlbnQoKS5yZWxlYXNlUmVhZENvbm5lY3Rpb24oY29ubmVjdGlvbik7
CiAgICAgfQorCisgICAgLyoqCisgICAgICogSU5URVJOQUw6CisgICAgICogVGhpcyBtZXRob2Qg
aXMgY2FsbGVkIGluIGNhc2UgZXh0ZXJuYWxDb25uZWN0aW9uUG9vbGluZyBpcyB1c2VkCisgICAg
ICogcmlnaHQgYWZ0ZXIgdGhlIGFjY2Vzc29yIGlzIGNvbm5lY3RlZC4gCisgICAgICogVXNlZCBi
eSB0aGUgc2Vzc2lvbiB0byByaXNlIGFuIGFwcHJvcHJpYXRlIGV2ZW50LgorICAgICAqLworICAg
IHB1YmxpYyB2b2lkIHBvc3RDb25uZWN0RXh0ZXJuYWxDb25uZWN0aW9uKEFjY2Vzc29yIGFjY2Vz
c29yKSB7CisgICAgICAgIGlmIChnZXRDb25uZWN0aW9uUG9saWN5KCkuaXNQb29sZWQoKSkgewor
ICAgICAgICAgICAgZ2V0RXZlbnRNYW5hZ2VyKCkucG9zdEFjcXVpcmVDb25uZWN0aW9uKGFjY2Vz
c29yKTsKKyAgICAgICAgfQorICAgICAgICBpZiAoZ2V0Q29ubmVjdGlvblBvbGljeSgpLnNob3Vs
ZFVzZUV4Y2x1c2l2ZUNvbm5lY3Rpb24oKSkgeworICAgICAgICAgICAgZ2V0RXZlbnRNYW5hZ2Vy
KCkucG9zdEFjcXVpcmVFeGNsdXNpdmVDb25uZWN0aW9uKHRoaXMsIGFjY2Vzc29yKTsKKyAgICAg
ICAgfQorICAgIH0KKworICAgIC8qKgorICAgICAqIElOVEVSTkFMOgorICAgICAqIFRoaXMgbWV0
aG9kIGlzIGNhbGxlZCBpbiBjYXNlIGV4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcgaXMgdXNlZAor
ICAgICAqIHJpZ2h0IGJlZm9yZSB0aGUgYWNjZXNzb3IgaXMgZGlzY29ubmVjdGVkLiAKKyAgICAg
KiBVc2VkIGJ5IHRoZSBzZXNzaW9uIHRvIHJpc2UgYW4gYXBwcm9wcmlhdGUgZXZlbnQuCisgICAg
ICovCisgICAgcHVibGljIHZvaWQgcHJlRGlzY29ubmVjdEV4dGVybmFsQ29ubmVjdGlvbihBY2Nl
c3NvciBhY2Nlc3NvcikgeworICAgICAgICBpZiAoZ2V0Q29ubmVjdGlvblBvbGljeSgpLmlzUG9v
bGVkKCkpIHsKKyAgICAgICAgICAgIGdldEV2ZW50TWFuYWdlcigpLnByZVJlbGVhc2VDb25uZWN0
aW9uKGFjY2Vzc29yKTsKKyAgICAgICAgfQorICAgICAgICBpZiAoZ2V0Q29ubmVjdGlvblBvbGlj
eSgpLnNob3VsZFVzZUV4Y2x1c2l2ZUNvbm5lY3Rpb24oKSkgeworICAgICAgICAgICAgZ2V0RXZl
bnRNYW5hZ2VyKCkucHJlUmVsZWFzZUV4Y2x1c2l2ZUNvbm5lY3Rpb24odGhpcywgYWNjZXNzb3Ip
OworICAgICAgICB9CisgICAgfQorICAgIAorICAgIC8qKgorICAgICAqIElOVEVSTkFMOgorICAg
ICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBpbiBjYXNlIGV4dGVybmFsQ29ubmVjdGlvblBvb2xp
bmcgaXMgdXNlZC4KKyAgICAgKiBJZiByZXR1cm5zIHRydWUsIGFjY2Vzc29yIHVzZWQgYnkgdGhl
IHNlc3Npb24ga2VlcHMgaXRzCisgICAgICogY29ubmVjdGlvbiBvcGVuIHVudGlsIHJlbGVhc2Vk
IGJ5IHRoZSBzZXNzaW9uLiAKKyAgICAgKi8KKyAgICBwdWJsaWMgYm9vbGVhbiBpc0V4Y2x1c2l2
ZUNvbm5lY3Rpb25SZXF1aXJlZCgpIHsKKyAgICAgICAgcmV0dXJuIGdldENvbm5lY3Rpb25Qb2xp
Y3koKS5zaG91bGRVc2VFeGNsdXNpdmVDb25uZWN0aW9uKCk7CisgICAgfQogfQpJbmRleDogZm91
bmRhdGlvbi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9zZXNz
aW9ucy9zZXJ2ZXIvU2VydmVyU2Vzc2lvbi5qYXZhDQo9PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLS0gZm91bmRhdGlv
bi9lY2xpcHNlbGluay5jb3JlL3NyYy9vcmcvZWNsaXBzZS9wZXJzaXN0ZW5jZS9zZXNzaW9ucy9z
ZXJ2ZXIvU2VydmVyU2Vzc2lvbi5qYXZhCShyZXZpc2lvbiA3NTUxKQ0KKysrIGZvdW5kYXRpb24v
ZWNsaXBzZWxpbmsuY29yZS9zcmMvb3JnL2VjbGlwc2UvcGVyc2lzdGVuY2Uvc2Vzc2lvbnMvc2Vy
dmVyL1NlcnZlclNlc3Npb24uamF2YQkod29ya2luZyBjb3B5KQ0KQEAgLTI1MCw3ICsyNTAsMTMg
QEANCiAgICAgICAgICAgICBDb25uZWN0aW9uUG9vbCBwb29sID0gKENvbm5lY3Rpb25Qb29sKWdl
dENvbm5lY3Rpb25Qb29scygpLmdldChjbGllbnRTZXNzaW9uLmdldENvbm5lY3Rpb25Qb2xpY3ko
KS5nZXRQb29sTmFtZSgpKTsKICAgICAgICAgICAgIEFjY2Vzc29yIGNvbm5lY3Rpb24gPSBwb29s
LmFjcXVpcmVDb25uZWN0aW9uKCk7CiAgICAgICAgICAgICBjbGllbnRTZXNzaW9uLnNldFdyaXRl
Q29ubmVjdGlvbihjb25uZWN0aW9uKTsKLSAgICAgICAgICAgIGdldEV2ZW50TWFuYWdlcigpLnBv
c3RBY3F1aXJlQ29ubmVjdGlvbihjb25uZWN0aW9uKTsKKyAgICAgICAgICAgIC8vaWYgd2UgYXJl
IHVzaW5nIGV4dGVybmFsIGNvbm5lY3Rpb24gcG9vbGluZyB0aGUgZXZlbnQgd2lsbCBiZSB0aHJv
d24gd2hlbiB0aGUgY29ubmVjdGlvbiBpcyBhY3R1YWxseSBhY3F1aXJlZAorICAgICAgICAgICAg
aWYoIWNvbm5lY3Rpb24udXNlc0V4dGVybmFsQ29ubmVjdGlvblBvb2xpbmcoKSkgeworICAgICAg
ICAgICAgICAgIGdldEV2ZW50TWFuYWdlcigpLnBvc3RBY3F1aXJlQ29ubmVjdGlvbihjb25uZWN0
aW9uKTsKKyAgICAgICAgICAgICAgICBpZiAoY2xpZW50U2Vzc2lvbi5nZXRDb25uZWN0aW9uUG9s
aWN5KCkuc2hvdWxkVXNlRXhjbHVzaXZlQ29ubmVjdGlvbigpKSB7CisgICAgICAgICAgICAgICAg
ICAgIGdldEV2ZW50TWFuYWdlcigpLnBvc3RBY3F1aXJlRXhjbHVzaXZlQ29ubmVjdGlvbihjbGll
bnRTZXNzaW9uLCBjbGllbnRTZXNzaW9uLmdldFdyaXRlQ29ubmVjdGlvbigpKTsKKyAgICAgICAg
ICAgICAgICB9CisgICAgICAgICAgICB9CiAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICBp
ZiAodGhpcy5tYXhOdW1iZXJPZk5vblBvb2xlZENvbm5lY3Rpb25zICE9IE5PX01BWCkgewogICAg
ICAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewpAQCAtMjY2LDExICsyNzIsMTMgQEAN
CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBjbGllbnRTZXNzaW9uLnNldFdyaXRlQ29ubmVj
dGlvbihjbGllbnRTZXNzaW9uLmdldExvZ2luKCkuYnVpbGRBY2Nlc3NvcigpKTsKICAgICAgICAg
ICAgIGNsaWVudFNlc3Npb24uY29ubmVjdCgpOworICAgICAgICAgICAgaWYgKGNsaWVudFNlc3Np
b24uZ2V0Q29ubmVjdGlvblBvbGljeSgpLnNob3VsZFVzZUV4Y2x1c2l2ZUNvbm5lY3Rpb24oKSkg
eworICAgICAgICAgICAgICAgIC8vaWYgd2UgYXJlIHVzaW5nIGV4dGVybmFsIGNvbm5lY3Rpb24g
cG9vbGluZyB0aGUgZXZlbnQgd2lsbCBiZSB0aHJvd24gd2hlbiB0aGUgY29ubmVjdGlvbiBpcyBh
Y3R1YWxseSBhY3F1aXJlZAorICAgICAgICAgICAgICAgIGlmKCFjbGllbnRTZXNzaW9uLmdldFdy
aXRlQ29ubmVjdGlvbigpLnVzZXNFeHRlcm5hbENvbm5lY3Rpb25Qb29saW5nKCkpIHsKKyAgICAg
ICAgICAgICAgICAgICAgZ2V0RXZlbnRNYW5hZ2VyKCkucG9zdEFjcXVpcmVFeGNsdXNpdmVDb25u
ZWN0aW9uKGNsaWVudFNlc3Npb24sIGNsaWVudFNlc3Npb24uZ2V0V3JpdGVDb25uZWN0aW9uKCkp
OworICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgIH0KICAgICAgICAgfQotICAgICAgICBp
ZiAoY2xpZW50U2Vzc2lvbi5nZXRDb25uZWN0aW9uUG9saWN5KCkuc2hvdWxkVXNlRXhjbHVzaXZl
Q29ubmVjdGlvbigpKSB7Ci0gICAgICAgICAgICAvL2lmIHdlIGFyZSB1c2luZyBleHRlcm5hbCBj
b25uZWN0aW9uIHBvb2xpbmcgdGhlIGV2ZW50IHdpbGwgYmUgdGhyb3duIHdoZW4gdGhlIGNvbm5l
Y3Rpb24gaXMgYWN0dWFsbHkgYWNxdWlyZWQKLSAgICAgICAgICAgIGdldEV2ZW50TWFuYWdlcigp
LnBvc3RBY3F1aXJlRXhjbHVzaXZlQ29ubmVjdGlvbihjbGllbnRTZXNzaW9uLCBjbGllbnRTZXNz
aW9uLmdldFdyaXRlQ29ubmVjdGlvbigpKTsKLSAgICAgICAgfQogICAgIH0KIAogICAgIC8qKgpA
QCAtNjE4LDEwICs2MjYsMjIgQEANCiAgICAgcHVibGljIHZvaWQgcmVsZWFzZUNsaWVudFNlc3Np
b24oQ2xpZW50U2Vzc2lvbiBjbGllbnRTZXNzaW9uKSB0aHJvd3MgRGF0YWJhc2VFeGNlcHRpb24g
ewogICAgICAgICBpZiAoY2xpZW50U2Vzc2lvbi5nZXRDb25uZWN0aW9uUG9saWN5KCkuaXNQb29s
ZWQoKSkgewogICAgICAgICAgICAgQ29ubmVjdGlvblBvb2wgcG9vbCA9IChDb25uZWN0aW9uUG9v
bClnZXRDb25uZWN0aW9uUG9vbHMoKS5nZXQoY2xpZW50U2Vzc2lvbi5nZXRDb25uZWN0aW9uUG9s
aWN5KCkuZ2V0UG9vbE5hbWUoKSk7Ci0gICAgICAgICAgICBnZXRFdmVudE1hbmFnZXIoKS5wcmVS
ZWxlYXNlQ29ubmVjdGlvbihjbGllbnRTZXNzaW9uLmdldFdyaXRlQ29ubmVjdGlvbigpKTsKKyAg
ICAgICAgICAgIC8vaWYgd2UgYXJlIHVzaW5nIGV4dGVybmFsIGNvbm5lY3Rpb24gcG9vbGluZyB0
aGUgZXZlbnQgaXMgdGhyb3duIHJpZ2h0IGJlZm9yZSB0aGUgY29ubmVjdGlvbiBjbG9zZXMuCisg
ICAgICAgICAgICBpZighY2xpZW50U2Vzc2lvbi5nZXRXcml0ZUNvbm5lY3Rpb24oKS51c2VzRXh0
ZXJuYWxDb25uZWN0aW9uUG9vbGluZygpKSB7CisgICAgICAgICAgICAgICAgZ2V0RXZlbnRNYW5h
Z2VyKCkucHJlUmVsZWFzZUNvbm5lY3Rpb24oY2xpZW50U2Vzc2lvbi5nZXRXcml0ZUNvbm5lY3Rp
b24oKSk7CisgICAgICAgICAgICAgICAgaWYgKGNsaWVudFNlc3Npb24uZ2V0Q29ubmVjdGlvblBv
bGljeSgpLnNob3VsZFVzZUV4Y2x1c2l2ZUNvbm5lY3Rpb24oKSkgeworICAgICAgICAgICAgICAg
ICAgICBnZXRFdmVudE1hbmFnZXIoKS5wcmVSZWxlYXNlRXhjbHVzaXZlQ29ubmVjdGlvbihjbGll
bnRTZXNzaW9uLCBjbGllbnRTZXNzaW9uLmdldFdyaXRlQ29ubmVjdGlvbigpKTsKKyAgICAgICAg
ICAgICAgICB9CisgICAgICAgICAgICB9CiAgICAgICAgICAgICBwb29sLnJlbGVhc2VDb25uZWN0
aW9uKGNsaWVudFNlc3Npb24uZ2V0V3JpdGVDb25uZWN0aW9uKCkpOwogICAgICAgICAgICAgY2xp
ZW50U2Vzc2lvbi5zZXRXcml0ZUNvbm5lY3Rpb24obnVsbCk7CiAgICAgICAgIH0gZWxzZSB7Cisg
ICAgICAgICAgICBpZiAoY2xpZW50U2Vzc2lvbi5nZXRDb25uZWN0aW9uUG9saWN5KCkuc2hvdWxk
VXNlRXhjbHVzaXZlQ29ubmVjdGlvbigpKSB7CisgICAgICAgICAgICAgICAgLy9pZiB3ZSBhcmUg
dXNpbmcgZXh0ZXJuYWwgY29ubmVjdGlvbiBwb29saW5nIHRoZSBldmVudCBpcyB0aHJvd24gcmln
aHQgYmVmb3JlIHRoZSBjb25uZWN0aW9uIGNsb3Nlcy4KKyAgICAgICAgICAgICAgICBpZighY2xp
ZW50U2Vzc2lvbi5nZXRXcml0ZUNvbm5lY3Rpb24oKS51c2VzRXh0ZXJuYWxDb25uZWN0aW9uUG9v
bGluZygpKSB7CisgICAgICAgICAgICAgICAgICAgIGdldEV2ZW50TWFuYWdlcigpLnByZVJlbGVh
c2VFeGNsdXNpdmVDb25uZWN0aW9uKGNsaWVudFNlc3Npb24sIGNsaWVudFNlc3Npb24uZ2V0V3Jp
dGVDb25uZWN0aW9uKCkpOworICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgIH0KICAgICAg
ICAgICAgIGNsaWVudFNlc3Npb24uZGlzY29ubmVjdCgpOwogICAgICAgICAgICAgY2xpZW50U2Vz
c2lvbi5zZXRXcml0ZUNvbm5lY3Rpb24obnVsbCk7CiAgICAgICAgICAgICBpZiAodGhpcy5tYXhO
dW1iZXJPZk5vblBvb2xlZENvbm5lY3Rpb25zICE9IE5PX01BWCkgewpAQCAtNjMxLDEwICs2NTEs
NiBAQA0KICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KLSAgICAg
ICAgaWYgKGNsaWVudFNlc3Npb24uZ2V0Q29ubmVjdGlvblBvbGljeSgpLnNob3VsZFVzZUV4Y2x1
c2l2ZUNvbm5lY3Rpb24oKSkgewotICAgICAgICAgICAgLy9pZiB3ZSBhcmUgdXNpbmcgZXh0ZXJu
YWwgY29ubmVjdGlvbiBwb29saW5nIHRoZSBldmVudCB3aWxsIGJlIHRocm93biB3aGVuIHRoZSBj
b25uZWN0aW9uIGlzIGFjdHVhbGx5IHJlbGVhc2VkCi0gICAgICAgICAgICBnZXRFdmVudE1hbmFn
ZXIoKS5wcmVSZWxlYXNlRXhjbHVzaXZlQ29ubmVjdGlvbihjbGllbnRTZXNzaW9uLCBjbGllbnRT
ZXNzaW9uLmdldFdyaXRlQ29ubmVjdGlvbigpKTsKLSAgICAgICAgfQogICAgIH0KIAogICAgIC8q
Kgo=
</data>

          </attachment>
      

    </bug>

</bugzilla>